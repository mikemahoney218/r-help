From @@h|mk@poor @end|ng |rom gm@||@com  Wed Jun  1 07:54:21 2022
From: @@h|mk@poor @end|ng |rom gm@||@com (Ashim Kapoor)
Date: Wed, 1 Jun 2022 11:24:21 +0530
Subject: [R] R_LIBS var needed to be set after upgrade to R 4.2.2
Message-ID: <CAC8=1eppHfgnZkhE2tS_ko3Db0DNSMcs0fbYR++nYNsWqMLpvQ@mail.gmail.com>

Dear All,

I upgraded to R 4.2.2 on Debian 10 today.

The R shell incantation worked fine and all libraries would load but,
I needed to point the R_LIBS variable to
/usr/local/lib/R/site-library/ in order for the R --vanilla < myfile.R
incantation to find the libraries.

May I ask, why was this ? I never needed to do this on any previous
upgrade to R.

Many thanks,
Ashim


From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Wed Jun  1 10:35:48 2022
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Wed, 1 Jun 2022 10:35:48 +0200
Subject: [R] R_LIBS var needed to be set after upgrade to R 4.2.2
In-Reply-To: <CAC8=1eppHfgnZkhE2tS_ko3Db0DNSMcs0fbYR++nYNsWqMLpvQ@mail.gmail.com>
References: <CAC8=1eppHfgnZkhE2tS_ko3Db0DNSMcs0fbYR++nYNsWqMLpvQ@mail.gmail.com>
Message-ID: <25239.9444.688970.964168@stat.math.ethz.ch>

>>>>> Ashim Kapoor 
>>>>>     on Wed, 1 Jun 2022 11:24:21 +0530 writes:

    > Dear All,

> I upgraded to R 4.2.2  on Debian 10 today.

Well, I assume you mean R 4.2.0 .. at least that one exists.

    > The R shell incantation worked fine and all libraries would load but,
    > I needed to point the R_LIBS variable to
    > /usr/local/lib/R/site-library/ in order for the R --vanilla < myfile.R
    > incantation to find the libraries.

you mean other installed *packages*

    > May I ask, why was this ? I never needed to do this on any previous
    > upgrade to R.

Well,  for me, the     R --vanilla   form also only sees the
29 (14 "base" + 15 "Recommended") packages that come with R.

Debian (& Ubuntu etc)  have used a similar setup where the
default {R-level}  .libPaths() has contained three libraries,
via

R_LIBS_SITE=${R_LIBS_SITE-'/usr/local/lib/R/site-library:/usr/lib/R/site-library:/usr/lib/R/library'}

see

   https://cloud.r-project.org/bin/linux/debian/#pathways-to-r-packages

also for much more.
Note (also from the above CRAN page
      https://cloud.r-project.org/bin/linux/debian/
   [ Remember "menu"  "Binaries" -> "Linux" -> "Debian" ]
   
The good thing about the Debian (and derivatives) setup is that
it also separates (as I do) the  "packages that come with R" in
one library (= /usr/lib/R/library) from packages that are
installed differently.


    > Many thanks,
    > Ashim


From @@h|mk@poor @end|ng |rom gm@||@com  Wed Jun  1 11:00:58 2022
From: @@h|mk@poor @end|ng |rom gm@||@com (Ashim Kapoor)
Date: Wed, 1 Jun 2022 14:30:58 +0530
Subject: [R] R_LIBS var needed to be set after upgrade to R 4.2.2
In-Reply-To: <25239.9444.688970.964168@stat.math.ethz.ch>
References: <CAC8=1eppHfgnZkhE2tS_ko3Db0DNSMcs0fbYR++nYNsWqMLpvQ@mail.gmail.com>
 <25239.9444.688970.964168@stat.math.ethz.ch>
Message-ID: <CAC8=1er4BwEJ0zousw0rC-g75G8HviGxqZ+1jB0heD2379x-wA@mail.gmail.com>

Dear Sir,

> > I upgraded to R 4.2.2  on Debian 10 today.
>
> Well, I assume you mean R 4.2.0 .. at least that one exists.

My bad, yes I made a typo. I did mean R 4.2.0.

>     > The R shell incantation worked fine and all libraries would load but,
>     > I needed to point the R_LIBS variable to
>     > /usr/local/lib/R/site-library/ in order for the R --vanilla < myfile.R
>     > incantation to find the libraries.
>
> you mean other installed *packages*
>
>     > May I ask, why was this ? I never needed to do this on any previous
>     > upgrade to R.
>
> Well,  for me, the     R --vanilla   form also only sees the
> 29 (14 "base" + 15 "Recommended") packages that come with R.

Has this ALWAYS been the case for you ? Even with prior versions of R ?

> Debian (& Ubuntu etc)  have used a similar setup where the
> default {R-level}  .libPaths() has contained three libraries,
> via
>
> R_LIBS_SITE=${R_LIBS_SITE-'/usr/local/lib/R/site-library:/usr/lib/R/site-library:/usr/lib/R/library'}
>
> see
>
>    https://cloud.r-project.org/bin/linux/debian/#pathways-to-r-packages
>
> also for much more.
> Note (also from the above CRAN page
>       https://cloud.r-project.org/bin/linux/debian/
>    [ Remember "menu"  "Binaries" -> "Linux" -> "Debian" ]
>
> The good thing about the Debian (and derivatives) setup is that
> it also separates (as I do) the  "packages that come with R" in
> one library (= /usr/lib/R/library) from packages that are
> installed differently.

My confusion is : Earlier R --vanilla incantation was working fine,
even without my intervening and
adding to R_LIBS. That is why I was confused.

My main query is : Is there anything special to R 4.2.0 which needs
R_LIBS to be setup seperately?

THAT is my query.

Best Regards,
Ashim


From j@de@shod@@ m@iii@g oii googiem@ii@com  Wed Jun  1 10:12:25 2022
From: j@de@shod@@ m@iii@g oii googiem@ii@com (j@de@shod@@ m@iii@g oii googiem@ii@com)
Date: Wed, 1 Jun 2022 09:12:25 +0100
Subject: [R] mgcv: concurvity/ auto-correlation in GAM predicting deaths
 from weather time series with distributed lag
Message-ID: <CANg3_k_YSkTKLgSkWkEuxuFe_3tOaC0vBxBAUSt7KucbGZ5h=w@mail.gmail.com>

Hello all,

First posting to this list, hope you can bear with me - not a
statistician here... (my field is public health).

Have tried posting on Cross Validated (stack exchange) but it seems
that there are not many people there working with GAMs. Have been
doing quite a bit of reading/ googling, but am being halted by my lack
of knowledge of matrix algebra (not a mathematician here either) and
don't know anyone who works with GAMs, so this list really is my last
hope in my struggles.

My question is: what should I be more worried about in a time series
GAM with distributed lag? Highly significant k-index for time terms or
high concurvity between time and explanatory variables? Or are both
two sides of the same coin?  And what should/ can I do about either?
For description of the problem, please see below.

I am running various GAM models (using mgcv) to estimate daily number
of deaths from daily time series of several weather variables such as
temperature, humidity and precipitation among others. The primary aim
is to get more insight into the (complex) relationship between these
variables (rather than pure prediction performance). The models have
distributed lag terms because deaths may occur over several days
following exposure. Modelling lag is based on the  example in Simon
Wood's 2017 book, p. 349 (and the gamair package documentation
(https://cran.r-project.org/web/packages/gamair/gamair.pdf, p. 54)).
Code is listed at the bottom of this post. Data (as well as R script,
and model output files) are available on Github:
https://github.com/JadeShodan/heat-mortality/tree/main/social_media_posts/r_help/concurvity

Model m1 below is relatively simple with just maximum temperature,
total daily precipitation and lag, and default k for (year) and
seasonality (doy = day of year). (Heap is a categorical variable
coding for the fact that all deaths for which no specific date was
known (data is from a low income country with problematic death
registration) were assigned to the 15th day of the month in which the
deaths were thought to have occurred. This categorical variable has
169 levels (0 for all non-heaping days, 1 for the first heaping day, 2
for the second ? 168 for the final heaping day over the 14 year
period).

When I run this model:

m1 <- gam(deaths~te(year, doy, bs = c("cr", "cc")) + heap +
                                te(temp_max, lag, k=c(10,4))+
te(precip_daily_total, lag, k=c(10,4)),
                                data = dat, family = nb, method =
'REML', select = TRUE, knots = knots)

I get a highly significant k-index for (year, doy) - not sure why I am
getting NAs either:

                                         k'               edf
k-index   p-value
te(year,doy)                     19.00000 13.17462    0.93     <2e-16 ***
te(temp_max,lag)            39.00000  4.23584      NA      NA
te(precip_daily_total,lag) 36.00000  0.00929      NA      NA

Concurvity between (year, doy) and (temp_max, lag) is very high too (0.83):

                                              para
te(year,doy)      te(temp_max,lag)      te(precip_daily_total,lag)
para                                 1.000000e+00     2.437000e-31
    0.3324461                 0.6666532
te(year,doy)                      2.149940e-31     1.000000e+00
0.8285219                  0.5601749
te(temp_max,lag)            3.329829e-01      8.268335e-01
1.0000000                  0.5861324
te(precip_daily_total,lag) 6.666532e-01      5.601749e-01
0.5975987                 1.0000000

To reduce significance of p for the k-index, increasing k helps
somewhat, but only up to a point:

m2 <- gam(deaths~te(year, doy, bs = c("cr", "cc"), k=c(7, 20)) + heap
+ te(temp_max, lag, k=c(10,4))+ te(precip_daily_total, lag,
k=c(10,4)), data = dat, family = nb, method = 'REML', select = TRUE,
knots = knots)

                                                k'      edf
k-index p-value
te(year,doy)                     132.0000  24.9619    0.94    0.01 **
te(temp_max,lag)            39.0000   3.8914      NA      NA
te(precip_daily_total,lag)  36.0000   0.0128      NA      NA

However, with increasing k for (year, doy) concurvity for (temp_max,
lag) and (precipitation, lag) with  (year, doy) increases even more
(which also happens in models with predictors other than temp_max):

                                           para
te(year,doy)           te(temp_max,lag)     te(precip_daily_total,lag)
para                                   1.000000e+00    3.260062e-32
    0.3235908                  0.6666532
te(year,doy)                       4.530791e-32     1.000000e+00
 0.9206842                  0.7261335
te(temp_max,lag)              3.298028e-01     9.157306e-01
1.0000000                  0.5831089
te(precip_daily_total,lag)   6.666532e-01     7.261335e-01
0.5805672                  1.0000000

Is this happening because of the lag term? Should I be worried about
this? Is there anything I can do about this? I saw lecture slides by
Simon Wood where he advises that the functions sp.vcov and gam.vcomp
can help shine light on the problem, but I don't know how to interpret
the output from these functions.

In models with more explanatory weather variables I also have high
concurvity - over 0.80 - between e.g. lagged humidity and lagged
temperature. Both variables are of interest (in fact the purpose of
this study) and should not be dropped, but I guess that's another
story. I posted about it on Cross Validated:
https://stats.stackexchange.com/questions/576688/assessing-impact-of-concurvity-in-gam-using-time-series-of-weather-and-mortality
and any thoughts about this are welcome too.

Posting output from summary() and gam.check() would make this post too
long, so instead I've put text files on Github:

output model 1:
https://github.com/JadeShodan/heat-mortality/blob/main/social_media_posts/r_help/concurvity/model_m1_output.txt

ouput model 2:

https://github.com/JadeShodan/heat-mortality/blob/main/social_media_posts/r_help/concurvity/model_m2_output.txt


I'd be very grateful for any help anyone might be able to offer!

Jade


###############################  Model code  ################################
library(readr)
library(mgcv)

df <- read_rds("data_crossvalidated_post2.rds")
# data available on github: https://github.com/JadeShodan/heat-mortality

# Create matrices for lagged weather variables (6 day lags)
lagard <- function(x,n.lag=7) {
n <- length(x); X <- matrix(NA,n,n.lag)
for (i in 1:n.lag) X[i:n,i] <- x[i:n-i+1]
X
}

dat <- list(lag=matrix(0:6,nrow(df),7,byrow=TRUE),
deaths=df$deaths_total, doy=df$doy, year = df$year, month = df$month,
weekday = df$weekday, week = df$week, monthday = df$monthday, time =
df$time, heap=df$heap, heap_bin = df$heap_bin)
dat$temp_max <- lagard(df$temp_max)
dat$precip_daily_total <- lagard( df$precip_daily_total)


knots <- list(doy=c(0.5, 366.5)) # set knots for cyclic spline for doy

m1 <- gam(deaths~te(year, doy, bs = c("cr", "cc")) + heap +
                                te(temp_max, lag, k=c(10,4))+
                                te(precip_daily_total, lag, k=c(10,4)),
                               data = dat, family = nb, method =
'REML', select = TRUE, knots =knots)

# now increase k for (year, doy)
m2 <- gam(deaths~te(year, doy, bs = c("cr", "cc"), k=c(7, 20)) + heap +
                                te(temp_max, lag, k=c(10,4))+
                                te(precip_daily_total, lag, k=c(10,4)),
                                data = dat, family = nb, method =
'REML', select = TRUE, knots = knots)

gam.check(m1, rep=1000)
gam.check(m2, rep=1000)
concurvity(m1, full=FALSE)$worst
concurvity(m2, full=FALSE)$worst


From m@rek@h|@v@c @end|ng |rom gm@||@com  Wed Jun  1 13:33:25 2022
From: m@rek@h|@v@c @end|ng |rom gm@||@com (Marek Hlavac)
Date: Wed, 1 Jun 2022 13:33:25 +0200
Subject: [R] Calling stargazer() with do.call() in R 4.2.0
In-Reply-To: <CAMTWbJgxm7DmWr-agv5HLyg15wj_qu0055XQ0fLAe=q9hMzjTw@mail.gmail.com>
References: <CAMTWbJiVBXDA5ABx2zGOueDk3OOPLCvWcjqJhY21tCSm5YWHMw@mail.gmail.com>
 <af234546-216c-52d0-060e-d6dbc47dbc7c@statistik.tu-dortmund.de>
 <CAMTWbJjb+XDS2zL18vScsYJa8+B5SRQdiEaSGUVbatWFYoburQ@mail.gmail.com>
 <CAPcHnpSe8Q0C5cMPfbVtJe8rZeHtYTpG16otS4=zYqjtraVEmA@mail.gmail.com>
 <CAMTWbJgxm7DmWr-agv5HLyg15wj_qu0055XQ0fLAe=q9hMzjTw@mail.gmail.com>
Message-ID: <CAP7TaCovurYpGXQ0M2KdMhansUfLq_xFPrgh-5hh8S3E1ixbdA@mail.gmail.com>

Thanks, everyone, will work on it this weekend.

On Sun, May 29, 2022 at 6:52 AM Arne Henningsen
<arne.henningsen at gmail.com> wrote:
>
> Dear Andrew
>
> Thanks a lot for investigating the problem and for suggesting a
> solution and a workaround! I have asked the maintainer of the
> 'stargazer' package to fix the problem. Until then, we can use the
> workaround that you suggested.
>
> Best regards,
> Arne
>
> On Sat, 28 May 2022 at 23:13, Andrew Simmons <akwsimmo at gmail.com> wrote:
> >
> > Hello,
> >
> >
> > I don't have the slightest clue what stargazer is supposed to be
> > doing, but it seems as though it's trying to create names for the ...
> > list using:
> > object.names.string <- deparse(substitute(list(...)))
> >
> > It makes an error in assuming that the return value of deparse will be
> > a character string. For stargazer(res), object.names.string becomes:
> > "list(res)"
> >
> > while for do.call(stargazer, list(res)), object.names.string becomes:
> > [1] "list(structure(list(coefficients = c(`(Intercept)` =
> > 6.41594246095523, "
> > [2] "UrbanPop = 0.0209346588197249), residuals = c(Alabama =
> > 5.56984732750071, "
> > [3] "Alaska = 2.57919391569797, Arizona = 0.009284833466778, Arkansas
> > = 1.33732459805853, "
> > [4] "California = 0.679003586449805, Colorado = -0.148845848893771, "
> > [5] "Connecticut = -4.72791119007405, Delaware = -2.02323789597542, "
> > [6] "Florida = 7.30928483346678, Georgia = 9.72797800986128, Hawaii =
> > -2.8535191429924, "
> > [7] "Idaho = -4.94641403722037, Illinois = 2.2464808570076, Indiana =
> > -0.576695284237348, "
> > [8] "Iowa = -5.40921801367955, Kansas = -1.79762994305707, Kentucky =
> > 2.19545528041907, "
> > [9] "Louisiana = 7.60237005694293, Maine = -5.3836100607612, Maryland
> > = 3.4814353981232, "
> >  [ reached getOption("max.print") -- omitted 110 entries ]
> >
> > perhaps the package maintainer could change the line from:
> > object.names.string <- deparse(substitute(list(...)))
> > to:
> > object.names.string <- deparse1(substitute(list(...)), collapse = "")
> >
> > or you could change your code to:
> > do.call(stargazer, alist(res))
> >
> > please note that using alist instead of list is only a workaround, you
> > should still let the package maintainer know of this bug. If the
> > maintainer asks, this is what I used to get the strings above:
> > fun <- \(...) deparse(substitute(list(...)))
> > data("USArrests")
> > res <- lm( Murder ~ UrbanPop, data = USArrests)
> > fun(res)
> > print(do.call("fun", list(res)), max = 9)
> >
> > On Sat, May 28, 2022 at 4:41 PM Arne Henningsen
> > <arne.henningsen at gmail.com> wrote:
> > >
> > > On Sat, 28 May 2022 at 01:21, Uwe Ligges
> > > <ligges at statistik.tu-dortmund.de> wrote:
> > > > On 27.05.2022 17:29, Arne Henningsen wrote:
> > > >> Dear all  (cc Marek = maintainer of the stargazer package)
> > > >>
> > > >> We use do.call() to automatically create many LaTeX tables with
> > > >> stargazer but after upgrading to R 4.2.0, this no longer works. I
> > > >> illustrate this with a simple reproducible example:
> > > >>
> > > >> R> data("USArrests")
> > > >> R> res <- lm( Murder ~ UrbanPop, data = USArrests )
> > > >> R> library(stargazer)
> > > >> R> stargazer(res)  # works as expected
> > > >> R> do.call( stargazer, list(res) )
> > > >> Error in if (is.na(s)) { : the condition has length > 1
> > > >
> > > > Without looking at the code in detail: The line aboce suggests the code
> > > > needs an any():    if(any(is.na(x))) raher than if(is.na(x)).
> > >
> > > Yes, this is likely a problem in the 'stargazer' package.
> > >
> > > ... but why does the problem occur when using do.call( stargazer, )
> > > but the problem does *not* occur when using stargazer() directly?
> > >
> > > Best regards,
> > > Arne
> > >
> > > >> Any ideas what we can do so that the last command works with R 4.2.0?
> > > >>
> > > >> /Arne
> > >
> > > --
> > > Arne Henningsen
> > > http://www.arne-henningsen.name
> > >
> > > ______________________________________________
> > > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > > https://stat.ethz.ch/mailman/listinfo/r-help
> > > PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> > > and provide commented, minimal, self-contained, reproducible code.
>
>
>
> --
> Arne Henningsen
> http://www.arne-henningsen.name


From jeroen @end|ng |rom berke|ey@edu  Wed Jun  1 14:05:51 2022
From: jeroen @end|ng |rom berke|ey@edu (Jeroen Ooms)
Date: Wed, 1 Jun 2022 14:05:51 +0200
Subject: [R] R_LIBS var needed to be set after upgrade to R 4.2.2
In-Reply-To: <CAC8=1er4BwEJ0zousw0rC-g75G8HviGxqZ+1jB0heD2379x-wA@mail.gmail.com>
References: <CAC8=1eppHfgnZkhE2tS_ko3Db0DNSMcs0fbYR++nYNsWqMLpvQ@mail.gmail.com>
 <25239.9444.688970.964168@stat.math.ethz.ch>
 <CAC8=1er4BwEJ0zousw0rC-g75G8HviGxqZ+1jB0heD2379x-wA@mail.gmail.com>
Message-ID: <CABFfbXu4eLha3rUaLFk=8N2c2xEO2B+abHSnZOePfCrCwEMuxg@mail.gmail.com>

On Wed, Jun 1, 2022 at 11:02 AM Ashim Kapoor <ashimkapoor at gmail.com> wrote:
>
> My confusion is : Earlier R --vanilla incantation was working fine,
> even without my intervening and
> adding to R_LIBS. That is why I was confused.
>
> My main query is : Is there anything special to R 4.2.0 which needs
> R_LIBS to be setup seperately?

I was hit by this problem as well a few weeks ago. You may get a more
detailed answer in r-sig-debian or from Dirk directly, but from what I
understood, this is now expected behavior: indeed if you start R
--vanilla then /usr/local/lib is no longer included in the library
path.

The reason is that R-core made a change in 4.2.0 to pre-set values for
R_LIBS_USER and R_LIBS_SITE in Renviron [1] which would take
precedence over the proper distro defaults (that include
/usr/local/lib) as configured by the r-base deb/rpm packages. To
mitigate the problem the the r-base deb package moved the appropriate
R_LIBS_USER and R_LIBS_SITE definitions into Renviron.site, which
takes precedence over Renviron. However a side effect of this solution
is that Renviron.site is ignored in --vanilla mode. At least this is
my best understanding of the problem.

[1] https://cran.r-project.org/doc/manuals/r-release/NEWS.html


From bh@@k@r@ko|k@t@ @end|ng |rom gm@||@com  Wed Jun  1 18:22:14 2022
From: bh@@k@r@ko|k@t@ @end|ng |rom gm@||@com (Bhaskar Mitra)
Date: Wed, 1 Jun 2022 09:22:14 -0700
Subject: [R] Request for some help about uncertainty analysis using
 bootstrap approach
In-Reply-To: <dae65208-0756-29b9-fbe0-e4c080c95a83@sapo.pt>
References: <CAEGXkYUo49WaArytfRffwxg87ZxNph1w-RNaZyi0Dgna=YKTbg@mail.gmail.com>
 <dae65208-0756-29b9-fbe0-e4c080c95a83@sapo.pt>
Message-ID: <CAEGXkYUnzyNMFuM527X9HGj2d0hJwb1F7M5TLj1oqNToz2NF2w@mail.gmail.com>

Thanks Rui. This is really helpful.

Regards,
Bhaskar

On Tue, May 31, 2022 at 4:03 AM Rui Barradas <ruipbarradas at sapo.pt> wrote:

> Hello,
>
> You can use package boot to bootstrap the statistic for you.
> Write a function to compute the new column and assign the column means
> to the new variable Z or, like in the code below Z2 (so that you can
> compare to the Z column of simple averages).
>
> library(dplyr)
> library(boot)
>
> boot_uncert <- function(data, indices) {
>    data[indices, ] %>%
>      group_by(Group) %>%
>      mutate(Y = mean(X, na.rm = TRUE),
>             Z = coalesce(X, Y)) %>%
>      pull(Z)
> }
>
> Df1 <- Df1 %>%
>    group_by(Group) %>%
>    mutate(Y = mean(X, na.rm = TRUE),
>           Z = coalesce(X, Y)) %>%
>    ungroup()
>
> set.seed(2022)
> R <- 1e3
>
> Df1 %>%
>    mutate(Z2 = colMeans(boot(., boot_uncert, R = R)$t, na.rm = TRUE),
>           Z2 = coalesce(X, Z2))
>
> Hope this helps,
>
> Rui Barradas
>
>
> ?s 22:23 de 29/05/2022, Bhaskar Mitra escreveu:
> > Hello Everyone,
> >
> > I have a query about uncertainty analysis and would really appreciate
> some
> > help  in this regard.
> >
> > I intend to gapfill the NAs in the ?X? column of the dataframe (Df1). I
> > have grouped the data using the column ?Group? ,
> > determined the mean and generated the ?Z? column.
> >
> > While I am using the mean and standard error approach to generate the
> > uncertainty analysis, can we use the bootstrap approach to
> > generate the uncertainty for the ?Z? column? Any help in this regard will
> > be really appreciated.
> >
> > Regards,
> > Bhaskar
> > ---------------------------------------------------------------
> >
> > Df1 <-
> >
> > Group     X            Y    Z
> > 1           2              3     2
> > 1          NA            3     3
> > 1            3             3     3
> > 1           4              3    4
> > 2            2             2    1
> > 2          NA            2    3
> > 2           NA           2    3
> > 2            4             2    4
> > 3             2            2    2
> > 3         NA             2     2
> > 3              2           2     2
> >
> >
> -------------------------------------------------------------------------------
> > Codes:
> >
> > Df1 <- Df1 %>% group_by(Group) %>% summarise(Y= mean(X), na.rm=T)
> >
> > Df1  <- Df1%>% mutate(Z= coalesce(X,Y))
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From @@h|mk@poor @end|ng |rom gm@||@com  Thu Jun  2 06:09:02 2022
From: @@h|mk@poor @end|ng |rom gm@||@com (Ashim Kapoor)
Date: Thu, 2 Jun 2022 09:39:02 +0530
Subject: [R] R_LIBS var needed to be set after upgrade to R 4.2.2
In-Reply-To: <CABFfbXu4eLha3rUaLFk=8N2c2xEO2B+abHSnZOePfCrCwEMuxg@mail.gmail.com>
References: <CAC8=1eppHfgnZkhE2tS_ko3Db0DNSMcs0fbYR++nYNsWqMLpvQ@mail.gmail.com>
 <25239.9444.688970.964168@stat.math.ethz.ch>
 <CAC8=1er4BwEJ0zousw0rC-g75G8HviGxqZ+1jB0heD2379x-wA@mail.gmail.com>
 <CABFfbXu4eLha3rUaLFk=8N2c2xEO2B+abHSnZOePfCrCwEMuxg@mail.gmail.com>
Message-ID: <CAC8=1eoTy7abPxRWeLk4EbvBVb3_gX0QTjx=1j9iXjGdP2113Q@mail.gmail.com>

Dear Sir,

Many thanks.

Best Regards,
Ashim

On Wed, Jun 1, 2022 at 5:36 PM Jeroen Ooms <jeroen at berkeley.edu> wrote:
>
> On Wed, Jun 1, 2022 at 11:02 AM Ashim Kapoor <ashimkapoor at gmail.com> wrote:
> >
> > My confusion is : Earlier R --vanilla incantation was working fine,
> > even without my intervening and
> > adding to R_LIBS. That is why I was confused.
> >
> > My main query is : Is there anything special to R 4.2.0 which needs
> > R_LIBS to be setup seperately?
>
> I was hit by this problem as well a few weeks ago. You may get a more
> detailed answer in r-sig-debian or from Dirk directly, but from what I
> understood, this is now expected behavior: indeed if you start R
> --vanilla then /usr/local/lib is no longer included in the library
> path.
>
> The reason is that R-core made a change in 4.2.0 to pre-set values for
> R_LIBS_USER and R_LIBS_SITE in Renviron [1] which would take
> precedence over the proper distro defaults (that include
> /usr/local/lib) as configured by the r-base deb/rpm packages. To
> mitigate the problem the the r-base deb package moved the appropriate
> R_LIBS_USER and R_LIBS_SITE definitions into Renviron.site, which
> takes precedence over Renviron. However a side effect of this solution
> is that Renviron.site is ignored in --vanilla mode. At least this is
> my best understanding of the problem.
>
> [1] https://cran.r-project.org/doc/manuals/r-release/NEWS.html


From @te|@no@@o||@ @end|ng |rom reg|one@m@rche@|t  Thu Jun  2 08:12:44 2022
From: @te|@no@@o||@ @end|ng |rom reg|one@m@rche@|t (Stefano Sofia)
Date: Thu, 2 Jun 2022 06:12:44 +0000
Subject: [R] rbind of multiple data frames by column name,
 when each data frames can contain different columns
Message-ID: <53bbac255bc84b64beecadbe62c4d092@regione.marche.it>

Dear R-list users,

for each winter season from 2000 to 2022 I have a data frame collecting for different weather stations snowpack height (Hs), snowfall in the last 24h (Hn) and a validation flag.

Suppose I have these three following data frames


df1 <- data.frame(data_POSIX=seq(as.POSIXct("2000-12-01", format="%Y-%m-%d", tz="Etc/GMT-1"), as.POSIXct("2000-12-05", format="%Y-%m-%d", tz="Etc/GMT-1"), by="1 days"), Station1_Hs = c(30, 40, 50, NA, 55), Station1_Hn = c(10, 20, 10, NA, 5), Station1_flag = c(0, 0, 0, NA, 0), Station2_Hs = c(20, 20, 30, 30, 0), Station2_Hn = c(0, 0, 10, 0, 5), Station2_flag = c(0, 0, 0, 1, 0))


df2 <- data.frame(data_POSIX=seq(as.POSIXct("2001-12-01", format="%Y-%m-%d", tz="Etc/GMT-1"), as.POSIXct("2001-12-05", format="%Y-%m-%d", tz="Etc/GMT-1"), by="1 days"), Station1_Hs = c(50, 60, 70, NA, NA), Station1_Hn = c(20, 20, 20, NA, NA), Station1_flag = c(0, 0, 0, NA, NA), Station3_Hs = c(20, 20, 30, 30, 0), Station3_Hn = c(0, 0, 10, 0, 5), Station3_flag = c(0, 0, 0, 1, 0))


df3 <- data.frame(data_POSIX=seq(as.POSIXct("2002-12-01", format="%Y-%m-%d", tz="Etc/GMT-1"), as.POSIXct("2002-12-05", format="%Y-%m-%d", tz="Etc/GMT-1"), by="1 days"), Station2_Hs = c(50, 60, 70, NA, NA), Station2_Hn = c(20, 20, 20, NA, NA), Station2_flag = c(0, 0, 0, NA, NA), Station3_Hs = c(20, 20, 30, 30, 0), Station3_Hn = c(0, 0, 10, 0, 5), Station3_flag = c(0, 0, 0, 1, 0))


As you can see, each data frame can have different stations loaded.

I would need to call rbind matching data frames by column name (i.e. by station name), keeping in mind that the number of stations loaded in each data frame may differ. The result should be

data_POSIX Station1_Hs Station1_Hn Station1_flag Station2_Hs Station2_Hn Station2_flag Station3_Hs Station3_Hn Station3_flag
2000-12-01 30 10 0 20 0 0 NA NA NA
2000-12-02 40 20 0 20 0 0 NA NA NA
2000-12-03 50 10 0 30 10 0 NA NA NA
2000-12-04 NA NA NA 30 0 0 NA NA NA
2000-12-05 55 5 0 0 5 0 NA NA NA
2001-12-01 50 20 0 NA NA NA 20 0 0
2001-12-02 60 20 0 NA NA NA 20 0 0
2001-12-03 70 20 0 NA NA NA 30 10 0
2001-12-04 NA NA NA NA NA NA 30 0 1
2001-12-05 NA NA NA NA NA NA 0 5 0
2002-12-01 NA NA NA 50 20 0 20 0 0
2002-12-02 NA NA NA 60 20 0 20 0 0
2002-12-03 NA NA NA 70 20 0 30 10 0
2002-12-04 NA NA NA NA NA NA 30 0 1
2002-12-05 NA NA NA NA NA NA 0 5 0

I tried this code

df_list <- list(df1, df2, df3)
allNms <- unique(unlist(lapply(df_list, names)))
do.call(rbind, c(lapply(df_list, function(x) data.frame(c(x, sapply(setdiff(allNms, names(x)), function(y) NA)))), make.row.names=FALSE))

but I get this error:
Error in (function (..., row.names = NULL, check.rows = FALSE, check.names = TRUE,  :
  arguments imply differing number of rows

Could someone please help me?


Thank you for your attention

Stefano


         (oo)
--oOO--( )--OOo--------------------------------------
Stefano Sofia PhD
Civil Protection - Marche Region - Italy
Meteo Section
Snow Section
Via del Colle Ameno 5
60126 Torrette di Ancona, Ancona (AN)
Uff: +39 071 806 7743
E-mail: stefano.sofia at regione.marche.it
---Oo---------oO----------------------------------------

________________________________

AVVISO IMPORTANTE: Questo messaggio di posta elettronica pu? contenere informazioni confidenziali, pertanto ? destinato solo a persone autorizzate alla ricezione. I messaggi di posta elettronica per i client di Regione Marche possono contenere informazioni confidenziali e con privilegi legali. Se non si ? il destinatario specificato, non leggere, copiare, inoltrare o archiviare questo messaggio. Se si ? ricevuto questo messaggio per errore, inoltrarlo al mittente ed eliminarlo completamente dal sistema del proprio computer. Ai sensi dell'art. 6 della DGR n. 1394/2008 si segnala che, in caso di necessit? ed urgenza, la risposta al presente messaggio di posta elettronica pu? essere visionata da persone estranee al destinatario.
IMPORTANT NOTICE: This e-mail message is intended to be received only by persons entitled to receive the confidential information it may contain. E-mail messages to clients of Regione Marche may contain information that is confidential and legally privileged. Please do not read, copy, forward, or store this message unless you are an intended recipient of it. If you have received this message in error, please forward it to the sender and delete it completely from your computer system.

--
Questo messaggio  stato analizzato da Libraesva ESG ed  risultato non infetto.
This message was scanned by Libraesva ESG and is believed to be clean.


	[[alternative HTML version deleted]]


From bh@@k@r@ko|k@t@ @end|ng |rom gm@||@com  Thu Jun  2 01:17:18 2022
From: bh@@k@r@ko|k@t@ @end|ng |rom gm@||@com (Bhaskar Mitra)
Date: Wed, 1 Jun 2022 16:17:18 -0700
Subject: [R] Request for some help: Error when joining multiple csv files
 together
Message-ID: <CAEGXkYV-F6sRgYaq=57ic-iXF52r-4GyLWW4485f+Rzz3wq_KA@mail.gmail.com>

Hello Everyone,

I have a bunch of csv files, all with common headers (d1, d2, d3, d4).
When I am trying to join the csv files together, with the following code
(shown below),
I am getting a warning  when the files are joined. The values under columns
d3 and d4 are not joined properly.

The code and the error are given below. I would really appreciate some help
in this regard.

regards,
bhaskar


#---code--------------------------------

df <- list.files(pattern = "*.csv") %>%
  lapply(read_csv) %>%
  bind_rows

#---code--------------------------------

Header of each file:

d1  d2  d3  d4
3   4    NA   NA
4   5   NA   7
5   6   8   8
6   7   8   NA

#--------------------------------------------------------

#Warning when the codes run --------------------------------------

Column specification
?????????????????????????????????????????????????????????????????????????????????????????????????????????????????
cols(
  .default = col_double(),
  name = col_character(),
  d1 = col_datetime(format = ""),
  d2 = col_character(),
  d3 = col_logical(),
  d4 = col_logical()
)

Warning: 48766 parsing failures.
* row*    *col*          * expected  *                         *actual*
     *file*
3529   d3           1/0/T/F/TRUE/FALSE       100             'file1.csv'
3529   d4            1/0/T/F/TRUE/FALSE      100             'file1.csv'

.... ..... .................. ...... ................................

	[[alternative HTML version deleted]]


From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Thu Jun  2 09:26:02 2022
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Thu, 2 Jun 2022 09:26:02 +0200
Subject: [R] R_LIBS var needed to be set after upgrade to R 4.2.2
In-Reply-To: <CAC8=1er4BwEJ0zousw0rC-g75G8HviGxqZ+1jB0heD2379x-wA@mail.gmail.com>
References: <CAC8=1eppHfgnZkhE2tS_ko3Db0DNSMcs0fbYR++nYNsWqMLpvQ@mail.gmail.com>
 <25239.9444.688970.964168@stat.math.ethz.ch>
 <CAC8=1er4BwEJ0zousw0rC-g75G8HviGxqZ+1jB0heD2379x-wA@mail.gmail.com>
Message-ID: <25240.26122.534907.343899@stat.math.ethz.ch>

>>>>> Ashim Kapoor 
>>>>>     on Wed, 1 Jun 2022 14:30:58 +0530 writes:

    > Dear Sir,
    >> > I upgraded to R 4.2.2  on Debian 10 today.
    >> 
    >> Well, I assume you mean R 4.2.0 .. at least that one exists.

    > My bad, yes I made a typo. I did mean R 4.2.0.

    >> > The R shell incantation worked fine and all libraries would load but,
    >> > I needed to point the R_LIBS variable to
    >> > /usr/local/lib/R/site-library/ in order for the R --vanilla < myfile.R
    >> > incantation to find the libraries.
    >> 
    >> you mean other installed *packages*
    >> 
    >> > May I ask, why was this ? I never needed to do this on any previous
    >> > upgrade to R.
    >> 
    >> Well,  for me, the     R --vanilla   form also only sees the
    >> 29 (14 "base" + 15 "Recommended") packages that come with R.

    > Has this ALWAYS been the case for you ? Even with prior versions of R ?

Yes; I'm sorry this was unclear.

    >> Debian (& Ubuntu etc)  have used a similar setup where the
    >> default {R-level}  .libPaths() has contained three libraries,
    >> via
    >> 
    >> R_LIBS_SITE=${R_LIBS_SITE-'/usr/local/lib/R/site-library:/usr/lib/R/site-library:/usr/lib/R/library'}
    >> 
    >> see
    >> 
    >> https://cloud.r-project.org/bin/linux/debian/#pathways-to-r-packages
    >> 
    >> also for much more.
    >> Note (also from the above CRAN page
    >> https://cloud.r-project.org/bin/linux/debian/
    >> [ Remember "menu"  "Binaries" -> "Linux" -> "Debian" ]
    >> 
    >> The good thing about the Debian (and derivatives) setup is that
    >> it also separates (as I do) the  "packages that come with R" in
    >> one library (= /usr/lib/R/library) from packages that are
    >> installed differently.

    > My confusion is : Earlier R --vanilla incantation was working fine,
    > even without my intervening and
    > adding to R_LIBS. That is why I was confused.

    > My main query is : Is there anything special to R 4.2.0 which needs
    > R_LIBS to be setup seperately?

to which Jeroen Ooms answered nicely -- thank you, Jeroen!

    > I was hit by this problem as well a few weeks ago. You may get a more
    > detailed answer in r-sig-debian or from Dirk directly, but from what I
    > understood, this is now expected behavior: indeed if you start R
    > --vanilla then /usr/local/lib is no longer included in the library path.

    > The reason is that R-core made a change in 4.2.0 to pre-set values for
    > R_LIBS_USER and R_LIBS_SITE in Renviron [1] which would take
    > precedence over the proper distro defaults (that include
    > /usr/local/lib) as configured by the r-base deb/rpm packages. To
    > mitigate the problem the r-base deb package moved the appropriate
    > R_LIBS_USER and R_LIBS_SITE definitions into Renviron.site, which
    > takes precedence over Renviron. However a side effect of this solution
    > is that Renviron.site is ignored in --vanilla mode. At least this is
    > my best understanding of the problem.

    > [1] https://cran.r-project.org/doc/manuals/r-release/NEWS.html

Yes, as

     R --help | grep -A1 -e --vanilla | head -2

has given
 
  --vanilla		Combine --no-save, --no-restore, --no-site-file,
			--no-init-file and --no-environ

(unchanged for many years).


Being a Linux user of more than 25 years, I've not been much of a
Debian-or-derivatives user in recent years (apart from setting up
and maintaining Ubuntu LTS on my wife's computer) mainly because
of lazyness as our IT staff helps me solve all problems with
Fedora quickly, including lowelevel device-related ones,
I think that Debian(+derivatives) has always been the exception
among the Linux distros and for all the others, '--vanilla'
really meant "vanilla" in a loose sense, i.e., "just base R".

I agree that I had wanted a "vanilla+strawberry" version myself, really.
which would be just not have the  --no-site-file  switch,
so we could call it
   --vanilla+site

{Others may hate  "feature creep" and yet more output from
'R --help'  ..}

Martin


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Thu Jun  2 09:30:01 2022
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Thu, 2 Jun 2022 08:30:01 +0100
Subject: [R] 
 Request for some help: Error when joining multiple csv files
 together
In-Reply-To: <CAEGXkYV-F6sRgYaq=57ic-iXF52r-4GyLWW4485f+Rzz3wq_KA@mail.gmail.com>
References: <CAEGXkYV-F6sRgYaq=57ic-iXF52r-4GyLWW4485f+Rzz3wq_KA@mail.gmail.com>
Message-ID: <f040297a-71b6-dadd-8e34-b1a523d105e9@sapo.pt>

Hello,

I'm seeing two obvious errors, those are not csv files and the columns 
spec is wrong, you have a spec of 6 columns but the posted data only has 
4 and of different classes.

If the data is in comma separated values (CSV) files the following 
worked without errors.


library(readr)

col_spec <- cols(
   d1 = col_double(),
   d2 = col_double(),
   d3 = col_double(),
   d4 = col_double()
)

list.files(pattern = "*\\.csv$") |>
   lapply(read_csv, col_types = col_spec) |>
   dplyr::bind_rows()


If the data is like in the question, try instead


list.files(pattern = "*\\.csv$") |>
   lapply(read_delim, delim = " ", col_types = col_spec) |>
   dplyr::bind_rows()


Hope this helps,

Rui Barradas

?s 00:17 de 02/06/2022, Bhaskar Mitra escreveu:
> Hello Everyone,
> 
> I have a bunch of csv files, all with common headers (d1, d2, d3, d4).
> When I am trying to join the csv files together, with the following code
> (shown below),
> I am getting a warning  when the files are joined. The values under columns
> d3 and d4 are not joined properly.
> 
> The code and the error are given below. I would really appreciate some help
> in this regard.
> 
> regards,
> bhaskar
> 
> 
> #---code--------------------------------
> 
> df <- list.files(pattern = "*.csv") %>%
>    lapply(read_csv) %>%
>    bind_rows
> 
> #---code--------------------------------
> 
> Header of each file:
> 
> d1  d2  d3  d4
> 3   4    NA   NA
> 4   5   NA   7
> 5   6   8   8
> 6   7   8   NA
> 
> #--------------------------------------------------------
> 
> #Warning when the codes run --------------------------------------
> 
> Column specification
> ?????????????????????????????????????????????????????????????????????????????????????????????????????????????????
> cols(
>    .default = col_double(),
>    name = col_character(),
>    d1 = col_datetime(format = ""),
>    d2 = col_character(),
>    d3 = col_logical(),
>    d4 = col_logical()
> )
> 
> Warning: 48766 parsing failures.
> * row*    *col*          * expected  *                         *actual*
>       *file*
> 3529   d3           1/0/T/F/TRUE/FALSE       100             'file1.csv'
> 3529   d4            1/0/T/F/TRUE/FALSE      100             'file1.csv'
> 
> .... ..... .................. ...... ................................
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Thu Jun  2 09:37:50 2022
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Thu, 2 Jun 2022 08:37:50 +0100
Subject: [R] rbind of multiple data frames by column name,
 when each data frames can contain different columns
In-Reply-To: <53bbac255bc84b64beecadbe62c4d092@regione.marche.it>
References: <53bbac255bc84b64beecadbe62c4d092@regione.marche.it>
Message-ID: <ca06d276-9e3a-dd6b-da51-30b07b7e7423@sapo.pt>

Hello,

Here are two ways, both with dplyr::bind_rows.


res1 <- Reduce(dplyr::bind_rows, df_list)
res2 <- do.call(dplyr::bind_rows, df_list)
identical(res1, res2)
# [1] TRUE


Hope this helps,

Rui Barradas

?s 07:12 de 02/06/2022, Stefano Sofia escreveu:
> Dear R-list users,
> 
> for each winter season from 2000 to 2022 I have a data frame collecting for different weather stations snowpack height (Hs), snowfall in the last 24h (Hn) and a validation flag.
> 
> Suppose I have these three following data frames
> 
> 
> df1 <- data.frame(data_POSIX=seq(as.POSIXct("2000-12-01", format="%Y-%m-%d", tz="Etc/GMT-1"), as.POSIXct("2000-12-05", format="%Y-%m-%d", tz="Etc/GMT-1"), by="1 days"), Station1_Hs = c(30, 40, 50, NA, 55), Station1_Hn = c(10, 20, 10, NA, 5), Station1_flag = c(0, 0, 0, NA, 0), Station2_Hs = c(20, 20, 30, 30, 0), Station2_Hn = c(0, 0, 10, 0, 5), Station2_flag = c(0, 0, 0, 1, 0))
> 
> 
> df2 <- data.frame(data_POSIX=seq(as.POSIXct("2001-12-01", format="%Y-%m-%d", tz="Etc/GMT-1"), as.POSIXct("2001-12-05", format="%Y-%m-%d", tz="Etc/GMT-1"), by="1 days"), Station1_Hs = c(50, 60, 70, NA, NA), Station1_Hn = c(20, 20, 20, NA, NA), Station1_flag = c(0, 0, 0, NA, NA), Station3_Hs = c(20, 20, 30, 30, 0), Station3_Hn = c(0, 0, 10, 0, 5), Station3_flag = c(0, 0, 0, 1, 0))
> 
> 
> df3 <- data.frame(data_POSIX=seq(as.POSIXct("2002-12-01", format="%Y-%m-%d", tz="Etc/GMT-1"), as.POSIXct("2002-12-05", format="%Y-%m-%d", tz="Etc/GMT-1"), by="1 days"), Station2_Hs = c(50, 60, 70, NA, NA), Station2_Hn = c(20, 20, 20, NA, NA), Station2_flag = c(0, 0, 0, NA, NA), Station3_Hs = c(20, 20, 30, 30, 0), Station3_Hn = c(0, 0, 10, 0, 5), Station3_flag = c(0, 0, 0, 1, 0))
> 
> 
> As you can see, each data frame can have different stations loaded.
> 
> I would need to call rbind matching data frames by column name (i.e. by station name), keeping in mind that the number of stations loaded in each data frame may differ. The result should be
> 
> data_POSIX Station1_Hs Station1_Hn Station1_flag Station2_Hs Station2_Hn Station2_flag Station3_Hs Station3_Hn Station3_flag
> 2000-12-01 30 10 0 20 0 0 NA NA NA
> 2000-12-02 40 20 0 20 0 0 NA NA NA
> 2000-12-03 50 10 0 30 10 0 NA NA NA
> 2000-12-04 NA NA NA 30 0 0 NA NA NA
> 2000-12-05 55 5 0 0 5 0 NA NA NA
> 2001-12-01 50 20 0 NA NA NA 20 0 0
> 2001-12-02 60 20 0 NA NA NA 20 0 0
> 2001-12-03 70 20 0 NA NA NA 30 10 0
> 2001-12-04 NA NA NA NA NA NA 30 0 1
> 2001-12-05 NA NA NA NA NA NA 0 5 0
> 2002-12-01 NA NA NA 50 20 0 20 0 0
> 2002-12-02 NA NA NA 60 20 0 20 0 0
> 2002-12-03 NA NA NA 70 20 0 30 10 0
> 2002-12-04 NA NA NA NA NA NA 30 0 1
> 2002-12-05 NA NA NA NA NA NA 0 5 0
> 
> I tried this code
> 
> df_list <- list(df1, df2, df3)
> allNms <- unique(unlist(lapply(df_list, names)))
> do.call(rbind, c(lapply(df_list, function(x) data.frame(c(x, sapply(setdiff(allNms, names(x)), function(y) NA)))), make.row.names=FALSE))
> 
> but I get this error:
> Error in (function (..., row.names = NULL, check.rows = FALSE, check.names = TRUE,  :
>    arguments imply differing number of rows
> 
> Could someone please help me?
> 
> 
> Thank you for your attention
> 
> Stefano
> 
> 
>           (oo)
> --oOO--( )--OOo--------------------------------------
> Stefano Sofia PhD
> Civil Protection - Marche Region - Italy
> Meteo Section
> Snow Section
> Via del Colle Ameno 5
> 60126 Torrette di Ancona, Ancona (AN)
> Uff: +39 071 806 7743
> E-mail: stefano.sofia at regione.marche.it
> ---Oo---------oO----------------------------------------
> 
> ________________________________
> 
> AVVISO IMPORTANTE: Questo messaggio di posta elettronica pu? contenere informazioni confidenziali, pertanto ? destinato solo a persone autorizzate alla ricezione. I messaggi di posta elettronica per i client di Regione Marche possono contenere informazioni confidenziali e con privilegi legali. Se non si ? il destinatario specificato, non leggere, copiare, inoltrare o archiviare questo messaggio. Se si ? ricevuto questo messaggio per errore, inoltrarlo al mittente ed eliminarlo completamente dal sistema del proprio computer. Ai sensi dell'art. 6 della DGR n. 1394/2008 si segnala che, in caso di necessit? ed urgenza, la risposta al presente messaggio di posta elettronica pu? essere visionata da persone estranee al destinatario.
> IMPORTANT NOTICE: This e-mail message is intended to be received only by persons entitled to receive the confidential information it may contain. E-mail messages to clients of Regione Marche may contain information that is confidential and legally privileged. Please do not read, copy, forward, or store this message unless you are an intended recipient of it. If you have received this message in error, please forward it to the sender and delete it completely from your computer system.
> 
> --
> 
> Questo messaggio  stato analizzato da Libraesva ESG ed  risultato non infetto.
> 
> This message was scanned by Libraesva ESG and is believed to be clean.
> 
> 
> 	[[alternative HTML version deleted]]
> 
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Thu Jun  2 09:46:02 2022
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Thu, 2 Jun 2022 08:46:02 +0100
Subject: [R] rbind of multiple data frames by column name,
 when each data frames can contain different columns
In-Reply-To: <ca06d276-9e3a-dd6b-da51-30b07b7e7423@sapo.pt>
References: <53bbac255bc84b64beecadbe62c4d092@regione.marche.it>
 <ca06d276-9e3a-dd6b-da51-30b07b7e7423@sapo.pt>
Message-ID: <bc824824-6873-b9ea-a007-6785ad2bde84@sapo.pt>

Hello,

And a base R only version.
Row binding code taken from StackOverflow [1].


rowbind <- function(x, y, all_cols = FALSE) {
   if(all_cols) {
     x[setdiff(names(y), names(x))] <- NA
     y[setdiff(names(x), names(y))] <- NA
   }
   rbind(x, y)
}

res3 <- Reduce(\(x, y) rowbind(x, y, all_cols = TRUE), df_list)
identical(res1, res3)
# [1] TRUE


[1] https://stackoverflow.com/a/46635610/8245406

Hope this helps,

Rui Barradas

?s 08:37 de 02/06/2022, Rui Barradas escreveu:
> Hello,
> 
> Here are two ways, both with dplyr::bind_rows.
> 
> 
> res1 <- Reduce(dplyr::bind_rows, df_list)
> res2 <- do.call(dplyr::bind_rows, df_list)
> identical(res1, res2)
> # [1] TRUE
> 
> 
> Hope this helps,
> 
> Rui Barradas
> 
> ?s 07:12 de 02/06/2022, Stefano Sofia escreveu:
>> Dear R-list users,
>>
>> for each winter season from 2000 to 2022 I have a data frame 
>> collecting for different weather stations snowpack height (Hs), 
>> snowfall in the last 24h (Hn) and a validation flag.
>>
>> Suppose I have these three following data frames
>>
>>
>> df1 <- data.frame(data_POSIX=seq(as.POSIXct("2000-12-01", 
>> format="%Y-%m-%d", tz="Etc/GMT-1"), as.POSIXct("2000-12-05", 
>> format="%Y-%m-%d", tz="Etc/GMT-1"), by="1 days"), Station1_Hs = c(30, 
>> 40, 50, NA, 55), Station1_Hn = c(10, 20, 10, NA, 5), Station1_flag = 
>> c(0, 0, 0, NA, 0), Station2_Hs = c(20, 20, 30, 30, 0), Station2_Hn = 
>> c(0, 0, 10, 0, 5), Station2_flag = c(0, 0, 0, 1, 0))
>>
>>
>> df2 <- data.frame(data_POSIX=seq(as.POSIXct("2001-12-01", 
>> format="%Y-%m-%d", tz="Etc/GMT-1"), as.POSIXct("2001-12-05", 
>> format="%Y-%m-%d", tz="Etc/GMT-1"), by="1 days"), Station1_Hs = c(50, 
>> 60, 70, NA, NA), Station1_Hn = c(20, 20, 20, NA, NA), Station1_flag = 
>> c(0, 0, 0, NA, NA), Station3_Hs = c(20, 20, 30, 30, 0), Station3_Hn = 
>> c(0, 0, 10, 0, 5), Station3_flag = c(0, 0, 0, 1, 0))
>>
>>
>> df3 <- data.frame(data_POSIX=seq(as.POSIXct("2002-12-01", 
>> format="%Y-%m-%d", tz="Etc/GMT-1"), as.POSIXct("2002-12-05", 
>> format="%Y-%m-%d", tz="Etc/GMT-1"), by="1 days"), Station2_Hs = c(50, 
>> 60, 70, NA, NA), Station2_Hn = c(20, 20, 20, NA, NA), Station2_flag = 
>> c(0, 0, 0, NA, NA), Station3_Hs = c(20, 20, 30, 30, 0), Station3_Hn = 
>> c(0, 0, 10, 0, 5), Station3_flag = c(0, 0, 0, 1, 0))
>>
>>
>> As you can see, each data frame can have different stations loaded.
>>
>> I would need to call rbind matching data frames by column name (i.e. 
>> by station name), keeping in mind that the number of stations loaded 
>> in each data frame may differ. The result should be
>>
>> data_POSIX Station1_Hs Station1_Hn Station1_flag Station2_Hs 
>> Station2_Hn Station2_flag Station3_Hs Station3_Hn Station3_flag
>> 2000-12-01 30 10 0 20 0 0 NA NA NA
>> 2000-12-02 40 20 0 20 0 0 NA NA NA
>> 2000-12-03 50 10 0 30 10 0 NA NA NA
>> 2000-12-04 NA NA NA 30 0 0 NA NA NA
>> 2000-12-05 55 5 0 0 5 0 NA NA NA
>> 2001-12-01 50 20 0 NA NA NA 20 0 0
>> 2001-12-02 60 20 0 NA NA NA 20 0 0
>> 2001-12-03 70 20 0 NA NA NA 30 10 0
>> 2001-12-04 NA NA NA NA NA NA 30 0 1
>> 2001-12-05 NA NA NA NA NA NA 0 5 0
>> 2002-12-01 NA NA NA 50 20 0 20 0 0
>> 2002-12-02 NA NA NA 60 20 0 20 0 0
>> 2002-12-03 NA NA NA 70 20 0 30 10 0
>> 2002-12-04 NA NA NA NA NA NA 30 0 1
>> 2002-12-05 NA NA NA NA NA NA 0 5 0
>>
>> I tried this code
>>
>> df_list <- list(df1, df2, df3)
>> allNms <- unique(unlist(lapply(df_list, names)))
>> do.call(rbind, c(lapply(df_list, function(x) data.frame(c(x, 
>> sapply(setdiff(allNms, names(x)), function(y) NA)))), 
>> make.row.names=FALSE))
>>
>> but I get this error:
>> Error in (function (..., row.names = NULL, check.rows = FALSE, 
>> check.names = TRUE,? :
>> ?? arguments imply differing number of rows
>>
>> Could someone please help me?
>>
>>
>> Thank you for your attention
>>
>> Stefano
>>
>>
>> ????????? (oo)
>> --oOO--( )--OOo--------------------------------------
>> Stefano Sofia PhD
>> Civil Protection - Marche Region - Italy
>> Meteo Section
>> Snow Section
>> Via del Colle Ameno 5
>> 60126 Torrette di Ancona, Ancona (AN)
>> Uff: +39 071 806 7743
>> E-mail: stefano.sofia at regione.marche.it
>> ---Oo---------oO----------------------------------------
>>
>> ________________________________
>>
>> AVVISO IMPORTANTE: Questo messaggio di posta elettronica pu? contenere 
>> informazioni confidenziali, pertanto ? destinato solo a persone 
>> autorizzate alla ricezione. I messaggi di posta elettronica per i 
>> client di Regione Marche possono contenere informazioni confidenziali 
>> e con privilegi legali. Se non si ? il destinatario specificato, non 
>> leggere, copiare, inoltrare o archiviare questo messaggio. Se si ? 
>> ricevuto questo messaggio per errore, inoltrarlo al mittente ed 
>> eliminarlo completamente dal sistema del proprio computer. Ai sensi 
>> dell'art. 6 della DGR n. 1394/2008 si segnala che, in caso di 
>> necessit? ed urgenza, la risposta al presente messaggio di posta 
>> elettronica pu? essere visionata da persone estranee al destinatario.
>> IMPORTANT NOTICE: This e-mail message is intended to be received only 
>> by persons entitled to receive the confidential information it may 
>> contain. E-mail messages to clients of Regione Marche may contain 
>> information that is confidential and legally privileged. Please do not 
>> read, copy, forward, or store this message unless you are an intended 
>> recipient of it. If you have received this message in error, please 
>> forward it to the sender and delete it completely from your computer 
>> system.
>>
>> -- 
>>
>> Questo messaggio? stato analizzato da Libraesva ESG ed? risultato non 
>> infetto.
>>
>> This message was scanned by Libraesva ESG and is believed to be clean.
>>
>>
>> ????[[alternative HTML version deleted]]
>>
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide 
>> http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide 
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From @@h|mk@poor @end|ng |rom gm@||@com  Thu Jun  2 10:00:27 2022
From: @@h|mk@poor @end|ng |rom gm@||@com (Ashim Kapoor)
Date: Thu, 2 Jun 2022 13:30:27 +0530
Subject: [R] R_LIBS var needed to be set after upgrade to R 4.2.2
In-Reply-To: <25240.26122.534907.343899@stat.math.ethz.ch>
References: <CAC8=1eppHfgnZkhE2tS_ko3Db0DNSMcs0fbYR++nYNsWqMLpvQ@mail.gmail.com>
 <25239.9444.688970.964168@stat.math.ethz.ch>
 <CAC8=1er4BwEJ0zousw0rC-g75G8HviGxqZ+1jB0heD2379x-wA@mail.gmail.com>
 <25240.26122.534907.343899@stat.math.ethz.ch>
Message-ID: <CAC8=1epPYOT1j9arYvOVBOv=ehm78WJ2gc4AL296EXPqak-bqA@mail.gmail.com>

Dear Sir,

Many thanks for the reply.

Best,
Ashim

On Thu, Jun 2, 2022 at 12:56 PM Martin Maechler
<maechler at stat.math.ethz.ch> wrote:
>
> >>>>> Ashim Kapoor
> >>>>>     on Wed, 1 Jun 2022 14:30:58 +0530 writes:
>
>     > Dear Sir,
>     >> > I upgraded to R 4.2.2  on Debian 10 today.
>     >>
>     >> Well, I assume you mean R 4.2.0 .. at least that one exists.
>
>     > My bad, yes I made a typo. I did mean R 4.2.0.
>
>     >> > The R shell incantation worked fine and all libraries would load but,
>     >> > I needed to point the R_LIBS variable to
>     >> > /usr/local/lib/R/site-library/ in order for the R --vanilla < myfile.R
>     >> > incantation to find the libraries.
>     >>
>     >> you mean other installed *packages*
>     >>
>     >> > May I ask, why was this ? I never needed to do this on any previous
>     >> > upgrade to R.
>     >>
>     >> Well,  for me, the     R --vanilla   form also only sees the
>     >> 29 (14 "base" + 15 "Recommended") packages that come with R.
>
>     > Has this ALWAYS been the case for you ? Even with prior versions of R ?
>
> Yes; I'm sorry this was unclear.
>
>     >> Debian (& Ubuntu etc)  have used a similar setup where the
>     >> default {R-level}  .libPaths() has contained three libraries,
>     >> via
>     >>
>     >> R_LIBS_SITE=${R_LIBS_SITE-'/usr/local/lib/R/site-library:/usr/lib/R/site-library:/usr/lib/R/library'}
>     >>
>     >> see
>     >>
>     >> https://cloud.r-project.org/bin/linux/debian/#pathways-to-r-packages
>     >>
>     >> also for much more.
>     >> Note (also from the above CRAN page
>     >> https://cloud.r-project.org/bin/linux/debian/
>     >> [ Remember "menu"  "Binaries" -> "Linux" -> "Debian" ]
>     >>
>     >> The good thing about the Debian (and derivatives) setup is that
>     >> it also separates (as I do) the  "packages that come with R" in
>     >> one library (= /usr/lib/R/library) from packages that are
>     >> installed differently.
>
>     > My confusion is : Earlier R --vanilla incantation was working fine,
>     > even without my intervening and
>     > adding to R_LIBS. That is why I was confused.
>
>     > My main query is : Is there anything special to R 4.2.0 which needs
>     > R_LIBS to be setup seperately?
>
> to which Jeroen Ooms answered nicely -- thank you, Jeroen!
>
>     > I was hit by this problem as well a few weeks ago. You may get a more
>     > detailed answer in r-sig-debian or from Dirk directly, but from what I
>     > understood, this is now expected behavior: indeed if you start R
>     > --vanilla then /usr/local/lib is no longer included in the library path.
>
>     > The reason is that R-core made a change in 4.2.0 to pre-set values for
>     > R_LIBS_USER and R_LIBS_SITE in Renviron [1] which would take
>     > precedence over the proper distro defaults (that include
>     > /usr/local/lib) as configured by the r-base deb/rpm packages. To
>     > mitigate the problem the r-base deb package moved the appropriate
>     > R_LIBS_USER and R_LIBS_SITE definitions into Renviron.site, which
>     > takes precedence over Renviron. However a side effect of this solution
>     > is that Renviron.site is ignored in --vanilla mode. At least this is
>     > my best understanding of the problem.
>
>     > [1] https://cran.r-project.org/doc/manuals/r-release/NEWS.html
>
> Yes, as
>
>      R --help | grep -A1 -e --vanilla | head -2
>
> has given
>
>   --vanilla             Combine --no-save, --no-restore, --no-site-file,
>                         --no-init-file and --no-environ
>
> (unchanged for many years).
>
>
> Being a Linux user of more than 25 years, I've not been much of a
> Debian-or-derivatives user in recent years (apart from setting up
> and maintaining Ubuntu LTS on my wife's computer) mainly because
> of lazyness as our IT staff helps me solve all problems with
> Fedora quickly, including lowelevel device-related ones,
> I think that Debian(+derivatives) has always been the exception
> among the Linux distros and for all the others, '--vanilla'
> really meant "vanilla" in a loose sense, i.e., "just base R".
>
> I agree that I had wanted a "vanilla+strawberry" version myself, really.
> which would be just not have the  --no-site-file  switch,
> so we could call it
>    --vanilla+site
>
> {Others may hate  "feature creep" and yet more output from
> 'R --help'  ..}
>
> Martin


From Qu|r|n_St|er @end|ng |rom gmx@de  Thu Jun  2 16:49:27 2022
From: Qu|r|n_St|er @end|ng |rom gmx@de (Quirin Stier)
Date: Thu, 2 Jun 2022 16:49:27 +0200
Subject: [R] Install OpenCL
Message-ID: <1e3ff528-1d77-6a66-3184-0f94ce826f62@gmx.de>

Hi everyone,

the installation of OpenCL on windows with CUDA 11.7 failed. I can set
up tensorflow in python and communicate with the GPU, so I assume CUDA
is set up correctly. OpenCL headers are also available through the CUDA
toolkit.

However, the package installation of OpenCL in R fails. There is not
much documentation available. Can anyone help with that please?

 > install.packages("OpenCL")
Installiere Paket nach ?C:/Users/quiri/AppData/Local/R/win-library/4.2?
(da ?lib? nicht spezifiziert)
Paket, das nur als Quelltext vorliegt und eventuell ?bersetzung von
C/C++/Fortran ben?tigt.: ?OpenCL?
installiere Quellpaket ?OpenCL?

trying URL 'https://cran.rstudio.com/src/contrib/OpenCL_0.2-2.tar.gz'
Content type 'application/x-gzip' length 20881 bytes (20 KB)
downloaded 20 KB

* installing *source* package 'OpenCL' ...
** Paket 'OpenCL' erfolgreich entpackt und MD5 Summen ?berpr?ft
** using staged installation

ERROR: OCL not set!

You will need a working OpenCL SDK with headers
and libraries for both i386 and x64

Set OCL to the root of the SDK

You can also set individial variables OCLINC,
OCL32LIB and OCL64LIB. If they are not set,
the default layout will be assumed.

ERROR: configuration failed for package 'OpenCL'
* removing 'C:/Users/quiri/AppData/Local/R/win-library/4.2/OpenCL'
Warning in install.packages :
 ? Installation des Pakets ?OpenCL? hatte Exit-Status ungleich 0

Die heruntergeladenen Quellpakete sind in
 ??C:\Users\quiri\AppData\Local\Temp\RtmpeepQng\downloaded_packages?


Best regards,

Quirin


From jr@| @end|ng |rom po@teo@no  Thu Jun  2 17:43:32 2022
From: jr@| @end|ng |rom po@teo@no (Rasmus Liland)
Date: Thu,  2 Jun 2022 15:43:32 +0000
Subject: [R] Install OpenCL
In-Reply-To: <1e3ff528-1d77-6a66-3184-0f94ce826f62@gmx.de>
References: <1e3ff528-1d77-6a66-3184-0f94ce826f62@gmx.de>
Message-ID: <YpjapBDJz46YX7Fy@posteo.no>

Dear Quirin,

To be able to install OpenCL on 
ArchLinux, I needed to install 
opencl-headers first, because my system 
complained about CL/opencl.h ...  Maybe 
there is something like that on Windows 
... 

Best,
Rasmus

[1] https://archlinux.org/packages/extra/any/opencl-headers/


From kry|ov@r00t @end|ng |rom gm@||@com  Thu Jun  2 17:46:55 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Thu, 2 Jun 2022 18:46:55 +0300
Subject: [R] Install OpenCL
In-Reply-To: <1e3ff528-1d77-6a66-3184-0f94ce826f62@gmx.de>
References: <1e3ff528-1d77-6a66-3184-0f94ce826f62@gmx.de>
Message-ID: <20220602184655.1c840903@arachnoid>

? Thu, 2 Jun 2022 16:49:27 +0200
Quirin Stier <Quirin_Stier at gmx.de> ?????:

> ERROR: OCL not set!
> 
> You will need a working OpenCL SDK with headers
> and libraries for both i386 and x64
> 
> Set OCL to the root of the SDK

Admittedly, it's not mentioned in the package's INSTALL file, but as
the configure script says, you need to set the "OCL" environment
variable to the path where you have OpenCL SDK installed. Use
Sys.setenv() to set the variable before running install.packages().

Also, make sure that the OpenCL DLLs are available via the %PATH%
variable.

-- 
Best regards,
Ivan


From bgunter@4567 @end|ng |rom gm@||@com  Thu Jun  2 22:04:15 2022
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Thu, 2 Jun 2022 13:04:15 -0700
Subject: [R] rbind of multiple data frames by column name,
 when each data frames can contain different columns
In-Reply-To: <53bbac255bc84b64beecadbe62c4d092@regione.marche.it>
References: <53bbac255bc84b64beecadbe62c4d092@regione.marche.it>
Message-ID: <CAGxFJbS9+zZMRSaRU7KhBEJUWb8kiKjy51xe5TtjyDboKDafxQ@mail.gmail.com>

Well, it seems better to me to put all the data frames in long format and
then rbind them instead of the other way round, which results in the piles
of NA's you see. I note also, FWIW, that this accords with the so-called
"tidy" format that many advocate these days. You can always subset (rows)
and choose by station, date, etc. as needed, of course from the long format.

Because of the regularity of your data frames, it is easy to do this. Here
is a little base R function that "reforms" each data frame (I suspect Rui
may well provide a more elegant version, though):


reform<- function(dat){
   nm <- names(dat)
   stanums <- unique(gsub("[^[:digit:]]","", nm[-1])) ## station numbers
present
    z <- do.call(rbind, lapply(stanums,
      \(i)
      structure(dat[,grep(i, nm, fixed = TRUE)],
                names = c("Hs", "Hn", "flag"))))
   data.frame(POSIX =rep(dat[,1], length(stanums)),
              Station = rep(stanums, e = nrow(dat)),
              z)
}

e.g.
> reform(df2)
        POSIX Station Hs Hn flag
1  2001-12-01       1 50 20    0
2  2001-12-02       1 60 20    0
3  2001-12-03       1 70 20    0
4  2001-12-04       1 NA NA   NA
5  2001-12-05       1 NA NA   NA
6  2001-12-01       3 20  0    0
7  2001-12-02       3 20  0    0
8  2001-12-03       3 30 10    0
9  2001-12-04       3 30  0    1
10 2001-12-05       3  0  5    0

A call to rbind() of the following form then gives you all your data in
long form(you may wish to use some shortcuts to form the list of frames):

> do.call(rbind, lapply(list(df1, df2, df3), reform))
        POSIX Station Hs Hn flag
1  2000-12-01       1 30 10    0
2  2000-12-02       1 40 20    0
3  2000-12-03       1 50 10    0
4  2000-12-04       1 NA NA   NA
5  2000-12-05       1 55  5    0
6  2000-12-01       2 20  0    0
7  2000-12-02       2 20  0    0
8  2000-12-03       2 30 10    0
9  2000-12-04       2 30  0    1
10 2000-12-05       2  0  5    0
11 2001-12-01       1 50 20    0
12 2001-12-02       1 60 20    0
13 2001-12-03       1 70 20    0
14 2001-12-04       1 NA NA   NA
15 2001-12-05       1 NA NA   NA
16 2001-12-01       3 20  0    0
17 2001-12-02       3 20  0    0
18 2001-12-03       3 30 10    0
19 2001-12-04       3 30  0    1
20 2001-12-05       3  0  5    0
21 2002-12-01       2 50 20    0
22 2002-12-02       2 60 20    0
23 2002-12-03       2 70 20    0
24 2002-12-04       2 NA NA   NA
25 2002-12-05       2 NA NA   NA
26 2002-12-01       3 20  0    0
27 2002-12-02       3 20  0    0
28 2002-12-03       3 30 10    0
29 2002-12-04       3 30  0    1
30 2002-12-05       3  0  5    0


Cheers,
Bert Gunter




On Wed, Jun 1, 2022 at 11:13 PM Stefano Sofia <
stefano.sofia at regione.marche.it> wrote:

> Dear R-list users,
>
> for each winter season from 2000 to 2022 I have a data frame collecting
> for different weather stations snowpack height (Hs), snowfall in the last
> 24h (Hn) and a validation flag.
>
> Suppose I have these three following data frames
>
>
> df1 <- data.frame(data_POSIX=seq(as.POSIXct("2000-12-01",
> format="%Y-%m-%d", tz="Etc/GMT-1"), as.POSIXct("2000-12-05",
> format="%Y-%m-%d", tz="Etc/GMT-1"), by="1 days"), Station1_Hs = c(30, 40,
> 50, NA, 55), Station1_Hn = c(10, 20, 10, NA, 5), Station1_flag = c(0, 0, 0,
> NA, 0), Station2_Hs = c(20, 20, 30, 30, 0), Station2_Hn = c(0, 0, 10, 0,
> 5), Station2_flag = c(0, 0, 0, 1, 0))
>
>
> df2 <- data.frame(data_POSIX=seq(as.POSIXct("2001-12-01",
> format="%Y-%m-%d", tz="Etc/GMT-1"), as.POSIXct("2001-12-05",
> format="%Y-%m-%d", tz="Etc/GMT-1"), by="1 days"), Station1_Hs = c(50, 60,
> 70, NA, NA), Station1_Hn = c(20, 20, 20, NA, NA), Station1_flag = c(0, 0,
> 0, NA, NA), Station3_Hs = c(20, 20, 30, 30, 0), Station3_Hn = c(0, 0, 10,
> 0, 5), Station3_flag = c(0, 0, 0, 1, 0))
>
>
> df3 <- data.frame(data_POSIX=seq(as.POSIXct("2002-12-01",
> format="%Y-%m-%d", tz="Etc/GMT-1"), as.POSIXct("2002-12-05",
> format="%Y-%m-%d", tz="Etc/GMT-1"), by="1 days"), Station2_Hs = c(50, 60,
> 70, NA, NA), Station2_Hn = c(20, 20, 20, NA, NA), Station2_flag = c(0, 0,
> 0, NA, NA), Station3_Hs = c(20, 20, 30, 30, 0), Station3_Hn = c(0, 0, 10,
> 0, 5), Station3_flag = c(0, 0, 0, 1, 0))
>
>
> As you can see, each data frame can have different stations loaded.
>
> I would need to call rbind matching data frames by column name (i.e. by
> station name), keeping in mind that the number of stations loaded in each
> data frame may differ. The result should be
>
> data_POSIX Station1_Hs Station1_Hn Station1_flag Station2_Hs Station2_Hn
> Station2_flag Station3_Hs Station3_Hn Station3_flag
> 2000-12-01 30 10 0 20 0 0 NA NA NA
> 2000-12-02 40 20 0 20 0 0 NA NA NA
> 2000-12-03 50 10 0 30 10 0 NA NA NA
> 2000-12-04 NA NA NA 30 0 0 NA NA NA
> 2000-12-05 55 5 0 0 5 0 NA NA NA
> 2001-12-01 50 20 0 NA NA NA 20 0 0
> 2001-12-02 60 20 0 NA NA NA 20 0 0
> 2001-12-03 70 20 0 NA NA NA 30 10 0
> 2001-12-04 NA NA NA NA NA NA 30 0 1
> 2001-12-05 NA NA NA NA NA NA 0 5 0
> 2002-12-01 NA NA NA 50 20 0 20 0 0
> 2002-12-02 NA NA NA 60 20 0 20 0 0
> 2002-12-03 NA NA NA 70 20 0 30 10 0
> 2002-12-04 NA NA NA NA NA NA 30 0 1
> 2002-12-05 NA NA NA NA NA NA 0 5 0
>
> I tried this code
>
> df_list <- list(df1, df2, df3)
> allNms <- unique(unlist(lapply(df_list, names)))
> do.call(rbind, c(lapply(df_list, function(x) data.frame(c(x,
> sapply(setdiff(allNms, names(x)), function(y) NA)))), make.row.names=FALSE))
>
> but I get this error:
> Error in (function (..., row.names = NULL, check.rows = FALSE, check.names
> = TRUE,  :
>   arguments imply differing number of rows
>
> Could someone please help me?
>
>
> Thank you for your attention
>
> Stefano
>
>
>          (oo)
> --oOO--( )--OOo--------------------------------------
> Stefano Sofia PhD
> Civil Protection - Marche Region - Italy
> Meteo Section
> Snow Section
> Via del Colle Ameno 5
> 60126 Torrette di Ancona, Ancona (AN)
> Uff: +39 071 806 7743
> E-mail: stefano.sofia at regione.marche.it
> ---Oo---------oO----------------------------------------
>
> ________________________________
>
> AVVISO IMPORTANTE: Questo messaggio di posta elettronica pu? contenere
> informazioni confidenziali, pertanto ? destinato solo a persone autorizzate
> alla ricezione. I messaggi di posta elettronica per i client di Regione
> Marche possono contenere informazioni confidenziali e con privilegi legali.
> Se non si ? il destinatario specificato, non leggere, copiare, inoltrare o
> archiviare questo messaggio. Se si ? ricevuto questo messaggio per errore,
> inoltrarlo al mittente ed eliminarlo completamente dal sistema del proprio
> computer. Ai sensi dell'art. 6 della DGR n. 1394/2008 si segnala che, in
> caso di necessit? ed urgenza, la risposta al presente messaggio di posta
> elettronica pu? essere visionata da persone estranee al destinatario.
> IMPORTANT NOTICE: This e-mail message is intended to be received only by
> persons entitled to receive the confidential information it may contain.
> E-mail messages to clients of Regione Marche may contain information that
> is confidential and legally privileged. Please do not read, copy, forward,
> or store this message unless you are an intended recipient of it. If you
> have received this message in error, please forward it to the sender and
> delete it completely from your computer system.
>
> --
> Questo messaggio  stato analizzato da Libraesva ESG ed  risultato non
> infetto.
> This message was scanned by Libraesva ESG and is believed to be clean.
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From j|ox @end|ng |rom mcm@@ter@c@  Fri Jun  3 02:26:53 2022
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Thu, 2 Jun 2022 20:26:53 -0400
Subject: [R] rbind of multiple data frames by column name,
 when each data frames can contain different columns
In-Reply-To: <18788_1654150401_2526DLjR006367_53bbac255bc84b64beecadbe62c4d092@regione.marche.it>
References: <18788_1654150401_2526DLjR006367_53bbac255bc84b64beecadbe62c4d092@regione.marche.it>
Message-ID: <f453cd34-b3bd-43f5-755b-bf01f7c78fe7@mcmaster.ca>

Dear Stefano,

I don't believe that your question has been answered.

You can use merge(), twice:

------- snip --------

 > merge(merge(df1, df2, all=TRUE), df3, all=TRUE)
    data_POSIX Station2_Hs Station2_Hn Station2_flag Station3_Hs Station3_Hn
1  2000-12-01          20           0             0          NA          NA
2  2000-12-02          20           0             0          NA          NA
3  2000-12-03          30          10             0          NA          NA
4  2000-12-04          30           0             1          NA          NA
5  2000-12-05           0           5             0          NA          NA
6  2001-12-01          NA          NA            NA          20           0
7  2001-12-02          NA          NA            NA          20           0
8  2001-12-03          NA          NA            NA          30          10
9  2001-12-04          NA          NA            NA          30           0
10 2001-12-05          NA          NA            NA           0           5
11 2002-12-01          50          20             0          20           0
12 2002-12-02          60          20             0          20           0
13 2002-12-03          70          20             0          30          10
14 2002-12-04          NA          NA            NA          30           0
15 2002-12-05          NA          NA            NA           0           5
    Station3_flag Station1_Hs Station1_Hn Station1_flag
1             NA          30          10             0
2             NA          40          20             0
3             NA          50          10             0
4             NA          NA          NA            NA
5             NA          55           5             0
6              0          50          20             0
7              0          60          20             0
8              0          70          20             0
9              1          NA          NA            NA
10             0          NA          NA            NA
11             0          NA          NA            NA
12             0          NA          NA            NA
13             0          NA          NA            NA
14             1          NA          NA            NA
15             0          NA          NA            NA

------- snip --------

The columns aren't in the order that you specified but, if that's 
important, you can simply reorder them.

I hope this helps,
  John

-- 
John Fox, Professor Emeritus
McMaster University
Hamilton, Ontario, Canada
web: https://socialsciences.mcmaster.ca/jfox/

On 2022-06-02 2:12 a.m., Stefano Sofia wrote:
> Dear R-list users,
> 
> for each winter season from 2000 to 2022 I have a data frame collecting for different weather stations snowpack height (Hs), snowfall in the last 24h (Hn) and a validation flag.
> 
> Suppose I have these three following data frames
> 
> 
> df1 <- data.frame(data_POSIX=seq(as.POSIXct("2000-12-01", format="%Y-%m-%d", tz="Etc/GMT-1"), as.POSIXct("2000-12-05", format="%Y-%m-%d", tz="Etc/GMT-1"), by="1 days"), Station1_Hs = c(30, 40, 50, NA, 55), Station1_Hn = c(10, 20, 10, NA, 5), Station1_flag = c(0, 0, 0, NA, 0), Station2_Hs = c(20, 20, 30, 30, 0), Station2_Hn = c(0, 0, 10, 0, 5), Station2_flag = c(0, 0, 0, 1, 0))
> 
> 
> df2 <- data.frame(data_POSIX=seq(as.POSIXct("2001-12-01", format="%Y-%m-%d", tz="Etc/GMT-1"), as.POSIXct("2001-12-05", format="%Y-%m-%d", tz="Etc/GMT-1"), by="1 days"), Station1_Hs = c(50, 60, 70, NA, NA), Station1_Hn = c(20, 20, 20, NA, NA), Station1_flag = c(0, 0, 0, NA, NA), Station3_Hs = c(20, 20, 30, 30, 0), Station3_Hn = c(0, 0, 10, 0, 5), Station3_flag = c(0, 0, 0, 1, 0))
> 
> 
> df3 <- data.frame(data_POSIX=seq(as.POSIXct("2002-12-01", format="%Y-%m-%d", tz="Etc/GMT-1"), as.POSIXct("2002-12-05", format="%Y-%m-%d", tz="Etc/GMT-1"), by="1 days"), Station2_Hs = c(50, 60, 70, NA, NA), Station2_Hn = c(20, 20, 20, NA, NA), Station2_flag = c(0, 0, 0, NA, NA), Station3_Hs = c(20, 20, 30, 30, 0), Station3_Hn = c(0, 0, 10, 0, 5), Station3_flag = c(0, 0, 0, 1, 0))
> 
> 
> As you can see, each data frame can have different stations loaded.
> 
> I would need to call rbind matching data frames by column name (i.e. by station name), keeping in mind that the number of stations loaded in each data frame may differ. The result should be
> 
> data_POSIX Station1_Hs Station1_Hn Station1_flag Station2_Hs Station2_Hn Station2_flag Station3_Hs Station3_Hn Station3_flag
> 2000-12-01 30 10 0 20 0 0 NA NA NA
> 2000-12-02 40 20 0 20 0 0 NA NA NA
> 2000-12-03 50 10 0 30 10 0 NA NA NA
> 2000-12-04 NA NA NA 30 0 0 NA NA NA
> 2000-12-05 55 5 0 0 5 0 NA NA NA
> 2001-12-01 50 20 0 NA NA NA 20 0 0
> 2001-12-02 60 20 0 NA NA NA 20 0 0
> 2001-12-03 70 20 0 NA NA NA 30 10 0
> 2001-12-04 NA NA NA NA NA NA 30 0 1
> 2001-12-05 NA NA NA NA NA NA 0 5 0
> 2002-12-01 NA NA NA 50 20 0 20 0 0
> 2002-12-02 NA NA NA 60 20 0 20 0 0
> 2002-12-03 NA NA NA 70 20 0 30 10 0
> 2002-12-04 NA NA NA NA NA NA 30 0 1
> 2002-12-05 NA NA NA NA NA NA 0 5 0
> 
> I tried this code
> 
> df_list <- list(df1, df2, df3)
> allNms <- unique(unlist(lapply(df_list, names)))
> do.call(rbind, c(lapply(df_list, function(x) data.frame(c(x, sapply(setdiff(allNms, names(x)), function(y) NA)))), make.row.names=FALSE))
> 
> but I get this error:
> Error in (function (..., row.names = NULL, check.rows = FALSE, check.names = TRUE,  :
>    arguments imply differing number of rows
> 
> Could someone please help me?
> 
> 
> Thank you for your attention
> 
> Stefano
> 
> 
>           (oo)
> --oOO--( )--OOo--------------------------------------
> Stefano Sofia PhD
> Civil Protection - Marche Region - Italy
> Meteo Section
> Snow Section
> Via del Colle Ameno 5
> 60126 Torrette di Ancona, Ancona (AN)
> Uff: +39 071 806 7743
> E-mail: stefano.sofia at regione.marche.it
> ---Oo---------oO----------------------------------------
> 
> ________________________________
> 
> AVVISO IMPORTANTE: Questo messaggio di posta elettronica pu? contenere informazioni confidenziali, pertanto ? destinato solo a persone autorizzate alla ricezione. I messaggi di posta elettronica per i client di Regione Marche possono contenere informazioni confidenziali e con privilegi legali. Se non si ? il destinatario specificato, non leggere, copiare, inoltrare o archiviare questo messaggio. Se si ? ricevuto questo messaggio per errore, inoltrarlo al mittente ed eliminarlo completamente dal sistema del proprio computer. Ai sensi dell'art. 6 della DGR n. 1394/2008 si segnala che, in caso di necessit? ed urgenza, la risposta al presente messaggio di posta elettronica pu? essere visionata da persone estranee al destinatario.
> IMPORTANT NOTICE: This e-mail message is intended to be received only by persons entitled to receive the confidential information it may contain. E-mail messages to clients of Regione Marche may contain information that is confidential and legally privileged. Please do not read, copy, forward, or store this message unless you are an intended recipient of it. If you have received this message in error, please forward it to the sender and delete it completely from your computer system.
> 
> --
> Questo messaggio  stato analizzato da Libraesva ESG ed  risultato non infetto.
> This message was scanned by Libraesva ESG and is believed to be clean.
> 
> 
> 	[[alternative HTML version deleted]]
> 
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


