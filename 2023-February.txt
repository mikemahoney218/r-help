From ttm|gue|tt @end|ng |rom gm@||@com  Wed Feb  1 04:16:54 2023
From: ttm|gue|tt @end|ng |rom gm@||@com (Michael Milton)
Date: Wed, 1 Feb 2023 14:16:54 +1100
Subject: [R] dyn.load(now = FALSE) not actually lazy?
Message-ID: <CAPZyOoJdGJ6yYhtmTyCR3v+=6H6XprxSsEG5bKwNbOTPqoJdTA@mail.gmail.com>

On Linux, if I have a .so file that has a dependency on another .so, and I
`dyn.load(now=FALSE)` the first one, R seems to try to resolve the symbols
immediately, causing the load to fail.

For example, I have `libtorch` installed on my HPC. Note that it links to
various libs such as `libcudart.so` and `libmkl_intel_lp64.so.2` which
aren't currently in my library path:

?  ~ ldd
/stornext/System/data/nvidia/libtorch-gpu/libtorch-gpu-1.12.1/lib/libtorch_cpu.so
        linux-vdso.so.1 =>  (0x00007ffcab58c000)
        libgomp.so.1 =>
/stornext/System/data/apps/gcc/gcc-11.2.0/lib64/libgomp.so.1
(0x00007f8cb22bf000)
        libpthread.so.0 => /lib64/libpthread.so.0 (0x00007f8cb20a3000)
        libc10.so =>
/stornext/System/data/nvidia/libtorch-gpu/libtorch-gpu-1.12.1/lib/libc10.so
(0x00007f8cb1e2d000)
        libnuma.so.1 => /lib64/libnuma.so.1 (0x00007f8cb1c21000)
        librt.so.1 => /lib64/librt.so.1 (0x00007f8cb1a19000)
        libgcc_s.so.1 =>
/stornext/System/data/apps/gcc/gcc-11.2.0/lib64/libgcc_s.so.1
(0x00007f8cb1801000)
        libdl.so.2 => /lib64/libdl.so.2 (0x00007f8cb15fd000)
        libmkl_intel_lp64.so.2 => not found
        libmkl_gnu_thread.so.2 => not found
        libmkl_core.so.2 => not found
        libm.so.6 => /lib64/libm.so.6 (0x00007f8cb12fb000)
        libcudart.so.11.0 => not found

Then in R, if I try to load that same file:

>
dyn.load("/stornext/System/data/nvidia/libtorch-gpu/libtorch-gpu-1.12.1/lib/libtorch_cpu.so",
now=FALSE)
Error in
dyn.load("/stornext/System/data/nvidia/libtorch-gpu/libtorch-gpu-1.12.1/lib/libtorch_cpu.so",
 :
  unable to load shared object
'/stornext/System/data/nvidia/libtorch-gpu/libtorch-gpu-1.12.1/lib/libtorch_cpu.so':
  libmkl_intel_lp64.so.2: cannot open shared object file: No such file or
directory

Is this a bug in the `dyn.load` implementation for R? If not, why is it
behaving like this? What should I do about it?

For reference, I'm on CentOS 7, with Linux
kernel 3.10.0-1160.81.1.el7.x86_64.

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Wed Feb  1 10:42:21 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 1 Feb 2023 04:42:21 -0500
Subject: [R] dyn.load(now = FALSE) not actually lazy?
In-Reply-To: <CAPZyOoJdGJ6yYhtmTyCR3v+=6H6XprxSsEG5bKwNbOTPqoJdTA@mail.gmail.com>
References: <CAPZyOoJdGJ6yYhtmTyCR3v+=6H6XprxSsEG5bKwNbOTPqoJdTA@mail.gmail.com>
Message-ID: <f28795b0-fa8a-fbb8-2fd5-9321734a9174@gmail.com>

According to the help page for dyn.load, I think this is within the 
allowed behaviour:

"now:
a logical controlling whether all symbols are resolved (and relocated) 
immediately the library is loaded or deferred until they are used. This 
control is useful for developers testing whether a library is complete 
and has all the necessary symbols, and for users to ignore missing 
symbols. Whether this has any effect is system-dependent."

It appears to be intended for a DLL that doesn't define all the symbols 
that your program will use, not for a DLL that has external references 
that can't be resolved.  And there's that last sentence.

I think for what you want, you'd have to write the DLL (i.e. libtorch) 
in such a way that it does delayed loading of its dependencies.

Duncan Murdoch

On 31/01/2023 10:16 p.m., Michael Milton wrote:
> On Linux, if I have a .so file that has a dependency on another .so, and I
> `dyn.load(now=FALSE)` the first one, R seems to try to resolve the symbols
> immediately, causing the load to fail.
> 
> For example, I have `libtorch` installed on my HPC. Note that it links to
> various libs such as `libcudart.so` and `libmkl_intel_lp64.so.2` which
> aren't currently in my library path:
> 
> ?  ~ ldd
> /stornext/System/data/nvidia/libtorch-gpu/libtorch-gpu-1.12.1/lib/libtorch_cpu.so
>          linux-vdso.so.1 =>  (0x00007ffcab58c000)
>          libgomp.so.1 =>
> /stornext/System/data/apps/gcc/gcc-11.2.0/lib64/libgomp.so.1
> (0x00007f8cb22bf000)
>          libpthread.so.0 => /lib64/libpthread.so.0 (0x00007f8cb20a3000)
>          libc10.so =>
> /stornext/System/data/nvidia/libtorch-gpu/libtorch-gpu-1.12.1/lib/libc10.so
> (0x00007f8cb1e2d000)
>          libnuma.so.1 => /lib64/libnuma.so.1 (0x00007f8cb1c21000)
>          librt.so.1 => /lib64/librt.so.1 (0x00007f8cb1a19000)
>          libgcc_s.so.1 =>
> /stornext/System/data/apps/gcc/gcc-11.2.0/lib64/libgcc_s.so.1
> (0x00007f8cb1801000)
>          libdl.so.2 => /lib64/libdl.so.2 (0x00007f8cb15fd000)
>          libmkl_intel_lp64.so.2 => not found
>          libmkl_gnu_thread.so.2 => not found
>          libmkl_core.so.2 => not found
>          libm.so.6 => /lib64/libm.so.6 (0x00007f8cb12fb000)
>          libcudart.so.11.0 => not found
> 
> Then in R, if I try to load that same file:
> 
>>
> dyn.load("/stornext/System/data/nvidia/libtorch-gpu/libtorch-gpu-1.12.1/lib/libtorch_cpu.so",
> now=FALSE)
> Error in
> dyn.load("/stornext/System/data/nvidia/libtorch-gpu/libtorch-gpu-1.12.1/lib/libtorch_cpu.so",
>   :
>    unable to load shared object
> '/stornext/System/data/nvidia/libtorch-gpu/libtorch-gpu-1.12.1/lib/libtorch_cpu.so':
>    libmkl_intel_lp64.so.2: cannot open shared object file: No such file or
> directory
> 
> Is this a bug in the `dyn.load` implementation for R? If not, why is it
> behaving like this? What should I do about it?
> 
> For reference, I'm on CentOS 7, with Linux
> kernel 3.10.0-1160.81.1.el7.x86_64.
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From kry|ov@r00t @end|ng |rom gm@||@com  Wed Feb  1 11:05:46 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 1 Feb 2023 13:05:46 +0300
Subject: [R] dyn.load(now = FALSE) not actually lazy?
In-Reply-To: <CAPZyOoJdGJ6yYhtmTyCR3v+=6H6XprxSsEG5bKwNbOTPqoJdTA@mail.gmail.com>
References: <CAPZyOoJdGJ6yYhtmTyCR3v+=6H6XprxSsEG5bKwNbOTPqoJdTA@mail.gmail.com>
Message-ID: <20230201130546.7b8abeba@arachnoid>

? Wed, 1 Feb 2023 14:16:54 +1100
Michael Milton <ttmigueltt at gmail.com> ?????:

> Is this a bug in the `dyn.load` implementation for R? If not, why is
> it behaving like this? What should I do about it?

On Unix-like systems, dyn.load forwards its arguments to dlopen(). It
should be possible to confirm with a debugger that R passes RTLD_NOW to
dlopen() when calling dyn.load(now = TRUE) and RTLD_LAZY when calling
dyn.load(now = FALSE).

I don't know for sure why the symbols are being resolved despite you
asked the linker not to. Did something in the system set the
LD_BIND_NOW environment variable? Do any of the libraries in the
dependency tree have any constructors (C++ or
__attribute__((constructor)) or otherwise mentioned in .ini* sections)
that rely on MKL being available at initialisation time?

If you launch R with the environment variable LD_DEBUG=libs set, the
debugging output may shine some light on the problem.

-- 
Best regards,
Ivan


From n|ckmwr@y @end|ng |rom gm@||@com  Wed Feb  1 17:07:51 2023
From: n|ckmwr@y @end|ng |rom gm@||@com (Nick Wray)
Date: Wed, 1 Feb 2023 16:07:51 +0000
Subject: [R] Detpack package
Message-ID: <CABxY9BP_j4Orh8WJv3k30egpTd7X-ins4Zbdq4FJBe9vtwsapA@mail.gmail.com>

Hello   I've successfully installed the package "Detpack" and remembered to
call it via library()  But when I try to use the functions i get this:


chi2testuniform(vals, 0.05)

Error in chi2testuniform(vals, 0.05) :
  could not find function "chi2testuniform"


And yet this function (amongst other which also are not recognised) are all
listed on the CRAN page:
http://cran.nexr.com/web/packages/detpack/detpack.pdf

I can't remember anything like this happening before - as far as I can see
I don't need to load or write anything else before executing the function
and I can't find references to any problems with this package on the net
Can anyone cast light on what's happening?  Thanks Nick Wray

	[[alternative HTML version deleted]]


From er|cjberger @end|ng |rom gm@||@com  Wed Feb  1 17:29:26 2023
From: er|cjberger @end|ng |rom gm@||@com (Eric Berger)
Date: Wed, 1 Feb 2023 18:29:26 +0200
Subject: [R] Detpack package
In-Reply-To: <CABxY9BP_j4Orh8WJv3k30egpTd7X-ins4Zbdq4FJBe9vtwsapA@mail.gmail.com>
References: <CABxY9BP_j4Orh8WJv3k30egpTd7X-ins4Zbdq4FJBe9vtwsapA@mail.gmail.com>
Message-ID: <CAGgJW74mKv3zoOVqDDhi_FLQ-42VkwzbmH5t4=1D3gskgJ7OQQ@mail.gmail.com>

Detpack or detpack?

What happens when you try detpack::chi2testuniform(...) ?


On Wed, Feb 1, 2023 at 6:08 PM Nick Wray <nickmwray at gmail.com> wrote:

> Hello   I've successfully installed the package "Detpack" and remembered to
> call it via library()  But when I try to use the functions i get this:
>
>
> chi2testuniform(vals, 0.05)
>
> Error in chi2testuniform(vals, 0.05) :
>   could not find function "chi2testuniform"
>
>
> And yet this function (amongst other which also are not recognised) are all
> listed on the CRAN page:
> http://cran.nexr.com/web/packages/detpack/detpack.pdf
>
> I can't remember anything like this happening before - as far as I can see
> I don't need to load or write anything else before executing the function
> and I can't find references to any problems with this package on the net
> Can anyone cast light on what's happening?  Thanks Nick Wray
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From n|ckmwr@y @end|ng |rom gm@||@com  Wed Feb  1 17:41:15 2023
From: n|ckmwr@y @end|ng |rom gm@||@com (Nick Wray)
Date: Wed, 1 Feb 2023 16:41:15 +0000
Subject: [R] Detpack package
In-Reply-To: <CAGgJW74mKv3zoOVqDDhi_FLQ-42VkwzbmH5t4=1D3gskgJ7OQQ@mail.gmail.com>
References: <CABxY9BP_j4Orh8WJv3k30egpTd7X-ins4Zbdq4FJBe9vtwsapA@mail.gmail.com>
 <CAGgJW74mKv3zoOVqDDhi_FLQ-42VkwzbmH5t4=1D3gskgJ7OQQ@mail.gmail.com>
Message-ID: <CABxY9BOKrt6mRubbpi_sT2og45Q9kjPZozyRCejw_3VWbtRNbA@mail.gmail.com>

I did use "detpack" ie not with a capital

detpack::chi2testuniform(vals,0.05)
gives this:

Error: 'chi2testuniform' is not an exported object from 'namespace:detpack'
??
Thanks Nick


On Wed, 1 Feb 2023 at 16:29, Eric Berger <ericjberger at gmail.com> wrote:

> Detpack or detpack?
>
> What happens when you try detpack::chi2testuniform(...) ?
>
>
> On Wed, Feb 1, 2023 at 6:08 PM Nick Wray <nickmwray at gmail.com> wrote:
>
>> Hello   I've successfully installed the package "Detpack" and remembered
>> to
>> call it via library()  But when I try to use the functions i get this:
>>
>>
>> chi2testuniform(vals, 0.05)
>>
>> Error in chi2testuniform(vals, 0.05) :
>>   could not find function "chi2testuniform"
>>
>>
>> And yet this function (amongst other which also are not recognised) are
>> all
>> listed on the CRAN page:
>> http://cran.nexr.com/web/packages/detpack/detpack.pdf
>>
>> I can't remember anything like this happening before - as far as I can see
>> I don't need to load or write anything else before executing the function
>> and I can't find references to any problems with this package on the net
>> Can anyone cast light on what's happening?  Thanks Nick Wray
>>
>>         [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide
>> http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
>>
>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Wed Feb  1 18:32:43 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 1 Feb 2023 12:32:43 -0500
Subject: [R] Detpack package
In-Reply-To: <CABxY9BOKrt6mRubbpi_sT2og45Q9kjPZozyRCejw_3VWbtRNbA@mail.gmail.com>
References: <CABxY9BP_j4Orh8WJv3k30egpTd7X-ins4Zbdq4FJBe9vtwsapA@mail.gmail.com>
 <CAGgJW74mKv3zoOVqDDhi_FLQ-42VkwzbmH5t4=1D3gskgJ7OQQ@mail.gmail.com>
 <CABxY9BOKrt6mRubbpi_sT2og45Q9kjPZozyRCejw_3VWbtRNbA@mail.gmail.com>
Message-ID: <734b74e7-494d-e0d6-0ea7-dab9962e4d54@gmail.com>

On 01/02/2023 11:41 a.m., Nick Wray wrote:
> I did use "detpack" ie not with a capital
> 
> detpack::chi2testuniform(vals,0.05)
> gives this:
> 
> Error: 'chi2testuniform' is not an exported object from 'namespace:detpack'
> ??
> Thanks Nick
> 

The only exports from detpack are these:

   > library(detpack)
   > ls(2)
   [1] "det.construct" "det.cut"       "det.de"        "det.leafs" 
"det.query"     "det.rnd"       "det1"
   [8] "det2"

It looks as though the author of detpack documented chi2testuniform, but 
forgot to export it.  You can see the source of the version on CRAN here:

   https://github.com/cran/detpack

The author used Roxygen2, but apparently forgot to say @export before 
that function (and some others).  The package tests perfectly OK on 
CRAN, because none of the examples made it into the help pages, where 
they would have failed.

Duncan Murdoch


From ttm|gue|tt @end|ng |rom gm@||@com  Thu Feb  2 03:35:39 2023
From: ttm|gue|tt @end|ng |rom gm@||@com (Michael Milton)
Date: Thu, 2 Feb 2023 13:35:39 +1100
Subject: [R] dyn.load(now = FALSE) not actually lazy?
In-Reply-To: <20230201130546.7b8abeba@arachnoid>
References: <CAPZyOoJdGJ6yYhtmTyCR3v+=6H6XprxSsEG5bKwNbOTPqoJdTA@mail.gmail.com>
 <20230201130546.7b8abeba@arachnoid>
Message-ID: <CAPZyOo+JJeYW9VAVy_Lcyoa9zWxyOAj8cKetKwf5Pm_i6pPQxw@mail.gmail.com>

Hi Ivan,

Thanks for the suggestion.

I found that libpqwalreceiver.so, which is part of pgsql-15.1, made for a
simpler example of my issue. So, using your advice, I ran the following in
my shell:
LD_DEBUG=libs R -e
'dyn.load("/stornext/System/data/tools/pgsql/pgsql-15.1/lib/libpqwalreceiver.so",
now=FALSE)'

I have attached the relevant part of the output from this command below.
The gist of it is that, indeed, R starts to look for dependent libraries
even if now=FALSE. Maybe it is the case that, as Duncan suggests, this is
intended behaviour? But I think it's not ideal behaviour because otherwise
it requires you to topologically sort all library dependencies and load
them in the optimal order, which is very difficult to do. Is there someone
involved in R development who can explain this behaviour to me?

Cheers.

***

>
dyn.load("/stornext/System/data/tools/pgsql/pgsql-15.1/lib/libpqwalreceiver.so",
now=FALSE)
      1655:     find library=libpq.so.5 [0]; searching
      1655:      search
path=/stornext/System/data/apps/gcc/gcc-11.1.0/lib64:/stornext/System/data/apps/pcre2/pcre2-10.36-gcc-11.1.0/lib:/stornext/System/data/tools/openSSL/openSSL-1.1.1n/lib:/stornext/System/data/apps/R/R-4.2.1/lib64/R/lib:/usr/local/lib64:/stornext/System/data/tools/openjdk/openjdk-13.0.2/lib/server:/stornext/System/data/apps/hdf5/hdf5-1.8.20/lib
        (LD_LIBRARY_PATH)
      1655:       trying
file=/stornext/System/data/apps/gcc/gcc-11.1.0/lib64/libpq.so.5
      1655:       trying
file=/stornext/System/data/apps/pcre2/pcre2-10.36-gcc-11.1.0/lib/libpq.so.5
      1655:       trying
file=/stornext/System/data/tools/openSSL/openSSL-1.1.1n/lib/libpq.so.5
      1655:       trying
file=/stornext/System/data/apps/R/R-4.2.1/lib64/R/lib/libpq.so.5
      1655:       trying file=/usr/local/lib64/libpq.so.5
      1655:       trying
file=/stornext/System/data/tools/openjdk/openjdk-13.0.2/lib/server/libpq.so.5
      1655:       trying
file=/stornext/System/data/apps/hdf5/hdf5-1.8.20/lib/libpq.so.5
      1655:      search
path=/usr/pgsql-15/lib/tls/x86_64:/usr/pgsql-15/lib/tls:/usr/pgsql-15/lib/x86_64:/usr/pgsql-15/lib
             (RUNPATH from file
/stornext/System/data/tools/pgsql/pgsql-15.1/lib/libpqwalreceiver.so)
      1655:       trying file=/usr/pgsql-15/lib/tls/x86_64/libpq.so.5
      1655:       trying file=/usr/pgsql-15/lib/tls/libpq.so.5
      1655:       trying file=/usr/pgsql-15/lib/x86_64/libpq.so.5
      1655:       trying file=/usr/pgsql-15/lib/libpq.so.5
      1655:      search cache=/etc/ld.so.cache
      1655:       trying file=/lib64/libpq.so.5
      1655:
      1655:     find library=libssl.so.10 [0]; searching
      1655:      search
path=/stornext/System/data/apps/gcc/gcc-11.1.0/lib64:/stornext/System/data/apps/pcre2/pcre2-10.36-gcc-11.1.0/lib:/stornext/System/data/tools/openSSL/openSSL-1.1.1n/lib:/stornext/System/data/apps/R/R-4.2.1/lib64/R/lib:/usr/local/lib64:/stornext/System/data/tools/openjdk/openjdk-13.0.2/lib/server:/stornext/System/data/apps/hdf5/hdf5-1.8.20/lib
        (LD_LIBRARY_PATH)
      1655:       trying
file=/stornext/System/data/apps/gcc/gcc-11.1.0/lib64/libssl.so.10
      1655:       trying
file=/stornext/System/data/apps/pcre2/pcre2-10.36-gcc-11.1.0/lib/libssl.so.10
      1655:       trying
file=/stornext/System/data/tools/openSSL/openSSL-1.1.1n/lib/libssl.so.10
      1655:       trying
file=/stornext/System/data/apps/R/R-4.2.1/lib64/R/lib/libssl.so.10
      1655:       trying file=/usr/local/lib64/libssl.so.10
      1655:       trying
file=/stornext/System/data/tools/openjdk/openjdk-13.0.2/lib/server/libssl.so.10
      1655:       trying
file=/stornext/System/data/apps/hdf5/hdf5-1.8.20/lib/libssl.so.10
      1655:      search cache=/etc/ld.so.cache
      1655:       trying file=/lib64/libssl.so.10
      1655:
      1655:     find library=libcrypto.so.10 [0]; searching
      1655:      search
path=/stornext/System/data/apps/gcc/gcc-11.1.0/lib64:/stornext/System/data/apps/pcre2/pcre2-10.36-gcc-11.1.0/lib:/stornext/System/data/tools/openSSL/openSSL-1.1.1n/lib:/stornext/System/data/apps/R/R-4.2.1/lib64/R/lib:/usr/local/lib64:/stornext/System/data/tools/openjdk/openjdk-13.0.2/lib/server:/stornext/System/data/apps/hdf5/hdf5-1.8.20/lib
        (LD_LIBRARY_PATH)
      1655:       trying
file=/stornext/System/data/apps/gcc/gcc-11.1.0/lib64/libcrypto.so.10
      1655:       trying
file=/stornext/System/data/apps/pcre2/pcre2-10.36-gcc-11.1.0/lib/libcrypto.so.10
      1655:       trying
file=/stornext/System/data/tools/openSSL/openSSL-1.1.1n/lib/libcrypto.so.10
      1655:       trying
file=/stornext/System/data/apps/R/R-4.2.1/lib64/R/lib/libcrypto.so.10
      1655:       trying file=/usr/local/lib64/libcrypto.so.10
      1655:       trying
file=/stornext/System/data/tools/openjdk/openjdk-13.0.2/lib/server/libcrypto.so.10
      1655:       trying
file=/stornext/System/data/apps/hdf5/hdf5-1.8.20/lib/libcrypto.so.10
      1655:      search cache=/etc/ld.so.cache
      1655:       trying file=/lib64/libcrypto.so.10
      1655:
      1655:     find library=libkrb5.so.3 [0]; searching
      1655:      search
path=/stornext/System/data/apps/gcc/gcc-11.1.0/lib64:/stornext/System/data/apps/pcre2/pcre2-10.36-gcc-11.1.0/lib:/stornext/System/data/tools/openSSL/openSSL-1.1.1n/lib:/stornext/System/data/apps/R/R-4.2.1/lib64/R/lib:/usr/local/lib64:/stornext/System/data/tools/openjdk/openjdk-13.0.2/lib/server:/stornext/System/data/apps/hdf5/hdf5-1.8.20/lib
        (LD_LIBRARY_PATH)
      1655:       trying
file=/stornext/System/data/apps/gcc/gcc-11.1.0/lib64/libkrb5.so.3
      1655:       trying
file=/stornext/System/data/apps/pcre2/pcre2-10.36-gcc-11.1.0/lib/libkrb5.so.3
      1655:       trying
file=/stornext/System/data/tools/openSSL/openSSL-1.1.1n/lib/libkrb5.so.3
      1655:       trying
file=/stornext/System/data/apps/R/R-4.2.1/lib64/R/lib/libkrb5.so.3
      1655:       trying file=/usr/local/lib64/libkrb5.so.3
      1655:       trying
file=/stornext/System/data/tools/openjdk/openjdk-13.0.2/lib/server/libkrb5.so.3
      1655:       trying
file=/stornext/System/data/apps/hdf5/hdf5-1.8.20/lib/libkrb5.so.3
      1655:      search cache=/etc/ld.so.cache
      1655:       trying file=/lib64/libkrb5.so.3
      1655:
      1655:     find library=libcom_err.so.2 [0]; searching
      1655:      search
path=/stornext/System/data/apps/gcc/gcc-11.1.0/lib64:/stornext/System/data/apps/pcre2/pcre2-10.36-gcc-11.1.0/lib:/stornext/System/data/tools/openSSL/openSSL-1.1.1n/lib:/stornext/System/data/apps/R/R-4.2.1/lib64/R/lib:/usr/local/lib64:/stornext/System/data/tools/openjdk/openjdk-13.0.2/lib/server:/stornext/System/data/apps/hdf5/hdf5-1.8.20/lib
        (LD_LIBRARY_PATH)
      1655:       trying
file=/stornext/System/data/apps/gcc/gcc-11.1.0/lib64/libcom_err.so.2
      1655:       trying
file=/stornext/System/data/apps/pcre2/pcre2-10.36-gcc-11.1.0/lib/libcom_err.so.2
      1655:       trying
file=/stornext/System/data/tools/openSSL/openSSL-1.1.1n/lib/libcom_err.so.2
      1655:       trying
file=/stornext/System/data/apps/R/R-4.2.1/lib64/R/lib/libcom_err.so.2
      1655:       trying file=/usr/local/lib64/libcom_err.so.2
      1655:       trying
file=/stornext/System/data/tools/openjdk/openjdk-13.0.2/lib/server/libcom_err.so.2
      1655:       trying
file=/stornext/System/data/apps/hdf5/hdf5-1.8.20/lib/libcom_err.so.2
      1655:      search cache=/etc/ld.so.cache
      1655:       trying file=/lib64/libcom_err.so.2
      1655:
      1655:     find library=libgssapi_krb5.so.2 [0]; searching
      1655:      search
path=/stornext/System/data/apps/gcc/gcc-11.1.0/lib64:/stornext/System/data/apps/pcre2/pcre2-10.36-gcc-11.1.0/lib:/stornext/System/data/tools/openSSL/openSSL-1.1.1n/lib:/stornext/System/data/apps/R/R-4.2.1/lib64/R/lib:/usr/local/lib64:/stornext/System/data/tools/openjdk/openjdk-13.0.2/lib/server:/stornext/System/data/apps/hdf5/hdf5-1.8.20/lib
        (LD_LIBRARY_PATH)
      1655:       trying
file=/stornext/System/data/apps/gcc/gcc-11.1.0/lib64/libgssapi_krb5.so.2
      1655:       trying
file=/stornext/System/data/apps/pcre2/pcre2-10.36-gcc-11.1.0/lib/libgssapi_krb5.so.2
      1655:       trying
file=/stornext/System/data/tools/openSSL/openSSL-1.1.1n/lib/libgssapi_krb5.so.2
      1655:       trying
file=/stornext/System/data/apps/R/R-4.2.1/lib64/R/lib/libgssapi_krb5.so.2
      1655:       trying file=/usr/local/lib64/libgssapi_krb5.so.2
      1655:       trying
file=/stornext/System/data/tools/openjdk/openjdk-13.0.2/lib/server/libgssapi_krb5.so.2
      1655:       trying
file=/stornext/System/data/apps/hdf5/hdf5-1.8.20/lib/libgssapi_krb5.so.2
      1655:      search cache=/etc/ld.so.cache
      1655:       trying file=/lib64/libgssapi_krb5.so.2
      1655:
      1655:     find library=libldap_r-2.4.so.2 [0]; searching
      1655:      search
path=/stornext/System/data/apps/gcc/gcc-11.1.0/lib64:/stornext/System/data/apps/pcre2/pcre2-10.36-gcc-11.1.0/lib:/stornext/System/data/tools/openSSL/openSSL-1.1.1n/lib:/stornext/System/data/apps/R/R-4.2.1/lib64/R/lib:/usr/local/lib64:/stornext/System/data/tools/openjdk/openjdk-13.0.2/lib/server:/stornext/System/data/apps/hdf5/hdf5-1.8.20/lib
        (LD_LIBRARY_PATH)
      1655:       trying
file=/stornext/System/data/apps/gcc/gcc-11.1.0/lib64/libldap_r-2.4.so.2
      1655:       trying
file=/stornext/System/data/apps/pcre2/pcre2-10.36-gcc-11.1.0/lib/libldap_r-2.4.so.2
      1655:       trying
file=/stornext/System/data/tools/openSSL/openSSL-1.1.1n/lib/libldap_r-2.4.so.2
      1655:       trying
file=/stornext/System/data/apps/R/R-4.2.1/lib64/R/lib/libldap_r-2.4.so.2
      1655:       trying file=/usr/local/lib64/libldap_r-2.4.so.2
      1655:       trying
file=/stornext/System/data/tools/openjdk/openjdk-13.0.2/lib/server/libldap_r-2.4.so.2
      1655:       trying
file=/stornext/System/data/apps/hdf5/hdf5-1.8.20/lib/libldap_r-2.4.so.2
D_LIBRARY_PATH)
      1655:       trying
file=/stornext/System/data/apps/gcc/gcc-11.1.0/lib64/libplc4.so
      1655:       trying
file=/stornext/System/data/apps/pcre2/pcre2-10.36-gcc-11.1.0/lib/libplc4.so
      1655:       trying
file=/stornext/System/data/tools/openSSL/openSSL-1.1.1n/lib/libplc4.so
      1655:       trying
file=/stornext/System/data/apps/R/R-4.2.1/lib64/R/lib/libplc4.so
      1655:       trying file=/usr/local/lib64/libplc4.so
      1655:       trying
file=/stornext/System/data/tools/openjdk/openjdk-13.0.2/lib/server/libplc4.so
      1655:       trying
file=/stornext/System/data/apps/hdf5/hdf5-1.8.20/lib/libplc4.so
      1655:      search cache=/etc/ld.so.cache
      1655:       trying file=/lib64/libplc4.so
      1655:
      1655:     find library=libnspr4.so [0]; searching
      1655:      search
path=/stornext/System/data/apps/gcc/gcc-11.1.0/lib64:/stornext/System/data/apps/pcre2/pcre2-10.36-gcc-11.1.0/lib:/stornext/System/data/tools/openSSL/openSSL-1.1.1n/lib:/stornext/System/data/apps/R/R-4.2.1/lib64/R/lib:/usr/local/lib64:/stornext/System/data/tools/openjdk/openjdk-13.0.2/lib/server:/stornext/System/data/apps/hdf5/hdf5-1.8.20/lib
        (LD_LIBRARY_PATH)
      1655:       trying
file=/stornext/System/data/apps/gcc/gcc-11.1.0/lib64/libnspr4.so
      1655:       trying
file=/stornext/System/data/apps/pcre2/pcre2-10.36-gcc-11.1.0/lib/libnspr4.so
      1655:       trying
file=/stornext/System/data/tools/openSSL/openSSL-1.1.1n/lib/libnspr4.so
      1655:       trying
file=/stornext/System/data/apps/R/R-4.2.1/lib64/R/lib/libnspr4.so
      1655:       trying file=/usr/local/lib64/libnspr4.so
      1655:       trying
file=/stornext/System/data/tools/openjdk/openjdk-13.0.2/lib/server/libnspr4.so
      1655:       trying
file=/stornext/System/data/apps/hdf5/hdf5-1.8.20/lib/libnspr4.so
      1655:      search cache=/etc/ld.so.cache
      1655:       trying file=/lib64/libnspr4.so
      1655:
      1655:     find library=libselinux.so.1 [0]; searching
      1655:      search
path=/stornext/System/data/apps/gcc/gcc-11.1.0/lib64:/stornext/System/data/apps/pcre2/pcre2-10.36-gcc-11.1.0/lib:/stornext/System/data/tools/openSSL/openSSL-1.1.1n/lib:/stornext/System/data/apps/R/R-4.2.1/lib64/R/lib:/usr/local/lib64:/stornext/System/data/tools/openjdk/openjdk-13.0.2/lib/server:/stornext/System/data/apps/hdf5/hdf5-1.8.20/lib
        (LD_LIBRARY_PATH)
      1655:       trying
file=/stornext/System/data/apps/gcc/gcc-11.1.0/lib64/libselinux.so.1
      1655:       trying
file=/stornext/System/data/apps/pcre2/pcre2-10.36-gcc-11.1.0/lib/libselinux.so.1
      1655:       trying
file=/stornext/System/data/tools/openSSL/openSSL-1.1.1n/lib/libselinux.so.1
      1655:       trying
file=/stornext/System/data/apps/R/R-4.2.1/lib64/R/lib/libselinux.so.1
      1655:       trying file=/usr/local/lib64/libselinux.so.1
      1655:       trying
file=/stornext/System/data/tools/openjdk/openjdk-13.0.2/lib/server/libselinux.so.1
      1655:       trying
file=/stornext/System/data/apps/hdf5/hdf5-1.8.20/lib/libselinux.so.1
      1655:      search cache=/etc/ld.so.cache
      1655:       trying file=/lib64/libselinux.so.1
      1655:
      1655:     find library=libpcre.so.1 [0]; searching
      1655:      search
path=/stornext/System/data/apps/gcc/gcc-11.1.0/lib64:/stornext/System/data/apps/pcre2/pcre2-10.36-gcc-11.1.0/lib:/stornext/System/data/tools/openSSL/openSSL-1.1.1n/lib:/stornext/System/data/apps/R/R-4.2.1/lib64/R/lib:/usr/local/lib64:/stornext/System/data/tools/openjdk/openjdk-13.0.2/lib/server:/stornext/System/data/apps/hdf5/hdf5-1.8.20/lib
        (LD_LIBRARY_PATH)
      1655:       trying
file=/stornext/System/data/apps/gcc/gcc-11.1.0/lib64/libpcre.so.1
      1655:       trying
file=/stornext/System/data/apps/pcre2/pcre2-10.36-gcc-11.1.0/lib/libpcre.so.1
      1655:       trying
file=/stornext/System/data/tools/openSSL/openSSL-1.1.1n/lib/libpcre.so.1
      1655:       trying
file=/stornext/System/data/apps/R/R-4.2.1/lib64/R/lib/libpcre.so.1
      1655:       trying file=/usr/local/lib64/libpcre.so.1
      1655:       trying
file=/stornext/System/data/tools/openjdk/openjdk-13.0.2/lib/server/libpcre.so.1
      1655:       trying
file=/stornext/System/data/apps/hdf5/hdf5-1.8.20/lib/libpcre.so.1
      1655:      search cache=/etc/ld.so.cache
      1655:       trying file=/lib64/libpcre.so.1
      1655:
      1655:
/stornext/System/data/tools/pgsql/pgsql-15.1/lib/libpqwalreceiver.so:
error: symbol lookup error: undefined symbol: work_mem (fatal)
Error in
dyn.load("/stornext/System/data/tools/pgsql/pgsql-15.1/lib/libpqwalreceiver.so",
 :
  unable to load shared object
'/stornext/System/data/tools/pgsql/pgsql-15.1/lib/libpqwalreceiver.so':
  /stornext/System/data/tools/pgsql/pgsql-15.1/lib/libpqwalreceiver.so:
undefined symbol: work_mem
Execution halted

On Wed, Feb 1, 2023 at 9:05 PM Ivan Krylov <krylov.r00t at gmail.com> wrote:

> ? Wed, 1 Feb 2023 14:16:54 +1100
> Michael Milton <ttmigueltt at gmail.com> ?????:
>
> > Is this a bug in the `dyn.load` implementation for R? If not, why is
> > it behaving like this? What should I do about it?
>
> On Unix-like systems, dyn.load forwards its arguments to dlopen(). It
> should be possible to confirm with a debugger that R passes RTLD_NOW to
> dlopen() when calling dyn.load(now = TRUE) and RTLD_LAZY when calling
> dyn.load(now = FALSE).
>
> I don't know for sure why the symbols are being resolved despite you
> asked the linker not to. Did something in the system set the
> LD_BIND_NOW environment variable? Do any of the libraries in the
> dependency tree have any constructors (C++ or
> __attribute__((constructor)) or otherwise mentioned in .ini* sections)
> that rely on MKL being available at initialisation time?
>
> If you launch R with the environment variable LD_DEBUG=libs set, the
> debugging output may shine some light on the problem.
>
> --
> Best regards,
> Ivan
>

	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Thu Feb  2 10:10:25 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Thu, 2 Feb 2023 12:10:25 +0300
Subject: [R] dyn.load(now = FALSE) not actually lazy?
In-Reply-To: <CAPZyOo+JJeYW9VAVy_Lcyoa9zWxyOAj8cKetKwf5Pm_i6pPQxw@mail.gmail.com>
References: <CAPZyOoJdGJ6yYhtmTyCR3v+=6H6XprxSsEG5bKwNbOTPqoJdTA@mail.gmail.com>
 <20230201130546.7b8abeba@arachnoid>
 <CAPZyOo+JJeYW9VAVy_Lcyoa9zWxyOAj8cKetKwf5Pm_i6pPQxw@mail.gmail.com>
Message-ID: <20230202121025.62464120@arachnoid>

? Thu, 2 Feb 2023 13:35:39 +1100
Michael Milton <ttmigueltt at gmail.com> ?????:

> The gist of it is that, indeed, R starts to look for dependent
> libraries even if now=FALSE.

I don't think that R does that. Here's a program that should do the
same thing that R does when you call dyn.load(now = FALSE):

#include <dlfcn.h>
#include <stdio.h>

int main(int argc, char ** argv) {
	if (argc != 2) {
		printf("Usage: %s path/to/library.so\n", argv[0]);
		return -1;
	}

	void * ptr = dlopen(argv[1], RTLD_LAZY);
	if (!ptr) {
		printf("%s\n", dlerror());
		return 1;
	}

	dlclose(ptr);
	return 0;
}

Link it with -ldl. If you launch it with LD_DEBUG=all (see also: the
output when you launch something with LD_DEBUG=help), it should give you
even more information about the shared object loading process.

> /stornext/System/data/tools/pgsql/pgsql-15.1/lib/libpqwalreceiver.so:
> error: symbol lookup error: undefined symbol: work_mem (fatal)

I think I have an explanation for this. work_mem turns out to be a
global variable, not a function:

https://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/include/miscadmin.h;h=96b3a1e1a0770bdbc25701b5a41e2001a7222b3b;hb=117d2604c2a59eb853e894410b94b4c453f8bd43#l261
https://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/init/globals.c;h=1b1d8142548aaf1234fcf1fc92753b9a8b8b3537;hb=117d2604c2a59eb853e894410b94b4c453f8bd43#l125

Indeed, libpqwalreceiver includes the header where the variable is
declared and accesses it:

https://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/replication/libpqwalreceiver/libpqwalreceiver.c;h=560ec974fa71444f1cb90e5098cef3c712e5b758;hb=117d2604c2a59eb853e894410b94b4c453f8bd43#l968

I guess that there's no way for the dynamic loader to postpone the
resolution of an import that's a variable, because it has to be a
pointer where the code should be able to read and write data. For
functions, there's stubs in the procedure linkage table that can
resolve the symbol later because they are functions and can do anything.

I could be wrong about my explanation. If you'd like to learn more
about this topic, one way to do that would be to start with Ulrich
Drepper's articles: https://akkadia.org/drepper/dsohowto.pdf

-- 
Best regards,
Ivan


From ho@@@|nmm @end|ng |rom jun|v@edu  Thu Feb  2 15:28:30 2023
From: ho@@@|nmm @end|ng |rom jun|v@edu (Md. Moyazzem Hossain)
Date: Thu, 2 Feb 2023 14:28:30 +0000
Subject: [R] Error: Invalid parent values
Message-ID: <CAO29qn5DiANH_EQkqqz50wCcJS5-=Bsqe6n4aBW=76-QKhp3sQ@mail.gmail.com>

Hi,

I hope that you are doing well.

I am Md Hossain, trying to fit the ARIMAX model in RJAGS. However, I got an
error message while I ran the code. Initially, I am using data obtained
from R-package then I will implement it into real data.

The code and error message are given below.

library(rjags)
#### load the data
data("mtcars")

#### select the response and predictor variables
y <- mtcars$mpg
x <- mtcars[,c("wt","qsec")]

### write the JAGS model code
jags_arimax_model <- "
model {
  beta0 ~ dnorm(0,0.0001)
  beta1 ~ dnorm(0,0.0001)
  beta2 ~ dnorm(0,0.0001)
  phi ~ dnorm(0,0.0001)
  tau ~ dgamma(0.001,0.001)

  #####
  beta0a[1] <- beta0
  beta1a[1] <- beta1
  beta2a[1] <- beta2
  phia[1] <- phi

  mu[1] <- beta0a + beta1a * x[1,1] + beta2a * x[1,2] + phia * y[2]
  ypred[1] ~ dnorm(mu[1], tau)

  ######
  for (i in 2:length(y)) {
  mu[i] <- beta0 + beta1 * x[i,1] + beta2 * x[i,2] + phi * y[i-1]
    ypred[i] ~ dnorm(mu[i], tau)
      }
  }
"

####Fit the Bayesian ARIMAX model using JAGS:

jags_arimax_fit <- jags.model(textConnection(jags_arimax_model), data =
list(y = y, x = x)  )

update(jags_arimax_fit, n.iter=2000, thin=1)

####
output_arimax=coda.samples(model=jags_arimax_fit, variable.names="ypred",
n.iter=2000, thin=5)

However, I got the following error message.


*Error in update.jags(model, n.iter, ...) : Error in node ypred[1]Invalid
parent values*

Please help me in this regard.

Thanks in advance.

Hossain

	[[alternative HTML version deleted]]


From ngre||er @end|ng |rom |q@h@rv@rd@edu  Wed Feb  1 18:49:30 2023
From: ngre||er @end|ng |rom |q@h@rv@rd@edu (Greifer, Noah)
Date: Wed, 1 Feb 2023 12:49:30 -0500
Subject: [R] [R-pkgs] {clarify}: Simulation-Based Inference for Regression
 Models
Message-ID: <CALABNevL7o=4hmB2v2G2PQmeCUcX7oa7YuPMfZ_Q6Az2RoL-pQ@mail.gmail.com>

Hello everyone,

Our new package {clarify} has been released. {clarify} provides
simulation-based inference as an alternative to the delta method for
interpretable quantities derived from model parameters, like average
marginal effects, dose-response functions, and predictions at
representative values. Also provided are methods for combining such
quantities across multiply imputed datasets.

Those of you who have used Clarify for Stata or the retired R package
{Zelig} will find similar and expanded capabilities in {clarify}.

Install {clarify} using
install.packages("clarify")

CRAN page:
https://cran.r-project.org/package=clarify

{clarify} website:
https://iqss.github.io/clarify/

Thank you!

-- 
Noah Greifer, Ph.D.
*Statistical Consultant and Programmer*
*Institute for Quantitative Social Science | Harvard University*
Pronouns: he/him

	[[alternative HTML version deleted]]

_______________________________________________
R-packages mailing list
R-packages at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-packages


From n|ckmwr@y @end|ng |rom gm@||@com  Fri Feb  3 23:02:06 2023
From: n|ckmwr@y @end|ng |rom gm@||@com (Nick Wray)
Date: Fri, 3 Feb 2023 22:02:06 +0000
Subject: [R] Lazy-load corrupt?
Message-ID: <CABxY9BNVKjvLs+KjnitqpCnNfdVN_sd3pEeqsdT705REJ2YckA@mail.gmail.com>

Hello  When trying to call various packages eg
library(raster)
library(sp)
library(rgdal)

I get this error message:
Loading required package: sp
Error: package or namespace load failed for ?sp? in get0(name, envir =
where, mode = "function", inherits = FALSE):
 lazy-load database 'C:/PROGRA~1/R/R-42~1.1/library/base/R/base.rdb' is
corrupt
Error: package ?sp? could not be loaded
In addition: Warning messages:
1: package ?raster? was built under R version 4.2.2
2: package ?sp? was built under R version 4.2.2
3: In get0(name, envir = where, mode = "function", inherits = FALSE) :
  restarting interrupted promise evaluation
4: In get0(name, envir = where, mode = "function", inherits = FALSE) :
  internal error -3 in R_decompress1


Other packages load fine (and the packages above load OK on my spare
laptop) but I'm imagining that this means that I have to uninstall my
current R and reinstall the latest version - but before I go through all
that can anyone confirm that that is indeed what I need to do or is there
some other problem?

Thanks Nick Wray

	[[alternative HTML version deleted]]


From bgunter@4567 @end|ng |rom gm@||@com  Fri Feb  3 23:14:56 2023
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Fri, 3 Feb 2023 14:14:56 -0800
Subject: [R] Lazy-load corrupt?
In-Reply-To: <CABxY9BNVKjvLs+KjnitqpCnNfdVN_sd3pEeqsdT705REJ2YckA@mail.gmail.com>
References: <CABxY9BNVKjvLs+KjnitqpCnNfdVN_sd3pEeqsdT705REJ2YckA@mail.gmail.com>
Message-ID: <CAGxFJbTXs1b86Hh5ZTsZ9RneovYXCyhkaezkN2PSkhhfd17ibA@mail.gmail.com>

Sorry -- I am too ignorant to answer your query.

But, just curious: Is there a good reason why you would *not* want to
install the latest version of R and your packages?

Cheers,
Bert

On Fri, Feb 3, 2023 at 2:02 PM Nick Wray <nickmwray at gmail.com> wrote:

> Hello  When trying to call various packages eg
> library(raster)
> library(sp)
> library(rgdal)
>
> I get this error message:
> Loading required package: sp
> Error: package or namespace load failed for ?sp? in get0(name, envir =
> where, mode = "function", inherits = FALSE):
>  lazy-load database 'C:/PROGRA~1/R/R-42~1.1/library/base/R/base.rdb' is
> corrupt
> Error: package ?sp? could not be loaded
> In addition: Warning messages:
> 1: package ?raster? was built under R version 4.2.2
> 2: package ?sp? was built under R version 4.2.2
> 3: In get0(name, envir = where, mode = "function", inherits = FALSE) :
>   restarting interrupted promise evaluation
> 4: In get0(name, envir = where, mode = "function", inherits = FALSE) :
>   internal error -3 in R_decompress1
>
>
> Other packages load fine (and the packages above load OK on my spare
> laptop) but I'm imagining that this means that I have to uninstall my
> current R and reinstall the latest version - but before I go through all
> that can anyone confirm that that is indeed what I need to do or is there
> some other problem?
>
> Thanks Nick Wray
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


