From @vi@e@gross m@iii@g oii gm@ii@com  Sun Sep  1 00:17:27 2024
From: @vi@e@gross m@iii@g oii gm@ii@com (@vi@e@gross m@iii@g oii gm@ii@com)
Date: Sat, 31 Aug 2024 18:17:27 -0400
Subject: [R] aggregating data with quality control
In-Reply-To: <27c3b1964d64474aac11678760647e61@regione.marche.it>
References: <27c3b1964d64474aac11678760647e61@regione.marche.it>
Message-ID: <017a01dafbf3$902a31c0$b07e9540$@gmail.com>

Stefano,

I see you already have an answer that works for you.

Sometimes you want to step back and see if some modification makes a problem easier to solve.

I often simply switch to using tools in the tidyverse such as dplyr for parts of the job albeit much of the same can be done using functions built-in to R.

In your case, there are many possible solutions besides taking the max in some way as in a factor column.

You seem to expect exactly 48 measurements. Currently you encode them as one of two character strings but if this is really a binary choice, you could have used a 0/1 or TRUE/FALSE column instead, or make one. This lets you do things like take the sum and compare it to 48 to see if all are true, or to zero to check if all are false. You could take the product to check if at least one is false or use a negation for another perspective. If the number of rows may not be 48, you can compare to a calculation of the actual number of rows in that subset.

If your data was placed into wide format, say based on your hs field being unique for each test site, there are similar ideas by taking a subset of the columns and applying things  by using functions like rowSum.

Again, some things I commonly use in dplyr such as group_by() and how it impacts other operations including reports, makes this a little different but most things can be done with careful use of base R, except areas where dplyr supports more and more abstract ways to specify what you want and that your example does not need.

Just FYI, you did not share what your function my.mean() is. 

I won't share the code unless interested but it looks like part of what you are doing is to bundle by a truncated version of date/time to just a day.  I am not sure your method is optimal. You make a list of three different things containing parts of a date. That can work but as dates are already looking like 2024-01-02 which sorts and compares well alphabetically, I wonder if instead you group by that.


-----Original Message-----
From: R-help <r-help-bounces at r-project.org> On Behalf Of Stefano Sofia
Sent: Saturday, August 31, 2024 7:15 AM
To: r-help at R-project.org
Subject: [R] aggregating data with quality control

Dear R-list users,

I deal with semi-hourly data from automatic meteorological stations.

They have to pass a manual validation; suppose that status = "C" stands for correct and status = "D" for discarded.

Here a simple example with "Snow height" (HS):


mydf <- data.frame(data_POSIX=seq(as.POSIXct("2024-01-01 00:00:00", format = "%Y-%m-%d %H:%M:%S", tz="Etc/GMT-1"), as.POSIXct("2024-01-02 23:30:00", format = "%Y-%m-%d %H:%M:%S", tz="Etc/GMT-1"), by="30 min"))

mydf$hs <- round(runif(96, 0, 100))

mydf$status <- c(rep("C", 50), "S", rep("C", 45))


Evaluating the daily mean indipendently from the status is very easy:

aggregate(mydf$hs, by=list(format(mydf$data_POSIX, "%Y"), format(mydf$data_POSIX, "%m"), format(mydf$data_POSIX, "%d")), my.mean)


Things become more complicated when I need to export also the status: this should be "C" when all 48 data have status equal to "C", and status "D" when at least one value has status ="D".


I have no clue on how to do that in an efficient way.

Could some of you give me some clues on how to do that?


Thank you for your usual support

Stefano Sofia


         (oo)
--oOO--( )--OOo--------------------------------------
Stefano Sofia PhD
Civil Protection - Marche Region - Italy
Meteo Section
Snow Section
Via del Colle Ameno 5
60126 Torrette di Ancona, Ancona (AN)
Uff: +39 071 806 7743
E-mail: stefano.sofia at regione.marche.it
---Oo---------oO----------------------------------------

________________________________

AVVISO IMPORTANTE: Questo messaggio di posta elettronica pu? contenere informazioni confidenziali, pertanto ? destinato solo a persone autorizzate alla ricezione. I messaggi di posta elettronica per i client di Regione Marche possono contenere informazioni confidenziali e con privilegi legali. Se non si ? il destinatario specificato, non leggere, copiare, inoltrare o archiviare questo messaggio. Se si ? ricevuto questo messaggio per errore, inoltrarlo al mittente ed eliminarlo completamente dal sistema del proprio computer. Ai sensi dell'art. 6 della DGR n. 1394/2008 si segnala che, in caso di necessit? ed urgenza, la risposta al presente messaggio di posta elettronica pu? essere visionata da persone estranee al destinatario.
IMPORTANT NOTICE: This e-mail message is intended to be received only by persons entitled to receive the confidential information it may contain. E-mail messages to clients of Regione Marche may contain information that is confidential and legally privileged. Please do not read, copy, forward, or store this message unless you are an intended recipient of it. If you have received this message in error, please forward it to the sender and delete it completely from your computer system.

	[[alternative HTML version deleted]]


From bog@@o@chr|@to|er @end|ng |rom gm@||@com  Tue Sep  3 01:26:17 2024
From: bog@@o@chr|@to|er @end|ng |rom gm@||@com (Christofer Bogaso)
Date: Tue, 3 Sep 2024 04:56:17 +0530
Subject: [R] Adding parameters for Benchmark normal distribution in
 shapiro.test
Message-ID: <CA+dpOJnCG=jhE=T4fdsq8F6X8JiLQmm81jX=kTGcMokywCC13w@mail.gmail.com>

Hi,

In ?shapiro.test, there seems to be no option to pass mean and sd
information of the Normal distribution which I want to compare my
sample data to.

For example in the code below, I want to test my sample to N(0, 10).

shapiro.test(rnorm(100, mean = 5, sd = 3))

Is there any way to pass the information of the benchmark normal distribution?


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Tue Sep  3 01:53:50 2024
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Mon, 02 Sep 2024 16:53:50 -0700
Subject: [R] Adding parameters for Benchmark normal distribution in
 shapiro.test
In-Reply-To: <CA+dpOJnCG=jhE=T4fdsq8F6X8JiLQmm81jX=kTGcMokywCC13w@mail.gmail.com>
References: <CA+dpOJnCG=jhE=T4fdsq8F6X8JiLQmm81jX=kTGcMokywCC13w@mail.gmail.com>
Message-ID: <637456A8-A64B-44DB-AADE-E660B413238B@dcn.davis.ca.us>

Wouldn't that be because the sample is not being compared to a specific distribution but rather to many possible distributions by MC? [1]

If you think that need not be the case, perhaps you can write your own test... but then it will probably be answering a different question?

[1] https://en.m.wikipedia.org/wiki/Shapiro%E2%80%93Wilk_test

On September 2, 2024 4:26:17 PM PDT, Christofer Bogaso <bogaso.christofer at gmail.com> wrote:
>Hi,
>
>In ?shapiro.test, there seems to be no option to pass mean and sd
>information of the Normal distribution which I want to compare my
>sample data to.
>
>For example in the code below, I want to test my sample to N(0, 10).
>
>shapiro.test(rnorm(100, mean = 5, sd = 3))
>
>Is there any way to pass the information of the benchmark normal distribution?
>
>______________________________________________
>R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>https://stat.ethz.ch/mailman/listinfo/r-help
>PLEASE do read the posting guide https://www.R-project.org/posting-guide.html
>and provide commented, minimal, self-contained, reproducible code.

-- 
Sent from my phone. Please excuse my brevity.


From bbo|ker @end|ng |rom gm@||@com  Tue Sep  3 02:22:08 2024
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Mon, 2 Sep 2024 20:22:08 -0400
Subject: [R] Adding parameters for Benchmark normal distribution in
 shapiro.test
In-Reply-To: <CA+dpOJnCG=jhE=T4fdsq8F6X8JiLQmm81jX=kTGcMokywCC13w@mail.gmail.com>
References: <CA+dpOJnCG=jhE=T4fdsq8F6X8JiLQmm81jX=kTGcMokywCC13w@mail.gmail.com>
Message-ID: <d557d541-24cf-45dc-9bbb-d7b9d050f5f1@gmail.com>

   From Shapiro and Wilk's paper:

 > The objective is to derive a test for the hypothesis that this is a 
sample from a normal distribution with unknown mean mu and unknown 
variance sigma^2

  That is, the estimates of the mean and SD are folded into the 
derivation of the test statistic.

   If you want to test against a specified alternative you could try 
e.g. a Kolmogorov-Smirnov test

set.seed(101)
x <- rnorm(100, mean = 5, sd = 3)

ks.test(x, "pnorm", 0, 10)




On 2024-09-02 7:26 p.m., Christofer Bogaso wrote:
> Hi,
> 
> In ?shapiro.test, there seems to be no option to pass mean and sd
> information of the Normal distribution which I want to compare my
> sample data to.
> 
> For example in the code below, I want to test my sample to N(0, 10).
> 
> shapiro.test(rnorm(100, mean = 5, sd = 3))
> 
> Is there any way to pass the information of the benchmark normal distribution?
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide https://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.

-- 
Dr. Benjamin Bolker
Professor, Mathematics & Statistics and Biology, McMaster University
Director, School of Computational Science and Engineering
 > E-mail is sent at my convenience; I don't expect replies outside of 
working hours.


From p@ych@o||u @end|ng |rom gm@||@com  Tue Sep  3 18:30:54 2024
From: p@ych@o||u @end|ng |rom gm@||@com (Chao Liu)
Date: Tue, 3 Sep 2024 12:30:54 -0400
Subject: [R] Goodreader: Scrape and Analyze 'Goodreads' Book Data
Message-ID: <CACCU-vM3B95EnoYz=-wKf5r+iWm-O8iCW6h-cBo-q+kjvuRk1Q@mail.gmail.com>

Dear R Users,

I am pleased to announce that Goodreader 0.1.1 is now available on CRAN.

Goodreader offers a toolkit for scraping and analyzing book data from
Goodreads. Users can search for books, scrape detailed information and
reviews, perform sentiment analysis on reviews, and conduct topic modeling.

Here?s a quick overview of how to use Goodreader:
# Search for books
AI_df <- search_goodreads(search_term = "artificial intelligence",
search_in = "title", num_books = 10, sort_by = "ratings")

# Retrieve Book IDs and save them to a text file
get_book_ids(input_data = AI_df, file_name = "AI_books.txt")

# Get book-related information
scrape_books(book_ids_path = "AI_books.txt")

# Scrape book reviews
scrape_reviews(book_ids_path = "AI_books.txt", num_reviews = 10)

For more details, please visit: https://liu-chao.site/Goodreader/

Best regards,

Chao Liu

	[[alternative HTML version deleted]]


From bog@@o@chr|@to|er @end|ng |rom gm@||@com  Wed Sep  4 01:15:11 2024
From: bog@@o@chr|@to|er @end|ng |rom gm@||@com (Christofer Bogaso)
Date: Wed, 4 Sep 2024 04:45:11 +0530
Subject: [R] How R calculates SE of prediction for Logistic regression?
Message-ID: <CA+dpOJ=Opxvsc+GM06ge=Rpqecr6KTMr7x-WytL3W3uzndkbeQ@mail.gmail.com>

Hi,

I have below logistic regression

Dat =
read.csv('https://raw.githubusercontent.com/sam16tyagi/Machine-Learning-techniques-in-python/master/logistic%20regression%20dataset-Social_Network_Ads.csv')
head(Dat)
Model = glm(Purchased ~ Gender, data = Dat, family = binomial())

How I can get Standard deviation of forecasts as

head(predict(Model, type="response", se.fit = T)$se.fit)

My question: given that in Logistic regression, logit link is used,
how R calculate SE for the predicted probability from the VCV matrix
of estimated coefficients?

Does R uses some approximation like delta rule?


From |@go@g|ne @end|ng |rom @jd@e@  Wed Sep  4 07:23:48 2024
From: |@go@g|ne @end|ng |rom @jd@e@ (=?iso-8859-1?Q?Iago_Gin=E9_V=E1zquez?=)
Date: Wed, 4 Sep 2024 05:23:48 +0000
Subject: [R] fixed set.seed + kmeans output disagree on distinct platforms
Message-ID: <VI0PR02MB104934BC51026686BB56EEE3594922@VI0PR02MB10493.eurprd02.prod.outlook.com>

Hi all,

I build a dataset processing in the same way the same data in Windows than in Linux.

The output of Windows processing is: https://gitlab.com/iagogv/repdata/-/raw/main/exdata.csv?ref_type=heads
The output of Linux processing is: https://gitlab.com/iagogv/repdata/-/raw/main/exdata2.csv?ref_type=heads

exdata=as.matrix(read.csv("https://gitlab.com/iagogv/repdata/-/raw/main/exdata.csv?ref_type=heads", header=FALSE))
exdata2=as.matrix(read.csv("https://gitlab.com/iagogv/repdata/-/raw/main/exdata2.csv?ref_type=heads", header=FALSE))

They are not identical (`identical(exdata,exdata2)` is FALSE), but they are essentially equal (`all.equal(exdata,exdata2)` is TRUE). If I run

set.seed(20232260)
exkmns <- kmeans(exdata, centers = 7, iter.max = 2000, nstart = 750)

I get

exkmns$centers
          V1         V2          V3          V4          V5           V6
1 -0.4910731 -0.2662055  0.57928758  0.14267293 -0.03013791  0.106472717
2  0.5301237  0.2815620 -0.23898532  1.00979412 -0.26123328  0.068099931
3  0.2255298 -0.5165964 -0.02498471 -0.20438275 -0.41224195 -0.107538855
4 -0.2616257  0.5680582  0.55387437 -0.09562789 -0.01706577 -0.028248679
5 -0.4820078 -0.1667370 -0.46533618 -0.05271446  0.05477352  0.005236259
6  0.6455994 -0.1396674  0.05988547 -0.15557399  0.62766365  0.031051986
7  0.1072127  0.5538876 -0.33117098 -0.43209203 -0.18646403 -0.081273130

both in Windows  (1) and in Linux (2, 3) up to rows order. If I run in Linux in my computer (2)

set.seed(20232260)
exkmns2 <- kmeans(exdata2, centers = 7, iter.max = 2000, nstart = 750)

then, I get

exkmns2$centers
           V1         V2          V3          V4          V5          V6
1  0.64559941 -0.1396674  0.05988547 -0.15557399  0.62766365  0.03105199
2 -0.26162573  0.5680582  0.55387437 -0.09562789 -0.01706577 -0.02824868
3  0.53012369  0.2815620 -0.23898532  1.00979412 -0.26123328  0.06809993
4  0.03409765  0.3492520 -0.36910409 -0.40721418 -0.21482793  0.03073180
5 -0.58527394 -0.1790337 -0.46778956  0.03573883  0.15473589 -0.07980379
6 -0.49107314 -0.2662055  0.57928758  0.14267293 -0.03013791  0.10647272
7  0.22552984 -0.5165964 -0.02498471 -0.20438275 -0.41224195 -0.10753886

therefore, all rows essentially equal except for rows 5 and 7 of first dataset (5 and 4 of second dataset).  With a bit more detail:

  *
Row 0.2255298 -0.5165964 -0.02498471 -0.20438275 -0.41224195 -0.107538855 belongs to exdata (and exdata2) and is center of both outputs
  *
Row 0.1072127  0.5538876 -0.33117098 -0.43209203 -0.18646403 -0.081273130 belongs to the dataset and it is only center of exdata output
  *
Row -0.4820078 -0.1667370 -0.46533618 -0.05271446  0.05477352  0.005236259 does not belong to the dataset and it is only center of exdata output
  *
Row -0.58527394 -0.1790337 -0.46778956  0.03573883  0.15473589 -0.07980379 belongs to the dataset and it is only center for exdata2 on Linux in my computer
  *
Row 0.03409765  0.3492520 -0.36910409 -0.40721418 -0.21482793  0.03073180 does not belong to the dataset and it is only center for exdata2 on Linux in my computer
  *
All other 4 rows (1,2,4 and 6 of first output) do not belong to the dataset and are common centers.

Even, further, if I run

set.seed(20232260)
exkmns <- kmeans(exdata, centers = 7, iter.max = 2000, nstart = 750)

in  posit.cloud (3), I get the same result than above. However, if I run (both in posit.cloud or in Windows)

set.seed(20232260)
exkmns2 <- kmeans(exdata2, centers = 7, iter.max = 2000, nstart = 750)

then I get


exkmns2$centers
          V1         V2          V3         V4          V5          V6
1  0.6426035 -0.1449498  0.05843435 -0.1527968  0.62943077  0.02984948
2 -0.4092382 -0.3740695  0.69597037  0.1956896 -0.05026200 -0.01453132
3  0.1072127  0.5538876 -0.33117098 -0.4320920 -0.18646403 -0.08127313
4  0.2255298 -0.5165964 -0.02498471 -0.2043827 -0.41224195 -0.10753886
5  0.5301237  0.2815620 -0.23898532  1.0097941 -0.26123328  0.06809993
6 -0.5223387 -0.1484517 -0.38982567 -0.0341488  0.06446446  0.03622056
7 -0.2701703  0.5263218  0.52942311 -0.1112202 -0.03460591  0.03577287

So only its rows 4 and 5 are common centers to both of previous outputs and row 3 is common width exdata centers.

Does all this have any sense?

Thanks!

Iago

(1)
R version 4.4.1 (2024-06-14 ucrt)
Platform: x86_64-w64-mingw32/x64
Running under: Windows 10 x64 (build 19045)

Matrix products: default

(2)
R version 4.4.1 (2024-06-14)
Platform: x86_64-pc-linux-gnu
Running under: Debian GNU/Linux 12 (bookworm)

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3
LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.21.so;  LAPACK version 3.11.0

(3)
R version 4.4.1 (2024-06-14)
Platform: x86_64-pc-linux-gnu
Running under: Ubuntu 20.04.6 LTS

 Matrix products: default
BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.8.so;  LAPACK version 3.9.0




	[[alternative HTML version deleted]]


From bgunter@4567 @end|ng |rom gm@||@com  Wed Sep  4 08:32:25 2024
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Tue, 3 Sep 2024 23:32:25 -0700
Subject: [R] 
 fixed set.seed + kmeans output disagree on distinct platforms
In-Reply-To: <VI0PR02MB104934BC51026686BB56EEE3594922@VI0PR02MB10493.eurprd02.prod.outlook.com>
References: <VI0PR02MB104934BC51026686BB56EEE3594922@VI0PR02MB10493.eurprd02.prod.outlook.com>
Message-ID: <CAGxFJbR2AHToKZM+L0ZXnQSY+acZbBsMgYUPi9wM1GuXmBszSQ@mail.gmail.com>

I have no clue, but I did note that you are using different versions of
BLAS/LAPACK on the different platforms. Could that be (part) of the issue?

Cheers,
Bert

On Tue, Sep 3, 2024 at 10:24?PM Iago Gin? V?zquez <iago.gine at sjd.es> wrote:

> Hi all,
>
> I build a dataset processing in the same way the same data in Windows than
> in Linux.
>
> The output of Windows processing is:
> https://gitlab.com/iagogv/repdata/-/raw/main/exdata.csv?ref_type=heads
> The output of Linux processing is:
> https://gitlab.com/iagogv/repdata/-/raw/main/exdata2.csv?ref_type=heads
>
> exdata=as.matrix(read.csv("
> https://gitlab.com/iagogv/repdata/-/raw/main/exdata.csv?ref_type=heads",
> header=FALSE))
> exdata2=as.matrix(read.csv("
> https://gitlab.com/iagogv/repdata/-/raw/main/exdata2.csv?ref_type=heads",
> header=FALSE))
>
> They are not identical (`identical(exdata,exdata2)` is FALSE), but they
> are essentially equal (`all.equal(exdata,exdata2)` is TRUE). If I run
>
> set.seed(20232260)
> exkmns <- kmeans(exdata, centers = 7, iter.max = 2000, nstart = 750)
>
> I get
>
> exkmns$centers
>           V1         V2          V3          V4          V5           V6
> 1 -0.4910731 -0.2662055  0.57928758  0.14267293 -0.03013791  0.106472717
> 2  0.5301237  0.2815620 -0.23898532  1.00979412 -0.26123328  0.068099931
> 3  0.2255298 -0.5165964 -0.02498471 -0.20438275 -0.41224195 -0.107538855
> 4 -0.2616257  0.5680582  0.55387437 -0.09562789 -0.01706577 -0.028248679
> 5 -0.4820078 -0.1667370 -0.46533618 -0.05271446  0.05477352  0.005236259
> 6  0.6455994 -0.1396674  0.05988547 -0.15557399  0.62766365  0.031051986
> 7  0.1072127  0.5538876 -0.33117098 -0.43209203 -0.18646403 -0.081273130
>
> both in Windows  (1) and in Linux (2, 3) up to rows order. If I run in
> Linux in my computer (2)
>
> set.seed(20232260)
> exkmns2 <- kmeans(exdata2, centers = 7, iter.max = 2000, nstart = 750)
>
> then, I get
>
> exkmns2$centers
>            V1         V2          V3          V4          V5          V6
> 1  0.64559941 -0.1396674  0.05988547 -0.15557399  0.62766365  0.03105199
> 2 -0.26162573  0.5680582  0.55387437 -0.09562789 -0.01706577 -0.02824868
> 3  0.53012369  0.2815620 -0.23898532  1.00979412 -0.26123328  0.06809993
> 4  0.03409765  0.3492520 -0.36910409 -0.40721418 -0.21482793  0.03073180
> 5 -0.58527394 -0.1790337 -0.46778956  0.03573883  0.15473589 -0.07980379
> 6 -0.49107314 -0.2662055  0.57928758  0.14267293 -0.03013791  0.10647272
> 7  0.22552984 -0.5165964 -0.02498471 -0.20438275 -0.41224195 -0.10753886
>
> therefore, all rows essentially equal except for rows 5 and 7 of first
> dataset (5 and 4 of second dataset).  With a bit more detail:
>
>   *
> Row 0.2255298 -0.5165964 -0.02498471 -0.20438275 -0.41224195 -0.107538855
> belongs to exdata (and exdata2) and is center of both outputs
>   *
> Row 0.1072127  0.5538876 -0.33117098 -0.43209203 -0.18646403 -0.081273130
> belongs to the dataset and it is only center of exdata output
>   *
> Row -0.4820078 -0.1667370 -0.46533618 -0.05271446  0.05477352  0.005236259
> does not belong to the dataset and it is only center of exdata output
>   *
> Row -0.58527394 -0.1790337 -0.46778956  0.03573883  0.15473589 -0.07980379
> belongs to the dataset and it is only center for exdata2 on Linux in my
> computer
>   *
> Row 0.03409765  0.3492520 -0.36910409 -0.40721418 -0.21482793  0.03073180
> does not belong to the dataset and it is only center for exdata2 on Linux
> in my computer
>   *
> All other 4 rows (1,2,4 and 6 of first output) do not belong to the
> dataset and are common centers.
>
> Even, further, if I run
>
> set.seed(20232260)
> exkmns <- kmeans(exdata, centers = 7, iter.max = 2000, nstart = 750)
>
> in  posit.cloud (3), I get the same result than above. However, if I run
> (both in posit.cloud or in Windows)
>
> set.seed(20232260)
> exkmns2 <- kmeans(exdata2, centers = 7, iter.max = 2000, nstart = 750)
>
> then I get
>
>
> exkmns2$centers
>           V1         V2          V3         V4          V5          V6
> 1  0.6426035 -0.1449498  0.05843435 -0.1527968  0.62943077  0.02984948
> 2 -0.4092382 -0.3740695  0.69597037  0.1956896 -0.05026200 -0.01453132
> 3  0.1072127  0.5538876 -0.33117098 -0.4320920 -0.18646403 -0.08127313
> 4  0.2255298 -0.5165964 -0.02498471 -0.2043827 -0.41224195 -0.10753886
> 5  0.5301237  0.2815620 -0.23898532  1.0097941 -0.26123328  0.06809993
> 6 -0.5223387 -0.1484517 -0.38982567 -0.0341488  0.06446446  0.03622056
> 7 -0.2701703  0.5263218  0.52942311 -0.1112202 -0.03460591  0.03577287
>
> So only its rows 4 and 5 are common centers to both of previous outputs
> and row 3 is common width exdata centers.
>
> Does all this have any sense?
>
> Thanks!
>
> Iago
>
> (1)
> R version 4.4.1 (2024-06-14 ucrt)
> Platform: x86_64-w64-mingw32/x64
> Running under: Windows 10 x64 (build 19045)
>
> Matrix products: default
>
> (2)
> R version 4.4.1 (2024-06-14)
> Platform: x86_64-pc-linux-gnu
> Running under: Debian GNU/Linux 12 (bookworm)
>
> Matrix products: default
> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3
> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.21.so;
> LAPACK version 3.11.0
>
> (3)
> R version 4.4.1 (2024-06-14)
> Platform: x86_64-pc-linux-gnu
> Running under: Ubuntu 20.04.6 LTS
>
>  Matrix products: default
> BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/
> libopenblasp-r0.3.8.so;  LAPACK version 3.9.0
>
>
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> https://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Wed Sep  4 10:41:34 2024
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Wed, 4 Sep 2024 10:41:34 +0200
Subject: [R] 
 fixed set.seed + kmeans output disagree on distinct platforms
In-Reply-To: <CAGxFJbR2AHToKZM+L0ZXnQSY+acZbBsMgYUPi9wM1GuXmBszSQ@mail.gmail.com>
References: <VI0PR02MB104934BC51026686BB56EEE3594922@VI0PR02MB10493.eurprd02.prod.outlook.com>
 <CAGxFJbR2AHToKZM+L0ZXnQSY+acZbBsMgYUPi9wM1GuXmBszSQ@mail.gmail.com>
Message-ID: <26328.7486.699492.779127@stat.math.ethz.ch>

>>>>> Bert Gunter 
>>>>>     on Tue, 3 Sep 2024 23:32:25 -0700 writes:

    > I have no clue, but I did note that you are using different versions of
    > BLAS/LAPACK on the different platforms. Could that be (part) of the issue?

Good catch!  My gut feeling would say "yes!" that is almost surely part of
the issue.

    > Cheers,
    > Bert

Additionally, careful reading of the help page (*before* any post ..)
would have shown

   Note:

	The clusters are numbered in the returned object, but they are a
	_set_ and no ordering is implied.  (Their apparent ordering may
	differ by platform.)


Martin



    > On Tue, Sep 3, 2024 at 10:24?PM Iago Gin? V?zquez <iago.gine at sjd.es> wrote:

    >> Hi all,
    >> 
    >> I build a dataset processing in the same way the same data in Windows than
    >> in Linux.
    >> 
    >> The output of Windows processing is:
    >> https://gitlab.com/iagogv/repdata/-/raw/main/exdata.csv?ref_type=heads
    >> The output of Linux processing is:
    >> https://gitlab.com/iagogv/repdata/-/raw/main/exdata2.csv?ref_type=heads
    >> 
    >> exdata=as.matrix(read.csv("
    >> https://gitlab.com/iagogv/repdata/-/raw/main/exdata.csv?ref_type=heads",
    >> header=FALSE))
    >> exdata2=as.matrix(read.csv("
    >> https://gitlab.com/iagogv/repdata/-/raw/main/exdata2.csv?ref_type=heads",
    >> header=FALSE))
    >> 
    >> They are not identical (`identical(exdata,exdata2)` is FALSE), but they
    >> are essentially equal (`all.equal(exdata,exdata2)` is TRUE). If I run
    >> 
    >> set.seed(20232260)
    >> exkmns <- kmeans(exdata, centers = 7, iter.max = 2000, nstart = 750)
    >> 
    >> I get
    >> 
    >> exkmns$centers
    >> V1         V2          V3          V4          V5           V6
    >> 1 -0.4910731 -0.2662055  0.57928758  0.14267293 -0.03013791  0.106472717
    >> 2  0.5301237  0.2815620 -0.23898532  1.00979412 -0.26123328  0.068099931
    >> 3  0.2255298 -0.5165964 -0.02498471 -0.20438275 -0.41224195 -0.107538855
    >> 4 -0.2616257  0.5680582  0.55387437 -0.09562789 -0.01706577 -0.028248679
    >> 5 -0.4820078 -0.1667370 -0.46533618 -0.05271446  0.05477352  0.005236259
    >> 6  0.6455994 -0.1396674  0.05988547 -0.15557399  0.62766365  0.031051986
    >> 7  0.1072127  0.5538876 -0.33117098 -0.43209203 -0.18646403 -0.081273130
    >> 
    >> both in Windows  (1) and in Linux (2, 3) up to rows order. If I run in
    >> Linux in my computer (2)
    >> 
    >> set.seed(20232260)
    >> exkmns2 <- kmeans(exdata2, centers = 7, iter.max = 2000, nstart = 750)
    >> 
    >> then, I get
    >> 
    >> exkmns2$centers
    >> V1         V2          V3          V4          V5          V6
    >> 1  0.64559941 -0.1396674  0.05988547 -0.15557399  0.62766365  0.03105199
    >> 2 -0.26162573  0.5680582  0.55387437 -0.09562789 -0.01706577 -0.02824868
    >> 3  0.53012369  0.2815620 -0.23898532  1.00979412 -0.26123328  0.06809993
    >> 4  0.03409765  0.3492520 -0.36910409 -0.40721418 -0.21482793  0.03073180
    >> 5 -0.58527394 -0.1790337 -0.46778956  0.03573883  0.15473589 -0.07980379
    >> 6 -0.49107314 -0.2662055  0.57928758  0.14267293 -0.03013791  0.10647272
    >> 7  0.22552984 -0.5165964 -0.02498471 -0.20438275 -0.41224195 -0.10753886
    >> 
    >> therefore, all rows essentially equal except for rows 5 and 7 of first
    >> dataset (5 and 4 of second dataset).  With a bit more detail:
    >> 
    >> *
    >> Row 0.2255298 -0.5165964 -0.02498471 -0.20438275 -0.41224195 -0.107538855
    >> belongs to exdata (and exdata2) and is center of both outputs
    >> *
    >> Row 0.1072127  0.5538876 -0.33117098 -0.43209203 -0.18646403 -0.081273130
    >> belongs to the dataset and it is only center of exdata output
    >> *
    >> Row -0.4820078 -0.1667370 -0.46533618 -0.05271446  0.05477352  0.005236259
    >> does not belong to the dataset and it is only center of exdata output
    >> *
    >> Row -0.58527394 -0.1790337 -0.46778956  0.03573883  0.15473589 -0.07980379
    >> belongs to the dataset and it is only center for exdata2 on Linux in my
    >> computer
    >> *
    >> Row 0.03409765  0.3492520 -0.36910409 -0.40721418 -0.21482793  0.03073180
    >> does not belong to the dataset and it is only center for exdata2 on Linux
    >> in my computer
    >> *
    >> All other 4 rows (1,2,4 and 6 of first output) do not belong to the
    >> dataset and are common centers.
    >> 
    >> Even, further, if I run
    >> 
    >> set.seed(20232260)
    >> exkmns <- kmeans(exdata, centers = 7, iter.max = 2000, nstart = 750)
    >> 
    >> in  posit.cloud (3), I get the same result than above. However, if I run
    >> (both in posit.cloud or in Windows)
    >> 
    >> set.seed(20232260)
    >> exkmns2 <- kmeans(exdata2, centers = 7, iter.max = 2000, nstart = 750)
    >> 
    >> then I get
    >> 
    >> 
    >> exkmns2$centers
    >> V1         V2          V3         V4          V5          V6
    >> 1  0.6426035 -0.1449498  0.05843435 -0.1527968  0.62943077  0.02984948
    >> 2 -0.4092382 -0.3740695  0.69597037  0.1956896 -0.05026200 -0.01453132
    >> 3  0.1072127  0.5538876 -0.33117098 -0.4320920 -0.18646403 -0.08127313
    >> 4  0.2255298 -0.5165964 -0.02498471 -0.2043827 -0.41224195 -0.10753886
    >> 5  0.5301237  0.2815620 -0.23898532  1.0097941 -0.26123328  0.06809993
    >> 6 -0.5223387 -0.1484517 -0.38982567 -0.0341488  0.06446446  0.03622056
    >> 7 -0.2701703  0.5263218  0.52942311 -0.1112202 -0.03460591  0.03577287
    >> 
    >> So only its rows 4 and 5 are common centers to both of previous outputs
    >> and row 3 is common width exdata centers.
    >> 
    >> Does all this have any sense?
    >> 
    >> Thanks!
    >> 
    >> Iago
    >> 
    >> (1)
    >> R version 4.4.1 (2024-06-14 ucrt)
    >> Platform: x86_64-w64-mingw32/x64
    >> Running under: Windows 10 x64 (build 19045)
    >> 
    >> Matrix products: default
    >> 
    >> (2)
    >> R version 4.4.1 (2024-06-14)
    >> Platform: x86_64-pc-linux-gnu
    >> Running under: Debian GNU/Linux 12 (bookworm)
    >> 
    >> Matrix products: default
    >> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3
    >> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.21.so;
    >> LAPACK version 3.11.0
    >> 
    >> (3)
    >> R version 4.4.1 (2024-06-14)
    >> Platform: x86_64-pc-linux-gnu
    >> Running under: Ubuntu 20.04.6 LTS
    >> 
    >> Matrix products: default
    >> BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/
    >> libopenblasp-r0.3.8.so;  LAPACK version 3.9.0
    >>


From |@go@g|ne @end|ng |rom @jd@e@  Wed Sep  4 11:18:55 2024
From: |@go@g|ne @end|ng |rom @jd@e@ (=?utf-8?B?SWFnbyBHaW7DqSBWw6F6cXVleg==?=)
Date: Wed, 4 Sep 2024 09:18:55 +0000
Subject: [R] 
 fixed set.seed + kmeans output disagree on distinct platforms
In-Reply-To: <26328.7486.699492.779127@stat.math.ethz.ch>
References: <VI0PR02MB104934BC51026686BB56EEE3594922@VI0PR02MB10493.eurprd02.prod.outlook.com>
 <CAGxFJbR2AHToKZM+L0ZXnQSY+acZbBsMgYUPi9wM1GuXmBszSQ@mail.gmail.com>
 <26328.7486.699492.779127@stat.math.ethz.ch>
Message-ID: <VI0PR02MB10493B13612F7B58FC7A3872A949C2@VI0PR02MB10493.eurprd02.prod.outlook.com>

Thanks both Bert and Martin,

However  exkmns2$centers is common in posit.cloud  - LAPACK version 3.9.0- and in Windows -LAPACK 3.12.0-, while  distinct with my Linux settings -LAPACK version 3.11.0- (I don't know the BLAS version used by R in windows). It is a bit strange...

Iago

________________________________
De: Martin Maechler <maechler at stat.math.ethz.ch>
Enviat el: dimecres, 4 de setembre de 2024 10:41
Per a: Bert Gunter <bgunter.4567 at gmail.com>
A/c: Iago Gin? V?zquez <iago.gine at sjd.es>; r-help at r-project.org <r-help at r-project.org>
Tema: Re: [R] fixed set.seed + kmeans output disagree on distinct platforms

>>>>> Bert Gunter
>>>>>     on Tue, 3 Sep 2024 23:32:25 -0700 writes:

    > I have no clue, but I did note that you are using different versions of
    > BLAS/LAPACK on the different platforms. Could that be (part) of the issue?

Good catch!  My gut feeling would say "yes!" that is almost surely part of
the issue.

    > Cheers,
    > Bert

Additionally, careful reading of the help page (*before* any post ..)
would have shown

   Note:

        The clusters are numbered in the returned object, but they are a
        _set_ and no ordering is implied.  (Their apparent ordering may
        differ by platform.)


Martin



    > On Tue, Sep 3, 2024 at 10:24?PM Iago Gin? V?zquez <iago.gine at sjd.es> wrote:

    >> Hi all,
    >>
    >> I build a dataset processing in the same way the same data in Windows than
    >> in Linux.
    >>
    >> The output of Windows processing is:
    >> https://gitlab.com/iagogv/repdata/-/raw/main/exdata.csv?ref_type=heads
    >> The output of Linux processing is:
    >> https://gitlab.com/iagogv/repdata/-/raw/main/exdata2.csv?ref_type=heads
    >>
    >> exdata=as.matrix(read.csv("
    >> https://gitlab.com/iagogv/repdata/-/raw/main/exdata.csv?ref_type=heads",
    >> header=FALSE))
    >> exdata2=as.matrix(read.csv("
    >> https://gitlab.com/iagogv/repdata/-/raw/main/exdata2.csv?ref_type=heads",
    >> header=FALSE))
    >>
    >> They are not identical (`identical(exdata,exdata2)` is FALSE), but they
    >> are essentially equal (`all.equal(exdata,exdata2)` is TRUE). If I run
    >>
    >> set.seed(20232260)
    >> exkmns <- kmeans(exdata, centers = 7, iter.max = 2000, nstart = 750)
    >>
    >> I get
    >>
    >> exkmns$centers
    >> V1         V2          V3          V4          V5           V6
    >> 1 -0.4910731 -0.2662055  0.57928758  0.14267293 -0.03013791  0.106472717
    >> 2  0.5301237  0.2815620 -0.23898532  1.00979412 -0.26123328  0.068099931
    >> 3  0.2255298 -0.5165964 -0.02498471 -0.20438275 -0.41224195 -0.107538855
    >> 4 -0.2616257  0.5680582  0.55387437 -0.09562789 -0.01706577 -0.028248679
    >> 5 -0.4820078 -0.1667370 -0.46533618 -0.05271446  0.05477352  0.005236259
    >> 6  0.6455994 -0.1396674  0.05988547 -0.15557399  0.62766365  0.031051986
    >> 7  0.1072127  0.5538876 -0.33117098 -0.43209203 -0.18646403 -0.081273130
    >>
    >> both in Windows  (1) and in Linux (2, 3) up to rows order. If I run in
    >> Linux in my computer (2)
    >>
    >> set.seed(20232260)
    >> exkmns2 <- kmeans(exdata2, centers = 7, iter.max = 2000, nstart = 750)
    >>
    >> then, I get
    >>
    >> exkmns2$centers
    >> V1         V2          V3          V4          V5          V6
    >> 1  0.64559941 -0.1396674  0.05988547 -0.15557399  0.62766365  0.03105199
    >> 2 -0.26162573  0.5680582  0.55387437 -0.09562789 -0.01706577 -0.02824868
    >> 3  0.53012369  0.2815620 -0.23898532  1.00979412 -0.26123328  0.06809993
    >> 4  0.03409765  0.3492520 -0.36910409 -0.40721418 -0.21482793  0.03073180
    >> 5 -0.58527394 -0.1790337 -0.46778956  0.03573883  0.15473589 -0.07980379
    >> 6 -0.49107314 -0.2662055  0.57928758  0.14267293 -0.03013791  0.10647272
    >> 7  0.22552984 -0.5165964 -0.02498471 -0.20438275 -0.41224195 -0.10753886
    >>
    >> therefore, all rows essentially equal except for rows 5 and 7 of first
    >> dataset (5 and 4 of second dataset).  With a bit more detail:
    >>
    >> *
    >> Row 0.2255298 -0.5165964 -0.02498471 -0.20438275 -0.41224195 -0.107538855
    >> belongs to exdata (and exdata2) and is center of both outputs
    >> *
    >> Row 0.1072127  0.5538876 -0.33117098 -0.43209203 -0.18646403 -0.081273130
    >> belongs to the dataset and it is only center of exdata output
    >> *
    >> Row -0.4820078 -0.1667370 -0.46533618 -0.05271446  0.05477352  0.005236259
    >> does not belong to the dataset and it is only center of exdata output
    >> *
    >> Row -0.58527394 -0.1790337 -0.46778956  0.03573883  0.15473589 -0.07980379
    >> belongs to the dataset and it is only center for exdata2 on Linux in my
    >> computer
    >> *
    >> Row 0.03409765  0.3492520 -0.36910409 -0.40721418 -0.21482793  0.03073180
    >> does not belong to the dataset and it is only center for exdata2 on Linux
    >> in my computer
    >> *
    >> All other 4 rows (1,2,4 and 6 of first output) do not belong to the
    >> dataset and are common centers.
    >>
    >> Even, further, if I run
    >>
    >> set.seed(20232260)
    >> exkmns <- kmeans(exdata, centers = 7, iter.max = 2000, nstart = 750)
    >>
    >> in  posit.cloud (3), I get the same result than above. However, if I run
    >> (both in posit.cloud or in Windows)
    >>
    >> set.seed(20232260)
    >> exkmns2 <- kmeans(exdata2, centers = 7, iter.max = 2000, nstart = 750)
    >>
    >> then I get
    >>
    >>
    >> exkmns2$centers
    >> V1         V2          V3         V4          V5          V6
    >> 1  0.6426035 -0.1449498  0.05843435 -0.1527968  0.62943077  0.02984948
    >> 2 -0.4092382 -0.3740695  0.69597037  0.1956896 -0.05026200 -0.01453132
    >> 3  0.1072127  0.5538876 -0.33117098 -0.4320920 -0.18646403 -0.08127313
    >> 4  0.2255298 -0.5165964 -0.02498471 -0.2043827 -0.41224195 -0.10753886
    >> 5  0.5301237  0.2815620 -0.23898532  1.0097941 -0.26123328  0.06809993
    >> 6 -0.5223387 -0.1484517 -0.38982567 -0.0341488  0.06446446  0.03622056
    >> 7 -0.2701703  0.5263218  0.52942311 -0.1112202 -0.03460591  0.03577287
    >>
    >> So only its rows 4 and 5 are common centers to both of previous outputs
    >> and row 3 is common width exdata centers.
    >>
    >> Does all this have any sense?
    >>
    >> Thanks!
    >>
    >> Iago
    >>
    >> (1)
    >> R version 4.4.1 (2024-06-14 ucrt)
    >> Platform: x86_64-w64-mingw32/x64
    >> Running under: Windows 10 x64 (build 19045)
    >>
    >> Matrix products: default
    >>
    >> (2)
    >> R version 4.4.1 (2024-06-14)
    >> Platform: x86_64-pc-linux-gnu
    >> Running under: Debian GNU/Linux 12 (bookworm)
    >>
    >> Matrix products: default
    >> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3
    >> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.21.so;
    >> LAPACK version 3.11.0
    >>
    >> (3)
    >> R version 4.4.1 (2024-06-14)
    >> Platform: x86_64-pc-linux-gnu
    >> Running under: Ubuntu 20.04.6 LTS
    >>
    >> Matrix products: default
    >> BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/
    >> libopenblasp-r0.3.8.so;  LAPACK version 3.9.0
    >>

	[[alternative HTML version deleted]]


From @nupty@g| @end|ng |rom gm@||@com  Wed Sep  4 15:16:18 2024
From: @nupty@g| @end|ng |rom gm@||@com (Anupam Tyagi)
Date: Wed, 4 Sep 2024 18:46:18 +0530
Subject: [R] dotchart and dotplot(lattice) plot with two/three conditioning
 variables
Message-ID: <CAFL9eu=RLJ2-cdDSkjp_uokTnAahGxaX2YE6w51zE7kkm6YM_Q@mail.gmail.com>

Hello, I am trying to make a Cleaveland Dotplot with two, if possible
three, variables on the vertical axis. I was able to do it in Stata
with two variables, Year and Population (see graph at the link:
https://drive.google.com/file/d/1SiIfmmqk6IFa_OI5i26Ux1ZxkN2oek-o/view?usp=sharing
). I hope the link to the graph works. I have never tried this before.

I want to make a similar (possibly better) graph in R. I tried several
ways to make it in R with dotchart() and dotplot(lattice). I have been
only partially successful thus far. I would like Year, Population and
popGroup on the vertical axis. If popGroup occupies too much space,
then I would like a gap between the groups of Cities and Villages, so
they can be seen as distinct "Populations". My code and a made-up data
are below (in actual data I have 18 categories in "Population",
instead of only six in the made-up data). How can I make this type of
graph?

# Only for 2004-05. How to plot 2011-12 on the same plot?
dotchart(test$"X0_50"[test$"Year"=="2004-05"], labels=test$Population,
xlab = "Income Share ",
         main = "Income shares of percentiles of population", xlim = c(12, 50))
points(test$"X50_90"[test$"Year"=="2004-05"], 1:6, pch = 2)
points(test$"X90_100"[test$"Year"=="2004-05"], 1:6, pch = 16)
legend(x = "topleft",
       legend = c("0-50%", "50-90%", "90-100%"),
       pch = c(1,2, 16)
)

# reorder so Year 2004-05 is plotted before Year 2011-12. This is not
plotting correctly for
# second and third variables. Gap between different Cities and
Villages is quite a bit.
test2 <- test[order(test$seqCode, test$Year, decreasing = T),]

dotchart(test2$"X0_50", labels=test2$Year, xlab = "Income Share ",
         main = "Income shares of percentiles of population", groups =
as.factor(test2$Population), xlim = c(12, 50))
points(test2$"X50_90", 1:12, pch = 2)
points(test2$"X90_100", 1: 12, pch = 16)


# use lattice library
library(lattice)
dotplot(reorder(Population, -seqCode) ~ test$"X0_50" + test$"X50_90" +
test$"X90_100", data = test, auto.key = TRUE)

testLong <- reshape(test, idvar = c("Population", "Year"), varying = list(5:7),
                           v.names = "ptile", direction = "long")

dotplot(reorder(Population, -seqCode) ~ ptile | Year, data = testLong,
groups = time, auto.key = T)

Dataframe is below using dput(). Dataframe is named "test" in my code.

structure(list(seqCode = c(1L, 2L, 3L, 4L, 5L, 6L, 1L, 2L, 3L,
4L, 5L, 6L), popGroup = c("City", "City", "City", "Village",
"Village", "Village", "City", "City", "City", "Village", "Village",
"Village"), Population = c("Dallas", "Boston", "Chicago", "Kip",
"Von", "Dan", "Dallas", "Boston", "Chicago", "Kip", "Von", "Dan"
), Year = c("2004-05", "2004-05", "2004-05", "2004-05", "2004-05",
"2004-05", "2011-12", "2011-12", "2011-12", "2011-12", "2011-12",
"2011-12"), X0_50 = c(15.47, 21.29, 18.04, 15.62, 18.89, 24.37,
17.43, 17.99, 18.04, 14.95, 16.33, 28.98), X50_90 = c(44.12,
43.25, 45.72, 46.15, 43.84, 46.24, 44.39, 44.08, 43.62, 42.89,
44.57, 47.14), X90_100 = c(40.42, 35.47, 36.24, 38.24, 37.27,
29.39, 38.18, 37.93, 38.34, 42.16, 39.11, 23.88)), class =
"data.frame", row.names = c(NA,
-12L))

--
Anupam.


From deep@y@n@@@rk@r @end|ng |rom gm@||@com  Wed Sep  4 16:31:40 2024
From: deep@y@n@@@rk@r @end|ng |rom gm@||@com (Deepayan Sarkar)
Date: Wed, 4 Sep 2024 20:01:40 +0530
Subject: [R] 
 dotchart and dotplot(lattice) plot with two/three conditioning
 variables
In-Reply-To: <CAFL9eu=RLJ2-cdDSkjp_uokTnAahGxaX2YE6w51zE7kkm6YM_Q@mail.gmail.com>
References: <CAFL9eu=RLJ2-cdDSkjp_uokTnAahGxaX2YE6w51zE7kkm6YM_Q@mail.gmail.com>
Message-ID: <CADfFDC7PWFrncupE57PNmg_pTibOM7XyrgFBC5iNB44z=UGr1g@mail.gmail.com>

For lattice::dotplot(), you are close; this is more like the layout you
want:

dotplot(Year ~ ptile | reorder(Population, ptile, mean), testLong,
        groups = c("0-50", "50-90", "90-100")[time],
        layout = c(1, NA),
        par.settings = simpleTheme(pch = 16), auto.key = TRUE)

dotchart() works better with tables, but unfortunately it doesn't seem to
handle more than two dimensions, so you can only get one group at a time:

xtabs(ptile ~ Year + Population, testLong, subset = time == 1) |>
dotchart(pch = 16)

This seems like something that should not be too difficult to improve.

Best,
-Deepayan


On Wed, 4 Sept 2024 at 18:46, Anupam Tyagi <anuptyagi at gmail.com> wrote:

> Hello, I am trying to make a Cleaveland Dotplot with two, if possible
> three, variables on the vertical axis. I was able to do it in Stata
> with two variables, Year and Population (see graph at the link:
>
> https://drive.google.com/file/d/1SiIfmmqk6IFa_OI5i26Ux1ZxkN2oek-o/view?usp=sharing
> ). I hope the link to the graph works. I have never tried this before.
>
> I want to make a similar (possibly better) graph in R. I tried several
> ways to make it in R with dotchart() and dotplot(lattice). I have been
> only partially successful thus far. I would like Year, Population and
> popGroup on the vertical axis. If popGroup occupies too much space,
> then I would like a gap between the groups of Cities and Villages, so
> they can be seen as distinct "Populations". My code and a made-up data
> are below (in actual data I have 18 categories in "Population",
> instead of only six in the made-up data). How can I make this type of
> graph?
>
> # Only for 2004-05. How to plot 2011-12 on the same plot?
> dotchart(test$"X0_50"[test$"Year"=="2004-05"], labels=test$Population,
> xlab = "Income Share ",
>          main = "Income shares of percentiles of population", xlim = c(12,
> 50))
> points(test$"X50_90"[test$"Year"=="2004-05"], 1:6, pch = 2)
> points(test$"X90_100"[test$"Year"=="2004-05"], 1:6, pch = 16)
> legend(x = "topleft",
>        legend = c("0-50%", "50-90%", "90-100%"),
>        pch = c(1,2, 16)
> )
>
> # reorder so Year 2004-05 is plotted before Year 2011-12. This is not
> plotting correctly for
> # second and third variables. Gap between different Cities and
> Villages is quite a bit.
> test2 <- test[order(test$seqCode, test$Year, decreasing = T),]
>
> dotchart(test2$"X0_50", labels=test2$Year, xlab = "Income Share ",
>          main = "Income shares of percentiles of population", groups =
> as.factor(test2$Population), xlim = c(12, 50))
> points(test2$"X50_90", 1:12, pch = 2)
> points(test2$"X90_100", 1: 12, pch = 16)
>
>
> # use lattice library
> library(lattice)
> dotplot(reorder(Population, -seqCode) ~ test$"X0_50" + test$"X50_90" +
> test$"X90_100", data = test, auto.key = TRUE)
>
> testLong <- reshape(test, idvar = c("Population", "Year"), varying =
> list(5:7),
>                            v.names = "ptile", direction = "long")
>
> dotplot(reorder(Population, -seqCode) ~ ptile | Year, data = testLong,
> groups = time, auto.key = T)
>
> Dataframe is below using dput(). Dataframe is named "test" in my code.
>
> structure(list(seqCode = c(1L, 2L, 3L, 4L, 5L, 6L, 1L, 2L, 3L,
> 4L, 5L, 6L), popGroup = c("City", "City", "City", "Village",
> "Village", "Village", "City", "City", "City", "Village", "Village",
> "Village"), Population = c("Dallas", "Boston", "Chicago", "Kip",
> "Von", "Dan", "Dallas", "Boston", "Chicago", "Kip", "Von", "Dan"
> ), Year = c("2004-05", "2004-05", "2004-05", "2004-05", "2004-05",
> "2004-05", "2011-12", "2011-12", "2011-12", "2011-12", "2011-12",
> "2011-12"), X0_50 = c(15.47, 21.29, 18.04, 15.62, 18.89, 24.37,
> 17.43, 17.99, 18.04, 14.95, 16.33, 28.98), X50_90 = c(44.12,
> 43.25, 45.72, 46.15, 43.84, 46.24, 44.39, 44.08, 43.62, 42.89,
> 44.57, 47.14), X90_100 = c(40.42, 35.47, 36.24, 38.24, 37.27,
> 29.39, 38.18, 37.93, 38.34, 42.16, 39.11, 23.88)), class =
> "data.frame", row.names = c(NA,
> -12L))
>
> --
> Anupam.
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> https://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From d@n|e|obo9976 @end|ng |rom gm@||@com  Wed Sep  4 20:54:15 2024
From: d@n|e|obo9976 @end|ng |rom gm@||@com (Daniel Lobo)
Date: Thu, 5 Sep 2024 00:24:15 +0530
Subject: [R] Calculation of VCV matrix of estimated coefficient
In-Reply-To: <CADZb7hocD=zCsmWTw3DaG7P_qgnSww5aRFsPpeL5fkAj48Tzug@mail.gmail.com>
References: <CADZb7hocD=zCsmWTw3DaG7P_qgnSww5aRFsPpeL5fkAj48Tzug@mail.gmail.com>
Message-ID: <CADZb7hpfAc-RPyQHAoYcz8rYEt--37BrDSWmBHuv5SnWhcAEKQ@mail.gmail.com>

Hi,

I am trying to replicate the R's result for VCV matrix of estimated
coefficients from linear model as below

data(mtcars)
model <- lm(mpg~disp+hp, data=mtcars)
model_summ <-summary(model)
MSE = mean(model_summ$residuals^2)
vcov(model)

Now I want to calculate the same thing manually,

library(dplyr)
X = as.matrix(mtcars[, c('disp', 'hp')] %>% mutate(Intercept = 1));
solve(t(X) %*% X) * MSE

Unfortunately they do not match.

Could you please help where I made mistake, if any.

Thanks


From bbo|ker @end|ng |rom gm@||@com  Wed Sep  4 22:14:09 2024
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Wed, 4 Sep 2024 16:14:09 -0400
Subject: [R] Calculation of VCV matrix of estimated coefficient
In-Reply-To: <CADZb7hpfAc-RPyQHAoYcz8rYEt--37BrDSWmBHuv5SnWhcAEKQ@mail.gmail.com>
References: <CADZb7hocD=zCsmWTw3DaG7P_qgnSww5aRFsPpeL5fkAj48Tzug@mail.gmail.com>
 <CADZb7hpfAc-RPyQHAoYcz8rYEt--37BrDSWmBHuv5SnWhcAEKQ@mail.gmail.com>
Message-ID: <CABghstTTqF25PnS0tRs+Pxibx+Q-X5PEwMd3vckN2Rw_bWDkwQ@mail.gmail.com>

The number you need for MSE is

sum(residuals(model)^2)/df.residual(model)

On Wed, Sep 4, 2024 at 3:34?PM Daniel Lobo <danielobo9976 at gmail.com> wrote:
>
> Hi,
>
> I am trying to replicate the R's result for VCV matrix of estimated
> coefficients from linear model as below
>
> data(mtcars)
> model <- lm(mpg~disp+hp, data=mtcars)
> model_summ <-summary(model)
> MSE = mean(model_summ$residuals^2)
> vcov(model)
>
> Now I want to calculate the same thing manually,
>
> library(dplyr)
> X = as.matrix(mtcars[, c('disp', 'hp')] %>% mutate(Intercept = 1));
> solve(t(X) %*% X) * MSE
>
> Unfortunately they do not match.
>
> Could you please help where I made mistake, if any.
>
> Thanks
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide https://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From p@ych@o||u @end|ng |rom gm@||@com  Tue Sep  3 18:30:54 2024
From: p@ych@o||u @end|ng |rom gm@||@com (Chao Liu)
Date: Tue, 3 Sep 2024 12:30:54 -0400
Subject: [R] [R-pkgs] Goodreader: Scrape and Analyze 'Goodreads' Book Data
Message-ID: <CACCU-vM3B95EnoYz=-wKf5r+iWm-O8iCW6h-cBo-q+kjvuRk1Q@mail.gmail.com>

Dear R Users,

I am pleased to announce that Goodreader 0.1.1 is now available on CRAN.

Goodreader offers a toolkit for scraping and analyzing book data from
Goodreads. Users can search for books, scrape detailed information and
reviews, perform sentiment analysis on reviews, and conduct topic modeling.

Here?s a quick overview of how to use Goodreader:
# Search for books
AI_df <- search_goodreads(search_term = "artificial intelligence",
search_in = "title", num_books = 10, sort_by = "ratings")

# Retrieve Book IDs and save them to a text file
get_book_ids(input_data = AI_df, file_name = "AI_books.txt")

# Get book-related information
scrape_books(book_ids_path = "AI_books.txt")

# Scrape book reviews
scrape_reviews(book_ids_path = "AI_books.txt", num_reviews = 10)

For more details, please visit: https://liu-chao.site/Goodreader/

Best regards,

Chao Liu

	[[alternative HTML version deleted]]

_______________________________________________
R-packages mailing list
R-packages at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-packages


From gdr@|@m@ @end|ng |rom x@4@||@n|  Thu Sep  5 13:05:35 2024
From: gdr@|@m@ @end|ng |rom x@4@||@n| (Gerrit Draisma)
Date: Thu, 5 Sep 2024 13:05:35 +0200
Subject: [R] lattice log scale labels.
Message-ID: <b01b6e2d-9c73-420f-8170-0cb4c900f312@xs4all.nl>

Dear R-helpers,

In the plot below I would like to have labels at positions 2^(3*(0:10)),
and keep the labels in the exponential format.
I tried using yscale.components.default.

*This* gives the right format of the labels:
--------
 > yscale.components.default(lim= c(0,30),log=2)
....
$num.limit
[1]  0 30
...
[1]  0  5 10 15 20 25 30
...
$left$labels$labels
[1] "2^0"  "2^5"  "2^10" "2^15" "2^20" "2^25" "2^30"
--------

and *this* gives the right locations
--------
 > yscale.components.default(lim= c(0,30),log=2,at=2^(3*(0:10)))
$num.limit
[1]  0 30
...
  [1]  0  3  6  9 12 15 18 21 24 27 30
...
$left$labels$labels
  [1] "1"          "8"          "64"         "512"        "4096"
  [6] "32768"      "262144"     "2097152"    "16777216"   "134217728"
[11] "1073741824"
--------

How can I get the format in the first example at the locations of the 
second?

Thanks,
Gerrit

-------------
x <- read.csv(text="
n,c,t,u
4,1,2,1
8,28,8,1
12,495,42,3
16,8008,256,7
20,125970,1680,31
24,1961256,11640,138
28,30421755,83776,808
32,471435600,620576,4956
36,7307872110,4700880,33719")
library(lattice)
yscale.components.log2 <- function(...){
     ans <- yscale.components.default(...)
     ans$left$labels$labels <-
         parse(text = ans$left$labels$labels)
     ans
}


# pdf("tangle_mathFig06.pdf")
xyplot(c+t+u~n,data=x,type="b", xlab="Size", ylab="Number of tangles",
    scales=list(x=list(at=4*(1:9)),y=list(log=2)),
    yscale.components=yscale.components.log2,
    auto.key=list(columns=3,text=c("(choose m n)","tangles","unique 
tangles"),
    points=FALSE,lines=TRUE))
# dev.off()


From ggrothend|eck @end|ng |rom gm@||@com  Thu Sep  5 16:36:54 2024
From: ggrothend|eck @end|ng |rom gm@||@com (Gabor Grothendieck)
Date: Thu, 5 Sep 2024 10:36:54 -0400
Subject: [R] Calculation of VCV matrix of estimated coefficient
In-Reply-To: <CADZb7hpfAc-RPyQHAoYcz8rYEt--37BrDSWmBHuv5SnWhcAEKQ@mail.gmail.com>
References: <CADZb7hocD=zCsmWTw3DaG7P_qgnSww5aRFsPpeL5fkAj48Tzug@mail.gmail.com>
 <CADZb7hpfAc-RPyQHAoYcz8rYEt--37BrDSWmBHuv5SnWhcAEKQ@mail.gmail.com>
Message-ID: <CAP01uRnywJTLerMkPEm4MsNRF4GLUVcKXyBjOpHAw8ED8HYjKw@mail.gmail.com>

sigma(model)^2 will give the correct MSE.  Also note that your model
matrix has intercept at
the end whereas vcov will have it at the beginning so you will need to
permute the rows
and columns to get them to be the same/

On Wed, Sep 4, 2024 at 3:34?PM Daniel Lobo <danielobo9976 at gmail.com> wrote:
>
> Hi,
>
> I am trying to replicate the R's result for VCV matrix of estimated
> coefficients from linear model as below
>
> data(mtcars)
> model <- lm(mpg~disp+hp, data=mtcars)
> model_summ <-summary(model)
> MSE = mean(model_summ$residuals^2)
> vcov(model)
>
> Now I want to calculate the same thing manually,
>
> library(dplyr)
> X = as.matrix(mtcars[, c('disp', 'hp')] %>% mutate(Intercept = 1));
> solve(t(X) %*% X) * MSE
>
> Unfortunately they do not match.
>
> Could you please help where I made mistake, if any.
>
> Thanks
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide https://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.



-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From bgunter@4567 @end|ng |rom gm@||@com  Thu Sep  5 16:54:00 2024
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Thu, 5 Sep 2024 07:54:00 -0700
Subject: [R] lattice log scale labels.
In-Reply-To: <b01b6e2d-9c73-420f-8170-0cb4c900f312@xs4all.nl>
References: <b01b6e2d-9c73-420f-8170-0cb4c900f312@xs4all.nl>
Message-ID: <CAGxFJbT+yMfCOLNdWPsADYZYBK_P-S4ga5SRBFD_--FFehi1-w@mail.gmail.com>

Do the "at" and "labels" components of the "scales" list argument to xyplot
not do what you want?

Cheers,
Bert

On Thu, Sep 5, 2024 at 4:05?AM Gerrit Draisma <gdraisma at xs4all.nl> wrote:

> Dear R-helpers,
>
> In the plot below I would like to have labels at positions 2^(3*(0:10)),
> and keep the labels in the exponential format.
> I tried using yscale.components.default.
>
> *This* gives the right format of the labels:
> --------
>  > yscale.components.default(lim= c(0,30),log=2)
> ....
> $num.limit
> [1]  0 30
> ...
> [1]  0  5 10 15 20 25 30
> ...
> $left$labels$labels
> [1] "2^0"  "2^5"  "2^10" "2^15" "2^20" "2^25" "2^30"
> --------
>
> and *this* gives the right locations
> --------
>  > yscale.components.default(lim= c(0,30),log=2,at=2^(3*(0:10)))
> $num.limit
> [1]  0 30
> ...
>   [1]  0  3  6  9 12 15 18 21 24 27 30
> ...
> $left$labels$labels
>   [1] "1"          "8"          "64"         "512"        "4096"
>   [6] "32768"      "262144"     "2097152"    "16777216"   "134217728"
> [11] "1073741824"
> --------
>
> How can I get the format in the first example at the locations of the
> second?
>
> Thanks,
> Gerrit
>
> -------------
> x <- read.csv(text="
> n,c,t,u
> 4,1,2,1
> 8,28,8,1
> 12,495,42,3
> 16,8008,256,7
> 20,125970,1680,31
> 24,1961256,11640,138
> 28,30421755,83776,808
> 32,471435600,620576,4956
> 36,7307872110,4700880,33719")
> library(lattice)
> yscale.components.log2 <- function(...){
>      ans <- yscale.components.default(...)
>      ans$left$labels$labels <-
>          parse(text = ans$left$labels$labels)
>      ans
> }
>
>
> # pdf("tangle_mathFig06.pdf")
> xyplot(c+t+u~n,data=x,type="b", xlab="Size", ylab="Number of tangles",
>     scales=list(x=list(at=4*(1:9)),y=list(log=2)),
>     yscale.components=yscale.components.log2,
>     auto.key=list(columns=3,text=c("(choose m n)","tangles","unique
> tangles"),
>     points=FALSE,lines=TRUE))
> # dev.off()
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> https://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From gdr@|@m@ @end|ng |rom x@4@||@n|  Thu Sep  5 19:01:24 2024
From: gdr@|@m@ @end|ng |rom x@4@||@n| (Gerrit Draisma)
Date: Thu, 5 Sep 2024 19:01:24 +0200
Subject: [R] lattice log scale labels.
In-Reply-To: <CAGxFJbT+yMfCOLNdWPsADYZYBK_P-S4ga5SRBFD_--FFehi1-w@mail.gmail.com>
References: <b01b6e2d-9c73-420f-8170-0cb4c900f312@xs4all.nl>
 <CAGxFJbT+yMfCOLNdWPsADYZYBK_P-S4ga5SRBFD_--FFehi1-w@mail.gmail.com>
Message-ID: <34aa1fe5-0160-4c34-8844-0145dc681b08@xs4all.nl>

Thanks Greg and Bert for solving my problem.
This gives what I want:
----------------

myticks <- 2^(3*(0:11))
mylabels <- parse(text=paste0("2^",log2(myticks)))

xyplot(c+t+u~n,data=x,type="b", xlab="Size", ylab="Number of tangles",
   scales=list(x=list(at=4*(1:9)),y=list(log=2,at=myticks,labels=mylabels),
    auto.key=list(columns=3,text=c("(choose m n)","tangles","unique
       tangles"), points=FALSE,lines=TRUE)))
----------------
Solved!
Gerrit

Op 05-09-2024 om 16:54 schreef Bert Gunter:
> Do the "at" and "labels" components of the "scales" list argument to 
> xyplot not do what you want?
> 
> Cheers,
> Bert
> 
> On Thu, Sep 5, 2024 at 4:05?AM Gerrit Draisma <gdraisma at xs4all.nl 
> <mailto:gdraisma at xs4all.nl>> wrote:
> 
>     Dear R-helpers,
> 
>     In the plot below I would like to have labels at positions 2^(3*(0:10)),
>     and keep the labels in the exponential format.
>     I tried using yscale.components.default.
> 
>     *This* gives the right format of the labels:
>     --------
>      ?> yscale.components.default(lim= c(0,30),log=2)
>     ....
>     $num.limit
>     [1]? 0 30
>     ...
>     [1]? 0? 5 10 15 20 25 30
>     ...
>     $left$labels$labels
>     [1] "2^0"? "2^5"? "2^10" "2^15" "2^20" "2^25" "2^30"
>     --------
> 
>     and *this* gives the right locations
>     --------
>      ?> yscale.components.default(lim= c(0,30),log=2,at=2^(3*(0:10)))
>     $num.limit
>     [1]? 0 30
>     ...
>      ? [1]? 0? 3? 6? 9 12 15 18 21 24 27 30
>     ...
>     $left$labels$labels
>      ? [1] "1"? ? ? ? ? "8"? ? ? ? ? "64"? ? ? ? ?"512"? ? ? ? "4096"
>      ? [6] "32768"? ? ? "262144"? ? ?"2097152"? ? "16777216"? ?"134217728"
>     [11] "1073741824"
>     --------
> 
>     How can I get the format in the first example at the locations of the
>     second?
> 
>     Thanks,
>     Gerrit
> 
>     -------------
>     x <- read.csv(text="
>     n,c,t,u
>     4,1,2,1
>     8,28,8,1
>     12,495,42,3
>     16,8008,256,7
>     20,125970,1680,31
>     24,1961256,11640,138
>     28,30421755,83776,808
>     32,471435600,620576,4956
>     36,7307872110,4700880,33719")
>     library(lattice)
>     yscale.components.log2 <- function(...){
>      ? ? ?ans <- yscale.components.default(...)
>      ? ? ?ans$left$labels$labels <-
>      ? ? ? ? ?parse(text = ans$left$labels$labels)
>      ? ? ?ans
>     }
> 
> 
>     # pdf("tangle_mathFig06.pdf")
>     xyplot(c+t+u~n,data=x,type="b", xlab="Size", ylab="Number of tangles",
>      ? ? scales=list(x=list(at=4*(1:9)),y=list(log=2)),
>      ? ? yscale.components=yscale.components.log2,
>      ? ? auto.key=list(columns=3,text=c("(choose m n)","tangles","unique
>     tangles"),
>      ? ? points=FALSE,lines=TRUE))
>     # dev.off()
> 
>     ______________________________________________
>     R-help at r-project.org <mailto:R-help at r-project.org> mailing list --
>     To UNSUBSCRIBE and more, see
>     https://stat.ethz.ch/mailman/listinfo/r-help <https://stat.ethz.ch/
>     mailman/listinfo/r-help>
>     PLEASE do read the posting guide https://www.R-project.org/posting-
>     guide.html <https://www.R-project.org/posting-guide.html>
>     and provide commented, minimal, self-contained, reproducible code.
>


From |eo@m@d@ @end|ng |rom @yon|c@eu  Thu Sep  5 22:23:25 2024
From: |eo@m@d@ @end|ng |rom @yon|c@eu (Leo Mada)
Date: Thu, 5 Sep 2024 20:23:25 +0000
Subject: [R] BUG: atan(1i) / 5 = NaN+Infi ?
Message-ID: <DBAP192MB0956E56C96996102FA20D5E8849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>

Dear R Users,

Is this desired behaviour?
I presume it's a bug.

atan(1i)
# 0+Infi

tan(atan(1i))
# 0+1i

atan(1i) / 5
# NaN+Infi

There were some changes in handling of complex numbers. But it looks like a bug.

Sincerely,

Leonard


	[[alternative HTML version deleted]]


From bgunter@4567 @end|ng |rom gm@||@com  Thu Sep  5 23:38:15 2024
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Thu, 5 Sep 2024 14:38:15 -0700
Subject: [R] BUG: atan(1i) / 5 = NaN+Infi ?
In-Reply-To: <DBAP192MB0956E56C96996102FA20D5E8849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
References: <DBAP192MB0956E56C96996102FA20D5E8849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
Message-ID: <CAGxFJbT-FU3ehHir6xUf=FSyyuSW_MArTeFCdbRwV=CU8HgieA@mail.gmail.com>

What version of R are you using and on what platform?

I get:
> atan(1i)
[1] 0.7853982+Infi
> atan(1i)/5
[1] NaN+Infi

on:
R version 4.4.1 (2024-06-14)
Platform: aarch64-apple-darwin20
Running under: macOS Sonoma 14.6.1

-- Bert

On Thu, Sep 5, 2024 at 1:23?PM Leo Mada via R-help <r-help at r-project.org>
wrote:

> Dear R Users,
>
> Is this desired behaviour?
> I presume it's a bug.
>
> atan(1i)
> # 0+Infi
>
> tan(atan(1i))
> # 0+1i
>
> atan(1i) / 5
> # NaN+Infi
>
> There were some changes in handling of complex numbers. But it looks like
> a bug.
>
> Sincerely,
>
> Leonard
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> https://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Thu Sep  5 23:40:53 2024
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 5 Sep 2024 17:40:53 -0400
Subject: [R] BUG: atan(1i) / 5 = NaN+Infi ?
In-Reply-To: <DBAP192MB0956E56C96996102FA20D5E8849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
References: <DBAP192MB0956E56C96996102FA20D5E8849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
Message-ID: <f3a0740d-386a-44e4-8415-7259c1e8827f@gmail.com>

On 2024-09-05 4:23 p.m., Leo Mada via R-help wrote:
> Dear R Users,
> 
> Is this desired behaviour?
> I presume it's a bug.
> 
> atan(1i)
> # 0+Infi
> 
> tan(atan(1i))
> # 0+1i
> 
> atan(1i) / 5
> # NaN+Infi

There's no need to involve atan() and tan() in this:

 > (0+Inf*1i)/5
[1] NaN+Infi

Why do you think this is a bug?

Duncan Murdoch


From bgunter@4567 @end|ng |rom gm@||@com  Fri Sep  6 00:12:06 2024
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Thu, 5 Sep 2024 15:12:06 -0700
Subject: [R] BUG: atan(1i) / 5 = NaN+Infi ?
In-Reply-To: <f3a0740d-386a-44e4-8415-7259c1e8827f@gmail.com>
References: <DBAP192MB0956E56C96996102FA20D5E8849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
 <f3a0740d-386a-44e4-8415-7259c1e8827f@gmail.com>
Message-ID: <CAGxFJbQGcyzHa=Km+z_+iy=m9RaUCrsPOfXmHKWMPcXh9bbeHA@mail.gmail.com>

Perhaps

> Inf*1i
[1] NaN+Infi

clarifies why it is *not* a bug.
(Boy, did that jog some long dusty math memories :-)  )

-- Bert

On Thu, Sep 5, 2024 at 2:48?PM Duncan Murdoch <murdoch.duncan at gmail.com>
wrote:

> On 2024-09-05 4:23 p.m., Leo Mada via R-help wrote:
> > Dear R Users,
> >
> > Is this desired behaviour?
> > I presume it's a bug.
> >
> > atan(1i)
> > # 0+Infi
> >
> > tan(atan(1i))
> > # 0+1i
> >
> > atan(1i) / 5
> > # NaN+Infi
>
> There's no need to involve atan() and tan() in this:
>
>  > (0+Inf*1i)/5
> [1] NaN+Infi
>
> Why do you think this is a bug?
>
> Duncan Murdoch
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> https://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From |eo@m@d@ @end|ng |rom @yon|c@eu  Fri Sep  6 00:20:20 2024
From: |eo@m@d@ @end|ng |rom @yon|c@eu (Leo Mada)
Date: Thu, 5 Sep 2024 22:20:20 +0000
Subject: [R] BUG: atan(1i) / 5 = NaN+Infi ?
In-Reply-To: <CAGxFJbQGcyzHa=Km+z_+iy=m9RaUCrsPOfXmHKWMPcXh9bbeHA@mail.gmail.com>
References: <DBAP192MB0956E56C96996102FA20D5E8849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
 <f3a0740d-386a-44e4-8415-7259c1e8827f@gmail.com>
 <CAGxFJbQGcyzHa=Km+z_+iy=m9RaUCrsPOfXmHKWMPcXh9bbeHA@mail.gmail.com>
Message-ID: <DBAP192MB09561B0A36D4EE0719704DFF849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>

Dear Bert,

These behave like real divisions/multiplications:
complex(re=Inf, im = Inf) * 5
# Inf+Infi
complex(re=-Inf, im = Inf) * 5
# -Inf+Infi

The real division / multiplication should be faster and also is well behaved. I was expecting R to do the real division/multiplication on a complex number. Which R actually does for these very particular cases; but not when only Im(x) is Inf.

Sincerely,

Leonard

________________________________
From: Bert Gunter <bgunter.4567 at gmail.com>
Sent: Friday, September 6, 2024 1:12 AM
To: Duncan Murdoch <murdoch.duncan at gmail.com>
Cc: Leo Mada <leo.mada at syonic.eu>; r-help at r-project.org <r-help at r-project.org>
Subject: Re: [R] BUG: atan(1i) / 5 = NaN+Infi ?

Perhaps

> Inf*1i
[1] NaN+Infi

clarifies why it is *not* a bug.
(Boy, did that jog some long dusty math memories :-)  )

-- Bert

On Thu, Sep 5, 2024 at 2:48?PM Duncan Murdoch <murdoch.duncan at gmail.com<mailto:murdoch.duncan at gmail.com>> wrote:
On 2024-09-05 4:23 p.m., Leo Mada via R-help wrote:
> Dear R Users,
>
> Is this desired behaviour?
> I presume it's a bug.
>
> atan(1i)
> # 0+Infi
>
> tan(atan(1i))
> # 0+1i
>
> atan(1i) / 5
> # NaN+Infi

There's no need to involve atan() and tan() in this:

 > (0+Inf*1i)/5
[1] NaN+Infi

Why do you think this is a bug?

Duncan Murdoch

______________________________________________
R-help at r-project.org<mailto:R-help at r-project.org> mailing list -- To UNSUBSCRIBE and more, see
https://stat.ethz.ch/mailman/listinfo/r-help
PLEASE do read the posting guide https://www.R-project.org/posting-guide.html
and provide commented, minimal, self-contained, reproducible code.

	[[alternative HTML version deleted]]


From bgunter@4567 @end|ng |rom gm@||@com  Fri Sep  6 00:38:33 2024
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Thu, 5 Sep 2024 15:38:33 -0700
Subject: [R] BUG: atan(1i) / 5 = NaN+Infi ?
In-Reply-To: <DBAP192MB09561B0A36D4EE0719704DFF849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
References: <DBAP192MB0956E56C96996102FA20D5E8849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
 <f3a0740d-386a-44e4-8415-7259c1e8827f@gmail.com>
 <CAGxFJbQGcyzHa=Km+z_+iy=m9RaUCrsPOfXmHKWMPcXh9bbeHA@mail.gmail.com>
 <DBAP192MB09561B0A36D4EE0719704DFF849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
Message-ID: <CAGxFJbRmhS0Uuzwa75A=9bwj1+fv50Q1T78V-kbezKwcEFoDvQ@mail.gmail.com>

> complex(real = 0, imaginary = Inf)
[1] 0+Infi

> Inf*1i
[1] NaN+Infi

>> complex(real = 0, imaginary = Inf)/5
[1] NaN+Infi

See the Note in ?complex for the explanation, I think.  Duncan can correct
if I'm wrong.

-- Bert

On Thu, Sep 5, 2024 at 3:20?PM Leo Mada <leo.mada at syonic.eu> wrote:

> Dear Bert,
>
> These behave like real divisions/multiplications:
> complex(re=Inf, im = Inf) * 5
> # Inf+Infi
> complex(re=-Inf, im = Inf) * 5
> # -Inf+Infi
>
> The real division / multiplication should be faster and also is well
> behaved. I was expecting R to do the real division/multiplication on a
> complex number. Which R actually does for these very particular cases; but
> not when only Im(x) is Inf.
>
> Sincerely,
>
> Leonard
>
> ------------------------------
> *From:* Bert Gunter <bgunter.4567 at gmail.com>
> *Sent:* Friday, September 6, 2024 1:12 AM
> *To:* Duncan Murdoch <murdoch.duncan at gmail.com>
> *Cc:* Leo Mada <leo.mada at syonic.eu>; r-help at r-project.org <
> r-help at r-project.org>
> *Subject:* Re: [R] BUG: atan(1i) / 5 = NaN+Infi ?
>
> Perhaps
>
> > Inf*1i
> [1] NaN+Infi
>
> clarifies why it is *not* a bug.
> (Boy, did that jog some long dusty math memories :-)  )
>
> -- Bert
>
> On Thu, Sep 5, 2024 at 2:48?PM Duncan Murdoch <murdoch.duncan at gmail.com>
> wrote:
>
> On 2024-09-05 4:23 p.m., Leo Mada via R-help wrote:
> > Dear R Users,
> >
> > Is this desired behaviour?
> > I presume it's a bug.
> >
> > atan(1i)
> > # 0+Infi
> >
> > tan(atan(1i))
> > # 0+1i
> >
> > atan(1i) / 5
> > # NaN+Infi
>
> There's no need to involve atan() and tan() in this:
>
>  > (0+Inf*1i)/5
> [1] NaN+Infi
>
> Why do you think this is a bug?
>
> Duncan Murdoch
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> https://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>
>

	[[alternative HTML version deleted]]


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Fri Sep  6 01:06:57 2024
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Thu, 05 Sep 2024 16:06:57 -0700
Subject: [R] BUG: atan(1i) / 5 = NaN+Infi ?
In-Reply-To: <CAGxFJbRmhS0Uuzwa75A=9bwj1+fv50Q1T78V-kbezKwcEFoDvQ@mail.gmail.com>
References: <DBAP192MB0956E56C96996102FA20D5E8849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
 <f3a0740d-386a-44e4-8415-7259c1e8827f@gmail.com>
 <CAGxFJbQGcyzHa=Km+z_+iy=m9RaUCrsPOfXmHKWMPcXh9bbeHA@mail.gmail.com>
 <DBAP192MB09561B0A36D4EE0719704DFF849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
 <CAGxFJbRmhS0Uuzwa75A=9bwj1+fv50Q1T78V-kbezKwcEFoDvQ@mail.gmail.com>
Message-ID: <B013294E-6859-41ED-B0E4-D6E1E6512B3E@dcn.davis.ca.us>

atan(1i) -> 0 + Inf i
complex(1/5) -> 0.2 + 0i
atan(1i) -> (0 + Inf i) * (0.2 + 0i)
-> 0*0.2 + 0*0i + Inf i * 0.2 + Inf i * 0i
infinity times zero is undefined
-> 0 + 0i + Inf i + NaN * i^2
-> 0 + 0i + Inf i - NaN
-> NaN + Inf i

I am not sure how complex arithmetic could arrive at another answer.

I advise against messing with infinities... use atan2() if you don't actually need complex arithmetic.

On September 5, 2024 3:38:33 PM PDT, Bert Gunter <bgunter.4567 at gmail.com> wrote:
>> complex(real = 0, imaginary = Inf)
>[1] 0+Infi
>
>> Inf*1i
>[1] NaN+Infi
>
>>> complex(real = 0, imaginary = Inf)/5
>[1] NaN+Infi
>
>See the Note in ?complex for the explanation, I think.  Duncan can correct
>if I'm wrong.
>
>-- Bert
>
>On Thu, Sep 5, 2024 at 3:20?PM Leo Mada <leo.mada at syonic.eu> wrote:
>
>> Dear Bert,
>>
>> These behave like real divisions/multiplications:
>> complex(re=Inf, im = Inf) * 5
>> # Inf+Infi
>> complex(re=-Inf, im = Inf) * 5
>> # -Inf+Infi
>>
>> The real division / multiplication should be faster and also is well
>> behaved. I was expecting R to do the real division/multiplication on a
>> complex number. Which R actually does for these very particular cases; but
>> not when only Im(x) is Inf.
>>
>> Sincerely,
>>
>> Leonard
>>
>> ------------------------------
>> *From:* Bert Gunter <bgunter.4567 at gmail.com>
>> *Sent:* Friday, September 6, 2024 1:12 AM
>> *To:* Duncan Murdoch <murdoch.duncan at gmail.com>
>> *Cc:* Leo Mada <leo.mada at syonic.eu>; r-help at r-project.org <
>> r-help at r-project.org>
>> *Subject:* Re: [R] BUG: atan(1i) / 5 = NaN+Infi ?
>>
>> Perhaps
>>
>> > Inf*1i
>> [1] NaN+Infi
>>
>> clarifies why it is *not* a bug.
>> (Boy, did that jog some long dusty math memories :-)  )
>>
>> -- Bert
>>
>> On Thu, Sep 5, 2024 at 2:48?PM Duncan Murdoch <murdoch.duncan at gmail.com>
>> wrote:
>>
>> On 2024-09-05 4:23 p.m., Leo Mada via R-help wrote:
>> > Dear R Users,
>> >
>> > Is this desired behaviour?
>> > I presume it's a bug.
>> >
>> > atan(1i)
>> > # 0+Infi
>> >
>> > tan(atan(1i))
>> > # 0+1i
>> >
>> > atan(1i) / 5
>> > # NaN+Infi
>>
>> There's no need to involve atan() and tan() in this:
>>
>>  > (0+Inf*1i)/5
>> [1] NaN+Infi
>>
>> Why do you think this is a bug?
>>
>> Duncan Murdoch
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide
>> https://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
>>
>>
>
>	[[alternative HTML version deleted]]
>
>______________________________________________
>R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>https://stat.ethz.ch/mailman/listinfo/r-help
>PLEASE do read the posting guide https://www.R-project.org/posting-guide.html
>and provide commented, minimal, self-contained, reproducible code.

-- 
Sent from my phone. Please excuse my brevity.


From murdoch@dunc@n @end|ng |rom gm@||@com  Fri Sep  6 01:40:35 2024
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 5 Sep 2024 19:40:35 -0400
Subject: [R] BUG: atan(1i) / 5 = NaN+Infi ?
In-Reply-To: <DBAP192MB0956C07B3C3DE087A227C12C849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
References: <DBAP192MB0956E56C96996102FA20D5E8849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
 <f3a0740d-386a-44e4-8415-7259c1e8827f@gmail.com>
 <DBAP192MB0956C07B3C3DE087A227C12C849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
Message-ID: <73d502d2-d6f3-4dde-bcbf-e520666b9036@gmail.com>

On 2024-09-05 6:12 p.m., Leo Mada wrote:
> Dear Duncan,
> 
> Here is also the missing information:
> R version 4.4.1 (2024-06-14 ucrt)
> Platform: x86_64-w64-mingw32/x64
> Running under: Windows 10 x64 (build 19045)
> 
> Regarding the results:
> atan(1i)
> #?0+Infi
> Re(atan(1i))
> # 0
> Im(atan(1i))
> #? Inf
> 
> 0 + Inf i is a valid complex number:
> tan(atan(1i))
> # 0+1i
> 
> Inf / 5
> # Inf
> 
> Note: atan(1i) / 5 should have generated 0 + Inf * 1i; even the explicit 
> complex number fails:
> complex(re=0, im = Inf) / 5
> # NaN+Infi
> complex(re=Inf, im = Inf) / 5
> # Inf+Infi
> 
> I presume that R tries to do the complex division, although the real 
> division is well defined.

I imagine that what happens is that when one operand is complex, both 
are coerced to complex and the operation is carried out.  I had assumed 
this was documented in ?complex, but I don't see it there.  Maybe it 
should be.

If you want z/5 to be carried out using the correct mathematical 
approach, you'll probably have to define it yourself.  For example,

   CxByReal <- function(num, denom) {
     if (is.complex(denom)) stop("this is for a real denominator!")
     complex(real = Re(num)/denom, imaginary = Im(num)/denom)
   }

   CxByReal(complex(real=0, imaginary=Inf), 5)
   # [1] 0+Infi

Duncan Murdoch

> 
> Sincerely,
> 
> Leonard
> 
> ------------------------------------------------------------------------
> *From:* Duncan Murdoch <murdoch.duncan at gmail.com>
> *Sent:* Friday, September 6, 2024 12:40 AM
> *To:* Leo Mada <leo.mada at syonic.eu>; r-help at r-project.org 
> <r-help at r-project.org>
> *Subject:* Re: [R] BUG: atan(1i) / 5 = NaN+Infi ?
> On 2024-09-05 4:23 p.m., Leo Mada via R-help wrote:
>> Dear R Users,
>> 
>> Is this desired behaviour?
>> I presume it's a bug.
>> 
>> atan(1i)
>> # 0+Infi
>> 
>> tan(atan(1i))
>> # 0+1i
>> 
>> atan(1i) / 5
>> # NaN+Infi
> 
> There's no need to involve atan() and tan() in this:
> 
>  ?> (0+Inf*1i)/5
> [1] NaN+Infi
> 
> Why do you think this is a bug?
> 
> Duncan Murdoch
>


From bgunter@4567 @end|ng |rom gm@||@com  Fri Sep  6 01:55:09 2024
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Thu, 5 Sep 2024 16:55:09 -0700
Subject: [R] BUG: atan(1i) / 5 = NaN+Infi ?
In-Reply-To: <B013294E-6859-41ED-B0E4-D6E1E6512B3E@dcn.davis.ca.us>
References: <DBAP192MB0956E56C96996102FA20D5E8849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
 <f3a0740d-386a-44e4-8415-7259c1e8827f@gmail.com>
 <CAGxFJbQGcyzHa=Km+z_+iy=m9RaUCrsPOfXmHKWMPcXh9bbeHA@mail.gmail.com>
 <DBAP192MB09561B0A36D4EE0719704DFF849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
 <CAGxFJbRmhS0Uuzwa75A=9bwj1+fv50Q1T78V-kbezKwcEFoDvQ@mail.gmail.com>
 <B013294E-6859-41ED-B0E4-D6E1E6512B3E@dcn.davis.ca.us>
Message-ID: <CAGxFJbQX65wpeF8mXa7P1+A9+vJ77hpmMR5v3wssidp+JFC4gw@mail.gmail.com>

> x <- complex(imag = Inf)
> x
[1] 0+Infi
> x*1
[1] NaN+Infi
> x+0
[1] 0+Infi

R does the addition and subtraction "coordinatewise"; the C library handles
everything else. This results in 2 different ways the point at infinity is
printed.

(Correction requested if this is wrong)

Bert

On Thu, Sep 5, 2024 at 4:07?PM Jeff Newmiller via R-help <
r-help at r-project.org> wrote:

> atan(1i) -> 0 + Inf i
> complex(1/5) -> 0.2 + 0i
> atan(1i) -> (0 + Inf i) * (0.2 + 0i)
> -> 0*0.2 + 0*0i + Inf i * 0.2 + Inf i * 0i
> infinity times zero is undefined
> -> 0 + 0i + Inf i + NaN * i^2
> -> 0 + 0i + Inf i - NaN
> -> NaN + Inf i
>
> I am not sure how complex arithmetic could arrive at another answer.
>
> I advise against messing with infinities... use atan2() if you don't
> actually need complex arithmetic.
>
> On September 5, 2024 3:38:33 PM PDT, Bert Gunter <bgunter.4567 at gmail.com>
> wrote:
> >> complex(real = 0, imaginary = Inf)
> >[1] 0+Infi
> >
> >> Inf*1i
> >[1] NaN+Infi
> >
> >>> complex(real = 0, imaginary = Inf)/5
> >[1] NaN+Infi
> >
> >See the Note in ?complex for the explanation, I think.  Duncan can correct
> >if I'm wrong.
> >
> >-- Bert
> >
> >On Thu, Sep 5, 2024 at 3:20?PM Leo Mada <leo.mada at syonic.eu> wrote:
> >
> >> Dear Bert,
> >>
> >> These behave like real divisions/multiplications:
> >> complex(re=Inf, im = Inf) * 5
> >> # Inf+Infi
> >> complex(re=-Inf, im = Inf) * 5
> >> # -Inf+Infi
> >>
> >> The real division / multiplication should be faster and also is well
> >> behaved. I was expecting R to do the real division/multiplication on a
> >> complex number. Which R actually does for these very particular cases;
> but
> >> not when only Im(x) is Inf.
> >>
> >> Sincerely,
> >>
> >> Leonard
> >>
> >> ------------------------------
> >> *From:* Bert Gunter <bgunter.4567 at gmail.com>
> >> *Sent:* Friday, September 6, 2024 1:12 AM
> >> *To:* Duncan Murdoch <murdoch.duncan at gmail.com>
> >> *Cc:* Leo Mada <leo.mada at syonic.eu>; r-help at r-project.org <
> >> r-help at r-project.org>
> >> *Subject:* Re: [R] BUG: atan(1i) / 5 = NaN+Infi ?
> >>
> >> Perhaps
> >>
> >> > Inf*1i
> >> [1] NaN+Infi
> >>
> >> clarifies why it is *not* a bug.
> >> (Boy, did that jog some long dusty math memories :-)  )
> >>
> >> -- Bert
> >>
> >> On Thu, Sep 5, 2024 at 2:48?PM Duncan Murdoch <murdoch.duncan at gmail.com
> >
> >> wrote:
> >>
> >> On 2024-09-05 4:23 p.m., Leo Mada via R-help wrote:
> >> > Dear R Users,
> >> >
> >> > Is this desired behaviour?
> >> > I presume it's a bug.
> >> >
> >> > atan(1i)
> >> > # 0+Infi
> >> >
> >> > tan(atan(1i))
> >> > # 0+1i
> >> >
> >> > atan(1i) / 5
> >> > # NaN+Infi
> >>
> >> There's no need to involve atan() and tan() in this:
> >>
> >>  > (0+Inf*1i)/5
> >> [1] NaN+Infi
> >>
> >> Why do you think this is a bug?
> >>
> >> Duncan Murdoch
> >>
> >> ______________________________________________
> >> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> >> https://stat.ethz.ch/mailman/listinfo/r-help
> >> PLEASE do read the posting guide
> >> https://www.R-project.org/posting-guide.html
> >> and provide commented, minimal, self-contained, reproducible code.
> >>
> >>
> >
> >       [[alternative HTML version deleted]]
> >
> >______________________________________________
> >R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> >https://stat.ethz.ch/mailman/listinfo/r-help
> >PLEASE do read the posting guide
> https://www.R-project.org/posting-guide.html
> >and provide commented, minimal, self-contained, reproducible code.
>
> --
> Sent from my phone. Please excuse my brevity.
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> https://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From cry@n @end|ng |rom b|ngh@mton@edu  Fri Sep  6 04:50:24 2024
From: cry@n @end|ng |rom b|ngh@mton@edu (Christopher W. Ryan)
Date: Thu, 5 Sep 2024 22:50:24 -0400
Subject: [R] effects() extractor for a quantile reqression object: error
 message
Message-ID: <ff1b1a84-d571-7e4c-d7d6-195cd240442e@binghamton.edu>

I'm using quantreg package version 5.98 of 24 May 2024, in R 4.4.1 on
Linux Mint.

The online documentation for quantreg says, in part, under the
description of the rq.object, "The coefficients, residuals, and effects
may be extracted by the generic functions of the same name, rather than
by the $ operator."

I create an rq object for the 0.9 quantile, called qm.9

effects(qm.9)

yields, the error message, " effects(qm.9)
Error in UseMethod("effects") :
  no applicable method for 'effects' applied to an object of class "rq"

I'm confused. Appreciate any suggestions. Thanks.

--Chris Ryan


From r@oknz @end|ng |rom gm@||@com  Fri Sep  6 06:44:01 2024
From: r@oknz @end|ng |rom gm@||@com (Richard O'Keefe)
Date: Fri, 6 Sep 2024 16:44:01 +1200
Subject: [R] BUG: atan(1i) / 5 = NaN+Infi ?
In-Reply-To: <CAGxFJbQGcyzHa=Km+z_+iy=m9RaUCrsPOfXmHKWMPcXh9bbeHA@mail.gmail.com>
References: <DBAP192MB0956E56C96996102FA20D5E8849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
 <f3a0740d-386a-44e4-8415-7259c1e8827f@gmail.com>
 <CAGxFJbQGcyzHa=Km+z_+iy=m9RaUCrsPOfXmHKWMPcXh9bbeHA@mail.gmail.com>
Message-ID: <CABcYAd+QTEB0ryJFT34N_sQDEaP=ycXQdfhFQzuO1KP56P8bdA@mail.gmail.com>

I expect that atan(1i) = (0 + infinity i) and that atan(1i)/5 = (0 +
infinity i)/5 = (0 + infinity i).
Here's what I get in C:
(0,1) = (0, 1)
atan((0,1)) = (0, inf)
atan((0,1))/5 = (0, inf)

Note the difference between I*infinity = (0,1)*infinity =
(0*infinity,1*infinity) = (NaN,infinity)
and (0,infinity)/5 = (0/5,infinity/5) = (0,infinity).
The former involves multiplying 0 by infinity, which yields NaN.
The latter does not.

> complex(1,0,Inf)*2
[1] NaN+Infi
There is no good reason for this. 0*2 is 0, not NaN.

In IEEE arithmetic, multiplying or dividing a complex number by a real number is
NOT the same as multiplying or dividing by the complex version of that
real number.
(0,Inf) * 2 = (0*2, Inf*2) = (0, Inf).
(0,Inf) * (2,0) = (0*2 - Inf*0, 0*0 + Inf*2) = (NaN, Inf).

There really truly is a bug here, and it is treating R*Z, Z*R, and Z/R
as if they were
the same as W*Z, Z*W, and Z/W where W = complex(1,R,0).

On Fri, 6 Sept 2024 at 10:12, Bert Gunter <bgunter.4567 at gmail.com> wrote:
>
> Perhaps
>
> > Inf*1i
> [1] NaN+Infi
>
> clarifies why it is *not* a bug.
> (Boy, did that jog some long dusty math memories :-)  )
>
> -- Bert
>
> On Thu, Sep 5, 2024 at 2:48?PM Duncan Murdoch <murdoch.duncan at gmail.com>
> wrote:
>
> > On 2024-09-05 4:23 p.m., Leo Mada via R-help wrote:
> > > Dear R Users,
> > >
> > > Is this desired behaviour?
> > > I presume it's a bug.
> > >
> > > atan(1i)
> > > # 0+Infi
> > >
> > > tan(atan(1i))
> > > # 0+1i
> > >
> > > atan(1i) / 5
> > > # NaN+Infi
> >
> > There's no need to involve atan() and tan() in this:
> >
> >  > (0+Inf*1i)/5
> > [1] NaN+Infi
> >
> > Why do you think this is a bug?
> >
> > Duncan Murdoch
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide
> > https://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.
> >
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide https://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From r@oknz @end|ng |rom gm@||@com  Fri Sep  6 07:24:07 2024
From: r@oknz @end|ng |rom gm@||@com (Richard O'Keefe)
Date: Fri, 6 Sep 2024 17:24:07 +1200
Subject: [R] BUG: atan(1i) / 5 = NaN+Infi ?
In-Reply-To: <B013294E-6859-41ED-B0E4-D6E1E6512B3E@dcn.davis.ca.us>
References: <DBAP192MB0956E56C96996102FA20D5E8849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
 <f3a0740d-386a-44e4-8415-7259c1e8827f@gmail.com>
 <CAGxFJbQGcyzHa=Km+z_+iy=m9RaUCrsPOfXmHKWMPcXh9bbeHA@mail.gmail.com>
 <DBAP192MB09561B0A36D4EE0719704DFF849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
 <CAGxFJbRmhS0Uuzwa75A=9bwj1+fv50Q1T78V-kbezKwcEFoDvQ@mail.gmail.com>
 <B013294E-6859-41ED-B0E4-D6E1E6512B3E@dcn.davis.ca.us>
Message-ID: <CABcYAdLZaO+9HTTAQg0PTGjgDzdSc42LV+fJv8nNMy_WOrb4+A@mail.gmail.com>

The thing is that real*complex, complex*real, and complex/real are not
"complex arithmetic"
in the requisite sense.  The complex numbers are a vector space over
the reals, and
complex*real and real*complex are vector*scalar and scalar*vector.
For example, in the Ada programming language, we have
function "*" (Left, Right : Complex) return Complex;
function "*" (Left : Complex;   Right : Real'Base) return Complex;
function "*" (Left : Real'Base; Right : Complex)   return Complex;
showing that Z*R and Z*W involve *different* functions.

It's worth noting that complex*real and real*complex just require two
real multiplications,
no other arithmetic operations, while complex*complex requires four
real multiplications,
an addition, and a subtraction.  So implementing complex*real by
conventing the real
to complex is inefficient (as well as getting the finer points of IEEE
arithmetic wrong).
As for comple division, getting that *right* in floating-point is
fiendishly difficult (there are
lots of algorithms out there and the majority of them have serious
flaws) and woefully costly.
It's not unfair to characterise implementing complex/real by
conversion to complex and
doing complex/complex as a beginner's bungle.

There are good reasons why "double", "_Imaginary double", and "_Complex double"
are distinct types in standard C (as they are in Ada), and the
definition of multiplication
in G.5.1 para 2 is *direct* (not via complex*complex).

Now R has its own way of doing things, and if the judgement of the R
maintainers is
that keeping the "convert to a common type and then operate" model is
more important
than getting good answers, well, it's THEIR language, not mine.  But
let's not pretend
that the answers are *right* in any other sense.

On Fri, 6 Sept 2024 at 11:07, Jeff Newmiller via R-help
<r-help at r-project.org> wrote:
>
> atan(1i) -> 0 + Inf i
> complex(1/5) -> 0.2 + 0i
> atan(1i) -> (0 + Inf i) * (0.2 + 0i)
> -> 0*0.2 + 0*0i + Inf i * 0.2 + Inf i * 0i
> infinity times zero is undefined
> -> 0 + 0i + Inf i + NaN * i^2
> -> 0 + 0i + Inf i - NaN
> -> NaN + Inf i
>
> I am not sure how complex arithmetic could arrive at another answer.
>
> I advise against messing with infinities... use atan2() if you don't actually need complex arithmetic.
>
> On September 5, 2024 3:38:33 PM PDT, Bert Gunter <bgunter.4567 at gmail.com> wrote:
> >> complex(real = 0, imaginary = Inf)
> >[1] 0+Infi
> >
> >> Inf*1i
> >[1] NaN+Infi
> >
> >>> complex(real = 0, imaginary = Inf)/5
> >[1] NaN+Infi
> >
> >See the Note in ?complex for the explanation, I think.  Duncan can correct
> >if I'm wrong.
> >
> >-- Bert
> >
> >On Thu, Sep 5, 2024 at 3:20?PM Leo Mada <leo.mada at syonic.eu> wrote:
> >
> >> Dear Bert,
> >>
> >> These behave like real divisions/multiplications:
> >> complex(re=Inf, im = Inf) * 5
> >> # Inf+Infi
> >> complex(re=-Inf, im = Inf) * 5
> >> # -Inf+Infi
> >>
> >> The real division / multiplication should be faster and also is well
> >> behaved. I was expecting R to do the real division/multiplication on a
> >> complex number. Which R actually does for these very particular cases; but
> >> not when only Im(x) is Inf.
> >>
> >> Sincerely,
> >>
> >> Leonard
> >>
> >> ------------------------------
> >> *From:* Bert Gunter <bgunter.4567 at gmail.com>
> >> *Sent:* Friday, September 6, 2024 1:12 AM
> >> *To:* Duncan Murdoch <murdoch.duncan at gmail.com>
> >> *Cc:* Leo Mada <leo.mada at syonic.eu>; r-help at r-project.org <
> >> r-help at r-project.org>
> >> *Subject:* Re: [R] BUG: atan(1i) / 5 = NaN+Infi ?
> >>
> >> Perhaps
> >>
> >> > Inf*1i
> >> [1] NaN+Infi
> >>
> >> clarifies why it is *not* a bug.
> >> (Boy, did that jog some long dusty math memories :-)  )
> >>
> >> -- Bert
> >>
> >> On Thu, Sep 5, 2024 at 2:48?PM Duncan Murdoch <murdoch.duncan at gmail.com>
> >> wrote:
> >>
> >> On 2024-09-05 4:23 p.m., Leo Mada via R-help wrote:
> >> > Dear R Users,
> >> >
> >> > Is this desired behaviour?
> >> > I presume it's a bug.
> >> >
> >> > atan(1i)
> >> > # 0+Infi
> >> >
> >> > tan(atan(1i))
> >> > # 0+1i
> >> >
> >> > atan(1i) / 5
> >> > # NaN+Infi
> >>
> >> There's no need to involve atan() and tan() in this:
> >>
> >>  > (0+Inf*1i)/5
> >> [1] NaN+Infi
> >>
> >> Why do you think this is a bug?
> >>
> >> Duncan Murdoch
> >>
> >> ______________________________________________
> >> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> >> https://stat.ethz.ch/mailman/listinfo/r-help
> >> PLEASE do read the posting guide
> >> https://www.R-project.org/posting-guide.html
> >> and provide commented, minimal, self-contained, reproducible code.
> >>
> >>
> >
> >       [[alternative HTML version deleted]]
> >
> >______________________________________________
> >R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> >https://stat.ethz.ch/mailman/listinfo/r-help
> >PLEASE do read the posting guide https://www.R-project.org/posting-guide.html
> >and provide commented, minimal, self-contained, reproducible code.
>
> --
> Sent from my phone. Please excuse my brevity.
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide https://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From |eo@m@d@ @end|ng |rom @yon|c@eu  Fri Sep  6 00:12:43 2024
From: |eo@m@d@ @end|ng |rom @yon|c@eu (Leo Mada)
Date: Thu, 5 Sep 2024 22:12:43 +0000
Subject: [R] BUG: atan(1i) / 5 = NaN+Infi ?
In-Reply-To: <f3a0740d-386a-44e4-8415-7259c1e8827f@gmail.com>
References: <DBAP192MB0956E56C96996102FA20D5E8849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
 <f3a0740d-386a-44e4-8415-7259c1e8827f@gmail.com>
Message-ID: <DBAP192MB0956C07B3C3DE087A227C12C849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>

Dear Duncan,

Here is also the missing information:
R version 4.4.1 (2024-06-14 ucrt)
Platform: x86_64-w64-mingw32/x64
Running under: Windows 10 x64 (build 19045)

Regarding the results:
atan(1i)
# 0+Infi
Re(atan(1i))
# 0
Im(atan(1i))
#  Inf

0 + Inf i is a valid complex number:
tan(atan(1i))
# 0+1i

Inf / 5
# Inf

Note: atan(1i) / 5 should have generated 0 + Inf * 1i; even the explicit complex number fails:
complex(re=0, im = Inf) / 5
# NaN+Infi
complex(re=Inf, im = Inf) / 5
# Inf+Infi

I presume that R tries to do the complex division, although the real division is well defined.

Sincerely,

Leonard

________________________________
From: Duncan Murdoch <murdoch.duncan at gmail.com>
Sent: Friday, September 6, 2024 12:40 AM
To: Leo Mada <leo.mada at syonic.eu>; r-help at r-project.org <r-help at r-project.org>
Subject: Re: [R] BUG: atan(1i) / 5 = NaN+Infi ?

On 2024-09-05 4:23 p.m., Leo Mada via R-help wrote:
> Dear R Users,
>
> Is this desired behaviour?
> I presume it's a bug.
>
> atan(1i)
> # 0+Infi
>
> tan(atan(1i))
> # 0+1i
>
> atan(1i) / 5
> # NaN+Infi

There's no need to involve atan() and tan() in this:

 > (0+Inf*1i)/5
[1] NaN+Infi

Why do you think this is a bug?

Duncan Murdoch


-------------- next part --------------
A non-text attachment was scrubbed...
Name: =?iso-8859-7?Q?5-(2019)-CEBP=E2-LIP_induces_cancer-type_metabolic_reprogr?= =?iso-8859-7?Q?amming_by_regulating_the_let-7LIN28B_circuit_in_mice.pdf?=
Type: application/pdf
Size: 2136921 bytes
Desc: =?iso-8859-7?Q?5-(2019)-CEBP=E2-LIP_induces_cancer-type_metabolic_reprogr?= =?iso-8859-7?Q?amming_by_regulating_the_let-7LIN28B_circuit_in_mice.pdf?=
URL: <https://stat.ethz.ch/pipermail/r-help/attachments/20240905/85b49427/attachment-0001.pdf>

From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Fri Sep  6 10:04:11 2024
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Fri, 6 Sep 2024 10:04:11 +0200
Subject: [R] effects() extractor for a quantile reqression object: error
 message
In-Reply-To: <ff1b1a84-d571-7e4c-d7d6-195cd240442e@binghamton.edu>
References: <ff1b1a84-d571-7e4c-d7d6-195cd240442e@binghamton.edu>
Message-ID: <26330.46971.450132.890513@stat.math.ethz.ch>

>>>>> Christopher W Ryan via R-help 
>>>>>     on Thu, 5 Sep 2024 22:50:24 -0400 writes:

    > I'm using quantreg package version 5.98 of 24 May 2024, in R 4.4.1 on
    > Linux Mint.

    > The online documentation for quantreg says, in part, under the
    > description of the rq.object, "The coefficients, residuals, and effects
    > may be extracted by the generic functions of the same name, rather than
    > by the $ operator."

    > I create an rq object for the 0.9 quantile, called qm.9

    > effects(qm.9)

    > yields, the error message, " effects(qm.9)
    > Error in UseMethod("effects") :
    > no applicable method for 'effects' applied to an object of class "rq"

    > I'm confused. Appreciate any suggestions. Thanks.

    > --Chris Ryan

Unfortunately, the documentation is wrong, here.

You can always use

     methods(class = class(qm.9))

to get list of generic function names for there is a method for
your object (of class "rq") in this case...
and indeed, "effects" is not among them.

Possibly this was a thinko (on the 'rq.object' help page) and
it was "predict" that was meant there,
as indeed there is a predict method (actually there are even 3
different predict() methods in package 'quantreg', and they are
well documented on the  ?predict.qr  help page.

{OTOH my guess is that there originally *was* an effects method
 and it has been dropped in the mean time}


Martin Maechler

ETH Zurich  and  R Core team


From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Fri Sep  6 10:37:36 2024
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Fri, 6 Sep 2024 10:37:36 +0200
Subject: [R] BUG: atan(1i) / 5 = NaN+Infi ?
In-Reply-To: <CABcYAdLZaO+9HTTAQg0PTGjgDzdSc42LV+fJv8nNMy_WOrb4+A@mail.gmail.com>
References: <DBAP192MB0956E56C96996102FA20D5E8849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
 <f3a0740d-386a-44e4-8415-7259c1e8827f@gmail.com>
 <CAGxFJbQGcyzHa=Km+z_+iy=m9RaUCrsPOfXmHKWMPcXh9bbeHA@mail.gmail.com>
 <DBAP192MB09561B0A36D4EE0719704DFF849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
 <CAGxFJbRmhS0Uuzwa75A=9bwj1+fv50Q1T78V-kbezKwcEFoDvQ@mail.gmail.com>
 <B013294E-6859-41ED-B0E4-D6E1E6512B3E@dcn.davis.ca.us>
 <CABcYAdLZaO+9HTTAQg0PTGjgDzdSc42LV+fJv8nNMy_WOrb4+A@mail.gmail.com>
Message-ID: <26330.48976.240526.972936@stat.math.ethz.ch>

>>>>> Richard O'Keefe 
>>>>>     on Fri, 6 Sep 2024 17:24:07 +1200 writes:

    > The thing is that real*complex, complex*real, and complex/real are not
    > "complex arithmetic" in the requisite sense.

    > The complex numbers are a vector space over  the reals,

Yes, but they _also_ are field (and as others have argued mathematically only
have one infinity point),
and I think here we are fighting with which definition should
take precedence here.
The English Wikipedia page is even more extensive and precise,
 https://en.wikipedia.org/wiki/Complex_number   (line breaking by me):

 " The complex numbers form a rich structure that is simultaneously
  - an algebraically closed field, 
  - a commutative algebra over the reals,   and 
  - a Euclidean vector space of dimension two."

our problem "of course" is that we additionally add  +/- Inf for
the reals and for storage etc treating them as a 2D vector space
over the reals is "obvious".

    > and complex*real and real*complex are vector*scalar and scalar*vector.
    > For example, in the Ada programming language, we have
    > function "*" (Left, Right : Complex) return Complex;
    > function "*" (Left : Complex;   Right : Real'Base) return Complex;
    > function "*" (Left : Real'Base; Right : Complex)   return Complex;
    > showing that Z*R and Z*W involve *different* functions.

    > It's worth noting that complex*real and real*complex just require two
    > real multiplications,
    > no other arithmetic operations, while complex*complex requires four
    > real multiplications,
    > an addition, and a subtraction.  So implementing complex*real by
    > conventing the real
    > to complex is inefficient (as well as getting the finer points of IEEE
    > arithmetic wrong).

I see your point.

    > As for complex division, getting that *right* in floating-point is
    > fiendishly difficult (there are
    > lots of algorithms out there and the majority of them have serious flaws)
    > and woefully costly.

    > It's not unfair to characterise implementing complex/real
    > by conversion to complex and doing complex/complex as a
    > beginner's bungle.

ouch!  ... but still I tend to acknowledge your point, incl the "not unfair" ..

    > There are good reasons why "double", "_Imaginary double", and "_Complex double"
    > are distinct types in standard C (as they are in Ada), 

interesting.  OTOH, I think standard C did not have strict
standards about complex number storage etc in the mid 1990s
when R was created.

    > and the definition of multiplication
    > in G.5.1 para 2 is *direct* (not via complex*complex).

I see (did not know about) -- where can we find  'G.5.1 para 2'

    > Now R has its own way of doing things, and if the judgement of the R
    > maintainers is
    > that keeping the "convert to a common type and then operate" model is
    > more important
    > than getting good answers, well, it's THEIR language, not mine.

Well, it should also be the R community's language,
where we, the R core team, do most of the "base" work and also
emphasize guaranteeing long term stability.

Personally, I think that
   "convert to a common type and then operate"
is a good rule and principle in many, even most places and cases,
but I hate it if humans should not be allowed to break good
rules for even better reasons  (but should rather behave like algorithms  ..).

This may well be a very good example of re-considering.
As mentioned above, e.g., I was not aware of the C language standard
being so specific here and different than what we've been doing
in R.


    > But let's not pretend
    > that the answers are *right* in any other sense.

I think that's too strong -- Jeff's computation (just here below)
is showing one well defined sense of "right" I'd say.
(Still I know and agree the    Inf * 0 |--> NaN
 rule *is* sometimes undesirable)

    > On Fri, 6 Sept 2024 at 11:07, Jeff Newmiller via R-help
    > <r-help at r-project.org> wrote:
    >> 
    >> atan(1i) -> 0 + Inf i
    >> complex(1/5) -> 0.2 + 0i
    >> atan(1i) -> (0 + Inf i) * (0.2 + 0i)
    -> 0*0.2 + 0*0i + Inf i * 0.2 + Inf i * 0i
    >> infinity times zero is undefined
    -> 0 + 0i + Inf i + NaN * i^2
    -> 0 + 0i + Inf i - NaN
    -> NaN + Inf i
    >> 
    >> I am not sure how complex arithmetic could arrive at another answer.
    >> 
    >> I advise against messing with infinities... use atan2() if you don't actually need complex arithmetic.
    >> 
    >> On September 5, 2024 3:38:33 PM PDT, Bert Gunter <bgunter.4567 at gmail.com> wrote:
    >> >> complex(real = 0, imaginary = Inf)
    >> >[1] 0+Infi
    >> >
    >> >> Inf*1i
    >> >[1] NaN+Infi
    >> >
    >> >>> complex(real = 0, imaginary = Inf)/5
    >> >[1] NaN+Infi
    >> >
    >> >See the Note in ?complex for the explanation, I think.  Duncan can correct
    >> >if I'm wrong.
    >> >
    >> >-- Bert

 [...................]

Martin

--
Martin Maechler
ETH Zurich  and   R Core team


From rkoenker @end|ng |rom ||||no|@@edu  Fri Sep  6 10:37:54 2024
From: rkoenker @end|ng |rom ||||no|@@edu (Koenker, Roger W)
Date: Fri, 6 Sep 2024 08:37:54 +0000
Subject: [R] Fwd: effects() extractor for a quantile reqression object:
 error message
References: <FB2308EE-B26C-49D4-A468-1802A4DD4655@illinois.edu>
Message-ID: <ECCF1BD8-B3E8-4981-A0A0-BD522337159D@illinois.edu>

Apologies,  forgot to copy R-help on this response.

Begin forwarded message:


From: Roger Koenker <rkoenker at illinois.edu>
Subject: Re: [R] effects() extractor for a quantile reqression object: error message
Date: September 6, 2024 at 8:38:47?AM GMT+1
To: "Christopher W. Ryan" <cryan at binghamton.edu>

Chris,

This was intended to emulate the effects component of lm() fitting, but was never implemented.  Frankly, I don?t quite see on first glance how this works for lm() ? it seems to be (mostly) about situations where X is not full rank (see lm.fit) and I also never bothered to implement rq for X that were not full rank.

Roger


On Sep 6, 2024, at 3:50?AM, Christopher W. Ryan via R-help <r-help at r-project.org> wrote:

I'm using quantreg package version 5.98 of 24 May 2024, in R 4.4.1 on
Linux Mint.

The online documentation for quantreg says, in part, under the
description of the rq.object, "The coefficients, residuals, and effects
may be extracted by the generic functions of the same name, rather than
by the $ operator."

I create an rq object for the 0.9 quantile, called qm.9

effects(qm.9)

yields, the error message, " effects(qm.9)
Error in UseMethod("effects") :
no applicable method for 'effects' applied to an object of class "rq"

I'm confused. Appreciate any suggestions. Thanks.

--Chris Ryan

______________________________________________
R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-help__;!!DZ3fjg!8EOq_-vshoZYLg-FZREULmFkpvaXrZ6aw5ABLzjX4aq3XNvoDxGipcY73SPgiBQasfWdncPj7J2odYZKU3BD$
PLEASE do read the posting guide https://urldefense.com/v3/__https://www.R-project.org/posting-guide.html__;!!DZ3fjg!8EOq_-vshoZYLg-FZREULmFkpvaXrZ6aw5ABLzjX4aq3XNvoDxGipcY73SPgiBQasfWdncPj7J2odY7Gv6_Z$
and provide commented, minimal, self-contained, reproducible code.



	[[alternative HTML version deleted]]


From pd@|gd @end|ng |rom gm@||@com  Fri Sep  6 10:46:36 2024
From: pd@|gd @end|ng |rom gm@||@com (peter dalgaard)
Date: Fri, 6 Sep 2024 10:46:36 +0200
Subject: [R] Calculation of VCV matrix of estimated coefficient
In-Reply-To: <CAP01uRnywJTLerMkPEm4MsNRF4GLUVcKXyBjOpHAw8ED8HYjKw@mail.gmail.com>
References: <CADZb7hocD=zCsmWTw3DaG7P_qgnSww5aRFsPpeL5fkAj48Tzug@mail.gmail.com>
 <CADZb7hpfAc-RPyQHAoYcz8rYEt--37BrDSWmBHuv5SnWhcAEKQ@mail.gmail.com>
 <CAP01uRnywJTLerMkPEm4MsNRF4GLUVcKXyBjOpHAw8ED8HYjKw@mail.gmail.com>
Message-ID: <D0E4E2BC-27B2-4476-8E14-A03866771C51@gmail.com>



> On 5 Sep 2024, at 16:36 , Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> 
> sigma(model)^2 will give the correct MSE.  Also note that your model
> matrix has intercept at
> the end whereas vcov will have it at the beginning so you will need to
> permute the rows
> and columns to get them to be the same/


Also, 

X <- cbind(1, as.matrix(mtcars[, c('disp', 'hp')]))

or even

X <- model.matrix(~ disp + hp, mtcars)

-pd


> 
> On Wed, Sep 4, 2024 at 3:34?PM Daniel Lobo <danielobo9976 at gmail.com> wrote:
>> 
>> Hi,
>> 
>> I am trying to replicate the R's result for VCV matrix of estimated
>> coefficients from linear model as below
>> 
>> data(mtcars)
>> model <- lm(mpg~disp+hp, data=mtcars)
>> model_summ <-summary(model)
>> MSE = mean(model_summ$residuals^2)
>> vcov(model)
>> 
>> Now I want to calculate the same thing manually,
>> 
>> library(dplyr)
>> X = as.matrix(mtcars[, c('disp', 'hp')] %>% mutate(Intercept = 1));
>> solve(t(X) %*% X) * MSE
>> 
>> Unfortunately they do not match.
>> 
>> Could you please help where I made mistake, if any.
>> 
>> Thanks
>> 
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide https://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
> 
> 
> 
> -- 
> Statistics & Software Consulting
> GKX Group, GKX Associates Inc.
> tel: 1-877-GKX-GROUP
> email: ggrothendieck at gmail.com
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide https://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Office: A 4.23
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From murdoch@dunc@n @end|ng |rom gm@||@com  Fri Sep  6 11:54:23 2024
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Fri, 6 Sep 2024 05:54:23 -0400
Subject: [R] BUG: atan(1i) / 5 = NaN+Infi ?
In-Reply-To: <CABcYAd+QTEB0ryJFT34N_sQDEaP=ycXQdfhFQzuO1KP56P8bdA@mail.gmail.com>
References: <DBAP192MB0956E56C96996102FA20D5E8849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
 <f3a0740d-386a-44e4-8415-7259c1e8827f@gmail.com>
 <CAGxFJbQGcyzHa=Km+z_+iy=m9RaUCrsPOfXmHKWMPcXh9bbeHA@mail.gmail.com>
 <CABcYAd+QTEB0ryJFT34N_sQDEaP=ycXQdfhFQzuO1KP56P8bdA@mail.gmail.com>
Message-ID: <8975c0de-df0a-4f39-b298-662f7debbac3@gmail.com>

On 2024-09-06 12:44 a.m., Richard O'Keefe wrote:
> I expect that atan(1i) = (0 + infinity i) and that atan(1i)/5 = (0 +
> infinity i)/5 = (0 + infinity i).
> Here's what I get in C:
> (0,1) = (0, 1)
> atan((0,1)) = (0, inf)
> atan((0,1))/5 = (0, inf)
> 
> Note the difference between I*infinity = (0,1)*infinity =
> (0*infinity,1*infinity) = (NaN,infinity)
> and (0,infinity)/5 = (0/5,infinity/5) = (0,infinity).
> The former involves multiplying 0 by infinity, which yields NaN.
> The latter does not.
> 
>> complex(1,0,Inf)*2
> [1] NaN+Infi
> There is no good reason for this. 0*2 is 0, not NaN.
> 
> In IEEE arithmetic, multiplying or dividing a complex number by a real number is
> NOT the same as multiplying or dividing by the complex version of that
> real number.
> (0,Inf) * 2 = (0*2, Inf*2) = (0, Inf).
> (0,Inf) * (2,0) = (0*2 - Inf*0, 0*0 + Inf*2) = (NaN, Inf).
> 
> There really truly is a bug here, and it is treating R*Z, Z*R, and Z/R
> as if they were
> the same as W*Z, Z*W, and Z/W where W = complex(1,R,0).

I would only disagree with the statement above by distinguishing between 
a "bug" (where R is not behaving as documented) and a "design flaw" 
(where it is behaving as documented, but the behaviour is undesirable).

I think this is a design flaw rather than a bug.

The distinction is important:  if it is a design flaw, then a change is 
harder, because users who rely on the behaviour deserve more help in 
adapting than those who rely on a bug.  Bugs should be fixed.  Design 
flaws need thinking about, and sometimes shouldn't be fixed.

On the other hand, I was unable to find documentation saying that the 
current behaviour is intended, so I could be wrong.

Duncan Murdoch

> 
> On Fri, 6 Sept 2024 at 10:12, Bert Gunter <bgunter.4567 at gmail.com> wrote:
>>
>> Perhaps
>>
>>> Inf*1i
>> [1] NaN+Infi
>>
>> clarifies why it is *not* a bug.
>> (Boy, did that jog some long dusty math memories :-)  )
>>
>> -- Bert
>>
>> On Thu, Sep 5, 2024 at 2:48?PM Duncan Murdoch <murdoch.duncan at gmail.com>
>> wrote:
>>
>>> On 2024-09-05 4:23 p.m., Leo Mada via R-help wrote:
>>>> Dear R Users,
>>>>
>>>> Is this desired behaviour?
>>>> I presume it's a bug.
>>>>
>>>> atan(1i)
>>>> # 0+Infi
>>>>
>>>> tan(atan(1i))
>>>> # 0+1i
>>>>
>>>> atan(1i) / 5
>>>> # NaN+Infi
>>>
>>> There's no need to involve atan() and tan() in this:
>>>
>>>   > (0+Inf*1i)/5
>>> [1] NaN+Infi
>>>
>>> Why do you think this is a bug?
>>>
>>> Duncan Murdoch
>>>
>>> ______________________________________________
>>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>> PLEASE do read the posting guide
>>> https://www.R-project.org/posting-guide.html
>>> and provide commented, minimal, self-contained, reproducible code.
>>>
>>
>>          [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide https://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.


From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Fri Sep  6 13:10:13 2024
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Fri, 6 Sep 2024 13:10:13 +0200
Subject: [R] BUG: atan(1i) / 5 = NaN+Infi ?
In-Reply-To: <8975c0de-df0a-4f39-b298-662f7debbac3@gmail.com>
References: <DBAP192MB0956E56C96996102FA20D5E8849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
 <f3a0740d-386a-44e4-8415-7259c1e8827f@gmail.com>
 <CAGxFJbQGcyzHa=Km+z_+iy=m9RaUCrsPOfXmHKWMPcXh9bbeHA@mail.gmail.com>
 <CABcYAd+QTEB0ryJFT34N_sQDEaP=ycXQdfhFQzuO1KP56P8bdA@mail.gmail.com>
 <8975c0de-df0a-4f39-b298-662f7debbac3@gmail.com>
Message-ID: <26330.58133.15925.293052@stat.math.ethz.ch>

>>>>> Duncan Murdoch 
>>>>>     on Fri, 6 Sep 2024 05:54:23 -0400 writes:

    > On 2024-09-06 12:44 a.m., Richard O'Keefe wrote:
    >> I expect that atan(1i) = (0 + infinity i) and that atan(1i)/5 = (0 +
    >> infinity i)/5 = (0 + infinity i).
    >> Here's what I get in C:
    >> (0,1) = (0, 1)
    >> atan((0,1)) = (0, inf)
    >> atan((0,1))/5 = (0, inf)
    >> 
    >> Note the difference between I*infinity = (0,1)*infinity =
    >> (0*infinity,1*infinity) = (NaN,infinity)
    >> and (0,infinity)/5 = (0/5,infinity/5) = (0,infinity).
    >> The former involves multiplying 0 by infinity, which yields NaN.
    >> The latter does not.
    >> 
    >>> complex(1,0,Inf)*2
    >> [1] NaN+Infi
    >> There is no good reason for this. 0*2 is 0, not NaN.
    >> 
    >> In IEEE arithmetic, multiplying or dividing a complex number by a real number is
    >> NOT the same as multiplying or dividing by the complex version of that
    >> real number.
    >> (0,Inf) *  2    = (0*2, Inf*2)               = (0, Inf).
    >> (0,Inf) * (2,0) = (0*2 - Inf*0, 0*0 + Inf*2) = (NaN, Inf).
    >> 
    >> There really truly is a bug here, and it is treating R*Z, Z*R, and Z/R
    >> as if they were
    >> the same as W*Z, Z*W, and Z/W where W = complex(1,R,0).

    > I would only disagree with the statement above by distinguishing between 
    > a "bug" (where R is not behaving as documented) and a "design flaw" 
    > (where it is behaving as documented, but the behaviour is undesirable).

    > I think this is a design flaw rather than a bug.

    > The distinction is important:  if it is a design flaw, then a change is 
    > harder, because users who rely on the behaviour deserve more help in 
    > adapting than those who rely on a bug.  Bugs should be fixed.  Design 
    > flaws need thinking about, and sometimes shouldn't be fixed.

    > On the other hand, I was unable to find documentation saying that the 
    > current behaviour is intended, so I could be wrong.

    > Duncan Murdoch

I agree 100% (with Duncan).

I've now also carefully read  ?Arithmetic  and  ?complex
and could not find docu explicitly documenting the current
behavior, in the context of complex arithmetic not even
mentioning the "overall principle" used very often in R to

	1. coerce to common type
	2. then compute with that "pure type"

In ?complex, we have the (last sentence of the first) 'Note:'

 --->  For ?+? and ?-?, R's own handling works strictly ?coordinate wise?.

now, implicitly that implies that {+, -} are the only
ops/functions where coordinate-wise arithmetic is used/applied
and hence could it be _stretched_ to say that for
 * and /  coordinate wise does not always apply,
in our case not even when it would make sense, i.e., when one of
the two operands is real (in the '/' case, it must be the 2nd operand)
and hence 2d-vector space arithmetic  <scalar  *  vector>
should be applied naturally.

It is still true that this must be considered a design flaw
rather than a bug, even if only because the above  "overall
principle"  is predominant and tought very often when teaching R.

In this case, I do think we should look into the consequences of
indeed distinguishing
  <double> * <complex> 
  <complex> * <double>  and
  <complex> / <double>
from their respective current {1. coerce to complex, 2. use complex arith}
arithmetic.

Hence, thanks a lot for bringing this up, to Leo Mada and
notably to Richard O'Keefe  for providing context, notably wrt
to C standards  {which I'd want to follow mostly, but not
always ... but I'm not opening that now}...

Martin


From g@@@powe|| @end|ng |rom protonm@||@com  Fri Sep  6 16:12:53 2024
From: g@@@powe|| @end|ng |rom protonm@||@com (Gregg Powell)
Date: Fri, 06 Sep 2024 14:12:53 +0000
Subject: [R] Fwd: effects() extractor for a quantile reqression object:
 error message
In-Reply-To: <ECCF1BD8-B3E8-4981-A0A0-BD522337159D@illinois.edu>
References: <FB2308EE-B26C-49D4-A468-1802A4DD4655@illinois.edu>
 <ECCF1BD8-B3E8-4981-A0A0-BD522337159D@illinois.edu>
Message-ID: <NNXrX1YsEp2Vz-Id6jV0Kd7bhuqKWJlJUHZRq6bIEJG9b3ofXbkshxH1X8C_NUUstSNxzXTMgctpafBEtZuqpdhjxfwUB2v96QYxeNegNUY=@protonmail.com>

Need to kill some time, so thought I'd Opine.

Given the intent, as I understood it... to extract components from a quantile regression (rq) object similar to how one might extract effects from an lm object.
 
Since it seems effects() is not implemented for rq, here are some alternative approaches to achieve similar functionality or extract useful information from the quantile regression model:

1. Extracting Coefficients. Use the coef() function to extract the coefficients of the quantile regression model. This is similar to extracting the effects in a linear model.

> coef(qm.9)

This will return the estimated coefficients for the 0.9 quantile.

2. Extracting Fitted Values. To get the fitted values from the quantile regression model, use: 

> fitted(qm.9)

This gives the fitted values for the quantile regression model, similar to what you'd see in an lm() model.

3. Extracting ResidualsResiduals from the quantile regression can be extracted using the resid() function: 

> resid(qm.9)

This gives the residuals for the 0.9 quantile regression model, which can be a useful diagnostic for checking model fit.

4. Manually Calculating "Effects".    While effects() is not available, you can manually calculate effects by examining the design matrix and the coefficients. If the term "effects" refers to the influence of different covariates in the model, these can be assessed by looking at the coefficients themselves and their impact on the fitted values.

5. Using the summary() Function.        The summary() function for rq objects provides detailed information about the quantile regression fit, including coefficient estimates, standard errors, and statistical significance:

> summary(qm.9)

This can give a more comprehensive understanding of how covariates are contributing to the model. 

6. Working with Design Matrices.            If you need the design matrix for further custom calculations, you can extract it using: 

> model.matrix(qm.9)                 

 This returns the matrix of predictor variables, which you can then use to manually compute the "effects" of changes in the predictors.

7. Explore Partial Effects with predict(). The predict() function can help you assess how changes in predictor values affect the outcome. For instance, to predict values at specific points in the design space, you can use: 

> predict(qm.9, newdata = data.frame(your_new_data))

8. Bootstrapping to Examine Variability. If you want to assess variability in the effects of predictors, you could use bootstrapping. The boot.rq() function in the quantreg package allows you to bootstrap the quantile regression coefficients, giving insight into the variability of the estimated "effects."

Example:

> boot_results <- boot.rq(y ~ X, tau = 0.9, data = your_data, R = 1000)

> summary(boot_results)

9.Interaction or Additive Effects (If Applicable). If you're trying to capture interaction or additive effects, you might need to specify interaction terms directly in your formula and then inspect the coefficients for these terms. Quantile regression will estimate these coefficients in the same manner as linear regression but specific to the quantile of interest.

In conclusion, while effects() is not available for quantile regression, the combination of coef(), fitted(), resid(), model.matrix(), and summary() provides the main components of a quantile regression model that should provide similar insights to what effects() provides for linear models.

Forgive any typos please... I'm on a mobile device.

Kind regards,
Gregg Powell


Sent from Proton Mail Android


-------- Original Message --------
On 06/09/2024 01:37, Koenker, Roger W <rkoenker at illinois.edu> wrote:

>  Apologies,  forgot to copy R-help on this response.
>  
>  Begin forwarded message:
>  
>  
>  From: Roger Koenker <rkoenker at illinois.edu>
>  Subject: Re: [R] effects() extractor for a quantile reqression object: error message
>  Date: September 6, 2024 at 8:38:47?AM GMT+1
>  To: "Christopher W. Ryan" <cryan at binghamton.edu>
>  
>  Chris,
>  
>  This was intended to emulate the effects component of lm() fitting, but was never implemented.  Frankly, I don?t quite see on first glance how this works for lm() ? it seems to be (mostly) about situations where X is not full rank (see lm.fit) and I also never bothered to implement rq for X that were not full rank.
>  
>  Roger
>  
>  
>  On Sep 6, 2024, at 3:50?AM, Christopher W. Ryan via R-help <r-help at r-project.org> wrote:
>  
>  I'm using quantreg package version 5.98 of 24 May 2024, in R 4.4.1 on
>  Linux Mint.
>  
>  The online documentation for quantreg says, in part, under the
>  description of the rq.object, "The coefficients, residuals, and effects
>  may be extracted by the generic functions of the same name, rather than
>  by the $ operator."
>  
>  I create an rq object for the 0.9 quantile, called qm.9
>  
>  effects(qm.9)
>  
>  yields, the error message, " effects(qm.9)
>  Error in UseMethod("effects") :
>  no applicable method for 'effects' applied to an object of class "rq"
>  
>  I'm confused. Appreciate any suggestions. Thanks.
>  
>  --Chris Ryan
>  
>  ______________________________________________
>  R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>  https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-help__;!!DZ3fjg!8EOq_-vshoZYLg-FZREULmFkpvaXrZ6aw5ABLzjX4aq3XNvoDxGipcY73SPgiBQasfWdncPj7J2odYZKU3BD$
>  PLEASE do read the posting guide https://urldefense.com/v3/__https://www.R-project.org/posting-guide.html__;!!DZ3fjg!8EOq_-vshoZYLg-FZREULmFkpvaXrZ6aw5ABLzjX4aq3XNvoDxGipcY73SPgiBQasfWdncPj7J2odY7Gv6_Z$
>  and provide commented, minimal, self-contained, reproducible code.
>  
>  
>  
>  	[[alternative HTML version deleted]]
>  
>  ______________________________________________
>  R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>  https://stat.ethz.ch/mailman/listinfo/r-help
>  PLEASE do read the posting guide https://www.R-project.org/posting-guide.html
>  and provide commented, minimal, self-contained, reproducible code.
>  
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 509 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-help/attachments/20240906/881ff7fd/attachment.sig>

From r@oknz @end|ng |rom gm@||@com  Fri Sep  6 16:40:29 2024
From: r@oknz @end|ng |rom gm@||@com (Richard O'Keefe)
Date: Sat, 7 Sep 2024 02:40:29 +1200
Subject: [R] BUG: atan(1i) / 5 = NaN+Infi ?
In-Reply-To: <26330.48976.240526.972936@stat.math.ethz.ch>
References: <DBAP192MB0956E56C96996102FA20D5E8849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
 <f3a0740d-386a-44e4-8415-7259c1e8827f@gmail.com>
 <CAGxFJbQGcyzHa=Km+z_+iy=m9RaUCrsPOfXmHKWMPcXh9bbeHA@mail.gmail.com>
 <DBAP192MB09561B0A36D4EE0719704DFF849D2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
 <CAGxFJbRmhS0Uuzwa75A=9bwj1+fv50Q1T78V-kbezKwcEFoDvQ@mail.gmail.com>
 <B013294E-6859-41ED-B0E4-D6E1E6512B3E@dcn.davis.ca.us>
 <CABcYAdLZaO+9HTTAQg0PTGjgDzdSc42LV+fJv8nNMy_WOrb4+A@mail.gmail.com>
 <26330.48976.240526.972936@stat.math.ethz.ch>
Message-ID: <CABcYAd+LZrfVMU9AjU6jQfd_O8pCbbYotNSthpWSJKdLAG4oDA@mail.gmail.com>

G.5.1 para 2 can be found in the C17 standard -- I actually have the
final draft not the published standard.  It's in earlier standards, I
just didn't check earlier standards.  Complex arithmetic was not in
the first C standard (C89) but was in C99.

The complex numbers do indeed form a field, and Z*W invokes an
operation in that field when Z and W are both complex numbers.  Z*R
and R*Z, where R is real-but-not-complex, is not that field operation;
it's the scalar multiplication from the vector spec view.

One way to characterise the C and Ada view is that real numbers x can
be viewed as (x,ZERO!!!) and imaginary numbers y*i can be viewed as
(ZERO!!!, y) where ZERO!!! is a real serious HARD zero, not an IEEE
+epsilon or -epsilon,  In fact this is important for getting "sign of
zero" right.
x + (u,v) = (x+u, v) *NOT* (x+u, v+0) and this does matter in IEEE arithmetic.

R is of course based on S, and S was not only designed before C got
complex numbers, but before there was an IEEE standard with things
like NaN, Inf, and signed zeros  But there *is* an IEEE standard now,
and even IBM mainframes offer IEEE-compliant arithmetic, so worrying
about the sign of zero etc is not something we can really overlook
these days.

You are of course correct that the one-point compactification of the
complex numbers involves adjoining just one infinity and that whacking
IEEE infinities into complex numbers does not give you anything
mathematically interesting (unless you count grief and vexation as
"interesting" (:-)).  Since R distinguishes between 0+Infi and
NaN+Infi, it's not clear that the one-point compactification has any
relevance to what R does.  And it's not just an unexpected NaN; with
all numbers finite you can get zeros with the wrong sign.  (S having
been designed before the sign of zero was something you needed to be
aware of.)

For what it's worth, the ISO "Language Independent Arithmetic"
standard, part 3, defines separate real, imaginary, and complex types,
and defines x*(z,w) to be (x*z, x*w) directly, just like C and Ada.
So it is quite clear that R does not currently conform to LIA-3.
LIA-3 (ISO/IEC 10967-3:2006) is the nearest we have to a definition of
what "right" answers are for floating-point complex arithmetic, and
what R does cannot be called "right" by that definition.  But of
course R doesn't claim conformance to any part of the LIA standard.

Whether the R community *want* R and C to give the same answers is not
for me to say.  I can only say that *I* found it reassuring that C
gave the expected answers when R did not, or, to put it another way,
disconcerting that R did not agree with C (or LIA-3).


What really annoys me is that I wrote an entire technical report on
(some of the) problems with complex arithmetic, and this whole "just
treat x as (x, +0.0)" thing completely failed to occur to me as
something anyone might do.

On Fri, 6 Sept 2024 at 20:37, Martin Maechler
<maechler at stat.math.ethz.ch> wrote:
>
> >>>>> Richard O'Keefe
> >>>>>     on Fri, 6 Sep 2024 17:24:07 +1200 writes:
>
>     > The thing is that real*complex, complex*real, and complex/real are not
>     > "complex arithmetic" in the requisite sense.
>
>     > The complex numbers are a vector space over  the reals,
>
> Yes, but they _also_ are field (and as others have argued mathematically only
> have one infinity point),
> and I think here we are fighting with which definition should
> take precedence here.
> The English Wikipedia page is even more extensive and precise,
>  https://en.wikipedia.org/wiki/Complex_number   (line breaking by me):
>
>  " The complex numbers form a rich structure that is simultaneously
>   - an algebraically closed field,
>   - a commutative algebra over the reals,   and
>   - a Euclidean vector space of dimension two."
>
> our problem "of course" is that we additionally add  +/- Inf for
> the reals and for storage etc treating them as a 2D vector space
> over the reals is "obvious".
>
>     > and complex*real and real*complex are vector*scalar and scalar*vector.
>     > For example, in the Ada programming language, we have
>     > function "*" (Left, Right : Complex) return Complex;
>     > function "*" (Left : Complex;   Right : Real'Base) return Complex;
>     > function "*" (Left : Real'Base; Right : Complex)   return Complex;
>     > showing that Z*R and Z*W involve *different* functions.
>
>     > It's worth noting that complex*real and real*complex just require two
>     > real multiplications,
>     > no other arithmetic operations, while complex*complex requires four
>     > real multiplications,
>     > an addition, and a subtraction.  So implementing complex*real by
>     > conventing the real
>     > to complex is inefficient (as well as getting the finer points of IEEE
>     > arithmetic wrong).
>
> I see your point.
>
>     > As for complex division, getting that *right* in floating-point is
>     > fiendishly difficult (there are
>     > lots of algorithms out there and the majority of them have serious flaws)
>     > and woefully costly.
>
>     > It's not unfair to characterise implementing complex/real
>     > by conversion to complex and doing complex/complex as a
>     > beginner's bungle.
>
> ouch!  ... but still I tend to acknowledge your point, incl the "not unfair" ..
>
>     > There are good reasons why "double", "_Imaginary double", and "_Complex double"
>     > are distinct types in standard C (as they are in Ada),
>
> interesting.  OTOH, I think standard C did not have strict
> standards about complex number storage etc in the mid 1990s
> when R was created.
>
>     > and the definition of multiplication
>     > in G.5.1 para 2 is *direct* (not via complex*complex).
>
> I see (did not know about) -- where can we find  'G.5.1 para 2'
>
>     > Now R has its own way of doing things, and if the judgement of the R
>     > maintainers is
>     > that keeping the "convert to a common type and then operate" model is
>     > more important
>     > than getting good answers, well, it's THEIR language, not mine.
>
> Well, it should also be the R community's language,
> where we, the R core team, do most of the "base" work and also
> emphasize guaranteeing long term stability.
>
> Personally, I think that
>    "convert to a common type and then operate"
> is a good rule and principle in many, even most places and cases,
> but I hate it if humans should not be allowed to break good
> rules for even better reasons  (but should rather behave like algorithms  ..).
>
> This may well be a very good example of re-considering.
> As mentioned above, e.g., I was not aware of the C language standard
> being so specific here and different than what we've been doing
> in R.
>
>
>     > But let's not pretend
>     > that the answers are *right* in any other sense.
>
> I think that's too strong -- Jeff's computation (just here below)
> is showing one well defined sense of "right" I'd say.
> (Still I know and agree the    Inf * 0 |--> NaN
>  rule *is* sometimes undesirable)
>
>     > On Fri, 6 Sept 2024 at 11:07, Jeff Newmiller via R-help
>     > <r-help at r-project.org> wrote:
>     >>
>     >> atan(1i) -> 0 + Inf i
>     >> complex(1/5) -> 0.2 + 0i
>     >> atan(1i) -> (0 + Inf i) * (0.2 + 0i)
>     -> 0*0.2 + 0*0i + Inf i * 0.2 + Inf i * 0i
>     >> infinity times zero is undefined
>     -> 0 + 0i + Inf i + NaN * i^2
>     -> 0 + 0i + Inf i - NaN
>     -> NaN + Inf i
>     >>
>     >> I am not sure how complex arithmetic could arrive at another answer.
>     >>
>     >> I advise against messing with infinities... use atan2() if you don't actually need complex arithmetic.
>     >>
>     >> On September 5, 2024 3:38:33 PM PDT, Bert Gunter <bgunter.4567 at gmail.com> wrote:
>     >> >> complex(real = 0, imaginary = Inf)
>     >> >[1] 0+Infi
>     >> >
>     >> >> Inf*1i
>     >> >[1] NaN+Infi
>     >> >
>     >> >>> complex(real = 0, imaginary = Inf)/5
>     >> >[1] NaN+Infi
>     >> >
>     >> >See the Note in ?complex for the explanation, I think.  Duncan can correct
>     >> >if I'm wrong.
>     >> >
>     >> >-- Bert
>
>  [...................]
>
> Martin
>
> --
> Martin Maechler
> ETH Zurich  and   R Core team


From JH@rm@e @end|ng |rom roku@com  Fri Sep  6 18:57:35 2024
From: JH@rm@e @end|ng |rom roku@com (Jorgen Harmse)
Date: Fri, 6 Sep 2024 16:57:35 +0000
Subject: [R] BUG: atan(1i) / 5 = NaN+Infi ?
In-Reply-To: <mailman.371911.7678.1725607380.1268.r-help@r-project.org>
References: <mailman.371911.7678.1725607380.1268.r-help@r-project.org>
Message-ID: <BL0PR01MB4434094155C2FD480814D4A0DC9E2@BL0PR01MB4434.prod.exchangelabs.com>

It seems to me that the documentation of R's complex class & R's atan function do not tell us what to expect, so (as others have suggested), some additional notes are needed. I think that mathematically atan(1i) should be NA_complex_, but R seems not to use any mathematically standard compactification of the complex plane (and I'm not sure that IEEE does either).

Incidentally, the signature of the complex constructor is confusing. complex(1L) returns zero, but complex(1L, argument=theta) is an element of the unit circle. The defaults suggest ambiguous results in case only length.out is specified, and you have to read a parenthesis in the details to figure out what will happen. Even then, the behaviour in my example is not spelled out (although it is suggested by negative inference). Moreover, the real & imaginary parts are ignored if either modulus or argument is provided, and I don't see that this is explained at all.

R's numeric (& IEEE's floating-point types) seem to approximate a multi-point compactification of the real line. +Inf & -Inf fill out the approximation to the extended real line, and NaN, NA_real_ & maybe some others handle some cases in which the answer does not live in the extended real line. (I'm not digging into bit patterns here. I suspect that there are several versions of NaN, but I hope that they all behave the same way.) The documentation suggests that a complex scalar in R is just a pair of numeric scalars, so we are not dealing with the Riemann sphere or any other usually-studied extension of the complex plane. Since R distinguishes various complex infinities (and seems to allow any combination of numeric values in real & imaginary parts), the usual mathematical answer for atan(1i) may no longer be relevant.

The tangent function has an essential singularity at complex infinity (the compactification point in the Riemann sphere, which I consider the natural extension for the study of meromorphic functions, for example making the tangent function well defined on the whole plane), so the usual extension of the plane does not give us an answer for atan(1i). However, another possible extension is the Cartesian square of the extended real line, and in that extension continuity suggests that tan(x + Inf*1i) = 1i and tan(x - Inf*1i) = -1i (for x real & finite). That is the result from R's tan function, and it explains why atan(1i) in R is not NA or NaN. The specific choice of pi/4 + Inf*1i puzzled me at first, but I think it's related to the branch-cut rules given in the documentation. The real part of atan((1+.Machine$double.eps)*1i) is pi/2, and the real part of atan((1-.Machine$double.eps)*1i) is zero, and someone apparently decided to average those for atan(1i).

TL;DR: The documentation needs more details, and I don't really like the extended complex plane that R implemented, but within that framework the answers for atan(1i) & atan(-1i) make sense.

Regards,
Jorgen Harmse.





	[[alternative HTML version deleted]]


