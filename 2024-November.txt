From |kry|ov @end|ng |rom d|@root@org  Fri Nov  1 22:29:45 2024
From: |kry|ov @end|ng |rom d|@root@org (Ivan Krylov)
Date: Sat, 2 Nov 2024 00:29:45 +0300
Subject: [R] 
 Invalid term in model formula with gmm after formula.tools is loaded
In-Reply-To: <CALcKxsq+6FKxX_JFA9RDoc1JWfiuCNSqKopQ3j=ex=Z+hdN8Tg@mail.gmail.com>
References: <CALcKxsq+6FKxX_JFA9RDoc1JWfiuCNSqKopQ3j=ex=Z+hdN8Tg@mail.gmail.com>
Message-ID: <20241102002945.64b6c79a@Tarkus>

Hi Aristide and welcome to R-help!

Your message was a bit mangled [*]. It's best to compose messages to
this mailing list in plain text. Otherwise (when composed in HTML), the
mailing list eats the HTML part and we're left with the plain text part
automatically generated by your mailer, which isn't always readable.

? Wed, 30 Oct 2024 17:45:29 +0100
Elys?e Aristide <ariel92and at gmail.com> ?????:

> I am using the gmm function from the gmm package and encountered an
> unexpected error. No model can be estimated if I load formula.tools?I
> need to restart R each time.

I can reproduce the problem:

library(gmm)
data(Finance)
r <- Finance[1:300, 1:10]                                              
rm <- Finance[1:300, "rm"]                             
rf <- Finance[1:300, "rf"]
z <- as.matrix(r-rf) 
zm <- rm-rf
res <- gmm(z ~ zm, x = ~ zm)
library(formula.tools)
gmm(z ~ zm, x = ~ zm) # signals an error

Looking at the traceback(), I see the formula being transformed into NA
~ NA at some point:

10: terms.formula(formula, data = data) # <-- error happens here
9: terms(formula, data = data)
8: model.frame.default(data = object$data, formula = NA ~ NA, drop.unused.levels = TRUE, 
       na.action = "na.pass")
7: model.frame(data = object$data, formula = NA ~ NA, drop.unused.levels = TRUE, 
       na.action = "na.pass") # <-- formula is already NA ~ NA here
6: eval(mfh, parent.frame())
5: eval(mfh, parent.frame())
4: getDat(object$g, object$x, data = object$data)
3: getModel.baseGmm(all_args, ...)
2: getModel(all_args, ...)
1: gmm(z ~ zm, x = ~zm)

It seems that in base R, as.character(z ~ zm) returns a three-element
character vector, while with formula.tools loaded, it only returns a
single string, 'z ~ zm'. This breaks formula manipulation in getDat().

An immediate workaround is to replace the method provided by
formula.tools with one that immediately delegates back to R:

.S3method('as.character', 'formula', function (x, ...) NextMethod())
gmm(z ~ zm, x = ~ zm) # seems to work once again

(Is there a way to truly unregister an S3 method?)

Perhaps gmm::getDat could be made more robust by working directly on
the formula/call object instead of going through the string
representation.

-- 
Best regards,
Ivan

[*] https://stat.ethz.ch/pipermail/r-help/2024-October/480157.html


From @|by||e@@toeck|| @end|ng |rom gmx@ch  Sat Nov  2 09:23:14 2024
From: @|by||e@@toeck|| @end|ng |rom gmx@ch (=?utf-8?Q?Sibylle_St=C3=B6ckli?=)
Date: Sat, 2 Nov 2024 09:23:14 +0100
Subject: [R] foreSIGHT package
Message-ID: <0050F99A-A468-43BD-A9CD-B36AF05BD623@gmx.ch>

Dear community

I have started to use the foreSIGHT package fo calculate some climatic indicators.

Example
library(foreSIGHT)
func_avgDSD(WAAR$Ta, attArgs)

Dataset (WAAR, Ta = average daily temperature)
Year DOY Ta
1990 1 -2.45
1990 2 1.54
.
.
2001 1 4.54
,
2001 205 15.65
2001 206 20.14
.
2001 365 8.65
..
2023 1 0.45


Questions:
Is it possible to run the foreSIGHT with DOY numbers not dates (e.g. 1983-04-09 23.64) and additionally separate years? 
 
I have some problems to understand attArgs. Up to now I have not found any reference. How do I need to prepare the list? And where I can set the threshold?
 
Sometimes there are indicators without any definition of the threshold? E.g. cold seasons length: func_CSL (data) how is a cold day defined here (the threshold for cold days), there is no attArgs?

Many thanks 
Sibylle



	[[alternative HTML version deleted]]


From @r|e|92@nd @end|ng |rom gm@||@com  Sun Nov  3 12:53:52 2024
From: @r|e|92@nd @end|ng |rom gm@||@com (=?UTF-8?Q?Elys=C3=A9e_Aristide?=)
Date: Sun, 3 Nov 2024 12:53:52 +0100
Subject: [R] 
 Invalid term in model formula with gmm after formula.tools is loaded
In-Reply-To: <20241102002945.64b6c79a@Tarkus>
References: <CALcKxsq+6FKxX_JFA9RDoc1JWfiuCNSqKopQ3j=ex=Z+hdN8Tg@mail.gmail.com>
 <20241102002945.64b6c79a@Tarkus>
Message-ID: <CALcKxso-+3Fc22nL9Nfy9Zv3TQVjstXbU1bPHiPQK13ZvJR=wQ@mail.gmail.com>

Hi Ivan,

Thank you for your message. Does that mean that I should send a new
message? Or is it okay for this time?

Best,
Aristide

On Fri, Nov 1, 2024, 22:29 Ivan Krylov <ikrylov at disroot.org> wrote:

> Hi Aristide and welcome to R-help!
>
> Your message was a bit mangled [*]. It's best to compose messages to
> this mailing list in plain text. Otherwise (when composed in HTML), the
> mailing list eats the HTML part and we're left with the plain text part
> automatically generated by your mailer, which isn't always readable.
>
> ? Wed, 30 Oct 2024 17:45:29 +0100
> Elys?e Aristide <ariel92and at gmail.com> ?????:
>
> > I am using the gmm function from the gmm package and encountered an
> > unexpected error. No model can be estimated if I load formula.tools?I
> > need to restart R each time.
>
> I can reproduce the problem:
>
> library(gmm)
> data(Finance)
> r <- Finance[1:300, 1:10]
> rm <- Finance[1:300, "rm"]
> rf <- Finance[1:300, "rf"]
> z <- as.matrix(r-rf)
> zm <- rm-rf
> res <- gmm(z ~ zm, x = ~ zm)
> library(formula.tools)
> gmm(z ~ zm, x = ~ zm) # signals an error
>
> Looking at the traceback(), I see the formula being transformed into NA
> ~ NA at some point:
>
> 10: terms.formula(formula, data = data) # <-- error happens here
> 9: terms(formula, data = data)
> 8: model.frame.default(data = object$data, formula = NA ~ NA,
> drop.unused.levels = TRUE,
>        na.action = "na.pass")
> 7: model.frame(data = object$data, formula = NA ~ NA, drop.unused.levels =
> TRUE,
>        na.action = "na.pass") # <-- formula is already NA ~ NA here
> 6: eval(mfh, parent.frame())
> 5: eval(mfh, parent.frame())
> 4: getDat(object$g, object$x, data = object$data)
> 3: getModel.baseGmm(all_args, ...)
> 2: getModel(all_args, ...)
> 1: gmm(z ~ zm, x = ~zm)
>
> It seems that in base R, as.character(z ~ zm) returns a three-element
> character vector, while with formula.tools loaded, it only returns a
> single string, 'z ~ zm'. This breaks formula manipulation in getDat().
>
> An immediate workaround is to replace the method provided by
> formula.tools with one that immediately delegates back to R:
>
> .S3method('as.character', 'formula', function (x, ...) NextMethod())
> gmm(z ~ zm, x = ~ zm) # seems to work once again
>
> (Is there a way to truly unregister an S3 method?)
>
> Perhaps gmm::getDat could be made more robust by working directly on
> the formula/call object instead of going through the string
> representation.
>
> --
> Best regards,
> Ivan
>
> [*] https://stat.ethz.ch/pipermail/r-help/2024-October/480157.html
>

	[[alternative HTML version deleted]]


From |kry|ov @end|ng |rom d|@root@org  Mon Nov  4 11:37:33 2024
From: |kry|ov @end|ng |rom d|@root@org (Ivan Krylov)
Date: Mon, 4 Nov 2024 13:37:33 +0300
Subject: [R] 
 Invalid term in model formula with gmm after formula.tools is loaded
In-Reply-To: <CALcKxso-+3Fc22nL9Nfy9Zv3TQVjstXbU1bPHiPQK13ZvJR=wQ@mail.gmail.com>
References: <CALcKxsq+6FKxX_JFA9RDoc1JWfiuCNSqKopQ3j=ex=Z+hdN8Tg@mail.gmail.com>
 <20241102002945.64b6c79a@Tarkus>
 <CALcKxso-+3Fc22nL9Nfy9Zv3TQVjstXbU1bPHiPQK13ZvJR=wQ@mail.gmail.com>
Message-ID: <20241104133733.6f3f7506@Tarkus>

? Sun, 3 Nov 2024 12:53:52 +0100
Elys?e Aristide <ariel92and at gmail.com> ?????:

> Does that mean that I should send a new message? Or is it okay for
> this time?

No need to post it again. Did it help to replace the as.character()
method for formulas provided by 'formula.tools'? I see the problem is
already reported to the 'formula.tools' maintainer [*], so there isn't
much else to do about it.

-- 
Best regards,
Ivan

[*] https://github.com/decisionpatterns/formula.tools/issues/11


From @r|e|92@nd @end|ng |rom gm@||@com  Mon Nov  4 13:37:24 2024
From: @r|e|92@nd @end|ng |rom gm@||@com (=?UTF-8?Q?Elys=C3=A9e_Aristide?=)
Date: Mon, 4 Nov 2024 13:37:24 +0100
Subject: [R] 
 Invalid term in model formula with gmm after formula.tools is loaded
In-Reply-To: <20241104133733.6f3f7506@Tarkus>
References: <CALcKxsq+6FKxX_JFA9RDoc1JWfiuCNSqKopQ3j=ex=Z+hdN8Tg@mail.gmail.com>
 <20241102002945.64b6c79a@Tarkus>
 <CALcKxso-+3Fc22nL9Nfy9Zv3TQVjstXbU1bPHiPQK13ZvJR=wQ@mail.gmail.com>
 <20241104133733.6f3f7506@Tarkus>
Message-ID: <CALcKxspZLE7ymTQXYT4F_bG5dNx=FZaMKoLKYB31dvtWFfBtdw@mail.gmail.com>

Hi Ivan,

I tried that solution, but unfortunately, it did not help.
The issue is about the formula of the instruments when converting into
data. I finally converted this formula to a matrix by myself and gave the
matrix to gmm directly. So, gmm does not need to convert tit.

Best regards,

Aristide




On Mon, Nov 4, 2024 at 11:37?AM Ivan Krylov <ikrylov at disroot.org> wrote:

> ? Sun, 3 Nov 2024 12:53:52 +0100
> Elys?e Aristide <ariel92and at gmail.com> ?????:
>
> > Does that mean that I should send a new message? Or is it okay for
> > this time?
>
> No need to post it again. Did it help to replace the as.character()
> method for formulas provided by 'formula.tools'? I see the problem is
> already reported to the 'formula.tools' maintainer [*], so there isn't
> much else to do about it.
>
> --
> Best regards,
> Ivan
>
> [*] https://github.com/decisionpatterns/formula.tools/issues/11
>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Nov  4 18:06:36 2024
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 4 Nov 2024 12:06:36 -0500
Subject: [R] 
 Invalid term in model formula with gmm after formula.tools is loaded
In-Reply-To: <20241104133733.6f3f7506@Tarkus>
References: <CALcKxsq+6FKxX_JFA9RDoc1JWfiuCNSqKopQ3j=ex=Z+hdN8Tg@mail.gmail.com>
 <20241102002945.64b6c79a@Tarkus>
 <CALcKxso-+3Fc22nL9Nfy9Zv3TQVjstXbU1bPHiPQK13ZvJR=wQ@mail.gmail.com>
 <20241104133733.6f3f7506@Tarkus>
Message-ID: <a47638c1-2872-47e1-b0ab-d8e4c6475eba@gmail.com>

On 2024-11-04 5:37 a.m., Ivan Krylov via R-help wrote:
> ? Sun, 3 Nov 2024 12:53:52 +0100
> Elys?e Aristide <ariel92and at gmail.com> ?????:
> 
>> Does that mean that I should send a new message? Or is it okay for
>> this time?
> 
> No need to post it again. Did it help to replace the as.character()
> method for formulas provided by 'formula.tools'? I see the problem is
> already reported to the 'formula.tools' maintainer [*], so there isn't
> much else to do about it.
> 

One thing Aristide or someone else could do is to fix the bug in 
formula.tools, and submit a PR.  Five years ago the author said he 
didn't have time to fix the bug.  Apparently nobody else has had time 
either.

Another choice is to recognize that there isn't much interest in 
supporting that package from the author or any of its users, and abandon it.

Duncan Murdoch


From n@re@h_gurbux@n| @end|ng |rom hotm@||@com  Tue Nov  5 13:26:07 2024
From: n@re@h_gurbux@n| @end|ng |rom hotm@||@com (Naresh Gurbuxani)
Date: Tue, 5 Nov 2024 12:26:07 +0000
Subject: [R] lattice subscripts with both condition and group
Message-ID: <IA1P223MB049910B784B00782216C74E2FA522@IA1P223MB0499.NAMP223.PROD.OUTLOOK.COM>

How can I use subscripts to draw the last graph with one call to ? ? ? ? ? ? ? ? ? ? ? ??
function xyplot()? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
Thanks, ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
Naresh ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
library(data.table) ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
library(lattice) ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
library(latticeExtra) ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
mydt2024 <- data.table( ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
? ? date = rep(as.Date(c("2024-11-01", "2024-11-04")), c(8, 8)), ? ? ? ? ? ? ? ? ? ? ? ??
? ? day_forward = rep(1:8, 2), ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
? ? news_clicks = c(10, 12, 13, 18, 20, 21, 15, 11, 21, 23, 25, 18, 14, 12, ? ? ? ? ? ? ?
? ? ? ? ? ? ? ? ? ? 12, 10), ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
? ? days_to_election = rep(c(4, 1), c(8, 8)), ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
? ? electyear = "Election 2024") ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
## Works when only condition is present ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
mydt2024[ ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
? , xyplot(news_clicks ~ day_forward | date, type = c("l", "g"), ? ? ? ? ? ? ? ? ? ? ? ??
? ? ? ? ? ?panel = function(x, y, ..., subscripts) { ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
? ? ? ? ? ? ? ?panel.xyplot(x, y, ...) ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
? ? ? ? ? ? ? ?panel.abline(v = days_to_election[subscripts][1], lty = 2) ? ? ? ? ? ? ? ?
? ? ? ? ? ?}) ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
] ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
mydt2020 <- data.table( ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
? ? date = rep(as.Date(c("2020-10-30", "2020-11-02")), c(8, 8)), ? ? ? ? ? ? ? ? ? ? ? ??
? ? day_forward = rep(1:8, 2), ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
? ? news_clicks = c(9, 11, 12, 17, 21, 20, 14, 8, 20, 24, 28, 15, 12, 10, ? ? ? ? ? ? ? ?
? ? ? ? ? ? ? ? ? ? 8, 6), ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
? ? days_to_election = rep(c(4, 1), c(8, 8)), ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
? ? electyear = "Election 2020" ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
) ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
mydt <- rbind(mydt2020, mydt2024) ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
mydt[, `:=`(electlabel = paste(days_to_election, "Days Before"))] ? ? ? ? ? ? ? ? ? ? ? ?
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
## This does not work with both condition and group ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
mydt[ ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
? , xyplot(news_clicks ~ day_forward | electlabel, groups = electyear, ? ? ? ? ? ? ? ? ??
? ? ? ? ? ?type = c("o", "g"), auto.key = list(columns = 2, space = "bottom"), ? ? ? ? ??
? ? ? ? ? ?panel = function(x, y, ..., subscripts) { ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
? ? ? ? ? ? ? ?panel.xyplot(x, y, ...) ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
? ? ? ? ? ? ? ?panel.abline(v = days_to_election[subscripts][1], lty = 2) ? ? ? ? ? ? ? ?
? ? ? ? ? ?}) ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
] ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
## This works ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
electplot <- mydt[ ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
? , xyplot(news_clicks ~ day_forward | electlabel, groups = electyear, ? ? ? ? ? ? ? ? ??
? ? ? ? ? ?type = c("o", "g"), auto.key = list(columns = 2, space = "bottom")) ? ? ? ? ??
] ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
vlineplot <- mydt[ ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
? , xyplot(news_clicks ~ day_forward | electlabel, ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
? ? ? ? ? ?panel = function(x, y, ..., subscripts) { ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
? ? ? ? ? ? ? ?panel.abline(v = days_to_election[subscripts][1], lty = 2) ? ? ? ? ? ? ? ?
? ? ? ? ? ?}) ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
] ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
electplot + vlineplot ??

From @|by||e@@toeck|| @end|ng |rom gmx@ch  Wed Nov  6 07:29:27 2024
From: @|by||e@@toeck|| @end|ng |rom gmx@ch (=?utf-8?Q?Sibylle_St=C3=B6ckli?=)
Date: Wed, 6 Nov 2024 07:29:27 +0100
Subject: [R] Using multiple dat files
References: <B8E50D3E-29D2-4E6D-B90A-A08259C803BD@unige.ch>
Message-ID: <6E7A7742-21DC-4E9E-8AA3-059ECA813E43@gmx.ch>

Dear community

To import multiple .dat  weather files I am using list.files().
I intend to use the R package ?ClimInd? to calculate different agroclimatic indicators. 

Question: Is there another solution to import multiple .dat files so that I can select elements from the list, e.g. one specific weather file (example AAR_DailyWeather)?
 
 
# Import multiple .dat files weather data
filelist <- list.files(path = "O:/Data-Work/??./Daten_RA-MeteoCH_1990-2021", pattern='*.dat', all.files= T, full.names= T)
W <- lapply(filelist, function(x) read.table(x, header = TRUE, sep = "", colClasses = "numeric", comment.char = ""))
W[[1]]
 
> dd(data = W[[1]]$Precip, time.scale = W[[1]]$year)
Fehler in W[[1]]$year : $ operator is invalid for atomic vectors
 
Kind regards
Sibylle
 
 
 

From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Wed Nov  6 18:17:58 2024
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Wed, 6 Nov 2024 17:17:58 +0000
Subject: [R] Using multiple dat files
In-Reply-To: <6E7A7742-21DC-4E9E-8AA3-059ECA813E43@gmx.ch>
References: <B8E50D3E-29D2-4E6D-B90A-A08259C803BD@unige.ch>
 <6E7A7742-21DC-4E9E-8AA3-059ECA813E43@gmx.ch>
Message-ID: <65aef957-7552-4789-8864-2502e59d7ed9@sapo.pt>

?s 06:29 de 06/11/2024, Sibylle St?ckli via R-help escreveu:
> Dear community
> 
> To import multiple .dat  weather files I am using list.files().
> I intend to use the R package ?ClimInd? to calculate different agroclimatic indicators.
> 
> Question: Is there another solution to import multiple .dat files so that I can select elements from the list, e.g. one specific weather file (example AAR_DailyWeather)?
>   
>   
> # Import multiple .dat files weather data
> filelist <- list.files(path = "O:/Data-Work/??./Daten_RA-MeteoCH_1990-2021", pattern='*.dat', all.files= T, full.names= T)
> W <- lapply(filelist, function(x) read.table(x, header = TRUE, sep = "", colClasses = "numeric", comment.char = ""))
> W[[1]]
>   
>> dd(data = W[[1]]$Precip, time.scale = W[[1]]$year)
> Fehler in W[[1]]$year : $ operator is invalid for atomic vectors
>   
> Kind regards
> Sibylle
>   
>   
>   
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide https://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
Hello,

I find it strange that the error is complaining about the 2nd argument, 
W[[1]]$year. It seems that column W[[1]]$Precip exists but not year.

What does

str(W[[1]])

return? A data.frame?

And why sep = "" when reading the files, aren't those files csv files?

Hope this helps,

Rui Barradas


-- 
Este e-mail foi analisado pelo software antiv?rus AVG para verificar a presen?a de v?rus.
www.avg.com


From bgunter@4567 @end|ng |rom gm@||@com  Wed Nov  6 18:28:29 2024
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Wed, 6 Nov 2024 09:28:29 -0800
Subject: [R] Using multiple dat files
In-Reply-To: <6E7A7742-21DC-4E9E-8AA3-059ECA813E43@gmx.ch>
References: <B8E50D3E-29D2-4E6D-B90A-A08259C803BD@unige.ch>
 <6E7A7742-21DC-4E9E-8AA3-059ECA813E43@gmx.ch>
Message-ID: <CAGxFJbTHiqLXgo-L7zBLZFy61Dt-GEHgbnOWfyUaVborYykRfQ@mail.gmail.com>

Not quite sure if I understand you.

list.files() simply returns a character vector(not a list). You can simply
use a vector index to select whatever file you wish to read. So if your
desired filename is the 5th element of filelist above, something like

myfile <- read.table(filename[5], ...)

You can also use regular expressions to choose a bunch of files that have
some common signature to their names that you can read in simultaneously
using your "filelist" vector of names via something like:

myfiles <- lapply(grep("weath", filelist, value = TRUE), \(x)
read.table(x,...))
### Note that the result of lapply *is* a list, so use list indexing for
extraction from myfiles.


You can also choose files to read interactively (via a GUI interface) using
file.choose() instead of using list.files() if you prefer to do it that way.

Cheers,
Bert

On Wed, Nov 6, 2024 at 8:25?AM Sibylle St?ckli via R-help <
r-help at r-project.org> wrote:

> Dear community
>
> To import multiple .dat  weather files I am using list.files().
> I intend to use the R package ?ClimInd? to calculate different
> agroclimatic indicators.
>
> Question: Is there another solution to import multiple .dat files so that
> I can select elements from the list, e.g. one specific weather file
> (example AAR_DailyWeather)?
>
>
> # Import multiple .dat files weather data
> filelist <- list.files(path =
> "O:/Data-Work/??./Daten_RA-MeteoCH_1990-2021", pattern='*.dat', all.files=
> T, full.names= T)
> W <- lapply(filelist, function(x) read.table(x, header = TRUE, sep = "",
> colClasses = "numeric", comment.char = ""))
> W[[1]]
>
> > dd(data = W[[1]]$Precip, time.scale = W[[1]]$year)
> Fehler in W[[1]]$year : $ operator is invalid for atomic vectors
>
> Kind regards
> Sibylle
>
>
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> https://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From bgunter@4567 @end|ng |rom gm@||@com  Wed Nov  6 21:46:27 2024
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Wed, 6 Nov 2024 12:46:27 -0800
Subject: [R] Using multiple dat files
In-Reply-To: <trinity-e67b69c2-afc2-4b13-a41c-4906c0a5e2c2-1730919598265@trinity-msg-rest-gmx-gmx-live-c75c5fb4b-m9vrp>
References: <B8E50D3E-29D2-4E6D-B90A-A08259C803BD@unige.ch>
 <6E7A7742-21DC-4E9E-8AA3-059ECA813E43@gmx.ch>
 <CAGxFJbTHiqLXgo-L7zBLZFy61Dt-GEHgbnOWfyUaVborYykRfQ@mail.gmail.com>
 <trinity-e67b69c2-afc2-4b13-a41c-4906c0a5e2c2-1730919598265@trinity-msg-rest-gmx-gmx-live-c75c5fb4b-m9vrp>
Message-ID: <CAGxFJbSQkRirQcJKQWRdcShE6_5ebgBqvn2Aefm5MoC_gNea1w@mail.gmail.com>

"It seems therefore that there is no other way than read in individually >
100 weather tables using read.tables., right? Using file.choose() doesn't
change the work."

Yes. With that many files, file.choose() does not make sense. However, I
still do not understand what is the problem with using lapply() on the
character vector of file names with read.table() as you did in your
original post to read in all the files as components of the W list. As data
frames are also lists, you can extract individual columns as you did before
using  the $ extractor, i.e. W[[1]]$year, etc.. You can also use data frame
indices for the columns, i.e. W[[1]][ ,1] or W[[1]][ ,"year"] . All of
which I believe you know.

However, I will hazard a *guess* (so exercise due diligence and check) as
to the cause of your original error,

"dd(data = W[[1]]$Precip, time.scale = W[[1]]$year)
Fehler in W[[1]]$year : $ operator is invalid for atomic vectors'

even though I know **nothing** about the dd() function. My guess is:
"data" is usually an argument to a function that tells it to use
"nonstandard evaluation" to look for arguments and other names in the
function first in the "data" argument, rather than by following R's
"standard" evaluation by looking first through the function's closures.
**If** this guess is correct, the call you gave above should be something
like:

dd(data = W[[1]], time.scale = year, precip = Precip,...)

where precip (small "p") is a formal argument of the dd() function and
Precip is a column in the data frame W[[1]].  If this is wrong, my
apologies, and feel free to ignore without responding.

Best,
Bert

On Wed, Nov 6, 2024 at 10:59?AM Sibylle St?ckli <sibylle.stoeckli at gmx.ch>
wrote:

> Dear Rui
> Dear Bert
>
> Many thanks
>
> Solution
> filelist <- list.files(path =
> "O:/Data-Work/2.../Daten_RA-MeteoCH_1990-2021", pattern='*.dat', all.files=
> T, full.names= T)
> AAR<-read.table(filelist[1])
>
> It seems therefore that there is no other way than read in individually >
> 100 weather tables using read.tables., right? Using file.choose() doesn't
> change the work.
>
> Yes my .dat files are data.frames
>
> > str(W[[1]])'data.frame':	11688 obs. of  7 variables:
>  $ year  : num  1990 1990 1990 1990 1990 1990 1990 1990 1990 1990 ...
>  $ DOY   : num  1 2 3 4 5 6 7 8 9 10 ...
>  $ Ta    : num  -2.67 -2.77 -2.23 -2.21 -0.98 0.82 0.49 -1.02 -2.31 -3.36 ...
>  $ Tmin  : num  -3.5 -3.7 -4.26 -2.87 -2.98 0.3 -0.83 -1.27 -3 -3.82 ...
>  $ Tmax  : num  -1.13 -0.15 -0.13 -0.45 1 1.87 1.72 -0.35 -0.85 -2.3 ...
>  $ Precip: num  0 0 0 0 0.45 1.81 0.03 0 0 0 ...
>  $ rSSD  : num  0 0.08 0 0 0.08 0 0 0 0 0 ...
>
>
> *Gesendet: *Mittwoch, 6. November 2024 um 18:28
> *Von: *"Bert Gunter" <bgunter.4567 at gmail.com>
> *An: *"Sibylle St?ckli" <sibylle.stoeckli at gmx.ch>
> *CC: *r-help at r-project.org
> *Betreff: *Re: [R] Using multiple dat files
> Not quite sure if I understand you.
>
> list.files() simply returns a character vector(not a list). You can simply
> use a vector index to select whatever file you wish to read. So if your
> desired filename is the 5th element of filelist above, something like
>
> myfile <- read.table(filename[5], ...)
>
> You can also use regular expressions to choose a bunch of files that have
> some common signature to their names that you can read in simultaneously
> using your "filelist" vector of names via something like:
>
> myfiles <- lapply(grep("weath", filelist, value = TRUE), \(x)
> read.table(x,...))
> ### Note that the result of lapply *is* a list, so use list indexing for
> extraction from myfiles.
>
>
> You can also choose files to read interactively (via a GUI interface)
> using file.choose() instead of using list.files() if you prefer to do it
> that way.
>
> Cheers,
> Bert
>
> On Wed, Nov 6, 2024 at 8:25?AM Sibylle St?ckli via R-help <
> r-help at r-project.org> wrote:
>
>> Dear community
>>
>> To import multiple .dat  weather files I am using list.files().
>> I intend to use the R package ?ClimInd? to calculate different
>> agroclimatic indicators.
>>
>> Question: Is there another solution to import multiple .dat files so that
>> I can select elements from the list, e.g. one specific weather file
>> (example AAR_DailyWeather)?
>>
>>
>> # Import multiple .dat files weather data
>> filelist <- list.files(path =
>> "O:/Data-Work/??./Daten_RA-MeteoCH_1990-2021", pattern='*.dat', all.files=
>> T, full.names= T)
>> W <- lapply(filelist, function(x) read.table(x, header = TRUE, sep = "",
>> colClasses = "numeric", comment.char = ""))
>> W[[1]]
>>
>> > dd(data = W[[1]]$Precip, time.scale = W[[1]]$year)
>> Fehler in W[[1]]$year : $ operator is invalid for atomic vectors
>>
>> Kind regards
>> Sibylle
>>
>>
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide
>> https://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
>
>

	[[alternative HTML version deleted]]


From bgunter@4567 @end|ng |rom gm@||@com  Wed Nov  6 21:52:54 2024
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Wed, 6 Nov 2024 12:52:54 -0800
Subject: [R] Using multiple dat files
In-Reply-To: <CAGxFJbSQkRirQcJKQWRdcShE6_5ebgBqvn2Aefm5MoC_gNea1w@mail.gmail.com>
References: <B8E50D3E-29D2-4E6D-B90A-A08259C803BD@unige.ch>
 <6E7A7742-21DC-4E9E-8AA3-059ECA813E43@gmx.ch>
 <CAGxFJbTHiqLXgo-L7zBLZFy61Dt-GEHgbnOWfyUaVborYykRfQ@mail.gmail.com>
 <trinity-e67b69c2-afc2-4b13-a41c-4906c0a5e2c2-1730919598265@trinity-msg-rest-gmx-gmx-live-c75c5fb4b-m9vrp>
 <CAGxFJbSQkRirQcJKQWRdcShE6_5ebgBqvn2Aefm5MoC_gNea1w@mail.gmail.com>
Message-ID: <CAGxFJbQ5qGAikqTMm9X86Jbw5zwgG5PaxOe8QbGzrDG67==Ftg@mail.gmail.com>

Sorry, wrong language.
"through the function's closures" in my email should be:
through the function's chain of environments. (A function in R *is* a
closure).

-- Bert



On Wed, Nov 6, 2024 at 12:46?PM Bert Gunter <bgunter.4567 at gmail.com> wrote:

> "It seems therefore that there is no other way than read in individually
> > 100 weather tables using read.tables., right? Using file.choose() doesn't
> change the work."
>
> Yes. With that many files, file.choose() does not make sense. However, I
> still do not understand what is the problem with using lapply() on the
> character vector of file names with read.table() as you did in your
> original post to read in all the files as components of the W list. As data
> frames are also lists, you can extract individual columns as you did before
> using  the $ extractor, i.e. W[[1]]$year, etc.. You can also use data frame
> indices for the columns, i.e. W[[1]][ ,1] or W[[1]][ ,"year"] . All of
> which I believe you know.
>
> However, I will hazard a *guess* (so exercise due diligence and check) as
> to the cause of your original error,
>
> "dd(data = W[[1]]$Precip, time.scale = W[[1]]$year)
> Fehler in W[[1]]$year : $ operator is invalid for atomic vectors'
>
> even though I know **nothing** about the dd() function. My guess is:
> "data" is usually an argument to a function that tells it to use
> "nonstandard evaluation" to look for arguments and other names in the
> function first in the "data" argument, rather than by following R's
> "standard" evaluation by looking first through the function's closures.
> **If** this guess is correct, the call you gave above should be something
> like:
>
> dd(data = W[[1]], time.scale = year, precip = Precip,...)
>
> where precip (small "p") is a formal argument of the dd() function and
> Precip is a column in the data frame W[[1]].  If this is wrong, my
> apologies, and feel free to ignore without responding.
>
> Best,
> Bert
>
> On Wed, Nov 6, 2024 at 10:59?AM Sibylle St?ckli <sibylle.stoeckli at gmx.ch>
> wrote:
>
>> Dear Rui
>> Dear Bert
>>
>> Many thanks
>>
>> Solution
>> filelist <- list.files(path =
>> "O:/Data-Work/2.../Daten_RA-MeteoCH_1990-2021", pattern='*.dat', all.files=
>> T, full.names= T)
>> AAR<-read.table(filelist[1])
>>
>> It seems therefore that there is no other way than read in individually >
>> 100 weather tables using read.tables., right? Using file.choose() doesn't
>> change the work.
>>
>> Yes my .dat files are data.frames
>>
>> > str(W[[1]])'data.frame':	11688 obs. of  7 variables:
>>  $ year  : num  1990 1990 1990 1990 1990 1990 1990 1990 1990 1990 ...
>>  $ DOY   : num  1 2 3 4 5 6 7 8 9 10 ...
>>  $ Ta    : num  -2.67 -2.77 -2.23 -2.21 -0.98 0.82 0.49 -1.02 -2.31 -3.36 ...
>>  $ Tmin  : num  -3.5 -3.7 -4.26 -2.87 -2.98 0.3 -0.83 -1.27 -3 -3.82 ...
>>  $ Tmax  : num  -1.13 -0.15 -0.13 -0.45 1 1.87 1.72 -0.35 -0.85 -2.3 ...
>>  $ Precip: num  0 0 0 0 0.45 1.81 0.03 0 0 0 ...
>>  $ rSSD  : num  0 0.08 0 0 0.08 0 0 0 0 0 ...
>>
>>
>> *Gesendet: *Mittwoch, 6. November 2024 um 18:28
>> *Von: *"Bert Gunter" <bgunter.4567 at gmail.com>
>> *An: *"Sibylle St?ckli" <sibylle.stoeckli at gmx.ch>
>> *CC: *r-help at r-project.org
>> *Betreff: *Re: [R] Using multiple dat files
>> Not quite sure if I understand you.
>>
>> list.files() simply returns a character vector(not a list). You can
>> simply use a vector index to select whatever file you wish to read. So if
>> your desired filename is the 5th element of filelist above, something like
>>
>> myfile <- read.table(filename[5], ...)
>>
>> You can also use regular expressions to choose a bunch of files that have
>> some common signature to their names that you can read in simultaneously
>> using your "filelist" vector of names via something like:
>>
>> myfiles <- lapply(grep("weath", filelist, value = TRUE), \(x)
>> read.table(x,...))
>> ### Note that the result of lapply *is* a list, so use list indexing for
>> extraction from myfiles.
>>
>>
>> You can also choose files to read interactively (via a GUI interface)
>> using file.choose() instead of using list.files() if you prefer to do it
>> that way.
>>
>> Cheers,
>> Bert
>>
>> On Wed, Nov 6, 2024 at 8:25?AM Sibylle St?ckli via R-help <
>> r-help at r-project.org> wrote:
>>
>>> Dear community
>>>
>>> To import multiple .dat  weather files I am using list.files().
>>> I intend to use the R package ?ClimInd? to calculate different
>>> agroclimatic indicators.
>>>
>>> Question: Is there another solution to import multiple .dat files so
>>> that I can select elements from the list, e.g. one specific weather file
>>> (example AAR_DailyWeather)?
>>>
>>>
>>> # Import multiple .dat files weather data
>>> filelist <- list.files(path =
>>> "O:/Data-Work/??./Daten_RA-MeteoCH_1990-2021", pattern='*.dat', all.files=
>>> T, full.names= T)
>>> W <- lapply(filelist, function(x) read.table(x, header = TRUE, sep = "",
>>> colClasses = "numeric", comment.char = ""))
>>> W[[1]]
>>>
>>> > dd(data = W[[1]]$Precip, time.scale = W[[1]]$year)
>>> Fehler in W[[1]]$year : $ operator is invalid for atomic vectors
>>>
>>> Kind regards
>>> Sibylle
>>>
>>>
>>>
>>> ______________________________________________
>>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>> PLEASE do read the posting guide
>>> https://www.R-project.org/posting-guide.html
>>> and provide commented, minimal, self-contained, reproducible code.
>>
>>

	[[alternative HTML version deleted]]


