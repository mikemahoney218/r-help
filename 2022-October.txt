From @v|@e@gro@@ @end|ng |rom gm@||@com  Sat Oct  1 01:01:28 2022
From: @v|@e@gro@@ @end|ng |rom gm@||@com (Avi Gross)
Date: Fri, 30 Sep 2022 19:01:28 -0400
Subject: [R] Reading very large text files into R
In-Reply-To: <BN6PR2201MB15533DA430761C7B4A46AD15CF569@BN6PR2201MB1553.namprd22.prod.outlook.com>
References: <CABxY9BMk+Y82OV8Rcaoe-r+GeheN9ji6hvGpjVjejKD0h0=E+A@mail.gmail.com>
 <CABcYAdKtUWnUdpMBOZ6R_EajctOtVAHa=DUd6X4ytEr9H_acVQ@mail.gmail.com>
 <BN6PR2201MB155318FFE325C623BE53AAC2CF569@BN6PR2201MB1553.namprd22.prod.outlook.com>
 <004e01d8d501$12d6f2f0$3884d8d0$@gmail.com>
 <BN6PR2201MB15533DA430761C7B4A46AD15CF569@BN6PR2201MB1553.namprd22.prod.outlook.com>
Message-ID: <CABaFrRZkz8td3gzznUbSkmy=F5gacnCigGkGpnpiY7xiwKDMBQ@mail.gmail.com>

Those are valid reasons as examining data and cleaning or fixing it is a
major thing to do before making an analysis or plots. Indeed, an extra
column caused by something in an earlier column mat have messed up all
columns to the right.

My point was about replicating a problem like this may require many more
lines from the file.

On Fri, Sep 30, 2022, 5:58 PM Ebert,Timothy Aaron <tebert at ufl.edu> wrote:

> The point was more to figure out why most lines have 15 values and some
> give an error indicating that there are 16. Are there notes, or an extra
> comma? Some weather stations fail and give interesting data at, before, or
> after failure. Are the problem lines indicating machine failure? Typically
> code does not randomly enter extra data. Most answers appear to assume that
> the 16th column has been entered at the end of the data, but no evidence
> indicates this is true. If there is an initial value at the beginning of
> the row, then all of the data for that row will be in error if the "16"
> value is deleted. I am just paranoid enough to suggest looking at one case
> to make sure all is as assumed.
>    Another way to address the problem is to test the data. Are there
> temperatures less than -100 C or greater than 60 C? Why would one ever get
> such a thing? Machine error, or a column misaligned so that humidity values
> are in the temperature column.
>
> Tim
>
> -----Original Message-----
> From: R-help <r-help-bounces at r-project.org> On Behalf Of
> avi.e.gross at gmail.com
> Sent: Friday, September 30, 2022 3:16 PM
> Cc: r-help at r-project.org
> Subject: Re: [R] Reading very large text files into R
>
> [External Email]
>
> Tim and others,
>
> A point to consider is that there are various algorithms in the functions
> used to read in formatted data into data.frame form and they vary. Some do
> a look-ahead of some size to determine things and if they find a column
> that LOOKS LIKE all integers for say the first thousand lines, they go and
> read in that column as integer. If the first floating point value is
> thousands of lines further along, things may go wrong.
>
> So asking for line/row 16 to have an extra 16th entry/column may work fine
> for an algorithm that looks ahead and concludes there are 16 columns
> throughout. Yet a file where the first time a sixteenth entry is seen is at
> line/row 31,459 may well just set the algorithm to expect exactly 15
> columns and then be surprised as noted above.
>
> I have stayed out of this discussion and others have supplied pretty much
> what I would have said. I also see the data as flawed and ask which rows
> are the valid ones. If a sixteenth column is allowed, it would be better if
> all other rows had an empty sixteenth column. If not allowed, none should
> have it.
>
> The approach I might take, again as others have noted, is to preprocess
> the data file using some form of stream editor such as AWK that
> automagically reads in a line at a time and parses lines into a collection
> of tokens based on what separates them such as a comma. You can then either
> write out just the first 15 to the output stream if your choice is to
> ignore a spurious sixteenth, or write out all sixteen for every line, with
> the last being some form of null most of the time. And, of course, to be
> more general, you could make two passes through the file with the first one
> determining the maximum number of entries as well as what the most common
> number of entries is, and a second pass using that info to normalize the
> file the way you want. And note some of what was mentioned could often be
> done in this preprocessing such as removing any columns you do not want to
> read into R later. Do note such filters may need to handle edge cases like
> skipping comment lines or treating the row of headers differently.
>
> As some have shown, you can create your own filters within a language like
> R too and either read in lines and pre-process them as discussed or
> continue on to making your own data.frame and skip the read.table() type of
> functionality. For very large files, though, having multiple variations in
> memory at once may be an issue, especially if they are not removed and
> further processing and analysis continues.
>
> Perhaps it might be sensible to contact those maintaining the data and
> point out the anomaly and ask if their files might be saved alternately in
> a format that can be used without anomalies.
>
> Avi
>
> -----Original Message-----
> From: R-help <r-help-bounces at r-project.org> On Behalf Of Ebert,Timothy
> Aaron
> Sent: Friday, September 30, 2022 7:27 AM
> To: Richard O'Keefe <raoknz at gmail.com>; Nick Wray <nickmwray at gmail.com>
> Cc: r-help at r-project.org
> Subject: Re: [R] Reading very large text files into R
>
> Hi Nick,
>    Can you post one line of data with 15 entries followed by the next line
> of data with 16 entries?
>
> Tim
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>
> https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl.edu%7C3d75da30d3744c13847308daa3184c98%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638001622016765705%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=5w0Yrih%2Fxf09zpgabscAzMTVzcw4nhjNKX5%2FgWEPVWk%3D&amp;reserved=0
> PLEASE do read the posting guide
> https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%7C3d75da30d3744c13847308daa3184c98%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638001622016765705%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=K4ddCaLbSB5XU8TELCMhDEFsG4drevbeRp2YKPxY2ag%3D&amp;reserved=0
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From tebert @end|ng |rom u||@edu  Sat Oct  1 01:43:01 2022
From: tebert @end|ng |rom u||@edu (Ebert,Timothy Aaron)
Date: Fri, 30 Sep 2022 23:43:01 +0000
Subject: [R] Reading very large text files into R
In-Reply-To: <CABaFrRZkz8td3gzznUbSkmy=F5gacnCigGkGpnpiY7xiwKDMBQ@mail.gmail.com>
References: <CABxY9BMk+Y82OV8Rcaoe-r+GeheN9ji6hvGpjVjejKD0h0=E+A@mail.gmail.com>
 <CABcYAdKtUWnUdpMBOZ6R_EajctOtVAHa=DUd6X4ytEr9H_acVQ@mail.gmail.com>
 <BN6PR2201MB155318FFE325C623BE53AAC2CF569@BN6PR2201MB1553.namprd22.prod.outlook.com>
 <004e01d8d501$12d6f2f0$3884d8d0$@gmail.com>
 <BN6PR2201MB15533DA430761C7B4A46AD15CF569@BN6PR2201MB1553.namprd22.prod.outlook.com>
 <CABaFrRZkz8td3gzznUbSkmy=F5gacnCigGkGpnpiY7xiwKDMBQ@mail.gmail.com>
Message-ID: <BN6PR2201MB1553B86BFEE83B5EDD382CD9CF569@BN6PR2201MB1553.namprd22.prod.outlook.com>

Truth

Tim

-----Original Message-----
From: R-help <r-help-bounces at r-project.org> On Behalf Of Avi Gross
Sent: Friday, September 30, 2022 7:01 PM
Cc: R help Mailing list <r-help at r-project.org>
Subject: Re: [R] Reading very large text files into R

[External Email]

Those are valid reasons as examining data and cleaning or fixing it is a major thing to do before making an analysis or plots. Indeed, an extra column caused by something in an earlier column mat have messed up all columns to the right.

My point was about replicating a problem like this may require many more lines from the file.

On Fri, Sep 30, 2022, 5:58 PM Ebert,Timothy Aaron <tebert at ufl.edu> wrote:

> The point was more to figure out why most lines have 15 values and 
> some give an error indicating that there are 16. Are there notes, or 
> an extra comma? Some weather stations fail and give interesting data 
> at, before, or after failure. Are the problem lines indicating machine 
> failure? Typically code does not randomly enter extra data. Most 
> answers appear to assume that the 16th column has been entered at the 
> end of the data, but no evidence indicates this is true. If there is 
> an initial value at the beginning of the row, then all of the data for that row will be in error if the "16"
> value is deleted. I am just paranoid enough to suggest looking at one 
> case to make sure all is as assumed.
>    Another way to address the problem is to test the data. Are there 
> temperatures less than -100 C or greater than 60 C? Why would one ever 
> get such a thing? Machine error, or a column misaligned so that 
> humidity values are in the temperature column.
>
> Tim
>
> -----Original Message-----
> From: R-help <r-help-bounces at r-project.org> On Behalf Of 
> avi.e.gross at gmail.com
> Sent: Friday, September 30, 2022 3:16 PM
> Cc: r-help at r-project.org
> Subject: Re: [R] Reading very large text files into R
>
> [External Email]
>
> Tim and others,
>
> A point to consider is that there are various algorithms in the 
> functions used to read in formatted data into data.frame form and they 
> vary. Some do a look-ahead of some size to determine things and if 
> they find a column that LOOKS LIKE all integers for say the first 
> thousand lines, they go and read in that column as integer. If the 
> first floating point value is thousands of lines further along, things may go wrong.
>
> So asking for line/row 16 to have an extra 16th entry/column may work 
> fine for an algorithm that looks ahead and concludes there are 16 
> columns throughout. Yet a file where the first time a sixteenth entry 
> is seen is at line/row 31,459 may well just set the algorithm to 
> expect exactly 15 columns and then be surprised as noted above.
>
> I have stayed out of this discussion and others have supplied pretty 
> much what I would have said. I also see the data as flawed and ask 
> which rows are the valid ones. If a sixteenth column is allowed, it 
> would be better if all other rows had an empty sixteenth column. If 
> not allowed, none should have it.
>
> The approach I might take, again as others have noted, is to 
> preprocess the data file using some form of stream editor such as AWK 
> that automagically reads in a line at a time and parses lines into a 
> collection of tokens based on what separates them such as a comma. You 
> can then either write out just the first 15 to the output stream if 
> your choice is to ignore a spurious sixteenth, or write out all 
> sixteen for every line, with the last being some form of null most of 
> the time. And, of course, to be more general, you could make two 
> passes through the file with the first one determining the maximum 
> number of entries as well as what the most common number of entries 
> is, and a second pass using that info to normalize the file the way 
> you want. And note some of what was mentioned could often be done in 
> this preprocessing such as removing any columns you do not want to 
> read into R later. Do note such filters may need to handle edge cases like skipping comment lines or treating the row of headers differently.
>
> As some have shown, you can create your own filters within a language 
> like R too and either read in lines and pre-process them as discussed 
> or continue on to making your own data.frame and skip the read.table() 
> type of functionality. For very large files, though, having multiple 
> variations in memory at once may be an issue, especially if they are 
> not removed and further processing and analysis continues.
>
> Perhaps it might be sensible to contact those maintaining the data and 
> point out the anomaly and ask if their files might be saved 
> alternately in a format that can be used without anomalies.
>
> Avi
>
> -----Original Message-----
> From: R-help <r-help-bounces at r-project.org> On Behalf Of Ebert,Timothy 
> Aaron
> Sent: Friday, September 30, 2022 7:27 AM
> To: Richard O'Keefe <raoknz at gmail.com>; Nick Wray 
> <nickmwray at gmail.com>
> Cc: r-help at r-project.org
> Subject: Re: [R] Reading very large text files into R
>
> Hi Nick,
>    Can you post one line of data with 15 entries followed by the next 
> line of data with 16 entries?
>
> Tim
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>
> https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat
> .ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl
> .edu%7C5044822c1b7f45f2b5f408daa337cc46%7C0d4da0f84a314d76ace60a62331e
> 1b84%7C0%7C0%7C638001757304040018%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4w
> LjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C
> &amp;sdata=s1Vx7PfKdb12NTQFAsGPQ5k8oXBylcFyD30xtAnHqYQ%3D&amp;reserved
> =0
> PLEASE do read the posting guide
> https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r
> -project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%
> 7C5044822c1b7f45f2b5f408daa337cc46%7C0d4da0f84a314d76ace60a62331e1b84%
> 7C0%7C0%7C638001757304040018%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwM
> DAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;
> sdata=Q3cceHqosMsjflLn5cPgBE58EGdE%2B7riPYhubX%2BwEL8%3D&amp;reserved=
> 0 and provide commented, minimal, self-contained, reproducible code.
>

        [[alternative HTML version deleted]]

______________________________________________
R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl.edu%7C5044822c1b7f45f2b5f408daa337cc46%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638001757304040018%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=s1Vx7PfKdb12NTQFAsGPQ5k8oXBylcFyD30xtAnHqYQ%3D&amp;reserved=0
PLEASE do read the posting guide https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%7C5044822c1b7f45f2b5f408daa337cc46%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638001757304040018%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=Q3cceHqosMsjflLn5cPgBE58EGdE%2B7riPYhubX%2BwEL8%3D&amp;reserved=0
and provide commented, minimal, self-contained, reproducible code.


From dr@@|@m@o|@ng| @end|ng |rom gm@||@com  Sat Oct  1 14:53:00 2022
From: dr@@|@m@o|@ng| @end|ng |rom gm@||@com (Shah Alam)
Date: Sat, 1 Oct 2022 14:53:00 +0200
Subject: [R] could not find function "flexsurvreg"
Message-ID: <CA+bivFj5M5HeVawxZXeZ4S9JgZUAY2eF8DCUb_JXyNiNoLk59A@mail.gmail.com>

Dear All,
I am analyzing trial data for survival. During the loading of the R package
"flexsurv", the following error message appeared.

"Loading required package: survival
Error: package or namespace load failed for ?flexsurv? in loadNamespace(j
<- i[[1L]], c(lib.loc, .libPaths()), versionCheck = vI[[j]]):
 there is no package called ?lifecycle?

Despite installing lifecycle package, loading lifecycle package results in
the following error message:

Error in library(lifecycle) : there is no package called ?lifecycle?

Moreover, the flexsurvreg function in the flexsurv library also produces an
error:

Error in flexsurvreg(Surv(Time, Event) ~ 1, anc = NULL, data = data1,  :
  could not find function "flexsurvreg"

Several times I have installed and uninstalled packages, re-started R, but
the error persists.

Could anyone help me with the flexsurv package, why is it not working?

Best regards,
Shah

	[[alternative HTML version deleted]]


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Sat Oct  1 15:29:15 2022
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Sat, 1 Oct 2022 14:29:15 +0100
Subject: [R] could not find function "flexsurvreg"
In-Reply-To: <CA+bivFj5M5HeVawxZXeZ4S9JgZUAY2eF8DCUb_JXyNiNoLk59A@mail.gmail.com>
References: <CA+bivFj5M5HeVawxZXeZ4S9JgZUAY2eF8DCUb_JXyNiNoLk59A@mail.gmail.com>
Message-ID: <2975651c-bf02-4f2c-a44d-9f49b7f84deb@sapo.pt>

Hello,

Not knowing which system you have, here is a way that usually works.

1. If you are using an IDE sych as RStudio or RGui, save your work and 
exit. This is because when the packages' namepaces are loaded, the 
shared libs, if they exist, are blocked,

2. Open a terminal window
3. Run

R -q -e "install.packages(c('lifecycle', 'flexsurv'))"


The packages should now be installed.


Hope this helps,

Rui Barradas

?s 13:53 de 01/10/2022, Shah Alam escreveu:
> Dear All,
> I am analyzing trial data for survival. During the loading of the R package
> "flexsurv", the following error message appeared.
> 
> "Loading required package: survival
> Error: package or namespace load failed for ?flexsurv? in loadNamespace(j
> <- i[[1L]], c(lib.loc, .libPaths()), versionCheck = vI[[j]]):
>   there is no package called ?lifecycle?
> 
> Despite installing lifecycle package, loading lifecycle package results in
> the following error message:
> 
> Error in library(lifecycle) : there is no package called ?lifecycle?
> 
> Moreover, the flexsurvreg function in the flexsurv library also produces an
> error:
> 
> Error in flexsurvreg(Surv(Time, Event) ~ 1, anc = NULL, data = data1,  :
>    could not find function "flexsurvreg"
> 
> Several times I have installed and uninstalled packages, re-started R, but
> the error persists.
> 
> Could anyone help me with the flexsurv package, why is it not working?
> 
> Best regards,
> Shah
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From t@r|qkh@@|r| @end|ng |rom gm@||@com  Sun Oct  2 14:06:02 2022
From: t@r|qkh@@|r| @end|ng |rom gm@||@com (Tariq Khasiri)
Date: Sun, 2 Oct 2022 07:06:02 -0500
Subject: [R] Help with steam graph
Message-ID: <CAFy_oHAn0RGPVXG=ypbxHM_idX08=c94QOh+gpqwXVEEKYnuSw@mail.gmail.com>

Hi, i'm trying to create a steamgraph with the following data by creating a
unit indicator by combing the year and month. But, I'm getting error as :

Error in `group_by()`:
! Must group by variables found in `.data`.
? Column `com_num` is not found.
Run `rlang::last_error()` to see where the error occurred.

### Packages needed for the code
devtools::install_github("hrbrmstr/streamgraph")

library(tidyverse)
library(ggplot2)
library(dplyr)
library(steamgraph)

### Code ( The following code can be found on creator's account
https://hrbrmstr.github.io/streamgraph/  )

dat %>%
select(year, month, company, share, com_num) %>%
  tidyr::gather(company, share, -year) %>%
  group_by(year, com_num) %>%
  tally(wt=share) %>%
  ungroup %>%
  streamgraph("com_num", "n", "year") %>%
  sg_axis_x(0.8) %>%
  sg_fill_brewer("PuOr") %>%
  sg_legend(show=TRUE, label="Share: ")


### data is like the following

dput(dat)
structure(list(year = c(2018, 2019, 2019, 2019, 2019, 2019, 2019,
2019, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017,
2017, 2017, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018,
2018, 2018, 2018, 2019, 2019, 2019, 2019, 2019), month = c(12,
1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1,
2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5), company = c("ABC",
"ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "FGH", "FGH",
"FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
"FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
"FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH"
), share = c(20, 16.5, 15, 15.5, 15.5, 16, 17, 16.5, 61, 55,
53, 53, 54, 53, 58, 54, 50, 47, 55, 50, 52, 51, 51.5, 52, 53,
54, 55, 53, 54, 50, 42, 48, 41, 40, 39, 36.5, 35), com_name = c(1,
1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2)), row.names = c(NA,
-37L), spec = structure(list(cols = list(year = structure(list(), class =
c("collector_double",
"collector")), month = structure(list(), class = c("collector_double",
"collector")), company = structure(list(), class = c("collector_character",
"collector")), share = structure(list(), class = c("collector_double",
"collector")), com_name = structure(list(), class = c("collector_double",
"collector"))), default = structure(list(), class = c("collector_guess",
"collector")), delim = ","), class = "col_spec"), problems = <pointer:
0x7fd732028680>, class = c("spec_tbl_df",
"tbl_df", "tbl", "data.frame"))

	[[alternative HTML version deleted]]


From m@@c|@@|mone99 @end|ng |rom gm@||@com  Sun Oct  2 12:56:44 2022
From: m@@c|@@|mone99 @end|ng |rom gm@||@com (Simone Mascia)
Date: Sun, 2 Oct 2022 12:56:44 +0200
Subject: [R] Robust standard error
Message-ID: <CAPkN0fY32F=b=RFsTuCnDytg4i=++CkB_Bw7VLN+i=0rvaBQtQ@mail.gmail.com>

Is there a way to estimate Robust standard errors when using a nls()
function? I'm trying to fit some data to a complicated model and everything
works fine with nls() but I also wanted to obtain a robust estimate of my
errors.

I tried "coeftest(m, vcov=sandwich)" and it seems to work, but so does
"coeftest(m, vcov = NeweyWest(m, lag = 4))" or "coeftest(m, vcov =
kernHAC(m, kernel = "Bartlett", bw = 5, prewhite = FALSE, adjust =
FALSE))". They return different error estimates so I wanted you to help me
understand what I should do, if I'm doing something wrong and other stuff.

Thank you

	[[alternative HTML version deleted]]


From dw|n@em|u@ @end|ng |rom comc@@t@net  Sun Oct  2 16:11:55 2022
From: dw|n@em|u@ @end|ng |rom comc@@t@net (David Winsemius)
Date: Sun, 2 Oct 2022 07:11:55 -0700
Subject: [R] Help with steam graph
In-Reply-To: <CAFy_oHAn0RGPVXG=ypbxHM_idX08=c94QOh+gpqwXVEEKYnuSw@mail.gmail.com>
References: <CAFy_oHAn0RGPVXG=ypbxHM_idX08=c94QOh+gpqwXVEEKYnuSw@mail.gmail.com>
Message-ID: <0073C340-0152-48CF-BB4B-1890BFD1DDF3@comcast.net>

I don?t see a column with the name ?com_num?, so the error message makes complete sense. 

? 
David

Sent from my iPhone

> On Oct 2, 2022, at 5:06 AM, Tariq Khasiri <tariqkhasiri at gmail.com> wrote:
> 
> ?Hi, i'm trying to create a steamgraph with the following data by creating a
> unit indicator by combing the year and month. But, I'm getting error as :
> 
> Error in `group_by()`:
> ! Must group by variables found in `.data`.
> ? Column `com_num` is not found.
> Run `rlang::last_error()` to see where the error occurred.
> 
> ### Packages needed for the code
> devtools::install_github("hrbrmstr/streamgraph")
> 
> library(tidyverse)
> library(ggplot2)
> library(dplyr)
> library(steamgraph)
> 
> ### Code ( The following code can be found on creator's account
> https://hrbrmstr.github.io/streamgraph/  )
> 
> dat %>%
> select(year, month, company, share, com_num) %>%
>  tidyr::gather(company, share, -year) %>%
>  group_by(year, com_num) %>%
>  tally(wt=share) %>%
>  ungroup %>%
>  streamgraph("com_num", "n", "year") %>%
>  sg_axis_x(0.8) %>%
>  sg_fill_brewer("PuOr") %>%
>  sg_legend(show=TRUE, label="Share: ")
> 
> 
> ### data is like the following
> 
> dput(dat)
> structure(list(year = c(2018, 2019, 2019, 2019, 2019, 2019, 2019,
> 2019, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017,
> 2017, 2017, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018,
> 2018, 2018, 2018, 2019, 2019, 2019, 2019, 2019), month = c(12,
> 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1,
> 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5), company = c("ABC",
> "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "FGH", "FGH",
> "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
> "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
> "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH"
> ), share = c(20, 16.5, 15, 15.5, 15.5, 16, 17, 16.5, 61, 55,
> 53, 53, 54, 53, 58, 54, 50, 47, 55, 50, 52, 51, 51.5, 52, 53,
> 54, 55, 53, 54, 50, 42, 48, 41, 40, 39, 36.5, 35), com_name = c(1,
> 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
> 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2)), row.names = c(NA,
> -37L), spec = structure(list(cols = list(year = structure(list(), class =
> c("collector_double",
> "collector")), month = structure(list(), class = c("collector_double",
> "collector")), company = structure(list(), class = c("collector_character",
> "collector")), share = structure(list(), class = c("collector_double",
> "collector")), com_name = structure(list(), class = c("collector_double",
> "collector"))), default = structure(list(), class = c("collector_guess",
> "collector")), delim = ","), class = "col_spec"), problems = <pointer:
> 0x7fd732028680>, class = c("spec_tbl_df",
> "tbl_df", "tbl", "data.frame"))
> 
>    [[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From bgunter@4567 @end|ng |rom gm@||@com  Sun Oct  2 16:43:00 2022
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Sun, 2 Oct 2022 07:43:00 -0700
Subject: [R] Robust standard error
In-Reply-To: <CAPkN0fY32F=b=RFsTuCnDytg4i=++CkB_Bw7VLN+i=0rvaBQtQ@mail.gmail.com>
References: <CAPkN0fY32F=b=RFsTuCnDytg4i=++CkB_Bw7VLN+i=0rvaBQtQ@mail.gmail.com>
Message-ID: <CAGxFJbSTKN5C4SbGh4XRNTe95WArNd2m5XaE1gi8YgfC4ajnrg@mail.gmail.com>

You may get a helpful response here, but generally speaking, this list is
about R **programming**, and statistical issues/tutorials are off topic.
You might try
https://stackoverflow.com/questions/tagged/statistics
if you don't get adequate help here.

-- Bert

On Sun, Oct 2, 2022 at 6:42 AM Simone Mascia <masciasimone99 at gmail.com>
wrote:

> Is there a way to estimate Robust standard errors when using a nls()
> function? I'm trying to fit some data to a complicated model and everything
> works fine with nls() but I also wanted to obtain a robust estimate of my
> errors.
>
> I tried "coeftest(m, vcov=sandwich)" and it seems to work, but so does
> "coeftest(m, vcov = NeweyWest(m, lag = 4))" or "coeftest(m, vcov =
> kernHAC(m, kernel = "Bartlett", bw = 5, prewhite = FALSE, adjust =
> FALSE))". They return different error estimates so I wanted you to help me
> understand what I should do, if I'm doing something wrong and other stuff.
>
> Thank you
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From e@ @end|ng |rom enr|co@chum@nn@net  Sun Oct  2 17:59:32 2022
From: e@ @end|ng |rom enr|co@chum@nn@net (Enrico Schumann)
Date: Sun, 02 Oct 2022 17:59:32 +0200
Subject: [R] Robust standard error
In-Reply-To: <CAGxFJbSTKN5C4SbGh4XRNTe95WArNd2m5XaE1gi8YgfC4ajnrg@mail.gmail.com>
 (Bert Gunter's message of "Sun, 2 Oct 2022 07:43:00 -0700")
References: <CAPkN0fY32F=b=RFsTuCnDytg4i=++CkB_Bw7VLN+i=0rvaBQtQ@mail.gmail.com>
 <CAGxFJbSTKN5C4SbGh4XRNTe95WArNd2m5XaE1gi8YgfC4ajnrg@mail.gmail.com>
Message-ID: <87lepykyhn.fsf@enricoschumann.net>

On Sun, 02 Oct 2022, Bert Gunter writes:

> On Sun, Oct 2, 2022 at 6:42 AM Simone Mascia <masciasimone99 at gmail.com>
> wrote:
>
>> Is there a way to estimate Robust standard errors when using a nls()
>> function? I'm trying to fit some data to a complicated model and everything
>> works fine with nls() but I also wanted to obtain a robust estimate of my
>> errors.
>>
>> I tried "coeftest(m, vcov=sandwich)" and it seems to work, but so does
>> "coeftest(m, vcov = NeweyWest(m, lag = 4))" or "coeftest(m, vcov =
>> kernHAC(m, kernel = "Bartlett", bw = 5, prewhite = FALSE, adjust =
>> FALSE))". They return different error estimates so I wanted you to help me
>> understand what I should do, if I'm doing something wrong and other stuff.
>>
>> Thank you
>>
>
> You may get a helpful response here, but generally speaking, this list is
> about R **programming**, and statistical issues/tutorials are off topic.
> You might try
> https://stackoverflow.com/questions/tagged/statistics
> if you don't get adequate help here.
>
> -- Bert
>

Additionally, there is also
https://stat.ethz.ch/mailman/listinfo/R-sig-Robust .

-- 
Enrico Schumann
Lucerne, Switzerland
http://enricoschumann.net


From t@r|qkh@@|r| @end|ng |rom gm@||@com  Sun Oct  2 19:03:51 2022
From: t@r|qkh@@|r| @end|ng |rom gm@||@com (Tariq Khasiri)
Date: Sun, 2 Oct 2022 12:03:51 -0500
Subject: [R] Help with steam graph
In-Reply-To: <0073C340-0152-48CF-BB4B-1890BFD1DDF3@comcast.net>
References: <CAFy_oHAn0RGPVXG=ypbxHM_idX08=c94QOh+gpqwXVEEKYnuSw@mail.gmail.com>
 <0073C340-0152-48CF-BB4B-1890BFD1DDF3@comcast.net>
Message-ID: <CAFy_oHCNXkHGOXGixzyee74TRKsxjeaozwuR2Y2OY4T4236Kag@mail.gmail.com>

Actually in my main data the column name is com_num ( where mistakenly I
pasted the sample data here under the com_name ). So, when I run the
command successfully this is the error shows up -

    ?
  1. ??... %>% sg_legend(show = TRUE, label = "Share: ")
  2. ??streamgraph::sg_legend(., show = TRUE, label = "Share: ")
  3. ??streamgraph::sg_fill_brewer(., "PuOr")
  4. ??streamgraph::sg_axis_x(., 0.8)
  5. ??streamgraph::streamgraph(., "com_num", "n", "year")
  6. ? ??base::data.frame(data)
  7. ??dplyr::ungroup(.)
  8. ??dplyr::tally(., wt = share)
  9. ??dplyr::group_by(., year, com_num)
 10. ??dplyr:::group_by.data.frame(., year, com_num)
 11.   ??dplyr::group_by_prepare(.data, ..., .add = .add, caller_env =
caller_env())
 12.     ??rlang::abort(bullets, call = error_call)

Any suggestions on how I can fix it ??

On Sun, 2 Oct 2022 at 09:12, David Winsemius <dwinsemius at comcast.net> wrote:

> I don?t see a column with the name ?com_num?, so the error message makes
> complete sense.
>
> ?
> David
>
> Sent from my iPhone
>
> > On Oct 2, 2022, at 5:06 AM, Tariq Khasiri <tariqkhasiri at gmail.com>
> wrote:
> >
> > ?Hi, i'm trying to create a steamgraph with the following data by
> creating a
> > unit indicator by combing the year and month. But, I'm getting error as :
> >
> > Error in `group_by()`:
> > ! Must group by variables found in `.data`.
> > ? Column `com_num` is not found.
> > Run `rlang::last_error()` to see where the error occurred.
> >
> > ### Packages needed for the code
> > devtools::install_github("hrbrmstr/streamgraph")
> >
> > library(tidyverse)
> > library(ggplot2)
> > library(dplyr)
> > library(steamgraph)
> >
> > ### Code ( The following code can be found on creator's account
> > https://hrbrmstr.github.io/streamgraph/  )
> >
> > dat %>%
> > select(year, month, company, share, com_num) %>%
> >  tidyr::gather(company, share, -year) %>%
> >  group_by(year, com_num) %>%
> >  tally(wt=share) %>%
> >  ungroup %>%
> >  streamgraph("com_num", "n", "year") %>%
> >  sg_axis_x(0.8) %>%
> >  sg_fill_brewer("PuOr") %>%
> >  sg_legend(show=TRUE, label="Share: ")
> >
> >
> > ### data is like the following
> >
> > dput(dat)
> > structure(list(year = c(2018, 2019, 2019, 2019, 2019, 2019, 2019,
> > 2019, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017,
> > 2017, 2017, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018,
> > 2018, 2018, 2018, 2019, 2019, 2019, 2019, 2019), month = c(12,
> > 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1,
> > 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5), company = c("ABC",
> > "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "FGH", "FGH",
> > "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
> > "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
> > "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH"
> > ), share = c(20, 16.5, 15, 15.5, 15.5, 16, 17, 16.5, 61, 55,
> > 53, 53, 54, 53, 58, 54, 50, 47, 55, 50, 52, 51, 51.5, 52, 53,
> > 54, 55, 53, 54, 50, 42, 48, 41, 40, 39, 36.5, 35), com_name = c(1,
> > 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
> > 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2)), row.names = c(NA,
> > -37L), spec = structure(list(cols = list(year = structure(list(), class =
> > c("collector_double",
> > "collector")), month = structure(list(), class = c("collector_double",
> > "collector")), company = structure(list(), class =
> c("collector_character",
> > "collector")), share = structure(list(), class = c("collector_double",
> > "collector")), com_name = structure(list(), class = c("collector_double",
> > "collector"))), default = structure(list(), class = c("collector_guess",
> > "collector")), delim = ","), class = "col_spec"), problems = <pointer:
> > 0x7fd732028680>, class = c("spec_tbl_df",
> > "tbl_df", "tbl", "data.frame"))
> >
> >    [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.
>
>

	[[alternative HTML version deleted]]


From tebert @end|ng |rom u||@edu  Sun Oct  2 23:27:10 2022
From: tebert @end|ng |rom u||@edu (Ebert,Timothy Aaron)
Date: Sun, 2 Oct 2022 21:27:10 +0000
Subject: [R] Robust standard error
In-Reply-To: <87lepykyhn.fsf@enricoschumann.net>
References: <CAPkN0fY32F=b=RFsTuCnDytg4i=++CkB_Bw7VLN+i=0rvaBQtQ@mail.gmail.com>
 <CAGxFJbSTKN5C4SbGh4XRNTe95WArNd2m5XaE1gi8YgfC4ajnrg@mail.gmail.com>
 <87lepykyhn.fsf@enricoschumann.net>
Message-ID: <BN6PR2201MB1553F98BC7B6CD7D3134E849CF589@BN6PR2201MB1553.namprd22.prod.outlook.com>

Most computer code will take a pile of numbers and return a pile of numbers. Reading the documentation should help you figure out where each measure is appropriate. It all depends on the purpose of a specific method and its assumptions and how those relate to your data, application, and model assumptions. It is important to know that information because it could change if you change your model or find other questions to ask of your data. There is no universal right answer.

Tim

-----Original Message-----
From: R-help <r-help-bounces at r-project.org> On Behalf Of Enrico Schumann
Sent: Sunday, October 2, 2022 12:00 PM
To: Simone Mascia <masciasimone99 at gmail.com>
Cc: r-help at r-project.org
Subject: Re: [R] Robust standard error

[External Email]

On Sun, 02 Oct 2022, Bert Gunter writes:

> On Sun, Oct 2, 2022 at 6:42 AM Simone Mascia 
> <masciasimone99 at gmail.com>
> wrote:
>
>> Is there a way to estimate Robust standard errors when using a nls() 
>> function? I'm trying to fit some data to a complicated model and 
>> everything works fine with nls() but I also wanted to obtain a robust 
>> estimate of my errors.
>>
>> I tried "coeftest(m, vcov=sandwich)" and it seems to work, but so 
>> does "coeftest(m, vcov = NeweyWest(m, lag = 4))" or "coeftest(m, vcov 
>> = kernHAC(m, kernel = "Bartlett", bw = 5, prewhite = FALSE, adjust = 
>> FALSE))". They return different error estimates so I wanted you to 
>> help me understand what I should do, if I'm doing something wrong and other stuff.
>>
>> Thank you
>>
>
> You may get a helpful response here, but generally speaking, this list 
> is about R **programming**, and statistical issues/tutorials are off topic.
> You might try
> https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstac
> koverflow.com%2Fquestions%2Ftagged%2Fstatistics&amp;data=05%7C01%7Cteb
> ert%40ufl.edu%7C86352d688e094b941f6108daa48f2bb0%7C0d4da0f84a314d76ace
> 60a62331e1b84%7C0%7C0%7C638003232071609206%7CUnknown%7CTWFpbGZsb3d8eyJ
> WIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000
> %7C%7C%7C&amp;sdata=yFTdmRZyRqZd9F3XNsg12IvYlnWE2P6TTkRvNL6U4ZI%3D&amp
> ;reserved=0
> if you don't get adequate help here.
>
> -- Bert
>

Additionally, there is also
https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2FR-sig-Robust&amp;data=05%7C01%7Ctebert%40ufl.edu%7C86352d688e094b941f6108daa48f2bb0%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638003232071609206%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=WJY8zHOxsMLUv1uiHJ91q04mGVvkPi0Kg%2BYydMZMKhs%3D&amp;reserved=0 .

--
Enrico Schumann
Lucerne, Switzerland
https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fenricoschumann.net%2F&amp;data=05%7C01%7Ctebert%40ufl.edu%7C86352d688e094b941f6108daa48f2bb0%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638003232071609206%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=nntdbtWzMra1ZsSrTR2ZEuDNndB6J5GJ%2B1WSC%2Bhweqo%3D&amp;reserved=0

______________________________________________
R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl.edu%7C86352d688e094b941f6108daa48f2bb0%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638003232071609206%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=6J1gU7dtTJexvDxujaA10nKYYxypFk1CMjN8qc8NQZM%3D&amp;reserved=0
PLEASE do read the posting guide https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%7C86352d688e094b941f6108daa48f2bb0%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638003232071609206%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=qd99tAhjS4vz7SemhzyXKvpSDG%2FZD%2FtQ4BYbCtt%2Fsu8%3D&amp;reserved=0
and provide commented, minimal, self-contained, reproducible code.


From t@r|qkh@@|r| @end|ng |rom gm@||@com  Mon Oct  3 01:04:24 2022
From: t@r|qkh@@|r| @end|ng |rom gm@||@com (Tariq Khasiri)
Date: Sun, 2 Oct 2022 18:04:24 -0500
Subject: [R] Creating a year-month indicator and groupby with category
Message-ID: <CAFy_oHDGR7cnNwcTW3mNknKvHhRz+LC4v4XSeKrKEOUjMTcsmA@mail.gmail.com>

Hello,

I have the following data. I want to show in a line plot how each different
company is earning over the timeline of my data sample.

I'm not sure how I can create the *year-month indicator* to plot it nicely
in my horizontal axis out of my dataset.

After creating the *year-month* indicator ( which will be in my x axis) I
want to create a dataframe where I can groupby companies over the
year-month indicator by putting *share *in the y axis as variables.

### data is like the following

dput(dat)
structure(list(year = c(2018, 2019, 2019, 2019, 2019, 2019, 2019,
2019, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017,
2017, 2017, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018,
2018, 2018, 2018, 2019, 2019, 2019, 2019, 2019), month = c(12,
1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1,
2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5), company = c("ABC",
"ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "FGH", "FGH",
"FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
"FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
"FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH"
), share = c(20, 16.5, 15, 15.5, 15.5, 16, 17, 16.5, 61, 55,
53, 53, 54, 53, 58, 54, 50, 47, 55, 50, 52, 51, 51.5, 52, 53,
54, 55, 53, 54, 50, 42, 48, 41, 40, 39, 36.5, 35), com_name = c(1,
1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2)), row.names = c(NA,
-37L), spec = structure(list(cols = list(year = structure(list(), class =
c("collector_double",
"collector")), month = structure(list(), class = c("collector_double",
"collector")), company = structure(list(), class = c("collector_character",
"collector")), share = structure(list(), class = c("collector_double",
"collector")), com_name = structure(list(), class = c("collector_double",
"collector"))), default = structure(list(), class = c("collector_guess",
"collector")), delim = ","), class = "col_spec"), problems = <pointer:
0x7fd732028680>, class = c("spec_tbl_df",
"tbl_df", "tbl", "data.frame"))

	[[alternative HTML version deleted]]


From dw|n@em|u@ @end|ng |rom comc@@t@net  Mon Oct  3 04:33:37 2022
From: dw|n@em|u@ @end|ng |rom comc@@t@net (David Winsemius)
Date: Sun, 2 Oct 2022 19:33:37 -0700
Subject: [R] Help with steam graph
In-Reply-To: <CAFy_oHCNXkHGOXGixzyee74TRKsxjeaozwuR2Y2OY4T4236Kag@mail.gmail.com>
References: <CAFy_oHAn0RGPVXG=ypbxHM_idX08=c94QOh+gpqwXVEEKYnuSw@mail.gmail.com>
 <0073C340-0152-48CF-BB4B-1890BFD1DDF3@comcast.net>
 <CAFy_oHCNXkHGOXGixzyee74TRKsxjeaozwuR2Y2OY4T4236Kag@mail.gmail.com>
Message-ID: <1129c7dc-e5ba-3938-663b-85aeedf0e9ce@comcast.net>

I think you are being dishonest. That code does not appear on hrbrmstr's 
vignette at least in a form that I recognize.

When I run your code from the first posting with all the instances of 
`com_num` replaced by `com_name` and removing the `pointer` entry in dat 
which throws an error when trying to define dat, I get

Error in `group_by()`: ! Must group by variables found in `.data`. ? 
Column `com_name` is not found. So I "rewind the process to the point 
where the error is reported and find

> dat %>%+ select(year, month, company, share, com_name) %>% + 
tidyr::gather(company, share, -year) # A tibble: 148 ? 3 year company 
share <dbl> <chr> <chr> 1 2018 month 12 2 2019 month 1 3 2019 month 2 4 
2019 month 3 5 2019 month 4 6 2019 month 5 7 2019 month 6 8 2019 month 7 
9 2017 month 1 10 2017 month 2 # ? with 138 more rows # ? Use `print(n = 
...)` to see more rows So the "gathering" process seems to have removed 
the `com_name` column. Can exit R without saving your workspace and then 
construct a series of R commands that will create a reproducible 
example? -- David.

On 10/2/22 10:03, Tariq Khasiri wrote:
> Actually in my main data the column name is com_num ( where 
> mistakenly?I pasted the sample data here under the com_name ). So, 
> when I run the command successfully?this is the error shows up -
>
> ? ? ?
> ? 1. ??... %>% sg_legend(show = TRUE, label = "Share: ")
> ? 2. ??streamgraph::sg_legend(., show = TRUE, label = "Share: ")
> ? 3. ??streamgraph::sg_fill_brewer(., "PuOr")
> ? 4. ??streamgraph::sg_axis_x(., 0.8)
> ? 5. ??streamgraph::streamgraph(., "com_num", "n", "year")
> ? 6. ? ??base::data.frame(data)
> ? 7. ??dplyr::ungroup(.)
> ? 8. ??dplyr::tally(., wt = share)
> ? 9. ??dplyr::group_by(., year, com_num)
> ?10. ??dplyr:::group_by.data.frame(., year, com_num)
> ?11. ? ??dplyr::group_by_prepare(.data, ..., .add = .add, caller_env = 
> caller_env())
> ?12. ? ? ??rlang::abort(bullets, call = error_call)
>
> Any suggestions on how I can fix it ??
>
> On Sun, 2 Oct 2022 at 09:12, David Winsemius <dwinsemius at comcast.net> 
> wrote:
>
>     I don?t see a column with the name ?com_num?, so the error message
>     makes complete sense.
>
>     ?
>     David
>
>     Sent from my iPhone
>
>     > On Oct 2, 2022, at 5:06 AM, Tariq Khasiri
>     <tariqkhasiri at gmail.com> wrote:
>     >
>     > ?Hi, i'm trying to create a steamgraph with the following data
>     by creating a
>     > unit indicator by combing the year and month. But, I'm getting
>     error as :
>     >
>     > Error in `group_by()`:
>     > ! Must group by variables found in `.data`.
>     > ? Column `com_num` is not found.
>     > Run `rlang::last_error()` to see where the error occurred.
>     >
>     > ### Packages needed for the code
>     > devtools::install_github("hrbrmstr/streamgraph")
>     >
>     > library(tidyverse)
>     > library(ggplot2)
>     > library(dplyr)
>     > library(steamgraph)
>     >
>     > ### Code ( The following code can be found on creator's account
>     > https://hrbrmstr.github.io/streamgraph/ )
>     >
>     > dat %>%
>     > select(year, month, company, share, com_num) %>%
>     >? tidyr::gather(company, share, -year) %>%
>     >? group_by(year, com_num) %>%
>     >? tally(wt=share) %>%
>     >? ungroup %>%
>     >? streamgraph("com_num", "n", "year") %>%
>     >? sg_axis_x(0.8) %>%
>     >? sg_fill_brewer("PuOr") %>%
>     >? sg_legend(show=TRUE, label="Share: ")
>     >
>     >
>     > ### data is like the following
>     >
>     > dput(dat)
>     > structure(list(year = c(2018, 2019, 2019, 2019, 2019, 2019, 2019,
>     > 2019, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017,
>     > 2017, 2017, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018,
>     > 2018, 2018, 2018, 2019, 2019, 2019, 2019, 2019), month = c(12,
>     > 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1,
>     > 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5), company =
>     c("ABC",
>     > "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "FGH", "FGH",
>     > "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
>     > "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
>     > "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH"
>     > ), share = c(20, 16.5, 15, 15.5, 15.5, 16, 17, 16.5, 61, 55,
>     > 53, 53, 54, 53, 58, 54, 50, 47, 55, 50, 52, 51, 51.5, 52, 53,
>     > 54, 55, 53, 54, 50, 42, 48, 41, 40, 39, 36.5, 35), com_name = c(1,
>     > 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
>     > 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2)), row.names = c(NA,
>     > -37L), spec = structure(list(cols = list(year =
>     structure(list(), class =
>     > c("collector_double",
>     > "collector")), month = structure(list(), class =
>     c("collector_double",
>     > "collector")), company = structure(list(), class =
>     c("collector_character",
>     > "collector")), share = structure(list(), class =
>     c("collector_double",
>     > "collector")), com_name = structure(list(), class =
>     c("collector_double",
>     > "collector"))), default = structure(list(), class =
>     c("collector_guess",
>     > "collector")), delim = ","), class = "col_spec"), problems =
>     <pointer:
>     > 0x7fd732028680>, class = c("spec_tbl_df",
>     > "tbl_df", "tbl", "data.frame"))
>     >
>     >? ? [[alternative HTML version deleted]]
>     >
>     > ______________________________________________
>     > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>     > https://stat.ethz.ch/mailman/listinfo/r-help
>     > PLEASE do read the posting guide
>     http://www.R-project.org/posting-guide.html
>     <http://www.R-project.org/posting-guide.html>
>     > and provide commented, minimal, self-contained, reproducible code.
>


From |eo@m@d@ @end|ng |rom @yon|c@eu  Mon Oct  3 05:05:56 2022
From: |eo@m@d@ @end|ng |rom @yon|c@eu (Leonard Mada)
Date: Mon, 3 Oct 2022 06:05:56 +0300
Subject: [R] [External Help] Multivariate Polynomials in R
Message-ID: <b3d455f8-4446-6417-cc1e-b746842bc78e@syonic.eu>

Dear R Users,

I have written some R code for multivariate polynomials in R. I am 
looking forward for some help in redesigning and improving the code.

Although this code was not planned initially to be released as a 
package, the functionality has become quite versatile over time. I will 
provide some examples below. If anyone is interested in multivariate 
polynomials and has some spare time, or has some students interested to 
learn some interesting math, feel free to contact me.

The immediate focus should be on:
1) Writing/improving the automatic tests;
2) Redesigning the code (and build an R package);

As the code has grown in size, I am very cautious to change anything, 
until proper tests are written. I have started to write some test code 
(the link to the GitHub page is below), but I am not yet very confident 
how to properly write the tests and also lack the time as well. I will 
appreciate any expertise and help on this topic.

Ultimately, I hope to be able to focus more on the math topics. I will 
post a separate call for some of these topics.

CODE DETAILS

The source files are on GitHub:
https://github.com/discoleo/R/blob/master/Math/Polynomials.Helper.R
- (all) files named Polynomials.Helper.XXX.R are needed; (~ 25 files, 
including the test files);
- if requested, I can also upload a zip file with all these source files;
- the code started as some helper scripts (which is why all those files 
are mixed with other files);

The multivariate polynomials are stored as data.frames and R's 
aggregate() function is the workhorse: but it proved sufficiently fast 
and the code works well even with polynomials with > 10,000 monomials. I 
have some older Java code which used a TreeMap (sorted map), but I do 
not maintain that code anymore. I was very reserved initially regarding 
the efficiency of the data frame; but it worked well! And it proved very 
useful for sub-setting specific monomials!

I have attached some concrete examples below.

Sincerely,

Leonard


### Examples

source("Polynomials.Helper.R")
# - requires also the other Helper scripts;
# - not strictly needed (but are loaded automatically):
#?? library(polynom)
#?? library(pracma)

### Example 1:
n = 2; # Power "n" will be evaluated automatically
p1 = toPoly.pm("x^n*y + b*z - R")
p2 = toPoly.pm("y^n*z + b*x - R")
p3 = toPoly.pm("z^n*x + b*y - R")

pR = solve.lpm(p1, p2, p3, xn=c("z", "y"))
str(pR) # 124 monomials
# tweaking manually can improve the results;
pR = solve.lpm(p1, p2, p3, xn=c("y", "z"))
str(pR)
# pR[[2]]$Rez: 19 monomials: much better;

pR2 = div.pm(pR[[2]]$Rez, "x^3 + b*x - R", "x")
# Divisible!
str(pR2)
# Order 12 polynomial in x (24 monomials);

### Note:
# - the P[12] contains the distinct roots:
#?? it is the minimal order polynomial;
# - the trivial solution (x^3 + b*x = R) was removed;
# - this is the naive way to solve this system (but good as Demo);

# print the coefficients of x;
# (will be used inside the function coeff.S3Ht below)
pR2 = pR2$Rez;
pR2$coeff = - pR2$coeff; # positive leading coeff;
toCoeff(pR2, "x")

### Quick Check
solve.S3Ht = function(R, b) {
 ?? ?coeff = coeff.S3Ht(R, b);
 ?? ?x = roots(coeff); # library(pracma)
 ?? ?# Note: pracma uses leading to free coeff;
 ?? ?z = b*x^11 - R*x^10 - 2*R^2*b*x^5 + 2*R^2*b^2*x^3 + R*b^4*x^2 - R*b^5;
 ?? ?z = z / (- R^2*x^6 - R*b^2*x^5 + 3*R*b^3*x^3 - b^6);
 ?? ?y = (R - z^2*x) / b;
 ?? ?sol = cbind(x, y, z);
 ?? ?return(sol);
}
coeff.S3Ht = function(R, b) {
 ?? ?coeff = c(b^2, - 2*R*b, R^2 - b^3, 3*R*b^2,
 ?? ???? - 3*R^2*b + b^4, R^3 - 4*R*b^3,
 ?? ???? 2*R^2*b^2 - b^5, 5*R*b^4,
 ?? ???? R^4 - R^2*b^3 + b^6, - 3*R^3*b^2 - 3*R*b^5,
 ?? ???? - R^4*b + 3*R^2*b^4 - b^7,
 ?? ???? 2*R^3*b^3 - R*b^6,
 ?? ???? - R^2*b^5 + b^8);
 ?? ?return(coeff);
}

R = 5; b = -2;
sol = solve.S3Ht(R, b)
# all 12 sets of solutions:
x = sol[,1]; y = sol[,2]; z = sol[,3];

### Test:
x^2*y + b*z
y^2*z + b*x
z^2*x + b*y

id = 1;
eval.pm(p1, list(x=x[id], y=y[id], z=z[id], b=b, R=R))


##############

### Example 2:

n = 5
p1 = toPoly.pm("(x + a)^n + (y + a)^n - R1")
p2 = toPoly.pm("(x + b)*(y + b) - R2")

# Very Naive way to solve:
pR = solve.pm(p1, p2, "y")
str(pR)
table(pR$Rez$x)
# Order 10 with 109 monomials;
# [very naive!]


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Mon Oct  3 07:47:41 2022
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Mon, 3 Oct 2022 06:47:41 +0100
Subject: [R] Creating a year-month indicator and groupby with category
In-Reply-To: <CAFy_oHDGR7cnNwcTW3mNknKvHhRz+LC4v4XSeKrKEOUjMTcsmA@mail.gmail.com>
References: <CAFy_oHDGR7cnNwcTW3mNknKvHhRz+LC4v4XSeKrKEOUjMTcsmA@mail.gmail.com>
Message-ID: <3a22c0a7-3459-3982-0ff1-cd5df22b842a@sapo.pt>

Hello,

First of all, I'll repost the data at end because the OP posted with a 
pointer ref:

problems = <pointer: 0x7fd732028680>

and this must be removed for the dput output to run.
Suggestion: coerce to class "data.frame" and post the output of


dput(as.data.frame(dat))


Now the plot.
Here are two plots of share by date, grouped by company. One with base R 
graphics and the other one with package ggplot2.

Create a date/time column to be used by both plots.


dat$date <- with(dat, ISOdate(year, month, 1))


1) Base R plot.


ylim <- range(dat$share) + c(0, 2)  # make room for the legend on top
comp <- unique(dat$company)         # draw each line in a loop on companies

# open a blank plot witth all the data,
# setting the ylim as explained above
plot(share ~ date, dat, type = "n", ylim = ylim)
for(i in seq_along(comp)) {
   lines(share ~ date, subset(dat, company == comp[i]), col = i)
}
legend("top", legend = comp, col = seq_along(comp), lty = "solid", horiz 
= TRUE)


2) ggplot2 plot.


library(ggplot2)

ggplot(dat, aes(date, share, color = company)) +
   geom_line() +
   scale_x_datetime(date_labels = "%Y-%m") +
   scale_color_manual(values = c(ABC = "black", FGH = "red")) +
   theme_bw()


3) The data, reposted with the new pipe operator introduced in R 4.1.0 
to make it look modern and slightly edited.


dat |> as.data.frame() |> dput()
dat <-
structure(list(year = c(2018, 2019, 2019, 2019, 2019, 2019, 2019,
2019, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017,
2017, 2017, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018,
2018, 2018, 2018, 2019, 2019, 2019, 2019, 2019), month = c(12,
1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1,
2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5), company = c("ABC",
"ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "FGH", "FGH",
"FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
"FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
"FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH"
), share = c(20, 16.5, 15, 15.5, 15.5, 16, 17, 16.5, 61, 55,
53, 53, 54, 53, 58, 54, 50, 47, 55, 50, 52, 51, 51.5, 52, 53,
54, 55, 53, 54, 50, 42, 48, 41, 40, 39, 36.5, 35), com_name = c(1,
1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2), date = 
structure(c(1543665600,
1546344000, 1549022400, 1551441600, 1554120000, 1556712000, 1559390400,
1561982400, 1483272000, 1485950400, 1488369600, 1491048000, 1493640000,
1496318400, 1498910400, 1501588800, 1504267200, 1506859200, 1509537600,
1512129600, 1514808000, 1517486400, 1519905600, 1522584000, 1525176000,
1527854400, 1530446400, 1533124800, 1535803200, 1538395200, 1541073600,
1543665600, 1546344000, 1549022400, 1551441600, 1554120000, 1556712000
), class = c("POSIXct", "POSIXt"), tzone = "GMT")),
row.names = c(NA, -37L), class = "data.frame")


Hope this helps,

Rui Barradas

?s 00:04 de 03/10/2022, Tariq Khasiri escreveu:
> Hello,
> 
> I have the following data. I want to show in a line plot how each different
> company is earning over the timeline of my data sample.
> 
> I'm not sure how I can create the *year-month indicator* to plot it nicely
> in my horizontal axis out of my dataset.
> 
> After creating the *year-month* indicator ( which will be in my x axis) I
> want to create a dataframe where I can groupby companies over the
> year-month indicator by putting *share *in the y axis as variables.
> 
> ### data is like the following
> 
> dput(dat)
> structure(list(year = c(2018, 2019, 2019, 2019, 2019, 2019, 2019,
> 2019, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017,
> 2017, 2017, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018,
> 2018, 2018, 2018, 2019, 2019, 2019, 2019, 2019), month = c(12,
> 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1,
> 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5), company = c("ABC",
> "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "FGH", "FGH",
> "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
> "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
> "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH"
> ), share = c(20, 16.5, 15, 15.5, 15.5, 16, 17, 16.5, 61, 55,
> 53, 53, 54, 53, 58, 54, 50, 47, 55, 50, 52, 51, 51.5, 52, 53,
> 54, 55, 53, 54, 50, 42, 48, 41, 40, 39, 36.5, 35), com_name = c(1,
> 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
> 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2)), row.names = c(NA,
> -37L), spec = structure(list(cols = list(year = structure(list(), class =
> c("collector_double",
> "collector")), month = structure(list(), class = c("collector_double",
> "collector")), company = structure(list(), class = c("collector_character",
> "collector")), share = structure(list(), class = c("collector_double",
> "collector")), com_name = structure(list(), class = c("collector_double",
> "collector"))), default = structure(list(), class = c("collector_guess",
> "collector")), delim = ","), class = "col_spec"), problems = <pointer:
> 0x7fd732028680>, class = c("spec_tbl_df",
> "tbl_df", "tbl", "data.frame"))
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From drj|m|emon @end|ng |rom gm@||@com  Mon Oct  3 09:45:40 2022
From: drj|m|emon @end|ng |rom gm@||@com (Jim Lemon)
Date: Mon, 3 Oct 2022 18:45:40 +1100
Subject: [R] Creating a year-month indicator and groupby with category
In-Reply-To: <CAFy_oHDGR7cnNwcTW3mNknKvHhRz+LC4v4XSeKrKEOUjMTcsmA@mail.gmail.com>
References: <CAFy_oHDGR7cnNwcTW3mNknKvHhRz+LC4v4XSeKrKEOUjMTcsmA@mail.gmail.com>
Message-ID: <CA+8X3fUzVS1zKi0BaJoq2ZJC0cgXgPj_rXFNq9vVBpo7HCXojA@mail.gmail.com>

Hi Tariq,
There were a couple of glitches in your data structure. Here's an
example of a simple plot:

dat<-structure(list(year = c(2018, 2019, 2019, 2019, 2019, 2019, 2019,
2019, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017,
2017, 2017, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018,
2018, 2018, 2018, 2019, 2019, 2019, 2019, 2019), month = c(12,
1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1,
2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5), company = c("ABC",
"ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "FGH", "FGH",
"FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
"FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
"FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH"
), share = c(20, 16.5, 15, 15.5, 15.5, 16, 17, 16.5, 61, 55,
53, 53, 54, 53, 58, 54, 50, 47, 55, 50, 52, 51, 51.5, 52, 53,
54, 55, 53, 54, 50, 42, 48, 41, 40, 39, 36.5, 35), com_name = c(1,
1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2)), row.names = c(NA,
-37L), spec = structure(list(cols = list(year = structure(list(), class =
c("collector_double",
"collector")), month = structure(list(), class = c("collector_double",
"collector")), company = structure(list(), class = c("collector_character",
"collector")), share = structure(list(), class = c("collector_double",
"collector")), com_name = structure(list(), class = c("collector_double",
"collector"))), default = structure(list(), class = c("collector_guess",
"collector")), delim = ","), class = "col_spec"), class = c("spec_tbl_df",
"tbl_df", "tbl", "data.frame"))
# convert year and month fields to dates about the middle of each month
dat$date<-as.Date(paste(dat$year,dat$month,15,sep="-"),"%Y-%m-%d")
# plot the values for one company
plot(dat$date[dat$company=="ABC"],dat$share[dat$company=="ABC"],
 main="Plot of dat",xlab="Year",ylab="Share",
 xlim=range(dat$date),ylim=range(dat$share),
 type="l",col="red")
# add a line for the other one
lines(dat$date[dat$company=="FGH"],dat$share[dat$company=="FGH"],col="green")
# get the x plot limits as they are date values
xspan<-par("usr")[1:2]
# place a legend about in the middle of the plot
legend(xspan[1]+diff(xspan)*0.3,35,c("ABC","FGH"),lty=1,col=c("red","green"))

There are many more elegant ways to plot something like this.

Jim

On Mon, Oct 3, 2022 at 10:05 AM Tariq Khasiri <tariqkhasiri at gmail.com> wrote:
>
> Hello,
>
> I have the following data. I want to show in a line plot how each different
> company is earning over the timeline of my data sample.
>
> I'm not sure how I can create the *year-month indicator* to plot it nicely
> in my horizontal axis out of my dataset.
>
> After creating the *year-month* indicator ( which will be in my x axis) I
> want to create a dataframe where I can groupby companies over the
> year-month indicator by putting *share *in the y axis as variables.
>
> ### data is like the following
>
> dput(dat)
> structure(list(year = c(2018, 2019, 2019, 2019, 2019, 2019, 2019,
> 2019, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017,
> 2017, 2017, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018,
> 2018, 2018, 2018, 2019, 2019, 2019, 2019, 2019), month = c(12,
> 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1,
> 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5), company = c("ABC",
> "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "FGH", "FGH",
> "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
> "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
> "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH"
> ), share = c(20, 16.5, 15, 15.5, 15.5, 16, 17, 16.5, 61, 55,
> 53, 53, 54, 53, 58, 54, 50, 47, 55, 50, 52, 51, 51.5, 52, 53,
> 54, 55, 53, 54, 50, 42, 48, 41, 40, 39, 36.5, 35), com_name = c(1,
> 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
> 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2)), row.names = c(NA,
> -37L), spec = structure(list(cols = list(year = structure(list(), class =
> c("collector_double",
> "collector")), month = structure(list(), class = c("collector_double",
> "collector")), company = structure(list(), class = c("collector_character",
> "collector")), share = structure(list(), class = c("collector_double",
> "collector")), com_name = structure(list(), class = c("collector_double",
> "collector"))), default = structure(list(), class = c("collector_guess",
> "collector")), delim = ","), class = "col_spec"), problems = <pointer:
> 0x7fd732028680>, class = c("spec_tbl_df",
> "tbl_df", "tbl", "data.frame"))
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From y@ngk@|9999 @end|ng |rom y@hoo@com  Mon Oct  3 17:51:04 2022
From: y@ngk@|9999 @end|ng |rom y@hoo@com (Kai Yang)
Date: Mon, 3 Oct 2022 15:51:04 +0000 (UTC)
Subject: [R] automatic convert list to dataframe
References: <667635225.2169008.1664812264411.ref@mail.yahoo.com>
Message-ID: <667635225.2169008.1664812264411@mail.yahoo.com>

Hi R team,
I can use rio package to read excel file into R as a list. The excel file content multiple sheets (30 - 40 data sheets). I can convert each data elements into dataframe manually. I have multiple excel files with multiple data sheets. I need to load them into R and do the comparison for same sheet name from difference excel file. My current code is:
 library(rio)? ?setwd ("C:/temp")
filenames <- gsub("\\.xlsx$","", list.files(pattern="\\.xlsx$"))
for(i in filenames){
? assign(i, import_list(paste0(i, ".xlsx", sep="")))
}
file1_dx1? ? ?<-? file1[["dx1"]]

file1_dx2? ? ?<-? file1[["dx2"]]

file1_dx3? ? ?<-? file1[["dx3"]]

file2_dx1? ? ?<-? file1[["dx1"]]

file2_dx2? ? ?<-? file1[["dx2"]]
......

I hope the code can?automatic converting the list (may have 30 - 40 lists) by adding file name (such as: filename_sheetname) and put it in for loop


Thank you,
Kai




	[[alternative HTML version deleted]]


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Mon Oct  3 19:14:19 2022
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Mon, 3 Oct 2022 18:14:19 +0100
Subject: [R] automatic convert list to dataframe
In-Reply-To: <667635225.2169008.1664812264411@mail.yahoo.com>
References: <667635225.2169008.1664812264411.ref@mail.yahoo.com>
 <667635225.2169008.1664812264411@mail.yahoo.com>
Message-ID: <ddf82083-4b7e-24d6-e31e-2c868004f391@sapo.pt>

Hello,


list2env(file1, envir = .GlobalEnv)


will create data.frames dx1, dx2, etc, in the global environment.
If you really need the names file1_dx1, file1_dx2, etc, you can first 
change the names


names(file1) <- paste("file1", names(file1), sep = "_")


and then run list2env like above.

Hope this helps,

Rui Barradas

?s 16:51 de 03/10/2022, Kai Yang via R-help escreveu:
> Hi R team,
> I can use rio package to read excel file into R as a list. The excel file content multiple sheets (30 - 40 data sheets). I can convert each data elements into dataframe manually. I have multiple excel files with multiple data sheets. I need to load them into R and do the comparison for same sheet name from difference excel file. My current code is:
>   library(rio)? ?setwd ("C:/temp")
> filenames <- gsub("\\.xlsx$","", list.files(pattern="\\.xlsx$"))
> for(i in filenames){
>  ? assign(i, import_list(paste0(i, ".xlsx", sep="")))
> }
> file1_dx1? ? ?<-? file1[["dx1"]]
> 
> file1_dx2? ? ?<-? file1[["dx2"]]
> 
> file1_dx3? ? ?<-? file1[["dx3"]]
> 
> file2_dx1? ? ?<-? file1[["dx1"]]
> 
> file2_dx2? ? ?<-? file1[["dx2"]]
> ......
> 
> I hope the code can?automatic converting the list (may have 30 - 40 lists) by adding file name (such as: filename_sheetname) and put it in for loop
> 
> 
> Thank you,
> Kai
> 
> 
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From y@ngk@|9999 @end|ng |rom y@hoo@com  Mon Oct  3 19:38:43 2022
From: y@ngk@|9999 @end|ng |rom y@hoo@com (Kai Yang)
Date: Mon, 3 Oct 2022 17:38:43 +0000 (UTC)
Subject: [R] automatic convert list to dataframe
In-Reply-To: <ddf82083-4b7e-24d6-e31e-2c868004f391@sapo.pt>
References: <667635225.2169008.1664812264411.ref@mail.yahoo.com>
 <667635225.2169008.1664812264411@mail.yahoo.com>
 <ddf82083-4b7e-24d6-e31e-2c868004f391@sapo.pt>
Message-ID: <1293770278.2201006.1664818723656@mail.yahoo.com>

 Hi Rui,
list2env(file1, envir = .GlobalEnv) is worked very well. Thank you.

But when?I tried to put the sample code? into for loop. I got error message:
for(i in filenames){
? assign(i, import_list(paste0(i, ".xlsx", sep="")))
? names(i) <- paste(i, names(i), sep = "_")
? list2env(names(i), envir = .GlobalEnv)
}
Error in list2env(names(i), envir = .GlobalEnv) :?? first argument must be a named list

It seems I cannot put names(i) into for loop,?Could you please help me to debug it?
Thank you,Kai    On Monday, October 3, 2022 at 10:14:25 AM PDT, Rui Barradas <ruipbarradas at sapo.pt> wrote:  
 
 Hello,


list2env(file1, envir = .GlobalEnv)


will create data.frames dx1, dx2, etc, in the global environment.
If you really need the names file1_dx1, file1_dx2, etc, you can first 
change the names


names(file1) <- paste("file1", names(file1), sep = "_")


and then run list2env like above.

Hope this helps,

Rui Barradas

?s 16:51 de 03/10/2022, Kai Yang via R-help escreveu:
> Hi R team,
> I can use rio package to read excel file into R as a list. The excel file content multiple sheets (30 - 40 data sheets). I can convert each data elements into dataframe manually. I have multiple excel files with multiple data sheets. I need to load them into R and do the comparison for same sheet name from difference excel file. My current code is:
>? library(rio)? ?setwd ("C:/temp")
> filenames <- gsub("\\.xlsx$","", list.files(pattern="\\.xlsx$"))
> for(i in filenames){
>? ? assign(i, import_list(paste0(i, ".xlsx", sep="")))
> }
> file1_dx1? ? ?<-? file1[["dx1"]]
> 
> file1_dx2? ? ?<-? file1[["dx2"]]
> 
> file1_dx3? ? ?<-? file1[["dx3"]]
> 
> file2_dx1? ? ?<-? file1[["dx1"]]
> 
> file2_dx2? ? ?<-? file1[["dx2"]]
> ......
> 
> I hope the code can?automatic converting the list (may have 30 - 40 lists) by adding file name (such as: filename_sheetname) and put it in for loop
> 
> 
> Thank you,
> Kai
> 
> 
> 
> 
> ??? [[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
  
	[[alternative HTML version deleted]]


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Mon Oct  3 21:08:57 2022
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Mon, 3 Oct 2022 20:08:57 +0100
Subject: [R] automatic convert list to dataframe
In-Reply-To: <1293770278.2201006.1664818723656@mail.yahoo.com>
References: <667635225.2169008.1664812264411.ref@mail.yahoo.com>
 <667635225.2169008.1664812264411@mail.yahoo.com>
 <ddf82083-4b7e-24d6-e31e-2c868004f391@sapo.pt>
 <1293770278.2201006.1664818723656@mail.yahoo.com>
Message-ID: <4a102d90-352b-9c07-a83d-7dc9c3054be3@sapo.pt>

Hello,

If in each iteration i is a list, try removing the call to names().
Try, in the loop,


list2env(i, envir = .GlobalEnv)


The error message is telling that list2env's first argument must be a 
named list and names(i) is an unnamed vector, it's i that's the named 
list (you even changed its names in the previous instruction).

Hope this helps,

Rui Barradas

?s 18:38 de 03/10/2022, Kai Yang escreveu:
>   Hi Rui,
> list2env(file1, envir = .GlobalEnv) is worked very well. Thank you.
> 
> But when?I tried to put the sample code? into for loop. I got error message:
> for(i in filenames){
>  ? assign(i, import_list(paste0(i, ".xlsx", sep="")))
>  ? names(i) <- paste(i, names(i), sep = "_")
>  ? list2env(names(i), envir = .GlobalEnv)
> }
> Error in list2env(names(i), envir = .GlobalEnv) :?? first argument must be a named list
> 
> It seems I cannot put names(i) into for loop,?Could you please help me to debug it?
> Thank you,Kai    On Monday, October 3, 2022 at 10:14:25 AM PDT, Rui Barradas <ruipbarradas at sapo.pt> wrote:
>   
>   Hello,
> 
> 
> list2env(file1, envir = .GlobalEnv)
> 
> 
> will create data.frames dx1, dx2, etc, in the global environment.
> If you really need the names file1_dx1, file1_dx2, etc, you can first
> change the names
> 
> 
> names(file1) <- paste("file1", names(file1), sep = "_")
> 
> 
> and then run list2env like above.
> 
> Hope this helps,
> 
> Rui Barradas
> 
> ?s 16:51 de 03/10/2022, Kai Yang via R-help escreveu:
>> Hi R team,
>> I can use rio package to read excel file into R as a list. The excel file content multiple sheets (30 - 40 data sheets). I can convert each data elements into dataframe manually. I have multiple excel files with multiple data sheets. I need to load them into R and do the comparison for same sheet name from difference excel file. My current code is:
>>  ? library(rio)? ?setwd ("C:/temp")
>> filenames <- gsub("\\.xlsx$","", list.files(pattern="\\.xlsx$"))
>> for(i in filenames){
>>  ? ? assign(i, import_list(paste0(i, ".xlsx", sep="")))
>> }
>> file1_dx1? ? ?<-? file1[["dx1"]]
>>
>> file1_dx2? ? ?<-? file1[["dx2"]]
>>
>> file1_dx3? ? ?<-? file1[["dx3"]]
>>
>> file2_dx1? ? ?<-? file1[["dx1"]]
>>
>> file2_dx2? ? ?<-? file1[["dx2"]]
>> ......
>>
>> I hope the code can?automatic converting the list (may have 30 - 40 lists) by adding file name (such as: filename_sheetname) and put it in for loop
>>
>>
>> Thank you,
>> Kai
>>
>>
>>
>>
>>  ??? [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
>


From y@ngk@|9999 @end|ng |rom y@hoo@com  Mon Oct  3 21:51:11 2022
From: y@ngk@|9999 @end|ng |rom y@hoo@com (Kai Yang)
Date: Mon, 3 Oct 2022 19:51:11 +0000 (UTC)
Subject: [R] automatic convert list to dataframe
In-Reply-To: <4a102d90-352b-9c07-a83d-7dc9c3054be3@sapo.pt>
References: <667635225.2169008.1664812264411.ref@mail.yahoo.com>
 <667635225.2169008.1664812264411@mail.yahoo.com>
 <ddf82083-4b7e-24d6-e31e-2c868004f391@sapo.pt>
 <1293770278.2201006.1664818723656@mail.yahoo.com>
 <4a102d90-352b-9c07-a83d-7dc9c3054be3@sapo.pt>
Message-ID: <97481848.2244592.1664826671871@mail.yahoo.com>

 Hi Rui,
I copied "list2env(i, envir = .GlobalEnv)" to the code, but I got the same error message of "first argument must be a named list". Maybe list2env cannot put in loop? the code works very well outside of for loop.
One more thing, the difference file may have same sheet name. that's why I want to add file name in front of sheet name to avoid overwriting. It still works well outside of loop, but doesn't work in loop. I don't know how to fix the problems.
Thank you,
Kai

    On Monday, October 3, 2022 at 12:09:04 PM PDT, Rui Barradas <ruipbarradas at sapo.pt> wrote:  
 
 Hello,

If in each iteration i is a list, try removing the call to names().
Try, in the loop,


list2env(i, envir = .GlobalEnv)


The error message is telling that list2env's first argument must be a 
named list and names(i) is an unnamed vector, it's i that's the named 
list (you even changed its names in the previous instruction).

Hope this helps,

Rui Barradas

?s 18:38 de 03/10/2022, Kai Yang escreveu:
>? Hi Rui,
> list2env(file1, envir = .GlobalEnv) is worked very well. Thank you.
> 
> But when?I tried to put the sample code? into for loop. I got error message:
> for(i in filenames){
>? ? assign(i, import_list(paste0(i, ".xlsx", sep="")))
>? ? names(i) <- paste(i, names(i), sep = "_")
>? ? list2env(names(i), envir = .GlobalEnv)
> }
> Error in list2env(names(i), envir = .GlobalEnv) :?? first argument must be a named list
> 
> It seems I cannot put names(i) into for loop,?Could you please help me to debug it?
> Thank you,Kai? ? On Monday, October 3, 2022 at 10:14:25 AM PDT, Rui Barradas <ruipbarradas at sapo.pt> wrote:
>? 
>? Hello,
> 
> 
> list2env(file1, envir = .GlobalEnv)
> 
> 
> will create data.frames dx1, dx2, etc, in the global environment.
> If you really need the names file1_dx1, file1_dx2, etc, you can first
> change the names
> 
> 
> names(file1) <- paste("file1", names(file1), sep = "_")
> 
> 
> and then run list2env like above.
> 
> Hope this helps,
> 
> Rui Barradas
> 
> ?s 16:51 de 03/10/2022, Kai Yang via R-help escreveu:
>> Hi R team,
>> I can use rio package to read excel file into R as a list. The excel file content multiple sheets (30 - 40 data sheets). I can convert each data elements into dataframe manually. I have multiple excel files with multiple data sheets. I need to load them into R and do the comparison for same sheet name from difference excel file. My current code is:
>>? ? library(rio)? ?setwd ("C:/temp")
>> filenames <- gsub("\\.xlsx$","", list.files(pattern="\\.xlsx$"))
>> for(i in filenames){
>>? ? ? assign(i, import_list(paste0(i, ".xlsx", sep="")))
>> }
>> file1_dx1? ? ?<-? file1[["dx1"]]
>>
>> file1_dx2? ? ?<-? file1[["dx2"]]
>>
>> file1_dx3? ? ?<-? file1[["dx3"]]
>>
>> file2_dx1? ? ?<-? file1[["dx1"]]
>>
>> file2_dx2? ? ?<-? file1[["dx2"]]
>> ......
>>
>> I hope the code can?automatic converting the list (may have 30 - 40 lists) by adding file name (such as: filename_sheetname) and put it in for loop
>>
>>
>> Thank you,
>> Kai
>>
>>
>>
>>
>>? ??? [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
>? ? 
  
	[[alternative HTML version deleted]]


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Tue Oct  4 00:04:12 2022
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Mon, 3 Oct 2022 23:04:12 +0100
Subject: [R] automatic convert list to dataframe
In-Reply-To: <97481848.2244592.1664826671871@mail.yahoo.com>
References: <667635225.2169008.1664812264411.ref@mail.yahoo.com>
 <667635225.2169008.1664812264411@mail.yahoo.com>
 <ddf82083-4b7e-24d6-e31e-2c868004f391@sapo.pt>
 <1293770278.2201006.1664818723656@mail.yahoo.com>
 <4a102d90-352b-9c07-a83d-7dc9c3054be3@sapo.pt>
 <97481848.2244592.1664826671871@mail.yahoo.com>
Message-ID: <9ce3b94f-6533-5ecb-bc35-584d6877526a@sapo.pt>

Hello,

Here are two more attempts at solving the problem.

1. Instead of having 30-40 data.frames per file in the globalenv, not a 
good idea, the following code will create as many lists as you have 
files and each list is a list of df's.


temp_list <- vector("list", length = length(filenames))
for(i in seq_along(filenames)){
   xlfile <- filenames[i]
   temp_list[[i]] <- import_list(paste0(xlfile, ".xlsx"))
}
list2env(temp_list, envir = .GlobalEnv)
rm(temp_list)

Now you can access the data with code like


file1$dx1       # a data.frame, first sheet in excel file1
file1[["dx1"]]  # equivalent


2. I cannot see a reason why the following shouldn't work. It creates 
lots of data.frames in the globalenv, 30-40 per file. This makes the 
globalenv messy and is not recommended.


temp_list <- vector("list", length = length(filenames))
for(i in seq_along(filenames)){
   # import the data
   xlfile <- filenames[i]
   temp_list[[i]] <- import_list(paste0(xlfile, ".xlsx"))
   # now take care of the names
   new_names <- paste(xlfile, names(temp_list[[i]]), sep = "_")
   names(temp_list[[i]]) <- new_names
   # create the current data.frames in the globalenv
   list2env(temp_list[[i]], envir = .GlobalEnv)
}
rm(temp_list)


Hope this helps,

Rui Barradas


?s 20:51 de 03/10/2022, Kai Yang escreveu:
>   Hi Rui,
> I copied "list2env(i, envir = .GlobalEnv)" to the code, but I got the same error message of "first argument must be a named list". Maybe list2env cannot put in loop? the code works very well outside of for loop.
> One more thing, the difference file may have same sheet name. that's why I want to add file name in front of sheet name to avoid overwriting. It still works well outside of loop, but doesn't work in loop. I don't know how to fix the problems.
> Thank you,
> Kai
> 
>      On Monday, October 3, 2022 at 12:09:04 PM PDT, Rui Barradas <ruipbarradas at sapo.pt> wrote:
>   
>   Hello,
> 
> If in each iteration i is a list, try removing the call to names().
> Try, in the loop,
> 
> 
> list2env(i, envir = .GlobalEnv)
> 
> 
> The error message is telling that list2env's first argument must be a
> named list and names(i) is an unnamed vector, it's i that's the named
> list (you even changed its names in the previous instruction).
> 
> Hope this helps,
> 
> Rui Barradas
> 
> ?s 18:38 de 03/10/2022, Kai Yang escreveu:
>>  ? Hi Rui,
>> list2env(file1, envir = .GlobalEnv) is worked very well. Thank you.
>>
>> But when?I tried to put the sample code? into for loop. I got error message:
>> for(i in filenames){
>>  ? ? assign(i, import_list(paste0(i, ".xlsx", sep="")))
>>  ? ? names(i) <- paste(i, names(i), sep = "_")
>>  ? ? list2env(names(i), envir = .GlobalEnv)
>> }
>> Error in list2env(names(i), envir = .GlobalEnv) :?? first argument must be a named list
>>
>> It seems I cannot put names(i) into for loop,?Could you please help me to debug it?
>> Thank you,Kai? ? On Monday, October 3, 2022 at 10:14:25 AM PDT, Rui Barradas <ruipbarradas at sapo.pt> wrote:
>>    
>>  ? Hello,
>>
>>
>> list2env(file1, envir = .GlobalEnv)
>>
>>
>> will create data.frames dx1, dx2, etc, in the global environment.
>> If you really need the names file1_dx1, file1_dx2, etc, you can first
>> change the names
>>
>>
>> names(file1) <- paste("file1", names(file1), sep = "_")
>>
>>
>> and then run list2env like above.
>>
>> Hope this helps,
>>
>> Rui Barradas
>>
>> ?s 16:51 de 03/10/2022, Kai Yang via R-help escreveu:
>>> Hi R team,
>>> I can use rio package to read excel file into R as a list. The excel file content multiple sheets (30 - 40 data sheets). I can convert each data elements into dataframe manually. I have multiple excel files with multiple data sheets. I need to load them into R and do the comparison for same sheet name from difference excel file. My current code is:
>>>  ? ? library(rio)? ?setwd ("C:/temp")
>>> filenames <- gsub("\\.xlsx$","", list.files(pattern="\\.xlsx$"))
>>> for(i in filenames){
>>>  ? ? ? assign(i, import_list(paste0(i, ".xlsx", sep="")))
>>> }
>>> file1_dx1? ? ?<-? file1[["dx1"]]
>>>
>>> file1_dx2? ? ?<-? file1[["dx2"]]
>>>
>>> file1_dx3? ? ?<-? file1[["dx3"]]
>>>
>>> file2_dx1? ? ?<-? file1[["dx1"]]
>>>
>>> file2_dx2? ? ?<-? file1[["dx2"]]
>>> ......
>>>
>>> I hope the code can?automatic converting the list (may have 30 - 40 lists) by adding file name (such as: filename_sheetname) and put it in for loop
>>>
>>>
>>> Thank you,
>>> Kai
>>>
>>>
>>>
>>>
>>>  ? ??? [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>>> and provide commented, minimal, self-contained, reproducible code.
>>      
>


From t@r|qkh@@|r| @end|ng |rom gm@||@com  Tue Oct  4 00:30:46 2022
From: t@r|qkh@@|r| @end|ng |rom gm@||@com (Tariq Khasiri)
Date: Mon, 3 Oct 2022 17:30:46 -0500
Subject: [R] Creating a year-month indicator and groupby with category
In-Reply-To: <CA+8X3fUzVS1zKi0BaJoq2ZJC0cgXgPj_rXFNq9vVBpo7HCXojA@mail.gmail.com>
References: <CAFy_oHDGR7cnNwcTW3mNknKvHhRz+LC4v4XSeKrKEOUjMTcsmA@mail.gmail.com>
 <CA+8X3fUzVS1zKi0BaJoq2ZJC0cgXgPj_rXFNq9vVBpo7HCXojA@mail.gmail.com>
Message-ID: <CAFy_oHDaT-a=G_PrE768Xhk56MA3JwSqWOYGvogtDoQfF6F7+Q@mail.gmail.com>

Thanks everyone for being so kind and patient with me throughout the
process! Mr. Barradas and Mr. Lemon, very generous of you for taking the
time and patience to go over my code and data , and taking the time to give
me meaningful feedback!

With your help and suggestion, I was successful in making a graph from my
data. In my main data I have four companies, and just making the graph
process a little more advanced. However after writing the command , I get
the error that I have 4 values but gave only 2 values. Would anyone kindly
guide me what's the mistake and how I can rectify this?

Data is the same. But my main data has 4 companies whereas in R project I
just gave 2 only for convenience.

#### Code needed to execute it #########

library(tidyverse)
library(showtext)
library(usefunc)
library(patchwork)
library(cowplot)
library(rcartocolor)
library(zoo)

# load fonts
font_add_google(name = "Bungee Shade", family = "bungee")
font_add_google(name = "Dosis", family = "dosis")
showtext_auto()

# set colours
f_cols = c("#008080", "#329999", "#66b2b2",
           "#7fbfbf", "#99cccc", "#cce5e5")
m_cols = c("#4b0082", "#6e329b", "#9366b4",
           "#a57fc0", "#b799cd", "#dbcce6")

dat$YearMonth <- as.yearmon(paste(dat$year, " ", dat$month), "%Y %m")

# plot of share of companies per year
p1 <- ggplot(data = dat,
             mapping = aes(x = YearMonth, y = share, colour = company)) +
  geom_line() +
  geom_point(size = 1) +
  scale_colour_manual("", values = c(f_cols[1], m_cols[1]), labels = c("F",
"M" , "C" , "G")) +
  scale_y_continuous(limits = c(0, 80)) +
  coord_cartesian(expand = F) +
  labs(x = "Year",
       y = "Share of Companies") +
  theme(legend.position = c(0.1, 0.9),
        legend.title = element_blank(),
        legend.text = element_text(family = "dosis", size = 14),
        panel.background = element_rect(fill = "#FAFAFA", colour =
"#FAFAFA"),
        plot.background = element_rect(fill = "#FAFAFA", colour =
"#FAFAFA"),
        legend.background = element_rect(fill = "transparent", colour =
"transparent"),
        legend.key = element_rect(fill = "transparent", colour =
"transparent"),
        axis.title.y = element_text(margin = margin(0, 20, 0, 0), family =
"dosis"),
        axis.text = element_text(family = "dosis"),
        plot.margin = unit(c(0.5, 0.8, 0.5, 0.5), "cm"),
        panel.grid.major = element_line(colour = "#DEDEDE"),
        panel.grid.minor = element_blank())
p1

The error is saying :

??ggplot2 (local) FUN(X[[i]], ...)
  7.         ??base::unlist(...)
  8.         ??base::lapply(scales$scales, function(scale) scale$map_df(df
= df))
  9.           ??ggplot2 (local) FUN(X[[i]], ...)
 10.             ??scale$map_df(df = df)
 11.               ??ggplot2 (local) f(..., self = self)
 12.                 ??base::lapply(aesthetics, function(j)
self$map(df[[j]]))
 13.                   ??ggplot2 (local) FUN(X[[i]], ...)
 14.                     ??self$map(df[[j]])
 15.                       ??ggplot2 (local) f(..., self = self)
 16.                         ??self$palette(n)
 17.                           ??ggplot2 (local) f(...)
 18.                             ??rlang::abort(glue("Insufficient values
in manual scale. {n} needed but only {length(values)} provided."))

On Mon, 3 Oct 2022 at 02:45, Jim Lemon <drjimlemon at gmail.com> wrote:

> Hi Tariq,
> There were a couple of glitches in your data structure. Here's an
> example of a simple plot:
>
> dat<-structure(list(year = c(2018, 2019, 2019, 2019, 2019, 2019, 2019,
> 2019, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017,
> 2017, 2017, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018,
> 2018, 2018, 2018, 2019, 2019, 2019, 2019, 2019), month = c(12,
> 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1,
> 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5), company = c("ABC",
> "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "FGH", "FGH",
> "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
> "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
> "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH"
> ), share = c(20, 16.5, 15, 15.5, 15.5, 16, 17, 16.5, 61, 55,
> 53, 53, 54, 53, 58, 54, 50, 47, 55, 50, 52, 51, 51.5, 52, 53,
> 54, 55, 53, 54, 50, 42, 48, 41, 40, 39, 36.5, 35), com_name = c(1,
> 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
> 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2)), row.names = c(NA,
> -37L), spec = structure(list(cols = list(year = structure(list(), class =
> c("collector_double",
> "collector")), month = structure(list(), class = c("collector_double",
> "collector")), company = structure(list(), class = c("collector_character",
> "collector")), share = structure(list(), class = c("collector_double",
> "collector")), com_name = structure(list(), class = c("collector_double",
> "collector"))), default = structure(list(), class = c("collector_guess",
> "collector")), delim = ","), class = "col_spec"), class = c("spec_tbl_df",
> "tbl_df", "tbl", "data.frame"))
> # convert year and month fields to dates about the middle of each month
> dat$date<-as.Date(paste(dat$year,dat$month,15,sep="-"),"%Y-%m-%d")
> # plot the values for one company
> plot(dat$date[dat$company=="ABC"],dat$share[dat$company=="ABC"],
>  main="Plot of dat",xlab="Year",ylab="Share",
>  xlim=range(dat$date),ylim=range(dat$share),
>  type="l",col="red")
> # add a line for the other one
>
> lines(dat$date[dat$company=="FGH"],dat$share[dat$company=="FGH"],col="green")
> # get the x plot limits as they are date values
> xspan<-par("usr")[1:2]
> # place a legend about in the middle of the plot
>
> legend(xspan[1]+diff(xspan)*0.3,35,c("ABC","FGH"),lty=1,col=c("red","green"))
>
> There are many more elegant ways to plot something like this.
>
> Jim
>
> On Mon, Oct 3, 2022 at 10:05 AM Tariq Khasiri <tariqkhasiri at gmail.com>
> wrote:
> >
> > Hello,
> >
> > I have the following data. I want to show in a line plot how each
> different
> > company is earning over the timeline of my data sample.
> >
> > I'm not sure how I can create the *year-month indicator* to plot it
> nicely
> > in my horizontal axis out of my dataset.
> >
> > After creating the *year-month* indicator ( which will be in my x axis) I
> > want to create a dataframe where I can groupby companies over the
> > year-month indicator by putting *share *in the y axis as variables.
> >
> > ### data is like the following
> >
> > dput(dat)
> > structure(list(year = c(2018, 2019, 2019, 2019, 2019, 2019, 2019,
> > 2019, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017,
> > 2017, 2017, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018,
> > 2018, 2018, 2018, 2019, 2019, 2019, 2019, 2019), month = c(12,
> > 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1,
> > 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5), company = c("ABC",
> > "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "FGH", "FGH",
> > "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
> > "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
> > "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH"
> > ), share = c(20, 16.5, 15, 15.5, 15.5, 16, 17, 16.5, 61, 55,
> > 53, 53, 54, 53, 58, 54, 50, 47, 55, 50, 52, 51, 51.5, 52, 53,
> > 54, 55, 53, 54, 50, 42, 48, 41, 40, 39, 36.5, 35), com_name = c(1,
> > 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
> > 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2)), row.names = c(NA,
> > -37L), spec = structure(list(cols = list(year = structure(list(), class =
> > c("collector_double",
> > "collector")), month = structure(list(), class = c("collector_double",
> > "collector")), company = structure(list(), class =
> c("collector_character",
> > "collector")), share = structure(list(), class = c("collector_double",
> > "collector")), com_name = structure(list(), class = c("collector_double",
> > "collector"))), default = structure(list(), class = c("collector_guess",
> > "collector")), delim = ","), class = "col_spec"), problems = <pointer:
> > 0x7fd732028680>, class = c("spec_tbl_df",
> > "tbl_df", "tbl", "data.frame"))
> >
> >         [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From bgunter@4567 @end|ng |rom gm@||@com  Tue Oct  4 00:41:34 2022
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Mon, 3 Oct 2022 15:41:34 -0700
Subject: [R] automatic convert list to dataframe
In-Reply-To: <9ce3b94f-6533-5ecb-bc35-584d6877526a@sapo.pt>
References: <667635225.2169008.1664812264411.ref@mail.yahoo.com>
 <667635225.2169008.1664812264411@mail.yahoo.com>
 <ddf82083-4b7e-24d6-e31e-2c868004f391@sapo.pt>
 <1293770278.2201006.1664818723656@mail.yahoo.com>
 <4a102d90-352b-9c07-a83d-7dc9c3054be3@sapo.pt>
 <97481848.2244592.1664826671871@mail.yahoo.com>
 <9ce3b94f-6533-5ecb-bc35-584d6877526a@sapo.pt>
Message-ID: <CAGxFJbT-xm49epvu1cU2cffpD4u1FMaLe=Y031PGg97kTU+aTg@mail.gmail.com>

... But why not dispense with multiple files, name juggling, and
environments by simply putting everything in one list of lists (lists are
recursive structures!):

all_files <- lapply(filenames, function(nm)import_list(nm,...))
names(all_files) <- filenames
## Note: the ... are any optional parameters to import_list() that may be
needed.
## Perhaps none.

all_files will then be a single list, each of whose components is a list of
data frames for all the sheets in the file. I would think that such a list
could easily be accessed and manipulated via list indexing and
*apply-family functions. Just seems like a more straightforward approach to
me (assuming I haven't misunderstood, of course).

Bert




On Mon, Oct 3, 2022 at 3:04 PM Rui Barradas <ruipbarradas at sapo.pt> wrote:

> Hello,
>
> Here are two more attempts at solving the problem.
>
> 1. Instead of having 30-40 data.frames per file in the globalenv, not a
> good idea, the following code will create as many lists as you have
> files and each list is a list of df's.
>
>
> temp_list <- vector("list", length = length(filenames))
> for(i in seq_along(filenames)){
>    xlfile <- filenames[i]
>    temp_list[[i]] <- import_list(paste0(xlfile, ".xlsx"))
> }
> list2env(temp_list, envir = .GlobalEnv)
> rm(temp_list)
>
> Now you can access the data with code like
>
>
> file1$dx1       # a data.frame, first sheet in excel file1
> file1[["dx1"]]  # equivalent
>
>
> 2. I cannot see a reason why the following shouldn't work. It creates
> lots of data.frames in the globalenv, 30-40 per file. This makes the
> globalenv messy and is not recommended.
>
>
> temp_list <- vector("list", length = length(filenames))
> for(i in seq_along(filenames)){
>    # import the data
>    xlfile <- filenames[i]
>    temp_list[[i]] <- import_list(paste0(xlfile, ".xlsx"))
>    # now take care of the names
>    new_names <- paste(xlfile, names(temp_list[[i]]), sep = "_")
>    names(temp_list[[i]]) <- new_names
>    # create the current data.frames in the globalenv
>    list2env(temp_list[[i]], envir = .GlobalEnv)
> }
> rm(temp_list)
>
>
> Hope this helps,
>
> Rui Barradas
>
>
> ?s 20:51 de 03/10/2022, Kai Yang escreveu:
> >   Hi Rui,
> > I copied "list2env(i, envir = .GlobalEnv)" to the code, but I got the
> same error message of "first argument must be a named list". Maybe list2env
> cannot put in loop? the code works very well outside of for loop.
> > One more thing, the difference file may have same sheet name. that's why
> I want to add file name in front of sheet name to avoid overwriting. It
> still works well outside of loop, but doesn't work in loop. I don't know
> how to fix the problems.
> > Thank you,
> > Kai
> >
> >      On Monday, October 3, 2022 at 12:09:04 PM PDT, Rui Barradas <
> ruipbarradas at sapo.pt> wrote:
> >
> >   Hello,
> >
> > If in each iteration i is a list, try removing the call to names().
> > Try, in the loop,
> >
> >
> > list2env(i, envir = .GlobalEnv)
> >
> >
> > The error message is telling that list2env's first argument must be a
> > named list and names(i) is an unnamed vector, it's i that's the named
> > list (you even changed its names in the previous instruction).
> >
> > Hope this helps,
> >
> > Rui Barradas
> >
> > ?s 18:38 de 03/10/2022, Kai Yang escreveu:
> >>    Hi Rui,
> >> list2env(file1, envir = .GlobalEnv) is worked very well. Thank you.
> >>
> >> But when I tried to put the sample code  into for loop. I got error
> message:
> >> for(i in filenames){
> >>      assign(i, import_list(paste0(i, ".xlsx", sep="")))
> >>      names(i) <- paste(i, names(i), sep = "_")
> >>      list2env(names(i), envir = .GlobalEnv)
> >> }
> >> Error in list2env(names(i), envir = .GlobalEnv) :   first argument must
> be a named list
> >>
> >> It seems I cannot put names(i) into for loop, Could you please help me
> to debug it?
> >> Thank you,Kai    On Monday, October 3, 2022 at 10:14:25 AM PDT, Rui
> Barradas <ruipbarradas at sapo.pt> wrote:
> >>
> >>    Hello,
> >>
> >>
> >> list2env(file1, envir = .GlobalEnv)
> >>
> >>
> >> will create data.frames dx1, dx2, etc, in the global environment.
> >> If you really need the names file1_dx1, file1_dx2, etc, you can first
> >> change the names
> >>
> >>
> >> names(file1) <- paste("file1", names(file1), sep = "_")
> >>
> >>
> >> and then run list2env like above.
> >>
> >> Hope this helps,
> >>
> >> Rui Barradas
> >>
> >> ?s 16:51 de 03/10/2022, Kai Yang via R-help escreveu:
> >>> Hi R team,
> >>> I can use rio package to read excel file into R as a list. The excel
> file content multiple sheets (30 - 40 data sheets). I can convert each data
> elements into dataframe manually. I have multiple excel files with multiple
> data sheets. I need to load them into R and do the comparison for same
> sheet name from difference excel file. My current code is:
> >>>      library(rio)   setwd ("C:/temp")
> >>> filenames <- gsub("\\.xlsx$","", list.files(pattern="\\.xlsx$"))
> >>> for(i in filenames){
> >>>        assign(i, import_list(paste0(i, ".xlsx", sep="")))
> >>> }
> >>> file1_dx1     <-  file1[["dx1"]]
> >>>
> >>> file1_dx2     <-  file1[["dx2"]]
> >>>
> >>> file1_dx3     <-  file1[["dx3"]]
> >>>
> >>> file2_dx1     <-  file1[["dx1"]]
> >>>
> >>> file2_dx2     <-  file1[["dx2"]]
> >>> ......
> >>>
> >>> I hope the code can automatic converting the list (may have 30 - 40
> lists) by adding file name (such as: filename_sheetname) and put it in for
> loop
> >>>
> >>>
> >>> Thank you,
> >>> Kai
> >>>
> >>>
> >>>
> >>>
> >>>        [[alternative HTML version deleted]]
> >>>
> >>> ______________________________________________
> >>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> >>> https://stat.ethz.ch/mailman/listinfo/r-help
> >>> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> >>> and provide commented, minimal, self-contained, reproducible code.
> >>
> >
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From y@ngk@|9999 @end|ng |rom y@hoo@com  Tue Oct  4 01:08:14 2022
From: y@ngk@|9999 @end|ng |rom y@hoo@com (Kai Yang)
Date: Mon, 3 Oct 2022 23:08:14 +0000 (UTC)
Subject: [R] automatic convert list to dataframe
In-Reply-To: <CAGxFJbT-xm49epvu1cU2cffpD4u1FMaLe=Y031PGg97kTU+aTg@mail.gmail.com>
References: <667635225.2169008.1664812264411.ref@mail.yahoo.com>
 <667635225.2169008.1664812264411@mail.yahoo.com>
 <ddf82083-4b7e-24d6-e31e-2c868004f391@sapo.pt>
 <1293770278.2201006.1664818723656@mail.yahoo.com>
 <4a102d90-352b-9c07-a83d-7dc9c3054be3@sapo.pt>
 <97481848.2244592.1664826671871@mail.yahoo.com>
 <9ce3b94f-6533-5ecb-bc35-584d6877526a@sapo.pt>
 <CAGxFJbT-xm49epvu1cU2cffpD4u1FMaLe=Y031PGg97kTU+aTg@mail.gmail.com>
Message-ID: <1316789341.2303013.1664838494147@mail.yahoo.com>

 Hello Rui and Bert,
This is a great help! Thank you both!
Here is my job assignment: boss accumulate many years excel reports from same lab. Each report contents multiple data sheets. Those sheets may/may not updated, and some sheets are new. Good news is, the same testing result data will be saved in a data sheet and assign the same sheet name with same fields name, but does not in same file. Boss wants me to get non.duplicate data for difference testing from those excel files. So, I want to load all data into R and assign each data frame name as filename_sheetname. I use the 2nd suggestion from Rui to get this step done! Thanks Rui again. This method save a lot of time for me. Now, I can combine data frames (same _sheetname) together and remove duplicate.
Best,
Kai
    On Monday, October 3, 2022 at 03:41:45 PM PDT, Bert Gunter <bgunter.4567 at gmail.com> wrote:  
 
 ... But why not dispense with multiple files, name juggling, and environments by simply putting everything in one list of lists (lists are recursive structures!):

all_files <- lapply(filenames, function(nm)import_list(nm,...))names(all_files) <- filenames
## Note: the ... are any optional parameters to import_list() that may be needed. 
## Perhaps none.

all_files will then be a single list, each of whose components is a list of data frames for all the sheets in the file. I would think that such a list could easily be accessed and manipulated via list indexing and *apply-family functions. Just seems like a more straightforward approach to me (assuming I haven't misunderstood, of course).
Bert




On Mon, Oct 3, 2022 at 3:04 PM Rui Barradas <ruipbarradas at sapo.pt> wrote:

Hello,

Here are two more attempts at solving the problem.

1. Instead of having 30-40 data.frames per file in the globalenv, not a 
good idea, the following code will create as many lists as you have 
files and each list is a list of df's.


temp_list <- vector("list", length = length(filenames))
for(i in seq_along(filenames)){
? ?xlfile <- filenames[i]
? ?temp_list[[i]] <- import_list(paste0(xlfile, ".xlsx"))
}
list2env(temp_list, envir = .GlobalEnv)
rm(temp_list)

Now you can access the data with code like


file1$dx1? ? ? ?# a data.frame, first sheet in excel file1
file1[["dx1"]]? # equivalent


2. I cannot see a reason why the following shouldn't work. It creates 
lots of data.frames in the globalenv, 30-40 per file. This makes the 
globalenv messy and is not recommended.


temp_list <- vector("list", length = length(filenames))
for(i in seq_along(filenames)){
? ?# import the data
? ?xlfile <- filenames[i]
? ?temp_list[[i]] <- import_list(paste0(xlfile, ".xlsx"))
? ?# now take care of the names
? ?new_names <- paste(xlfile, names(temp_list[[i]]), sep = "_")
? ?names(temp_list[[i]]) <- new_names
? ?# create the current data.frames in the globalenv
? ?list2env(temp_list[[i]], envir = .GlobalEnv)
}
rm(temp_list)


Hope this helps,

Rui Barradas


?s 20:51 de 03/10/2022, Kai Yang escreveu:
>? ?Hi Rui,
> I copied "list2env(i, envir = .GlobalEnv)" to the code, but I got the same error message of "first argument must be a named list". Maybe list2env cannot put in loop? the code works very well outside of for loop.
> One more thing, the difference file may have same sheet name. that's why I want to add file name in front of sheet name to avoid overwriting. It still works well outside of loop, but doesn't work in loop. I don't know how to fix the problems.
> Thank you,
> Kai
> 
>? ? ? On Monday, October 3, 2022 at 12:09:04 PM PDT, Rui Barradas <ruipbarradas at sapo.pt> wrote:
>? ?
>? ?Hello,
> 
> If in each iteration i is a list, try removing the call to names().
> Try, in the loop,
> 
> 
> list2env(i, envir = .GlobalEnv)
> 
> 
> The error message is telling that list2env's first argument must be a
> named list and names(i) is an unnamed vector, it's i that's the named
> list (you even changed its names in the previous instruction).
> 
> Hope this helps,
> 
> Rui Barradas
> 
> ?s 18:38 de 03/10/2022, Kai Yang escreveu:
>>? ? Hi Rui,
>> list2env(file1, envir = .GlobalEnv) is worked very well. Thank you.
>>
>> But when?I tried to put the sample code? into for loop. I got error message:
>> for(i in filenames){
>>? ? ? assign(i, import_list(paste0(i, ".xlsx", sep="")))
>>? ? ? names(i) <- paste(i, names(i), sep = "_")
>>? ? ? list2env(names(i), envir = .GlobalEnv)
>> }
>> Error in list2env(names(i), envir = .GlobalEnv) :?? first argument must be a named list
>>
>> It seems I cannot put names(i) into for loop,?Could you please help me to debug it?
>> Thank you,Kai? ? On Monday, October 3, 2022 at 10:14:25 AM PDT, Rui Barradas <ruipbarradas at sapo.pt> wrote:
>>? ? 
>>? ? Hello,
>>
>>
>> list2env(file1, envir = .GlobalEnv)
>>
>>
>> will create data.frames dx1, dx2, etc, in the global environment.
>> If you really need the names file1_dx1, file1_dx2, etc, you can first
>> change the names
>>
>>
>> names(file1) <- paste("file1", names(file1), sep = "_")
>>
>>
>> and then run list2env like above.
>>
>> Hope this helps,
>>
>> Rui Barradas
>>
>> ?s 16:51 de 03/10/2022, Kai Yang via R-help escreveu:
>>> Hi R team,
>>> I can use rio package to read excel file into R as a list. The excel file content multiple sheets (30 - 40 data sheets). I can convert each data elements into dataframe manually. I have multiple excel files with multiple data sheets. I need to load them into R and do the comparison for same sheet name from difference excel file. My current code is:
>>>? ? ? library(rio)? ?setwd ("C:/temp")
>>> filenames <- gsub("\\.xlsx$","", list.files(pattern="\\.xlsx$"))
>>> for(i in filenames){
>>>? ? ? ? assign(i, import_list(paste0(i, ".xlsx", sep="")))
>>> }
>>> file1_dx1? ? ?<-? file1[["dx1"]]
>>>
>>> file1_dx2? ? ?<-? file1[["dx2"]]
>>>
>>> file1_dx3? ? ?<-? file1[["dx3"]]
>>>
>>> file2_dx1? ? ?<-? file1[["dx1"]]
>>>
>>> file2_dx2? ? ?<-? file1[["dx2"]]
>>> ......
>>>
>>> I hope the code can?automatic converting the list (may have 30 - 40 lists) by adding file name (such as: filename_sheetname) and put it in for loop
>>>
>>>
>>> Thank you,
>>> Kai
>>>
>>>
>>>
>>>
>>>? ? ??? [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>>> and provide commented, minimal, self-contained, reproducible code.
>>? ? ? 
>

______________________________________________
R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
https://stat.ethz.ch/mailman/listinfo/r-help
PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
and provide commented, minimal, self-contained, reproducible code.

  
	[[alternative HTML version deleted]]


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Tue Oct  4 08:23:29 2022
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Tue, 4 Oct 2022 07:23:29 +0100
Subject: [R] Creating a year-month indicator and groupby with category
In-Reply-To: <CAFy_oHDaT-a=G_PrE768Xhk56MA3JwSqWOYGvogtDoQfF6F7+Q@mail.gmail.com>
References: <CAFy_oHDGR7cnNwcTW3mNknKvHhRz+LC4v4XSeKrKEOUjMTcsmA@mail.gmail.com>
 <CA+8X3fUzVS1zKi0BaJoq2ZJC0cgXgPj_rXFNq9vVBpo7HCXojA@mail.gmail.com>
 <CAFy_oHDaT-a=G_PrE768Xhk56MA3JwSqWOYGvogtDoQfF6F7+Q@mail.gmail.com>
Message-ID: <7e07b891-b085-910d-0c32-c6ad693b9cb4@sapo.pt>

Hello,

The error comes from having 2 colors and 4 labels in


scale_colour_manual("", values = c(f_cols[1], m_cols[1]), labels = 
c("F", "M" , "C" , "G"))


You need the same number of colors and labels. For instance, though 
they're probably not the colors you want the following vector has 4 
colors and the plot code doesn't give an error.


values = c(f_cols[1], m_cols[1], f_cols[2], m_cols[2])



Besides, why are you defining 2 colors vectors with 6 colors each if you 
only have 4 companies?

Hope this helps,

Rui Barradas

?s 23:30 de 03/10/2022, Tariq Khasiri escreveu:
> Thanks everyone for being so kind and patient with me throughout the
> process! Mr. Barradas and Mr. Lemon, very generous of you for taking the
> time and patience to go over my code and data , and taking the time to give
> me meaningful feedback!
> 
> With your help and suggestion, I was successful in making a graph from my
> data. In my main data I have four companies, and just making the graph
> process a little more advanced. However after writing the command , I get
> the error that I have 4 values but gave only 2 values. Would anyone kindly
> guide me what's the mistake and how I can rectify this?
> 
> Data is the same. But my main data has 4 companies whereas in R project I
> just gave 2 only for convenience.
> 
> #### Code needed to execute it #########
> 
> library(tidyverse)
> library(showtext)
> library(usefunc)
> library(patchwork)
> library(cowplot)
> library(rcartocolor)
> library(zoo)
> 
> # load fonts
> font_add_google(name = "Bungee Shade", family = "bungee")
> font_add_google(name = "Dosis", family = "dosis")
> showtext_auto()
> 
> # set colours
> f_cols = c("#008080", "#329999", "#66b2b2",
>             "#7fbfbf", "#99cccc", "#cce5e5")
> m_cols = c("#4b0082", "#6e329b", "#9366b4",
>             "#a57fc0", "#b799cd", "#dbcce6")
> 
> dat$YearMonth <- as.yearmon(paste(dat$year, " ", dat$month), "%Y %m")
> 
> # plot of share of companies per year
> p1 <- ggplot(data = dat,
>               mapping = aes(x = YearMonth, y = share, colour = company)) +
>    geom_line() +
>    geom_point(size = 1) +
>    scale_colour_manual("", values = c(f_cols[1], m_cols[1]), labels = c("F",
> "M" , "C" , "G")) +
>    scale_y_continuous(limits = c(0, 80)) +
>    coord_cartesian(expand = F) +
>    labs(x = "Year",
>         y = "Share of Companies") +
>    theme(legend.position = c(0.1, 0.9),
>          legend.title = element_blank(),
>          legend.text = element_text(family = "dosis", size = 14),
>          panel.background = element_rect(fill = "#FAFAFA", colour =
> "#FAFAFA"),
>          plot.background = element_rect(fill = "#FAFAFA", colour =
> "#FAFAFA"),
>          legend.background = element_rect(fill = "transparent", colour =
> "transparent"),
>          legend.key = element_rect(fill = "transparent", colour =
> "transparent"),
>          axis.title.y = element_text(margin = margin(0, 20, 0, 0), family =
> "dosis"),
>          axis.text = element_text(family = "dosis"),
>          plot.margin = unit(c(0.5, 0.8, 0.5, 0.5), "cm"),
>          panel.grid.major = element_line(colour = "#DEDEDE"),
>          panel.grid.minor = element_blank())
> p1
> 
> The error is saying :
> 
> ??ggplot2 (local) FUN(X[[i]], ...)
>    7.         ??base::unlist(...)
>    8.         ??base::lapply(scales$scales, function(scale) scale$map_df(df
> = df))
>    9.           ??ggplot2 (local) FUN(X[[i]], ...)
>   10.             ??scale$map_df(df = df)
>   11.               ??ggplot2 (local) f(..., self = self)
>   12.                 ??base::lapply(aesthetics, function(j)
> self$map(df[[j]]))
>   13.                   ??ggplot2 (local) FUN(X[[i]], ...)
>   14.                     ??self$map(df[[j]])
>   15.                       ??ggplot2 (local) f(..., self = self)
>   16.                         ??self$palette(n)
>   17.                           ??ggplot2 (local) f(...)
>   18.                             ??rlang::abort(glue("Insufficient values
> in manual scale. {n} needed but only {length(values)} provided."))
> 
> On Mon, 3 Oct 2022 at 02:45, Jim Lemon <drjimlemon at gmail.com> wrote:
> 
>> Hi Tariq,
>> There were a couple of glitches in your data structure. Here's an
>> example of a simple plot:
>>
>> dat<-structure(list(year = c(2018, 2019, 2019, 2019, 2019, 2019, 2019,
>> 2019, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017,
>> 2017, 2017, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018,
>> 2018, 2018, 2018, 2019, 2019, 2019, 2019, 2019), month = c(12,
>> 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1,
>> 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5), company = c("ABC",
>> "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "FGH", "FGH",
>> "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
>> "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
>> "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH"
>> ), share = c(20, 16.5, 15, 15.5, 15.5, 16, 17, 16.5, 61, 55,
>> 53, 53, 54, 53, 58, 54, 50, 47, 55, 50, 52, 51, 51.5, 52, 53,
>> 54, 55, 53, 54, 50, 42, 48, 41, 40, 39, 36.5, 35), com_name = c(1,
>> 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
>> 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2)), row.names = c(NA,
>> -37L), spec = structure(list(cols = list(year = structure(list(), class =
>> c("collector_double",
>> "collector")), month = structure(list(), class = c("collector_double",
>> "collector")), company = structure(list(), class = c("collector_character",
>> "collector")), share = structure(list(), class = c("collector_double",
>> "collector")), com_name = structure(list(), class = c("collector_double",
>> "collector"))), default = structure(list(), class = c("collector_guess",
>> "collector")), delim = ","), class = "col_spec"), class = c("spec_tbl_df",
>> "tbl_df", "tbl", "data.frame"))
>> # convert year and month fields to dates about the middle of each month
>> dat$date<-as.Date(paste(dat$year,dat$month,15,sep="-"),"%Y-%m-%d")
>> # plot the values for one company
>> plot(dat$date[dat$company=="ABC"],dat$share[dat$company=="ABC"],
>>   main="Plot of dat",xlab="Year",ylab="Share",
>>   xlim=range(dat$date),ylim=range(dat$share),
>>   type="l",col="red")
>> # add a line for the other one
>>
>> lines(dat$date[dat$company=="FGH"],dat$share[dat$company=="FGH"],col="green")
>> # get the x plot limits as they are date values
>> xspan<-par("usr")[1:2]
>> # place a legend about in the middle of the plot
>>
>> legend(xspan[1]+diff(xspan)*0.3,35,c("ABC","FGH"),lty=1,col=c("red","green"))
>>
>> There are many more elegant ways to plot something like this.
>>
>> Jim
>>
>> On Mon, Oct 3, 2022 at 10:05 AM Tariq Khasiri <tariqkhasiri at gmail.com>
>> wrote:
>>>
>>> Hello,
>>>
>>> I have the following data. I want to show in a line plot how each
>> different
>>> company is earning over the timeline of my data sample.
>>>
>>> I'm not sure how I can create the *year-month indicator* to plot it
>> nicely
>>> in my horizontal axis out of my dataset.
>>>
>>> After creating the *year-month* indicator ( which will be in my x axis) I
>>> want to create a dataframe where I can groupby companies over the
>>> year-month indicator by putting *share *in the y axis as variables.
>>>
>>> ### data is like the following
>>>
>>> dput(dat)
>>> structure(list(year = c(2018, 2019, 2019, 2019, 2019, 2019, 2019,
>>> 2019, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017,
>>> 2017, 2017, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018,
>>> 2018, 2018, 2018, 2019, 2019, 2019, 2019, 2019), month = c(12,
>>> 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1,
>>> 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5), company = c("ABC",
>>> "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "FGH", "FGH",
>>> "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
>>> "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH",
>>> "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH", "FGH"
>>> ), share = c(20, 16.5, 15, 15.5, 15.5, 16, 17, 16.5, 61, 55,
>>> 53, 53, 54, 53, 58, 54, 50, 47, 55, 50, 52, 51, 51.5, 52, 53,
>>> 54, 55, 53, 54, 50, 42, 48, 41, 40, 39, 36.5, 35), com_name = c(1,
>>> 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
>>> 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2)), row.names = c(NA,
>>> -37L), spec = structure(list(cols = list(year = structure(list(), class =
>>> c("collector_double",
>>> "collector")), month = structure(list(), class = c("collector_double",
>>> "collector")), company = structure(list(), class =
>> c("collector_character",
>>> "collector")), share = structure(list(), class = c("collector_double",
>>> "collector")), com_name = structure(list(), class = c("collector_double",
>>> "collector"))), default = structure(list(), class = c("collector_guess",
>>> "collector")), delim = ","), class = "col_spec"), problems = <pointer:
>>> 0x7fd732028680>, class = c("spec_tbl_df",
>>> "tbl_df", "tbl", "data.frame"))
>>>
>>>          [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>> PLEASE do read the posting guide
>> http://www.R-project.org/posting-guide.html
>>> and provide commented, minimal, self-contained, reproducible code.
>>
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From Er|c@RhonC@|deron @end|ng |rom pennmed|c|ne@upenn@edu  Tue Oct  4 15:36:59 2022
From: Er|c@RhonC@|deron @end|ng |rom pennmed|c|ne@upenn@edu (Rhon Calderon, Eric)
Date: Tue, 4 Oct 2022 13:36:59 +0000
Subject: [R] Help executing R on High Performance Cluster
Message-ID: <MN2PR04MB6400AA8141307B71683D51F8CB5A9@MN2PR04MB6400.namprd04.prod.outlook.com>

Hi,

I need some help executing recently downloaded R on my HPC.

Here is the script I used to install R on my HPC module:


wget https://cran.r-project.org/src/base-prerelease/R-devel.tar.gz

tar -xvf R-devel.tar.gz

cd /home/ericrhon/labsoftware/R-devel/

./configure --prefix=/home/ericrhon/labsoftware/R-devel -with-recommended-packages=no --without-x --with-cairo --with-libpng --with-libtiff --with-jpeglib --enable-R-shlib --with-pcre1

make

make install

After I installed, I tried to run /home/ericrhon/labsoftware/R-devel/R. But I get the next error:


/home/ericrhon/labsoftware/R-devel/bin/exec/R: line 272: /home/ericrhon/labsoftware/R-devel/bin/exec/R: Argument list too long

/home/ericrhon/labsoftware/R-devel/bin/exec/R: line 272: /home/ericrhon/labsoftware/R-devel/bin/exec/R: Success

Here is the exec script of R, line 272 is highlighted:


#!/bin/sh

# Shell wrapper for R executable.


R_HOME_DIR="/home/ericrhon/labsoftware/R-devel"

if test "${R_HOME_DIR}" = "/home/ericrhon/labsoftware/shared_Renv/versions/R-devel/lib64/R"; then

   case "linux-gnu" in

   linux*)

     run_arch=`uname -m`

     case "$run_arch" in

        x86_64|mips64|ppc64|powerpc64|sparc64|s390x)

          libnn=lib64

          libnn_fallback=lib

        ;;

        *)

          libnn=lib

          libnn_fallback=lib64

        ;;

     esac

     if [ -x "/home/ericrhon/labsoftware/shared_Renv/versions/R-devel/${libnn}/R/bin/exec/R" ]; then

        R_HOME_DIR="/home/ericrhon/labsoftware/shared_Renv/versions/R-devel/${libnn}/R"

     elif [ -x "/home/ericrhon/labsoftware/shared_Renv/versions/R-devel/${libnn_fallback}/R/bin/exec/R" ]; then

        R_HOME_DIR="/home/ericrhon/labsoftware/shared_Renv/versions/R-devel/${libnn_fallback}/R"

     ## else -- leave alone (might be a sub-arch)

     fi

     ;;

  esac

fi


if test -n "${R_HOME}" && \

   test "${R_HOME}" != "${R_HOME_DIR}"; then

  echo "WARNING: ignoring environment value of R_HOME"

fi

R_HOME="${R_HOME_DIR}"

export R_HOME

R_SHARE_DIR="${R_HOME_DIR}/share"

export R_SHARE_DIR

R_INCLUDE_DIR="${R_HOME_DIR}/include"

export R_INCLUDE_DIR

R_DOC_DIR="${R_HOME_DIR}/doc"

export R_DOC_DIR


# Since this script can be called recursively, we allow R_ARCH to

# be overridden from the environment.

# This script is shared by parallel installs, so nothing in it should

# depend on the sub-architecture except the default here.

: ${R_ARCH=}


usage="

Usage: R [options] [< infile] [> outfile]

   or: R CMD command [arguments]


Start R, a system for statistical computation and graphics, with the

specified options, or invoke an R tool via the 'R CMD' interface.


Options:

  -h, --help            Print short help message and exit

  --version             Print version info and exit

  --encoding=ENC        Specify encoding to be used for stdin

  --encoding ENC

  RHOME                                  Print path to R home directory and exit

  --save                Do save workspace at the end of the session

  --no-save             Don't save it

  --no-environ          Don't read the site and user environment files

  --no-site-file        Don't read the site-wide Rprofile

  --no-init-file        Don't read the user R profile

  --restore             Do restore previously saved objects at startup

  --no-restore-data     Don't restore previously saved objects

  --no-restore-history  Don't restore the R history file

  --no-restore          Don't restore anything

  --vanilla                     Combine --no-save, --no-restore, --no-site-file,

                                    --no-init-file and --no-environ

  --no-readline         Don't use readline for command-line editing

  --max-ppsize=N        Set max size of protect stack to N

  --min-nsize=N         Set min number of fixed size obj's (\"cons cells\") to N

  --min-vsize=N         Set vector heap minimum to N bytes; '4M' = 4 MegaB

  -q, --quiet           Don't print startup message

  --silent              Same as --quiet

  -s, --no-echo         Make R run as quietly as possible

  --interactive         Force an interactive session

  --verbose             Print more information about progress

  -d, --debugger=NAME   Run R through debugger NAME

  --debugger-args=ARGS  Pass ARGS as arguments to the debugger

  -g TYPE, --gui=TYPE   Use TYPE as GUI; possible values are 'X11' (default)

                                    and 'Tk'.

  --arch=NAME            Specify a sub-architecture

  --args                Skip the rest of the command line

  -f FILE, --file=FILE  Take input from 'FILE'

  -e EXPR               Execute 'EXPR' and exit


FILE may contain spaces but not shell metacharacters.


Commands:

  BATCH                                   Run R in batch mode

  COMPILE                   Compile files for use with R

  SHLIB                         Build shared library for dynamic loading

  INSTALL                     Install add-on packages

  REMOVE                    Remove add-on packages

  build                          Build add-on packages

  check                         Check add-on packages

  LINK                           Front-end for creating executable programs

  Rprof                         Post-process R profiling files

  Rdconv                      Convert Rd format to various other formats

  Rd2pdf                      Convert Rd format to PDF

  Rd2txt                       Convert Rd format to pretty text

  Stangle                      Extract S/R code from Sweave documentation

  Sweave                      Process Sweave documentation

  Rdiff                           Diff R output ignoring headers etc

  config            Obtain configuration information about R

  javareconf                 Update the Java configuration variables

  rtags                 Create Emacs-style tag files from C, R, and Rd files


Please use 'R CMD command --help' to obtain further information about

the usage of 'command'.


Options --arch, --no-environ, --no-init-file, --no-site-file and --vanilla

can be placed between R and CMD, to apply to R processes run by 'command'


Report bugs at <https://bugs.R-project.org>."


## some systems have a more portable sed, e.g. /usr/xpg4/bin/sed on Solaris,

## so make sure that is used.

SED=/usr/bin/sed

export SED


error () {

  echo "ERROR: $*" >&2

  exit 1

}


### Argument loop

args=

debugger=

debugger_args=

gui=

while test -n "${1}"; do

  case ${1} in

    RHOME|--print-home)

      echo "${R_HOME}"; exit 0 ;;

    CMD)

      shift;

      export R_ARCH

      . "${R_HOME}/etc${R_ARCH}/ldpaths"

      exec sh "${R_HOME}/bin/Rcmd" "${@}" ;;

    -g|--gui)

      if test -n "`echo ${2} | ${SED} 's/^-.*//'`"; then

            gui="${2}"

        args="${args} ${1} ${2}"

            shift

      else

            error "option '${1}' requires an argument"

      fi

      ;;

    --gui=*)

      gui=`echo "${1}" | ${SED} -e 's/[^=]*=//'`

      args="${args} ${1}"

      ;;

    -d|--debugger)

      if test -n "`echo ${2} | ${SED} 's/^-.*//'`"; then

            debugger="${2}"; shift

      else

            error "option '${1}' requires an argument"

      fi

      ;;

    --debugger=*)

      debugger=`echo "${1}" | ${SED} -e 's/[^=]*=//'` ;;

    --debugger-args=*)

      debugger_args=`echo "${1}" | ${SED} -e 's/[^=]*=//'` ;;

    -h|--help)

      echo "${usage}"; exit 0 ;;

    --args)

      break ;;

    --arch)

      if test -n "`echo ${2} | ${SED} 's/^-.*//'`"; then

            R_ARCH="/${2}"

        shift

      else

        error "option '${1}' requires an argument"

      fi

      ## check sub-architecture here for a better error message

      if ! test -d ${R_HOME}/etc${R_ARCH}; then

        error "sub-architecture '${1}' is not installed"

      fi

      ;;

    --arch=*)

      r_arch=`echo "${1}" | ${SED} -e 's/[^=]*=//'`

      R_ARCH="/${r_arch}"

      ## check sub-architecture here for a better error message

      if ! test -d ${R_HOME}/etc${R_ARCH}; then

        error "sub-architecture '${r_arch}' is not installed"

      fi

      ;;

    -e)

      TAB=`printf "\t"`

      if test -n "`echo ${2} | ${SED} 's/^-.*//'`"; then

            a=`(echo "${2}" && echo) | ${SED} -e 's/ /~+~/g' | \

          ${SED} -e :a -e N -e '$!ba' -e 's/\n/~n~/g' -e 's/~n~$//g' -e "s/$TAB/~t~/g"`

        shift

      else

            error "option '${1}' requires a non-empty argument"

      fi

      args="${args} -e $a"

      ;;

    -f)

      if test -n "`echo ${2} | ${SED} 's/^-.*//'`"; then

            a=`echo "${2}" | ${SED} -e 's/ /~+~/g'`; shift

      else

            error "option '${1}' requires a filename argument"

      fi

      args="${args} -f $a"

      ;;

    --file=*)

      a=`echo "${1}" | ${SED} -e 's/[^=]*=//' | ${SED} -e 's/ /~+~/g'`

      args="${args} --file=$a"

      ;;

    --no-environ)

      R_ENVIRON=''

      export R_ENVIRON

      R_ENVIRON_USER=''

      export R_ENVIRON_USER

      args="${args} ${1}"

      ;;

    --no-site-file)

      R_PROFILE=''

      export R_PROFILE

      args="${args} ${1}"

      ;;

    --no-init-file)

      R_PROFILE_USER=''

      export R_PROFILE_USER

      args="${args} ${1}"

      ;;

    --vanilla)

      R_ENVIRON=''

      export R_ENVIRON

      R_ENVIRON_USER=''

      export R_ENVIRON_USER

      R_PROFILE=''

      export R_PROFILE

      R_PROFILE_USER=''

      export R_PROFILE_USER

      args="${args} ${1}"

      ;;

    *)

      args="${args} ${1}" ;;

  esac

  shift

done


. "${R_HOME}/etc${R_ARCH}/ldpaths"


R_binary="${R_HOME}/bin/exec${R_ARCH}/R"

export R_ARCH


case "${gui}" in

Tk|tk|X11|x11)

  ;;

"")

  ;;

*)

  error "unknown GUI ${gui}"

esac


## R_HOME may have moved, so check

if test -x "${R_HOME}"; then

  :

else

  error "R_HOME ('${R_HOME}') not found"

fi


## Startup
if test -z "${debugger}"; then
  exec "${R_binary}"  ${args} "${@}"

else

  ## Ideally, we would like the debugger to start R with additional

  ## ('inferior') arguments, but not all debuggers can do this.  We know

  ## about valgrind and some versions of GDB , and deal with these.

  ## Otherwise, to be on the safe side, we disregard non-debugger

  ## command line args.

  args_ok=no

  case "`${debugger} --version 2>/dev/null`" in

    "GNU gdb"*)

      if ${debugger} --help 2>/dev/null | \

          grep ' *--args' >/dev/null; then

            args_ok=yes

            debugger_args="${debugger_args} --args"

      fi

      ;;

    valgrind*)

      args_ok=yes

      ;;

  esac

  if test -n "${args}${*}" && test "${args_ok}" = no; then

    args=`expr "${args} ${*}" : " *\(.*\)"`

    echo "*** Further command line arguments ('${args}') disregarded"

    echo "*** (maybe use 'run ${args}' from *inside* ${debugger})"

    echo ""

    exec ${debugger} ${debugger_args} "${R_binary}"

  else

    exec ${debugger} ${debugger_args} "${R_binary}" ${args} "${@}"

  fi

fi


### Local Variables: ***

### mode: sh ***

### sh-indentation: 2 ***

### End: ***


Could you please help me? I have been trying to load it unsuccessfully.

Thanks.

Eric



	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Tue Oct  4 16:27:36 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 4 Oct 2022 17:27:36 +0300
Subject: [R] Help executing R on High Performance Cluster
In-Reply-To: <MN2PR04MB6400AA8141307B71683D51F8CB5A9@MN2PR04MB6400.namprd04.prod.outlook.com>
References: <MN2PR04MB6400AA8141307B71683D51F8CB5A9@MN2PR04MB6400.namprd04.prod.outlook.com>
Message-ID: <20221004172736.637bca14@arachnoid>

Hi Eric!

? Tue, 4 Oct 2022 13:36:59 +0000
"Rhon Calderon, Eric" <Eric.RhonCalderon at pennmedicine.upenn.edu> ?????:

> cd /home/ericrhon/labsoftware/R-devel/

> ./configure --prefix=/home/ericrhon/labsoftware/R-devel

I'm not sure, but the reason for the confusing behaviour could be
that the installation prefix is set to be the same as the directory
where you had unpacked the source code. This may have caused file path
conflicts and maybe some kind of recursion when building the final
executable path.

R can run straight from the build directory, without installation.
If you start from scratch, does bin/R work without `make install`? If
not, do you get any useful output if you run bin/R under sh -x?

(Additionally, R supports building away from the source code directory.
For example, if you navigate to the source code directory, then run
mkdir build && cd build && ../configure $CONFIGURE_ARGUMENTS, the build
will be mostly self-contained to that directory, which may be useful
when experimenting.)

Why are you building R with --with-recommended-packages=no?

R is supposed to be easy to build and start working with, but there may
be important details to consider, especially on an HPC, in the "R
installation and administration" guide:
https://cran.r-project.org/doc/manuals/r-release/R-admin.html

> Here is the exec script of R, line 272 is highlighted:
<...>
>	[[alternative HTML version deleted]]

This mailing list strips the HTML version of the e-mails; here's what
we see: https://stat.ethz.ch/pipermail/r-help/2022-October/475956.html

One way to link to R source code is to use the GitHub mirror:
https://github.com/r-devel/r-svn

-- 
Best regards,
Ivan


From petr@p|k@| @end|ng |rom prechez@@cz  Tue Oct  4 13:01:14 2022
From: petr@p|k@| @end|ng |rom prechez@@cz (PIKAL Petr)
Date: Tue, 4 Oct 2022 11:01:14 +0000
Subject: [R] R version 4.2.1 install.packages does not work with IE proxy
 setting
Message-ID: <344ae947626245a392ebba421f73e483@SRVEXCHCM1302.precheza.cz>

Dear all

After we installed new R version R 4.2.1 installing packages through IE
proxy setting is compromised with warning that R could not connect to server
(tested in vanilla R).

> chooseCRANmirror()
Warning: failed to download mirrors file (cannot open URL
'https://cran.r-project.org/CRAN_mirrors.csv'); using local file
'D:/programy/R/doc/CRAN_mirrors.csv'
Warning message:
In download.file(url, destfile = f, quiet = TRUE) :
  URL 'https://cran.r-project.org/CRAN_mirrors.csv': status was 'Couldn't
connect to server'

So install.packages("whatever") also ends with similar warnings.

When using directly (without proxy need) install.packages works as expected.

In R4.1.0 version it works as expected, without any warnings and packages
could be installed smoothly.

Is it known issue with this version? 
Could it be due to somehow corrupted installation?
Should we set something differently for this new R version

Best regards
Petr

From kry|ov@r00t @end|ng |rom gm@||@com  Tue Oct  4 17:42:56 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 4 Oct 2022 18:42:56 +0300
Subject: [R] 
 R version 4.2.1 install.packages does not work with IE proxy setting
In-Reply-To: <344ae947626245a392ebba421f73e483@SRVEXCHCM1302.precheza.cz>
References: <344ae947626245a392ebba421f73e483@SRVEXCHCM1302.precheza.cz>
Message-ID: <20221004184256.7ce13c60@arachnoid>

On Tue, 4 Oct 2022 11:01:14 +0000
PIKAL Petr <petr.pikal at precheza.cz> wrote:

> After we installed new R version R 4.2.1 installing packages through
> IE proxy setting is compromised with warning that R could not connect
> to server (tested in vanilla R).

R 4.1 deprecated the use of download.file(method = 'wininet'). R 4.2
switched the default download method to 'libcurl' and started giving
warnings for 'wininet' and http[s]:// URLs.

A workaround to get it working right now would be to set
options(download.file.method = 'wininet') and live with the resulting
warnings while R downloads the files, but a next version of R may
remove 'wininet' support altogether.

In order to get it working with the 'libcurl' method, you'll need to
provide some environment variables to curl:
https://stat.ethz.ch/pipermail/r-help/2022-September/475917.html

Not sure if libcurl would accept a patch to discover the Windows proxy
settings automatically, but I don't think it does that now.

-- 
Best regards,
Ivan


From M@|@@_D@S||v@ @end|ng |rom h@dm@h@rv@rd@edu  Tue Oct  4 17:58:20 2022
From: M@|@@_D@S||v@ @end|ng |rom h@dm@h@rv@rd@edu (Da Silva, Maisa Monseff Rodrigues)
Date: Tue, 4 Oct 2022 15:58:20 +0000
Subject: [R] R version 4.2.1 (2022-06-23),
 RStudio 2022.07.2 "Spotted Wakerobin" Release (e7373ef8,
 2022-09-06) for macOS, macOS Monterey version 12.6. Error: SVN not found
Message-ID: <BYAPR07MB5447FD6F319350E1EDDAA2D5AA5A9@BYAPR07MB5447.namprd07.prod.outlook.com>

Hello.
Thank you for helping me.
I am starting my Bioinformatics pathway, and came across a problem im stuck with, even after trying different things:

When in RStudio, I was able to install Git, but SVN remains "not found".
I tried installing SVN through HomeBrew and downloaded Xcode's Command Lines from Apple Developer (as instructed on https://support.rstudio.com/hc/en-us/articles/200532077?version=2022.07.2%2B576&mode=desktop).
After those steps, I restarted R and continue to see "not found" for SVN (git is working fine).
When on mac terminal,

"svn --version" prints

svn, version 1.14.2 (r1899510)

   compiled Oct  3 2022, 21:23:39 on x86_64-apple-darwin21.6.0


"svn info" prints

svn: E155007: '/Users/maisamonseff' is not a working copy

Could you point out what it is I am doing wrong?


Thank you in advance,

Maisa Monseff Rodrigues da Silva
MD - Endocrinologist - University S?o Paulo (Brazil)
PhD Student University S?o Paulo (BR) / Harvard (USA)

________________________________
CONFIDENTIALITY NOTICE: This message and any attached do...{{dropped:11}}


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Tue Oct  4 19:18:22 2022
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Tue, 04 Oct 2022 10:18:22 -0700
Subject: [R] R version 4.2.1 (2022-06-23),
 RStudio 2022.07.2 "Spotted Wakerobin" Release (e7373ef8,
 2022-09-06) for macOS, macOS Monterey version 12.6. Error: SVN not found
In-Reply-To: <BYAPR07MB5447FD6F319350E1EDDAA2D5AA5A9@BYAPR07MB5447.namprd07.prod.outlook.com>
References: <BYAPR07MB5447FD6F319350E1EDDAA2D5AA5A9@BYAPR07MB5447.namprd07.prod.outlook.com>
Message-ID: <8A776EC5-00FF-4F1A-A7CA-909331FB0463@dcn.davis.ca.us>

>Could you point out what it is I am doing wrong?

... wrong... posting questions about SVN and RStudio in a forum about R? Do read the Posting Guide before posting. There are specialty mailing lists mentioned there that _might_ be relevant, but it seems to me that you need to learn how to use SVN before you learn how to use it with RStudio, and neither of those tools are on their own relevant in any of the R mailing lists.

I don't use a Mac, but I believe you may encounter difficulties using it related to the fact that everything homebrew tools do has permissions restrictions related to homebrew so mixing in non-homebrew tools may not work.

Try perhaps StackOverflow or Reddit?

On October 4, 2022 8:58:20 AM PDT, "Da Silva, Maisa Monseff Rodrigues" <Maisa_DaSilva at hsdm.harvard.edu> wrote:
>Hello.
>Thank you for helping me.
>I am starting my Bioinformatics pathway, and came across a problem im stuck with, even after trying different things:
>
>When in RStudio, I was able to install Git, but SVN remains "not found".
>I tried installing SVN through HomeBrew and downloaded Xcode's Command Lines from Apple Developer (as instructed on https://support.rstudio.com/hc/en-us/articles/200532077?version=2022.07.2%2B576&mode=desktop).
>After those steps, I restarted R and continue to see "not found" for SVN (git is working fine).
>When on mac terminal,
>
>"svn --version" prints
>
>svn, version 1.14.2 (r1899510)
>
>   compiled Oct  3 2022, 21:23:39 on x86_64-apple-darwin21.6.0
>
>
>"svn info" prints
>
>svn: E155007: '/Users/maisamonseff' is not a working copy
>
>Could you point out what it is I am doing wrong?
>
>
>Thank you in advance,
>
>Maisa Monseff Rodrigues da Silva
>MD - Endocrinologist - University S?o Paulo (Brazil)
>PhD Student University S?o Paulo (BR) / Harvard (USA)
>
>________________________________
>CONFIDENTIALITY NOTICE: This message and any attached do...{{dropped:11}}
>

-- 
Sent from my phone. Please excuse my brevity.


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Tue Oct  4 19:32:55 2022
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Tue, 4 Oct 2022 18:32:55 +0100
Subject: [R] R version 4.2.1 (2022-06-23),
 RStudio 2022.07.2 "Spotted Wakerobin" Release (e7373ef8,
 2022-09-06) for macOS, macOS Monterey version 12.6. Error: SVN not found
In-Reply-To: <8A776EC5-00FF-4F1A-A7CA-909331FB0463@dcn.davis.ca.us>
References: <BYAPR07MB5447FD6F319350E1EDDAA2D5AA5A9@BYAPR07MB5447.namprd07.prod.outlook.com>
 <8A776EC5-00FF-4F1A-A7CA-909331FB0463@dcn.davis.ca.us>
Message-ID: <72780772-4b53-ee0c-d220-2c33d2bbdc18@sapo.pt>

Hello,

Post to R-SIG-Mac [1], the R help mailing list for Mac related questions?

[1] https://stat.ethz.ch/mailman/listinfo/r-sig-mac

Hope this helps,

Rui Barradas

?s 18:18 de 04/10/2022, Jeff Newmiller escreveu:
>> Could you point out what it is I am doing wrong?
> 
> ... wrong... posting questions about SVN and RStudio in a forum about R? Do read the Posting Guide before posting. There are specialty mailing lists mentioned there that _might_ be relevant, but it seems to me that you need to learn how to use SVN before you learn how to use it with RStudio, and neither of those tools are on their own relevant in any of the R mailing lists.
> 
> I don't use a Mac, but I believe you may encounter difficulties using it related to the fact that everything homebrew tools do has permissions restrictions related to homebrew so mixing in non-homebrew tools may not work.
> 
> Try perhaps StackOverflow or Reddit?
> 
> On October 4, 2022 8:58:20 AM PDT, "Da Silva, Maisa Monseff Rodrigues" <Maisa_DaSilva at hsdm.harvard.edu> wrote:
>> Hello.
>> Thank you for helping me.
>> I am starting my Bioinformatics pathway, and came across a problem im stuck with, even after trying different things:
>>
>> When in RStudio, I was able to install Git, but SVN remains "not found".
>> I tried installing SVN through HomeBrew and downloaded Xcode's Command Lines from Apple Developer (as instructed on https://support.rstudio.com/hc/en-us/articles/200532077?version=2022.07.2%2B576&mode=desktop).
>> After those steps, I restarted R and continue to see "not found" for SVN (git is working fine).
>> When on mac terminal,
>>
>> "svn --version" prints
>>
>> svn, version 1.14.2 (r1899510)
>>
>>    compiled Oct  3 2022, 21:23:39 on x86_64-apple-darwin21.6.0
>>
>>
>> "svn info" prints
>>
>> svn: E155007: '/Users/maisamonseff' is not a working copy
>>
>> Could you point out what it is I am doing wrong?
>>
>>
>> Thank you in advance,
>>
>> Maisa Monseff Rodrigues da Silva
>> MD - Endocrinologist - University S?o Paulo (Brazil)
>> PhD Student University S?o Paulo (BR) / Harvard (USA)
>>
>> ________________________________
>> CONFIDENTIALITY NOTICE: This message and any attached do...{{dropped:11}}
>>
>


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Tue Oct  4 20:30:34 2022
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Tue, 04 Oct 2022 11:30:34 -0700
Subject: [R] R version 4.2.1 (2022-06-23),
 RStudio 2022.07.2 "Spotted Wakerobin" Release (e7373ef8,
 2022-09-06) for macOS, macOS Monterey version 12.6. Error: SVN not found
In-Reply-To: <72780772-4b53-ee0c-d220-2c33d2bbdc18@sapo.pt>
References: <BYAPR07MB5447FD6F319350E1EDDAA2D5AA5A9@BYAPR07MB5447.namprd07.prod.outlook.com>
 <8A776EC5-00FF-4F1A-A7CA-909331FB0463@dcn.davis.ca.us>
 <72780772-4b53-ee0c-d220-2c33d2bbdc18@sapo.pt>
Message-ID: <49AC5E23-F7DE-408A-A164-C9579840255B@dcn.davis.ca.us>

Possibly, but the question is actually not about R, so probably not...

On October 4, 2022 10:32:55 AM PDT, Rui Barradas <ruipbarradas at sapo.pt> wrote:
>Hello,
>
>Post to R-SIG-Mac [1], the R help mailing list for Mac related questions?
>
>[1] https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>
>Hope this helps,
>
>Rui Barradas
>
>?s 18:18 de 04/10/2022, Jeff Newmiller escreveu:
>>> Could you point out what it is I am doing wrong?
>> 
>> ... wrong... posting questions about SVN and RStudio in a forum about R? Do read the Posting Guide before posting. There are specialty mailing lists mentioned there that _might_ be relevant, but it seems to me that you need to learn how to use SVN before you learn how to use it with RStudio, and neither of those tools are on their own relevant in any of the R mailing lists.
>> 
>> I don't use a Mac, but I believe you may encounter difficulties using it related to the fact that everything homebrew tools do has permissions restrictions related to homebrew so mixing in non-homebrew tools may not work.
>> 
>> Try perhaps StackOverflow or Reddit?
>> 
>> On October 4, 2022 8:58:20 AM PDT, "Da Silva, Maisa Monseff Rodrigues" <Maisa_DaSilva at hsdm.harvard.edu> wrote:
>>> Hello.
>>> Thank you for helping me.
>>> I am starting my Bioinformatics pathway, and came across a problem im stuck with, even after trying different things:
>>> 
>>> When in RStudio, I was able to install Git, but SVN remains "not found".
>>> I tried installing SVN through HomeBrew and downloaded Xcode's Command Lines from Apple Developer (as instructed on https://support.rstudio.com/hc/en-us/articles/200532077?version=2022.07.2%2B576&mode=desktop).
>>> After those steps, I restarted R and continue to see "not found" for SVN (git is working fine).
>>> When on mac terminal,
>>> 
>>> "svn --version" prints
>>> 
>>> svn, version 1.14.2 (r1899510)
>>> 
>>>    compiled Oct  3 2022, 21:23:39 on x86_64-apple-darwin21.6.0
>>> 
>>> 
>>> "svn info" prints
>>> 
>>> svn: E155007: '/Users/maisamonseff' is not a working copy
>>> 
>>> Could you point out what it is I am doing wrong?
>>> 
>>> 
>>> Thank you in advance,
>>> 
>>> Maisa Monseff Rodrigues da Silva
>>> MD - Endocrinologist - University S?o Paulo (Brazil)
>>> PhD Student University S?o Paulo (BR) / Harvard (USA)
>>> 
>>> ________________________________
>>> CONFIDENTIALITY NOTICE: This message and any attached do...{{dropped:11}}
>>> 
>> 

-- 
Sent from my phone. Please excuse my brevity.


From tder@mu@ @end|ng |rom p@rtner@@org  Wed Oct  5 01:35:09 2022
From: tder@mu@ @end|ng |rom p@rtner@@org (Deramus, Thomas Patrick)
Date: Tue, 4 Oct 2022 23:35:09 +0000
Subject: [R] Getting "Error in ect,
 plot.new has not been called yet" despite grouping plot call
Message-ID: <PH0PR04MB7493E39389D0196BEC260CB6BE5A9@PH0PR04MB7493.namprd04.prod.outlook.com>

Sorry to cross-post on Stackoverflow and here but I'm having some difficulty.
https://stackoverflow.com/questions/73942794/still-getting-error-in-ect-plot-new-has-not-been-called-yet-despite-grouping

Trying to make a nested loop that produces PDFs off different graphs, one for ACF/PACF diagnostics and another for the actual data, based on some time-series analyses I'm doing.

Unfortunately, I keep getting the dreaded: Error plot.new has not been called yet

The code is meant to write a PDF containing the ACF and PACF graphs, then do some analyses on the timeseries, and then make a separate PDF containing a plot describing the timeseries based on the p-values of each test for each individual.

library(plyr)
library(dplyr)
library(ggplot2)
library(Kendall)
library(lubridate)
library(xts)
library(TTR)
library(trend)
library(forecast)
library(openxlsx)

Game_Metrics_Word_Task <- read.xlsx("GamePack_Analytics_ALL_TIME_Short.xlsx", "Boggle")
Game_Metrics_Word_Task <- Game_Metrics_Word_Task %>% filter(grepl('1440', StudyId))
Game_Metrics_Word_Task$DeviceTime <- ymd_hms(Game_Metrics_Word_Task$DeviceTime,  tz = "America/New_York")
Game_Metrics_Word_Task <- Game_Metrics_Word_Task[!duplicated(Game_Metrics_Word_Task[1:2,])]

Participant_Word_Task <- split(arrange(Game_Metrics_Word_Task,StudyId,DeviceTime), arrange(Game_Metrics_Word_Task,StudyId,DeviceTime,StudyId,DeviceTime)$StudyId)

WordFrame <- data.frame(Participant = c(0), Task = c(0), MannKendall_Tau = c(0), MannKendall_P = c(0), Sen_Slope_Value = c(0), Sen_Slope_Pval = c(0), Pettitts_CIV = c(0), Pettitts_Pval = c(0), ARIMA_Model = c(0), Time_to_Petit = c(0), Number_of_Trials_to_Pettitt = c(0), Playtime_to_Petit_seconds = c(0), Time_Start_to_end_days = c(0), Number_of_Total_Trials = c(0), Total_Playtime_seconds = c(0), Learning_rate_days = c(0), Learning_rate_seconds = c(0), Learned_Task = c(0))

for (i in 1:length(Participant_Word_Task)){
    success_series <- xts(filter(Participant_Word_Task[[i]], GameEndReason == "TIMER_UP")$NumberOfSuccesfulWords , order.by=as.POSIXct(filter(Participant_Word_Task[[i]], GameEndReason == "TIMER_UP")$DeviceTime))
    original_series <- xts(Participant_Word_Task[[i]]$NumberOfSuccesfulWords, order.by=as.POSIXct(Participant_Word_Task[[i]]$DeviceTime))
    success_decomp <- ts(success_series, frequency = nweeks(success_series))
    original_decomp <- ts(original_series, frequency = nweeks(success_series))

    pdf(paste("Word_Task_Autocorrelation_plots_for_subject_",unique(Participant_Word_Task[[i]]$StudyId),".pdf" ,collapse = NULL, sep = ""))
    par(mfrow=c(1,2))
    Autocorrelationplot <- acf(success_decomp, main=paste(""))
    PartialAutocorrelationplot <- pacf(success_decomp, main=paste(""))
    mtext(paste("Word Task Auto and Partialauto correlations for subject ",unique(Participant_Word_Task[[i]]$StudyId)), side = 3, line = -3, outer = TRUE)
    dev.off()

    AutomatedArimaoutputs <- auto.arima(success_decomp)
    p <- length(AutomatedArimaoutputs$model$phi)
    #AR component
    q <- length(AutomatedArimaoutputs$model$theta)
    #MA component
    d <- AutomatedArimaoutputs$model$Delta
    #order of difference
    WordFrame[i,1] <- unique(Participant_Word_Task[[i]]$StudyId)
    WordFrame[i,2] <- "Word"
    WordFrame[i,3] <- MannKendall(success_decomp)$tau[1]
    WordFrame[i,4] <- MannKendall(success_decomp)$sl[1]
    WordFrame[i,5] <- sens.slope(success_decomp)$estimates
    WordFrame[i,6] <- sens.slope(success_decomp)$p.value
    WordFrame[i,7] <- pettitt.test(success_decomp)$estimate
    WordFrame[i,8] <- pettitt.test(success_decomp)$p.value
    WordFrame[i,9] <- paste("ARIMA(",p,",",q,",",d,")", collapse = NULL, sep = "")
    WordFrame[i,10] <- difftime(time(success_series[WordFrame[i,7]]),time(original_series[1]))
    WordFrame[i,11] <- tail(which(grepl(success_series[WordFrame[i,7]], original_series)), n=1)
    WordFrame[i,12] <- sum(Participant_Word_Task[[i]]$TotalDuration[1:WordFrame[i,11]])-sum(Participant_Word_Task[[i]]$TotalTimePaused[1:WordFrame[i,11]])
    WordFrame[i,13] <- difftime(time(original_series[length(original_series)]),time(original_series[1]))
    WordFrame[i,14] <- length(original_series)
    WordFrame[i,15] <- sum(Participant_Word_Task[[i]]$TotalDuration[1:length(original_series)])-sum(Participant_Word_Task[[i]]$TotalTimePaused[1:length(original_series)])


    simplemovingaverage <- SMA(original_series, n = nweeks(original_series))

    if (WordFrame[i,4] <= 0.05 & WordFrame[i,6] <= 0.05 & WordFrame[i,8] <= 0.05){
              {
              pdf(paste(WordFrame[i,1],"_Word_Task_Acquisition.pdf",collapse = NULL, sep = ""))
              plout <- plot(original_series,type='l',col='blue',xlab="Date of Play",ylab="Number of Successful Words")
              lines(simplemovingaverage,type='l',col='red')
              title(paste("Word Task Acquisition for Subject", WordFrame[i,1]))
              abline(v = index(original_series[WordFrame[i,7]]),lty=2, col='green', lwd=3)
              dev.off()
              }
              WordFrame[i,18] <- T
              WordFrame[i,16] <- (1-(WordFrame[i,10]/WordFrame[i,13]))
              WordFrame[i,17] <- (1-(WordFrame[i,12]/WordFrame[i,15]))
    } else {
              {
              pdf(paste(WordFrame[i,1],"_Word_Task_Acquisition.pdf",collapse = NULL, sep = ""))
              plout <- plot(original_series,type='l',col='blue',xlab="Date of Play",ylab="Number of Successful Words")
              lines(simplemovingaverage,type='l',col='red')
              title(paste("Word Task Acquisition for Subject", WordFrame[i,1]))
              dev.off()
              }
              WordFrame[i,18] <- F
              WordFrame[i,16] <- 0
              WordFrame[i,17] <- 0
    }
}

It will work just fine if I run the lines individually (e.g. set i = 1, 2, ect), and if I comment out abline and title (lines seems to work fine). But it will throw the error everytime I try to run the loop without these commented.

Have tried just about everything I could find on the Stack forums to run everything as a single argument and I'm just not sure what is wrong with it.

dev.list() spits out:

pdf
  2
following the error.

With abline and title commented out and lines run individually it's NULL.

Happens in both RStudio

2022.07.2+576 "Spotted Wakerobin" Release (e7373ef832b49b2a9b88162cfe7eac5f22c40b34, 2022-09-06) for Ubuntu Bionic
Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) QtWebEngine/5.12.8 Chrome/69.0.3497.128 Safari/537.36

And R:

platform       x86_64-pc-linux-gnu
arch           x86_64
os             linux-gnu
system         x86_64, linux-gnu
status
major          4
minor          2.1
year           2022
month          06
day            23
svn rev        82513
language       R
version.string R version 4.2.1 (2022-06-23)
nickname       Funny-Looking Kid


My OS:
PRETTY_NAME="Debian GNU/Linux 11 (bullseye)"
NAME="Debian GNU/Linux"
VERSION_ID="11"
VERSION="11 (bullseye)"
VERSION_CODENAME=bullseye
ID=debian
HOME_URL="https://www.debian.org/"
SUPPORT_URL="https://www.debian.org/support"
BUG_REPORT_URL="https://bugs.debian.org/"
No LSB modules are available.
Distributor ID:???Debian
Description:??????Debian GNU/Linux 11 (bullseye)
Release:????11
Codename:???bullseye
         Icon name: computer-desktop
           Chassis: desktop
        Machine ID: 053ebf23707f49c8ad4e0684f4cf19d3
           Boot ID: d0e6294d3b944286bef10e76c21e6401
  Operating System: Debian GNU/Linux 11 (bullseye)
            Kernel: Linux 5.10.0-18-amd64
      Architecture: x86-64


Any suggestions would be greatly appreciated.

--

Thomas DeRamus (He/Him/His)

Data Analyst

Massachusetts General Hospital Brigham

Alzheimer?s Clinical & Translational Research Unit

149 13th Street

Charlestown, MA 02129

Phone: 205-834-5066

Email: tderamus at partners.org<mailto:tderamus at partners.org>, tpderamus at gmail.com<mailto:tpderamus at gmail.com>


[https://ci3.googleusercontent.com/mail-sig/AIorK4we2sU30P2HyfDQF5hpEjYTt-9FTBK7cAVsP7EenrZ0nsKCf48fuYMtElj6Szn_2fpSPWr66eQ][https://ci3.googleusercontent.com/mail-sig/AIorK4yyY0DlImU0UONJrHTbPc5T3lJj8Kmu8SbDKJJ3XjcX6CgvVsvSueYKwficYFz4zXt6fZV8YIY]

?If knowledge can create problems, it is not through ignorance that we can solve them.?

?Issac Asimov
The information in this e-mail is intended only for the person to whom it is addressed.  If you believe this e-mail was sent to you in error and the e-mail contains patient information, please contact the Mass General Brigham Compliance HelpLine at https://www.massgeneralbrigham.org/complianceline <https://www.massgeneralbrigham.org/complianceline> .
Please note that this e-mail is not secure (encrypted).  If you do not wish to continue communication over unencrypted e-mail, please notify the sender of this message immediately.  Continuing to send or respond to e-mail after receiving this message means you understand and accept this risk and wish to continue to communicate over unencrypted e-mail. 

From r@turner @end|ng |rom @uck|@nd@@c@nz  Wed Oct  5 12:06:08 2022
From: r@turner @end|ng |rom @uck|@nd@@c@nz (Rolf Turner)
Date: Wed, 5 Oct 2022 23:06:08 +1300
Subject: [R] Getting "Error in ect,
 plot.new has not been called yet" despite grouping plot call
In-Reply-To: <PH0PR04MB7493E39389D0196BEC260CB6BE5A9@PH0PR04MB7493.namprd04.prod.outlook.com>
References: <PH0PR04MB7493E39389D0196BEC260CB6BE5A9@PH0PR04MB7493.namprd04.prod.outlook.com>
Message-ID: <20221005230608.793c8b9f@rolf-Latitude-E7470>


What you doing or trying to do is far too complex for my poor feeble
and senile brain to come anywhere near comprehending.  The code that
you present exceeds my complexity tolerance by many orders of magnitude.

I have a suggestion, but.  Strip your code down to the *essentials*.
Construct a simple sequence of plotting commands, with *simple* names
for the pdf files involved.  You should require only two or three such
files and two or three index levels associated with each of your
nested loops.

Run the stripped down code and the source of the problem will almost
surely become clear.

cheers,

Rolf Turner

On Tue, 4 Oct 2022 23:35:09 +0000
"Deramus, Thomas Patrick" <tderamus at partners.org> wrote:

> Sorry to cross-post on Stackoverflow and here but I'm having some
> difficulty.
> https://stackoverflow.com/questions/73942794/still-getting-error-in-ect-plot-new-has-not-been-called-yet-despite-grouping
> 
> Trying to make a nested loop that produces PDFs off different graphs,
> one for ACF/PACF diagnostics and another for the actual data, based
> on some time-series analyses I'm doing.
> 
> Unfortunately, I keep getting the dreaded: Error plot.new has not
> been called yet
> 
> The code is meant to write a PDF containing the ACF and PACF graphs,
> then do some analyses on the timeseries, and then make a separate PDF
> containing a plot describing the timeseries based on the p-values of
> each test for each individual.
> 
> library(plyr)
> library(dplyr)
> library(ggplot2)
> library(Kendall)
> library(lubridate)
> library(xts)
> library(TTR)
> library(trend)
> library(forecast)
> library(openxlsx)
> 
> Game_Metrics_Word_Task <-
> read.xlsx("GamePack_Analytics_ALL_TIME_Short.xlsx", "Boggle")
> Game_Metrics_Word_Task <- Game_Metrics_Word_Task %>%
> filter(grepl('1440', StudyId)) Game_Metrics_Word_Task$DeviceTime <-
> ymd_hms(Game_Metrics_Word_Task$DeviceTime,  tz = "America/New_York")
> Game_Metrics_Word_Task <-
> Game_Metrics_Word_Task[!duplicated(Game_Metrics_Word_Task[1:2,])]
> 
> Participant_Word_Task <-
> split(arrange(Game_Metrics_Word_Task,StudyId,DeviceTime),
> arrange(Game_Metrics_Word_Task,StudyId,DeviceTime,StudyId,DeviceTime)$StudyId)
> 
> WordFrame <- data.frame(Participant = c(0), Task = c(0),
> MannKendall_Tau = c(0), MannKendall_P = c(0), Sen_Slope_Value = c(0),
> Sen_Slope_Pval = c(0), Pettitts_CIV = c(0), Pettitts_Pval = c(0),
> ARIMA_Model = c(0), Time_to_Petit = c(0), Number_of_Trials_to_Pettitt
> = c(0), Playtime_to_Petit_seconds = c(0), Time_Start_to_end_days =
> c(0), Number_of_Total_Trials = c(0), Total_Playtime_seconds = c(0),
> Learning_rate_days = c(0), Learning_rate_seconds = c(0), Learned_Task
> = c(0))
> 
> for (i in 1:length(Participant_Word_Task)){
>     success_series <- xts(filter(Participant_Word_Task[[i]],
> GameEndReason == "TIMER_UP")$NumberOfSuccesfulWords ,
> order.by=as.POSIXct(filter(Participant_Word_Task[[i]], GameEndReason
> == "TIMER_UP")$DeviceTime)) original_series <-
> xts(Participant_Word_Task[[i]]$NumberOfSuccesfulWords,
> order.by=as.POSIXct(Participant_Word_Task[[i]]$DeviceTime))
> success_decomp <- ts(success_series, frequency =
> nweeks(success_series)) original_decomp <- ts(original_series,
> frequency = nweeks(success_series))
> 
>     pdf(paste("Word_Task_Autocorrelation_plots_for_subject_",unique(Participant_Word_Task[[i]]$StudyId),".pdf"
> ,collapse = NULL, sep = "")) par(mfrow=c(1,2))
>     Autocorrelationplot <- acf(success_decomp, main=paste(""))
>     PartialAutocorrelationplot <- pacf(success_decomp, main=paste(""))
>     mtext(paste("Word Task Auto and Partialauto correlations for
> subject ",unique(Participant_Word_Task[[i]]$StudyId)), side = 3, line
> = -3, outer = TRUE) dev.off()
> 
>     AutomatedArimaoutputs <- auto.arima(success_decomp)
>     p <- length(AutomatedArimaoutputs$model$phi)
>     #AR component
>     q <- length(AutomatedArimaoutputs$model$theta)
>     #MA component
>     d <- AutomatedArimaoutputs$model$Delta
>     #order of difference
>     WordFrame[i,1] <- unique(Participant_Word_Task[[i]]$StudyId)
>     WordFrame[i,2] <- "Word"
>     WordFrame[i,3] <- MannKendall(success_decomp)$tau[1]
>     WordFrame[i,4] <- MannKendall(success_decomp)$sl[1]
>     WordFrame[i,5] <- sens.slope(success_decomp)$estimates
>     WordFrame[i,6] <- sens.slope(success_decomp)$p.value
>     WordFrame[i,7] <- pettitt.test(success_decomp)$estimate
>     WordFrame[i,8] <- pettitt.test(success_decomp)$p.value
>     WordFrame[i,9] <- paste("ARIMA(",p,",",q,",",d,")", collapse =
> NULL, sep = "") WordFrame[i,10] <-
> difftime(time(success_series[WordFrame[i,7]]),time(original_series[1]))
> WordFrame[i,11] <- tail(which(grepl(success_series[WordFrame[i,7]],
> original_series)), n=1) WordFrame[i,12] <-
> sum(Participant_Word_Task[[i]]$TotalDuration[1:WordFrame[i,11]])-sum(Participant_Word_Task[[i]]$TotalTimePaused[1:WordFrame[i,11]])
> WordFrame[i,13] <-
> difftime(time(original_series[length(original_series)]),time(original_series[1]))
> WordFrame[i,14] <- length(original_series) WordFrame[i,15] <-
> sum(Participant_Word_Task[[i]]$TotalDuration[1:length(original_series)])-sum(Participant_Word_Task[[i]]$TotalTimePaused[1:length(original_series)])
> 
> 
>     simplemovingaverage <- SMA(original_series, n =
> nweeks(original_series))
> 
>     if (WordFrame[i,4] <= 0.05 & WordFrame[i,6] <= 0.05 &
> WordFrame[i,8] <= 0.05){ {
>               pdf(paste(WordFrame[i,1],"_Word_Task_Acquisition.pdf",collapse
> = NULL, sep = "")) plout <-
> plot(original_series,type='l',col='blue',xlab="Date of
> Play",ylab="Number of Successful Words")
> lines(simplemovingaverage,type='l',col='red') title(paste("Word Task
> Acquisition for Subject", WordFrame[i,1])) abline(v =
> index(original_series[WordFrame[i,7]]),lty=2, col='green', lwd=3)
> dev.off() } WordFrame[i,18] <- T
>               WordFrame[i,16] <- (1-(WordFrame[i,10]/WordFrame[i,13]))
>               WordFrame[i,17] <- (1-(WordFrame[i,12]/WordFrame[i,15]))
>     } else {
>               {
>               pdf(paste(WordFrame[i,1],"_Word_Task_Acquisition.pdf",collapse
> = NULL, sep = "")) plout <-
> plot(original_series,type='l',col='blue',xlab="Date of
> Play",ylab="Number of Successful Words")
> lines(simplemovingaverage,type='l',col='red') title(paste("Word Task
> Acquisition for Subject", WordFrame[i,1])) dev.off() }
>               WordFrame[i,18] <- F
>               WordFrame[i,16] <- 0
>               WordFrame[i,17] <- 0
>     }
> }
> 
> It will work just fine if I run the lines individually (e.g. set i =
> 1, 2, ect), and if I comment out abline and title (lines seems to
> work fine). But it will throw the error everytime I try to run the
> loop without these commented.
> 
> Have tried just about everything I could find on the Stack forums to
> run everything as a single argument and I'm just not sure what is
> wrong with it.
> 
> dev.list() spits out:
> 
> pdf
>   2
> following the error.
> 
> With abline and title commented out and lines run individually it's
> NULL.
> 
> Happens in both RStudio
> 
> 2022.07.2+576 "Spotted Wakerobin" Release
> (e7373ef832b49b2a9b88162cfe7eac5f22c40b34, 2022-09-06) for Ubuntu
> Bionic Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML,
> like Gecko) QtWebEngine/5.12.8 Chrome/69.0.3497.128 Safari/537.36
> 
> And R:
> 
> platform       x86_64-pc-linux-gnu
> arch           x86_64
> os             linux-gnu
> system         x86_64, linux-gnu
> status
> major          4
> minor          2.1
> year           2022
> month          06
> day            23
> svn rev        82513
> language       R
> version.string R version 4.2.1 (2022-06-23)
> nickname       Funny-Looking Kid
> 
> 
> My OS:
> PRETTY_NAME="Debian GNU/Linux 11 (bullseye)"
> NAME="Debian GNU/Linux"
> VERSION_ID="11"
> VERSION="11 (bullseye)"
> VERSION_CODENAME=bullseye
> ID=debian
> HOME_URL="https://www.debian.org"
> SUPPORT_URL="https://www.debian.org/support"
> BUG_REPORT_URL="https://bugs.debian.org"
> No LSB modules are available.
> Distributor ID:???Debian
> Description:??????Debian GNU/Linux 11 (bullseye)
> Release:????11
> Codename:???bullseye
>          Icon name: computer-desktop
>            Chassis: desktop
>         Machine ID: 053ebf23707f49c8ad4e0684f4cf19d3
>            Boot ID: d0e6294d3b944286bef10e76c21e6401
>   Operating System: Debian GNU/Linux 11 (bullseye)
>             Kernel: Linux 5.10.0-18-amd64
>       Architecture: x86-64
> 
> 
> Any suggestions would be greatly appreciated.
> 
> --
> 
> Thomas DeRamus (He/Him/His)
> 
> Data Analyst
> 
> Massachusetts General Hospital Brigham
> 
> Alzheimer?s Clinical & Translational Research Unit
> 
> 149 13th Street
> 
> Charlestown, MA 02129
> 
> Phone: 205-834-5066
> 
> Email: tderamus at partners.org<mailto:tderamus at partners.org>,
> tpderamus at gmail.com<mailto:tpderamus at gmail.com>
> 
> 
> [https://ci3.googleusercontent.com/mail-sig/AIorK4we2sU30P2HyfDQF5hpEjYTt-9FTBK7cAVsP7EenrZ0nsKCf48fuYMtElj6Szn_2fpSPWr66eQ][https://ci3.googleusercontent.com/mail-sig/AIorK4yyY0DlImU0UONJrHTbPc5T3lJj8Kmu8SbDKJJ3XjcX6CgvVsvSueYKwficYFz4zXt6fZV8YIY]
> 
> ?If knowledge can create problems, it is not through ignorance that
> we can solve them.?
> 
> ?Issac Asimov


From petr@p|k@| @end|ng |rom prechez@@cz  Wed Oct  5 12:34:02 2022
From: petr@p|k@| @end|ng |rom prechez@@cz (PIKAL Petr)
Date: Wed, 5 Oct 2022 10:34:02 +0000
Subject: [R] 
 R version 4.2.1 install.packages does not work with IE proxy setting
In-Reply-To: <20221004184256.7ce13c60@arachnoid>
References: <344ae947626245a392ebba421f73e483@SRVEXCHCM1302.precheza.cz>
 <20221004184256.7ce13c60@arachnoid>
Message-ID: <9b38aacf51d746bb87a9cc3765a16b99@SRVEXCHCM1302.precheza.cz>

Thanks, 

the workaround works but we need try the "permanent" solution with
Renviron.site file in future.

Cheers
Petr

> -----Original Message-----
> From: Ivan Krylov <krylov.r00t at gmail.com>
> Sent: Tuesday, October 4, 2022 5:43 PM
> To: PIKAL Petr <petr.pikal at precheza.cz>
> Cc: r-help mailing list <r-help at r-project.org>
> Subject: Re: [R] R version 4.2.1 install.packages does not work with IE
proxy
> setting
> 
> On Tue, 4 Oct 2022 11:01:14 +0000
> PIKAL Petr <petr.pikal at precheza.cz> wrote:
> 
> > After we installed new R version R 4.2.1 installing packages through
> > IE proxy setting is compromised with warning that R could not connect
> > to server (tested in vanilla R).
> 
> R 4.1 deprecated the use of download.file(method = 'wininet'). R 4.2
switched
> the default download method to 'libcurl' and started giving warnings for
> 'wininet' and http[s]:// URLs.
> 
> A workaround to get it working right now would be to set
> options(download.file.method = 'wininet') and live with the resulting
warnings
> while R downloads the files, but a next version of R may remove 'wininet'
> support altogether.
> 
> In order to get it working with the 'libcurl' method, you'll need to
provide some
> environment variables to curl:
> https://stat.ethz.ch/pipermail/r-help/2022-September/475917.html
> 
> Not sure if libcurl would accept a patch to discover the Windows proxy
settings
> automatically, but I don't think it does that now.
> 
> --
> Best regards,
> Ivan

From r@turner @end|ng |rom @uck|@nd@@c@nz  Thu Oct  6 00:28:02 2022
From: r@turner @end|ng |rom @uck|@nd@@c@nz (Rolf Turner)
Date: Thu, 6 Oct 2022 11:28:02 +1300
Subject: [R] Getting "Error in ect,
 plot.new has not been called yet" despite grouping plot call
In-Reply-To: <PH0PR04MB7493CE9332F02B56C0AFE31FBE5D9@PH0PR04MB7493.namprd04.prod.outlook.com>
References: <PH0PR04MB7493E39389D0196BEC260CB6BE5A9@PH0PR04MB7493.namprd04.prod.outlook.com>
 <20221005230608.793c8b9f@rolf-Latitude-E7470>
 <PH0PR04MB7493CE9332F02B56C0AFE31FBE5D9@PH0PR04MB7493.namprd04.prod.outlook.com>
Message-ID: <20221006112802.6897cd27@rolf-Latitude-E7470>



Your code is still much too complex for my feeble brain.

Without trying to understand very much, I get the impression that the
example is *not* reproducible.  It requires reading in Excel (yeucchh!)
files to which no-one but you has access.

Skip the reading-in completely.  Create toy data using rnorm() instead.
Then someone may be able to help you.

On Wed, 5 Oct 2022 13:32:00 +0000
"Deramus, Thomas Patrick" <tderamus at partners.org> wrote:

> Hi Rolf.
> 
> I followed your suggestion (though it's probably not as trimmed as it
> could be), but the problem unfortunately persists.

If the problem *didn't* persist, then *that* would have been
unfortunate!  The idea is to reproduce the problem in a simpler context
so that one can deduce what is causing the problem!

> Does this make it any clearer or still too many moving parts to make
> sense of?

There are still (far) too many moving parts, for me anyway.  Someone
cleverer than I might be able to see what the problem is.

cheers,

Rolf

> 
> rm(list = ls(all.names = TRUE)) #will clear all objects includes
> hidden objects.
> 
> #Loads the packages
> library(plyr)
> library(dplyr)
> library(ggplot2)
> library(Kendall)
> library(lubridate)
> library(xts)
> library(TTR)
> library(trend)
> library(forecast)
> library(openxlsx)
> 
> #Uses the learningCurve Package from Github:
> #https://github.com/AFIT-R/learningCurve
> library(learningCurve)
> 
> #Only load this if using VS Studio because it changes the plot
> function
> #https://stackoverflow.com/questions/52284345/how-to-show-r-graph-from-visual-studio-code
> library(httpgd) library(languageserver)
> 
> #Loads the Excel files to Dataframes and cleans the data
> Game_Metrics_Word_Task <-
> read.xlsx("GamePack_Analytics_ALL_TIME_Short.xlsx", "Boggle")
> Game_Metrics_Word_Task <- Game_Metrics_Word_Task %>%
> filter(grepl('1440', StudyId)) Game_Metrics_Word_Task$DeviceTime <-
> ymd_hms(Game_Metrics_Word_Task$DeviceTime,  tz = "America/New_York")
> Game_Metrics_Word_Task <-
> Game_Metrics_Word_Task[!duplicated(Game_Metrics_Word_Task[1:2,])]
> 
> #Splits the dataframe into a tibble containing each participant
> Participant_Word_Task <-
> split(arrange(Game_Metrics_Word_Task,StudyId,DeviceTime),
> arrange(Game_Metrics_Word_Task,StudyId,DeviceTime,StudyId,DeviceTime)$StudyId)
> 
> #Generates a blank output dataframe
> WordFrame <- data.frame(Participant = c(0), Task = c(0),
> MannKendall_Tau = c(0), MannKendall_P = c(0), Sen_Slope_Value = c(0),
> Sen_Slope_Pval = c(0), Pettitts_CIV = c(0), Pettitts_Pval = c(0),
> ARIMA_Model = c(0), Time_to_Petit = c(0), Number_of_Trials_to_Pettitt
> = c(0), Playtime_to_Petit_seconds = c(0), Time_Start_to_end_days =
> c(0), Number_of_Total_Trials = c(0), Total_Playtime_seconds = c(0),
> Learning_rate_days = c(0), Learning_rate_seconds = c(0), Learned_Task
> = c(0))
> 
> #The number of subjects in the xlsx file
> #Reduced to 2 for ease of use
> for (i in 1:2){
>   #This timeseries only includes the trials where the participant
> completed the task success_series <-
> xts(filter(Participant_Word_Task[[i]], GameEndReason ==
> "TIMER_UP")$NumberOfSuccesfulWords ,
> order.by=as.POSIXct(filter(Participant_Word_Task[[i]], GameEndReason
> == "TIMER_UP")$DeviceTime)) #This timeseries includes ALL the trials
> for the sake of plotting original_series <-
> xts(Participant_Word_Task[[i]]$NumberOfSuccesfulWords,
> order.by=as.POSIXct(Participant_Word_Task[[i]]$DeviceTime))
> 
>   #This is a decomposing process that xts seems to need for plotting.
>   #nweeks is needed for xts to plot the x-axis
>   success_decomp <- ts(success_series, frequency =
> nweeks(success_series)) original_decomp <- ts(original_series,
> frequency = nweeks(success_series))
> 
>   #Values which will be included in the plots
>   WordFrame[i,1] <- unique(Participant_Word_Task[[i]]$StudyId)
>   WordFrame[i,5] <- sens.slope(success_decomp)$estimates
>   WordFrame[i,6] <- sens.slope(success_decomp)$p.value
>   WordFrame[i,7] <- pettitt.test(success_decomp)$estimate
>   WordFrame[i,8] <- pettitt.test(success_decomp)$p.value
> 
>   #The simple moving average that will be overlayed with the plotted
> data simplemovingaverage <- SMA(original_series, n =
> nweeks(original_series))
> 
>   #If the three tests are statistically significant, add a green
> horizontal like to value WordFrame[i,7] #Which would be where the
> slope changes in the series #Fluid variables have been removed from
> all pdf() and paste() functions for ease-of-use if (WordFrame[i,4] <=
> 0.05 & WordFrame[i,6] <= 0.05 & WordFrame[i,8] <= 0.05){ {
>       pdf(file = "Word_Task_Acquisition.pdf")
>       plout <- plot(original_series)
>       lines(simplemovingaverage)
>       abline(v = index(original_series[WordFrame[i,7]]),lty=2,
> col='green', lwd=3) title(paste("Word Task Acquisition for Subject"))
>       dev.off()
>      }
>   #If the three tests are NOT statistically significant, generate a
> plot with NO horizontal line at WordFrame[i,7] } else {
>     {
>       pdf(file = "Word_Task_Acquisition.pdf")
>       plout <- plot(original_series)
>       lines(simplemovingaverage)
>       title(paste("Word Task Acquisition for Subject"))
>       dev.off()
>     }
>   }
> }
> 
> ________________________________
> From: Rolf Turner <r.turner at auckland.ac.nz>
> Sent: Wednesday, October 5, 2022 6:06 AM
> To: Deramus, Thomas Patrick <tderamus at partners.org>
> Cc: r-help at r-project.org <r-help at r-project.org>
> Subject: Re: [R] Getting "Error in ect, plot.new has not been called
> yet" despite grouping plot call
> 
>         External Email - Use Caution
> 
> What you doing or trying to do is far too complex for my poor feeble
> and senile brain to come anywhere near comprehending.  The code that
> you present exceeds my complexity tolerance by many orders of
> magnitude.
> 
> I have a suggestion, but.  Strip your code down to the *essentials*.
> Construct a simple sequence of plotting commands, with *simple* names
> for the pdf files involved.  You should require only two or three such
> files and two or three index levels associated with each of your
> nested loops.
> 
> Run the stripped down code and the source of the problem will almost
> surely become clear.
> 
> cheers,
> 
> Rolf Turner
> 
> On Tue, 4 Oct 2022 23:35:09 +0000
> "Deramus, Thomas Patrick" <tderamus at partners.org> wrote:
> 
> > Sorry to cross-post on Stackoverflow and here but I'm having some
> > difficulty.
> > https://secure-web.cisco.com/1_juqv4RvefQFJofsnOQcQA3Ixge89s4uC26pjoPBaYOSxSLGisKtgUTZkanxeHNRqNmjl30B8wYKfsppHje4T8Su77i7t8UbMKzs3GBKEyQva4yTjPH76Q9-l6tT24bB4qNMPQeFAxrkG5lpozNpGrDIAjfKCMvgS-5Qjs-QmvhWZfo84_3SK9rHhJjJvO9CqXb0MewWwI-dEmkZemjxnliGe_D9nooo7Ebjuw0dpBuMnrdaTzQxDdivsbkujPnrGurdjLARh93RW5IWPszNwaoziRD7P-30McF1PrAP8_yjWrhxQ_S3AgG6k40EoQJU/https%3A%2F%2Fstackoverflow.com%2Fquestions%2F73942794%2Fstill-getting-error-in-ect-plot-new-has-not-been-called-yet-despite-grouping
> >
> > Trying to make a nested loop that produces PDFs off different
> > graphs, one for ACF/PACF diagnostics and another for the actual
> > data, based on some time-series analyses I'm doing.
> >
> > Unfortunately, I keep getting the dreaded: Error plot.new has not
> > been called yet
> >
> > The code is meant to write a PDF containing the ACF and PACF graphs,
> > then do some analyses on the timeseries, and then make a separate
> > PDF containing a plot describing the timeseries based on the
> > p-values of each test for each individual.
> >
> > library(plyr)
> > library(dplyr)
> > library(ggplot2)
> > library(Kendall)
> > library(lubridate)
> > library(xts)
> > library(TTR)
> > library(trend)
> > library(forecast)
> > library(openxlsx)
> >
> > Game_Metrics_Word_Task <-
> > read.xlsx("GamePack_Analytics_ALL_TIME_Short.xlsx", "Boggle")
> > Game_Metrics_Word_Task <- Game_Metrics_Word_Task %>%
> > filter(grepl('1440', StudyId)) Game_Metrics_Word_Task$DeviceTime <-
> > ymd_hms(Game_Metrics_Word_Task$DeviceTime,  tz = "America/New_York")
> > Game_Metrics_Word_Task <-
> > Game_Metrics_Word_Task[!duplicated(Game_Metrics_Word_Task[1:2,])]
> >
> > Participant_Word_Task <-
> > split(arrange(Game_Metrics_Word_Task,StudyId,DeviceTime),
> > arrange(Game_Metrics_Word_Task,StudyId,DeviceTime,StudyId,DeviceTime)$StudyId)
> >
> > WordFrame <- data.frame(Participant = c(0), Task = c(0),
> > MannKendall_Tau = c(0), MannKendall_P = c(0), Sen_Slope_Value =
> > c(0), Sen_Slope_Pval = c(0), Pettitts_CIV = c(0), Pettitts_Pval =
> > c(0), ARIMA_Model = c(0), Time_to_Petit = c(0),
> > Number_of_Trials_to_Pettitt = c(0), Playtime_to_Petit_seconds =
> > c(0), Time_Start_to_end_days = c(0), Number_of_Total_Trials = c(0),
> > Total_Playtime_seconds = c(0), Learning_rate_days = c(0),
> > Learning_rate_seconds = c(0), Learned_Task = c(0))
> >
> > for (i in 1:length(Participant_Word_Task)){
> >     success_series <- xts(filter(Participant_Word_Task[[i]],
> > GameEndReason == "TIMER_UP")$NumberOfSuccesfulWords ,
> > order.by=as.POSIXct(filter(Participant_Word_Task[[i]], GameEndReason
> > == "TIMER_UP")$DeviceTime)) original_series <-
> > xts(Participant_Word_Task[[i]]$NumberOfSuccesfulWords,
> > order.by=as.POSIXct(Participant_Word_Task[[i]]$DeviceTime))
> > success_decomp <- ts(success_series, frequency =
> > nweeks(success_series)) original_decomp <- ts(original_series,
> > frequency = nweeks(success_series))
> >
> >     pdf(paste("Word_Task_Autocorrelation_plots_for_subject_",unique(Participant_Word_Task[[i]]$StudyId),".pdf"
> > ,collapse = NULL, sep = "")) par(mfrow=c(1,2))
> >     Autocorrelationplot <- acf(success_decomp, main=paste(""))
> >     PartialAutocorrelationplot <- pacf(success_decomp,
> > main=paste("")) mtext(paste("Word Task Auto and Partialauto
> > correlations for subject
> > ",unique(Participant_Word_Task[[i]]$StudyId)), side = 3, line = -3,
> > outer = TRUE) dev.off()
> >
> >     AutomatedArimaoutputs <- auto.arima(success_decomp)
> >     p <- length(AutomatedArimaoutputs$model$phi)
> >     #AR component
> >     q <- length(AutomatedArimaoutputs$model$theta)
> >     #MA component
> >     d <- AutomatedArimaoutputs$model$Delta
> >     #order of difference
> >     WordFrame[i,1] <- unique(Participant_Word_Task[[i]]$StudyId)
> >     WordFrame[i,2] <- "Word"
> >     WordFrame[i,3] <- MannKendall(success_decomp)$tau[1]
> >     WordFrame[i,4] <- MannKendall(success_decomp)$sl[1]
> >     WordFrame[i,5] <- sens.slope(success_decomp)$estimates
> >     WordFrame[i,6] <- sens.slope(success_decomp)$p.value
> >     WordFrame[i,7] <- pettitt.test(success_decomp)$estimate
> >     WordFrame[i,8] <- pettitt.test(success_decomp)$p.value
> >     WordFrame[i,9] <- paste("ARIMA(",p,",",q,",",d,")", collapse =
> > NULL, sep = "") WordFrame[i,10] <-
> > difftime(time(success_series[WordFrame[i,7]]),time(original_series[1]))
> > WordFrame[i,11] <- tail(which(grepl(success_series[WordFrame[i,7]],
> > original_series)), n=1) WordFrame[i,12] <-
> > sum(Participant_Word_Task[[i]]$TotalDuration[1:WordFrame[i,11]])-sum(Participant_Word_Task[[i]]$TotalTimePaused[1:WordFrame[i,11]])
> > WordFrame[i,13] <-
> > difftime(time(original_series[length(original_series)]),time(original_series[1]))
> > WordFrame[i,14] <- length(original_series) WordFrame[i,15] <-
> > sum(Participant_Word_Task[[i]]$TotalDuration[1:length(original_series)])-sum(Participant_Word_Task[[i]]$TotalTimePaused[1:length(original_series)])
> >
> >
> >     simplemovingaverage <- SMA(original_series, n =
> > nweeks(original_series))
> >
> >     if (WordFrame[i,4] <= 0.05 & WordFrame[i,6] <= 0.05 &
> > WordFrame[i,8] <= 0.05){ {
> >               pdf(paste(WordFrame[i,1],"_Word_Task_Acquisition.pdf",collapse
> > = NULL, sep = "")) plout <-
> > plot(original_series,type='l',col='blue',xlab="Date of
> > Play",ylab="Number of Successful Words")
> > lines(simplemovingaverage,type='l',col='red') title(paste("Word Task
> > Acquisition for Subject", WordFrame[i,1])) abline(v =
> > index(original_series[WordFrame[i,7]]),lty=2, col='green', lwd=3)
> > dev.off() } WordFrame[i,18] <- T
> >               WordFrame[i,16] <-
> > (1-(WordFrame[i,10]/WordFrame[i,13])) WordFrame[i,17] <-
> > (1-(WordFrame[i,12]/WordFrame[i,15])) } else {
> >               {
> >               pdf(paste(WordFrame[i,1],"_Word_Task_Acquisition.pdf",collapse
> > = NULL, sep = "")) plout <-
> > plot(original_series,type='l',col='blue',xlab="Date of
> > Play",ylab="Number of Successful Words")
> > lines(simplemovingaverage,type='l',col='red') title(paste("Word Task
> > Acquisition for Subject", WordFrame[i,1])) dev.off() }
> >               WordFrame[i,18] <- F
> >               WordFrame[i,16] <- 0
> >               WordFrame[i,17] <- 0
> >     }
> > }
> >
> > It will work just fine if I run the lines individually (e.g. set i =
> > 1, 2, ect), and if I comment out abline and title (lines seems to
> > work fine). But it will throw the error everytime I try to run the
> > loop without these commented.
> >
> > Have tried just about everything I could find on the Stack forums to
> > run everything as a single argument and I'm just not sure what is
> > wrong with it.
> >
> > dev.list() spits out:
> >
> > pdf
> >   2
> > following the error.
> >
> > With abline and title commented out and lines run individually it's
> > NULL.
> >
> > Happens in both RStudio
> >
> > 2022.07.2+576 "Spotted Wakerobin" Release
> > (e7373ef832b49b2a9b88162cfe7eac5f22c40b34, 2022-09-06) for Ubuntu
> > Bionic Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML,
> > like Gecko) QtWebEngine/5.12.8 Chrome/69.0.3497.128 Safari/537.36
> >
> > And R:
> >
> > platform       x86_64-pc-linux-gnu
> > arch           x86_64
> > os             linux-gnu
> > system         x86_64, linux-gnu
> > status
> > major          4
> > minor          2.1
> > year           2022
> > month          06
> > day            23
> > svn rev        82513
> > language       R
> > version.string R version 4.2.1 (2022-06-23)
> > nickname       Funny-Looking Kid
> >
> >
> > My OS:
> > PRETTY_NAME="Debian GNU/Linux 11 (bullseye)"
> > NAME="Debian GNU/Linux"
> > VERSION_ID="11"
> > VERSION="11 (bullseye)"
> > VERSION_CODENAME=bullseye
> > ID=debian
> > HOME_URL="https://secure-web.cisco.com/1Ruvt90Q90ixR-GE-RDiKJgzRpfDjlNz-lZTqQQGM8Tf4GAoj5QOfE2vXMaMWxMoexuf1npQrX7uAjFuU2viz28h42RPmHQK7jGDX7BpRLkTNcERyxHVKJTxgYegXo-n9N7rqegcKsrr47xlGmTcMOJcBAqH7SpTPQlYDOGgjz1ErtetQRzUsd-eKs9l4oCVPiF6SKV40C7s_NXm0tuCswL2Jhyfv70-edCtBO_4j9-3dSi5ZdFLYaWsMScnwwxNIGYU2n0vw5NH4GJcZNsv6Scu-r6W8ndJaGL4UmX9J3PX0LrdFyjLbGtA7RqPpKFUQ/https%3A%2F%2Fwww.debian.org"
> > SUPPORT_URL="https://secure-web.cisco.com/1gveQttVrJNRSM85857IiydpLraxrrtJobMyCNkRvQ4V2f00DH67Z0hEa50LLpCVYQvIjMsQZxHAVMZvYQV_Cp2-e82TDZzPY4aSR2td2th3bwuXGxtI7CTgSUudOWgPpmnwVLT5r34EnwXEmwnMoiPVnOEC7slpF1fLGq11wSynuyttcTagMfpN6qdYfgtbu_mz0JOBUecQ-etUQYw5BDmXEKv5JZ_y5Uyt8Q89Kirhi7Hk8FMbCVcxRZpOZZmghxlPMxYaNVIOnln-R0H8J2QIzqE49cQQPKkFZ9O29zpr8odlBXqjObKn24ReYPDhH/https%3A%2F%2Fwww.debian.org%2Fsupport"
> > BUG_REPORT_URL="https://secure-web.cisco.com/1tepDnCjDgHsmvw9Eth-7nfyKi3doVSOFKVzz83wskdyf8lsrEVkG2NYw7am6ePhSFfjQXdDyceMyc21Un-vqTirSQYKdPavRdKJy85HgHMP66Xk-OgxFf-5KXiPzmFreDfuuJlYizGSUNOLcADyNVTCo47xFfRgtB83Hs8j3yYAJFrff7TqNOFWzSzTcfrycio_WSSfbQkLpUl-1xGzg-dvP16tKuwkRr62bkPeydXJC_iH1FfnWv5b1G04au3aFmRTem8t2RS40LPMS9Mh0UmMvHD_9qwX16cFMHQ8U4x9Sp9IUcAFhgnbffOyPQm1C/https%3A%2F%2Fbugs.debian.org"
> > No LSB modules are available.
> > Distributor ID:???Debian
> > Description:??????Debian GNU/Linux 11 (bullseye)
> > Release:????11
> > Codename:???bullseye
> >          Icon name: computer-desktop
> >            Chassis: desktop
> >         Machine ID: 053ebf23707f49c8ad4e0684f4cf19d3
> >            Boot ID: d0e6294d3b944286bef10e76c21e6401
> >   Operating System: Debian GNU/Linux 11 (bullseye)
> >             Kernel: Linux 5.10.0-18-amd64
> >       Architecture: x86-64
> >
> >
> > Any suggestions would be greatly appreciated.
> >
> > --
> >
> > Thomas DeRamus (He/Him/His)
> >
> > Data Analyst
> >
> > Massachusetts General Hospital Brigham
> >
> > Alzheimer?s Clinical & Translational Research Unit
> >
> > 149 13th Street
> >
> > Charlestown, MA 02129
> >
> > Phone: 205-834-5066
> >
> > Email: tderamus at partners.org<mailto:tderamus at partners.org>,
> > tpderamus at gmail.com<mailto:tpderamus at gmail.com>
> >
> >
> > [https://secure-web.cisco.com/1AI4S4rz4bDZGM8naa-19GTAeSORO5ZmNe056Q_nhPRk4JVAzPiRKUBWitBK5TpxoKBLoLvNfoMDanGd1n5Bnf4SJFT7l7HnaLcjjH7oVk2BZdDfCLHo8a8eePvD4XrF2Fw3iuxKgIZY5dwdesP3P8pSvkmVGvyZ-HiEKRetk4uJHhRa6gSgOQ8MbCVKmi6XP1dtozTEH1RpDrFJ4EyevPO52UzaTAY6CR8USLWNbsxXJsnsjUz1G6_4P7B3ULuMu9mEPeQz_GnTrSXTrGZooK_idhoEougti7I8NYV0CS09Yahmp4Fe_vh9wu4Jkdal3/https://ci3.googleusercontent.com/mail-sig/AIorK4we2sU30P2HyfDQF5hpEjYTt-9FTBK7cAVsP7EenrZ0nsKCf48fuYMtElj6Szn_2fpSPWr66eQ][https://ci3.googleusercontent.com/mail-sig/AIorK4yyY0DlImU0UONJrHTbPc5T3lJj8Kmu8SbDKJJ3XjcX6CgvVsvSueYKwficYFz4zXt6fZV8YIY]
> >
> > ?If knowledge can create problems, it is not through ignorance that
> > we can solve them.?
> >
> > ?Issac Asimo


From jo@h@m@u|r|ch @end|ng |rom gm@||@com  Thu Oct  6 03:16:18 2022
From: jo@h@m@u|r|ch @end|ng |rom gm@||@com (Joshua Ulrich)
Date: Wed, 5 Oct 2022 20:16:18 -0500
Subject: [R] Getting "Error in ect,
 plot.new has not been called yet" despite grouping plot call
In-Reply-To: <PH0PR04MB7493E39389D0196BEC260CB6BE5A9@PH0PR04MB7493.namprd04.prod.outlook.com>
References: <PH0PR04MB7493E39389D0196BEC260CB6BE5A9@PH0PR04MB7493.namprd04.prod.outlook.com>
Message-ID: <CAPPM_gRn-HVg2oc8fkNDsJtqm1VSpa4C68z0tCHxPN7b7qQWEw@mail.gmail.com>

Hi,

My hunch is that you need to add print(plout) before you call dev.off().
See https://stackoverflow.com/a/39853861

Try that and let me know if that works. If not, I'll take a closer look
later.

Best,
Josh


On Wed, Oct 5, 2022, 1:40 AM Deramus, Thomas Patrick <tderamus at partners.org>
wrote:

> Sorry to cross-post on Stackoverflow and here but I'm having some
> difficulty.
>
> https://stackoverflow.com/questions/73942794/still-getting-error-in-ect-plot-new-has-not-been-called-yet-despite-grouping
>
> Trying to make a nested loop that produces PDFs off different graphs, one
> for ACF/PACF diagnostics and another for the actual data, based on some
> time-series analyses I'm doing.
>
> Unfortunately, I keep getting the dreaded: Error plot.new has not been
> called yet
>
> The code is meant to write a PDF containing the ACF and PACF graphs, then
> do some analyses on the timeseries, and then make a separate PDF containing
> a plot describing the timeseries based on the p-values of each test for
> each individual.
>
> library(plyr)
> library(dplyr)
> library(ggplot2)
> library(Kendall)
> library(lubridate)
> library(xts)
> library(TTR)
> library(trend)
> library(forecast)
> library(openxlsx)
>
> Game_Metrics_Word_Task <-
> read.xlsx("GamePack_Analytics_ALL_TIME_Short.xlsx", "Boggle")
> Game_Metrics_Word_Task <- Game_Metrics_Word_Task %>% filter(grepl('1440',
> StudyId))
> Game_Metrics_Word_Task$DeviceTime <-
> ymd_hms(Game_Metrics_Word_Task$DeviceTime,  tz = "America/New_York")
> Game_Metrics_Word_Task <-
> Game_Metrics_Word_Task[!duplicated(Game_Metrics_Word_Task[1:2,])]
>
> Participant_Word_Task <-
> split(arrange(Game_Metrics_Word_Task,StudyId,DeviceTime),
> arrange(Game_Metrics_Word_Task,StudyId,DeviceTime,StudyId,DeviceTime)$StudyId)
>
> WordFrame <- data.frame(Participant = c(0), Task = c(0), MannKendall_Tau =
> c(0), MannKendall_P = c(0), Sen_Slope_Value = c(0), Sen_Slope_Pval = c(0),
> Pettitts_CIV = c(0), Pettitts_Pval = c(0), ARIMA_Model = c(0),
> Time_to_Petit = c(0), Number_of_Trials_to_Pettitt = c(0),
> Playtime_to_Petit_seconds = c(0), Time_Start_to_end_days = c(0),
> Number_of_Total_Trials = c(0), Total_Playtime_seconds = c(0),
> Learning_rate_days = c(0), Learning_rate_seconds = c(0), Learned_Task =
> c(0))
>
> for (i in 1:length(Participant_Word_Task)){
>     success_series <- xts(filter(Participant_Word_Task[[i]], GameEndReason
> == "TIMER_UP")$NumberOfSuccesfulWords , order.by=as.POSIXct(filter(Participant_Word_Task[[i]],
> GameEndReason == "TIMER_UP")$DeviceTime))
>     original_series <-
> xts(Participant_Word_Task[[i]]$NumberOfSuccesfulWords, order.by
> =as.POSIXct(Participant_Word_Task[[i]]$DeviceTime))
>     success_decomp <- ts(success_series, frequency =
> nweeks(success_series))
>     original_decomp <- ts(original_series, frequency =
> nweeks(success_series))
>
>
> pdf(paste("Word_Task_Autocorrelation_plots_for_subject_",unique(Participant_Word_Task[[i]]$StudyId),".pdf"
> ,collapse = NULL, sep = ""))
>     par(mfrow=c(1,2))
>     Autocorrelationplot <- acf(success_decomp, main=paste(""))
>     PartialAutocorrelationplot <- pacf(success_decomp, main=paste(""))
>     mtext(paste("Word Task Auto and Partialauto correlations for subject
> ",unique(Participant_Word_Task[[i]]$StudyId)), side = 3, line = -3, outer =
> TRUE)
>     dev.off()
>
>     AutomatedArimaoutputs <- auto.arima(success_decomp)
>     p <- length(AutomatedArimaoutputs$model$phi)
>     #AR component
>     q <- length(AutomatedArimaoutputs$model$theta)
>     #MA component
>     d <- AutomatedArimaoutputs$model$Delta
>     #order of difference
>     WordFrame[i,1] <- unique(Participant_Word_Task[[i]]$StudyId)
>     WordFrame[i,2] <- "Word"
>     WordFrame[i,3] <- MannKendall(success_decomp)$tau[1]
>     WordFrame[i,4] <- MannKendall(success_decomp)$sl[1]
>     WordFrame[i,5] <- sens.slope(success_decomp)$estimates
>     WordFrame[i,6] <- sens.slope(success_decomp)$p.value
>     WordFrame[i,7] <- pettitt.test(success_decomp)$estimate
>     WordFrame[i,8] <- pettitt.test(success_decomp)$p.value
>     WordFrame[i,9] <- paste("ARIMA(",p,",",q,",",d,")", collapse = NULL,
> sep = "")
>     WordFrame[i,10] <-
> difftime(time(success_series[WordFrame[i,7]]),time(original_series[1]))
>     WordFrame[i,11] <- tail(which(grepl(success_series[WordFrame[i,7]],
> original_series)), n=1)
>     WordFrame[i,12] <-
> sum(Participant_Word_Task[[i]]$TotalDuration[1:WordFrame[i,11]])-sum(Participant_Word_Task[[i]]$TotalTimePaused[1:WordFrame[i,11]])
>     WordFrame[i,13] <-
> difftime(time(original_series[length(original_series)]),time(original_series[1]))
>     WordFrame[i,14] <- length(original_series)
>     WordFrame[i,15] <-
> sum(Participant_Word_Task[[i]]$TotalDuration[1:length(original_series)])-sum(Participant_Word_Task[[i]]$TotalTimePaused[1:length(original_series)])
>
>
>     simplemovingaverage <- SMA(original_series, n =
> nweeks(original_series))
>
>     if (WordFrame[i,4] <= 0.05 & WordFrame[i,6] <= 0.05 & WordFrame[i,8]
> <= 0.05){
>               {
>
> pdf(paste(WordFrame[i,1],"_Word_Task_Acquisition.pdf",collapse = NULL, sep
> = ""))
>               plout <- plot(original_series,type='l',col='blue',xlab="Date
> of Play",ylab="Number of Successful Words")
>               lines(simplemovingaverage,type='l',col='red')
>               title(paste("Word Task Acquisition for Subject",
> WordFrame[i,1]))
>               abline(v = index(original_series[WordFrame[i,7]]),lty=2,
> col='green', lwd=3)
>               dev.off()
>               }
>               WordFrame[i,18] <- T
>               WordFrame[i,16] <- (1-(WordFrame[i,10]/WordFrame[i,13]))
>               WordFrame[i,17] <- (1-(WordFrame[i,12]/WordFrame[i,15]))
>     } else {
>               {
>
> pdf(paste(WordFrame[i,1],"_Word_Task_Acquisition.pdf",collapse = NULL, sep
> = ""))
>               plout <- plot(original_series,type='l',col='blue',xlab="Date
> of Play",ylab="Number of Successful Words")
>               lines(simplemovingaverage,type='l',col='red')
>               title(paste("Word Task Acquisition for Subject",
> WordFrame[i,1]))
>               dev.off()
>               }
>               WordFrame[i,18] <- F
>               WordFrame[i,16] <- 0
>               WordFrame[i,17] <- 0
>     }
> }
>
> It will work just fine if I run the lines individually (e.g. set i = 1, 2,
> ect), and if I comment out abline and title (lines seems to work fine). But
> it will throw the error everytime I try to run the loop without these
> commented.
>
> Have tried just about everything I could find on the Stack forums to run
> everything as a single argument and I'm just not sure what is wrong with it.
>
> dev.list() spits out:
>
> pdf
>   2
> following the error.
>
> With abline and title commented out and lines run individually it's NULL.
>
> Happens in both RStudio
>
> 2022.07.2+576 "Spotted Wakerobin" Release
> (e7373ef832b49b2a9b88162cfe7eac5f22c40b34, 2022-09-06) for Ubuntu Bionic
> Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko)
> QtWebEngine/5.12.8 Chrome/69.0.3497.128 Safari/537.36
>
> And R:
>
> platform       x86_64-pc-linux-gnu
> arch           x86_64
> os             linux-gnu
> system         x86_64, linux-gnu
> status
> major          4
> minor          2.1
> year           2022
> month          06
> day            23
> svn rev        82513
> language       R
> version.string R version 4.2.1 (2022-06-23)
> nickname       Funny-Looking Kid
>
>
> My OS:
> PRETTY_NAME="Debian GNU/Linux 11 (bullseye)"
> NAME="Debian GNU/Linux"
> VERSION_ID="11"
> VERSION="11 (bullseye)"
> VERSION_CODENAME=bullseye
> ID=debian
> HOME_URL="https://www.debian.org/"
> SUPPORT_URL="https://www.debian.org/support"
> BUG_REPORT_URL="https://bugs.debian.org/"
> No LSB modules are available.
> Distributor ID: Debian
> Description: Debian GNU/Linux 11 (bullseye)
> Release: 11
> Codename: bullseye
>          Icon name: computer-desktop
>            Chassis: desktop
>         Machine ID: 053ebf23707f49c8ad4e0684f4cf19d3
>            Boot ID: d0e6294d3b944286bef10e76c21e6401
>   Operating System: Debian GNU/Linux 11 (bullseye)
>             Kernel: Linux 5.10.0-18-amd64
>       Architecture: x86-64
>
>
> Any suggestions would be greatly appreciated.
>
> --
>
> Thomas DeRamus (He/Him/His)
>
> Data Analyst
>
> Massachusetts General Hospital Brigham
>
> Alzheimer?s Clinical & Translational Research Unit
>
> 149 13th Street
>
> Charlestown, MA 02129
>
> Phone: 205-834-5066
>
> Email: tderamus at partners.org<mailto:tderamus at partners.org>,
> tpderamus at gmail.com<mailto:tpderamus at gmail.com>
>
>
> [
> https://ci3.googleusercontent.com/mail-sig/AIorK4we2sU30P2HyfDQF5hpEjYTt-9FTBK7cAVsP7EenrZ0nsKCf48fuYMtElj6Szn_2fpSPWr66eQ][https://ci3.googleusercontent.com/mail-sig/AIorK4yyY0DlImU0UONJrHTbPc5T3lJj8Kmu8SbDKJJ3XjcX6CgvVsvSueYKwficYFz4zXt6fZV8YIY
> ]
>
> ?If knowledge can create problems, it is not through ignorance that we can
> solve them.?
>
> ?Issac Asimov
> The information in this e-mail is intended only for th...{{dropped:22}}


From Er|c@RhonC@|deron @end|ng |rom pennmed|c|ne@upenn@edu  Wed Oct  5 22:02:02 2022
From: Er|c@RhonC@|deron @end|ng |rom pennmed|c|ne@upenn@edu (Rhon Calderon, Eric)
Date: Wed, 5 Oct 2022 20:02:02 +0000
Subject: [R] Help installing devtools plus other packages in R terminal
Message-ID: <MN2PR04MB6400967EAC2449BB0F2A528BCB5D9@MN2PR04MB6400.namprd04.prod.outlook.com>

Hi,

I am using R in my HPC terminal. After many tries, I was able to install and exec successfully R on my HPC but now I cannot install devtools and other dependencies. I need some of theses packages to install some others from bioconductor. I was wondering if anybody has a solution.

The script I got from my R session is (the highlighted part is the errors I keep getting):

> install.packages('devtools')
Installing package into ?/home/ericrhon/R/x86_64-pc-linux-gnu-library/4.2?
(as ?lib? is unspecified)
--- Please select a CRAN mirror for use in this session ---
Secure CRAN mirrors

 1: 0-Cloud [https]
 2: Australia (Canberra) [https]
 3: Australia (Melbourne 1) [https]
 4: Australia (Melbourne 2) [https]
 5: Australia (Perth) [https]
 6: Austria [https]
 7: Belgium (Brussels) [https]
 8: Brazil (PR) [https]
 9: Brazil (RJ) [https]
10: Brazil (SP 1) [https]
11: Brazil (SP 2) [https]
12: Bulgaria [https]
13: Canada (MB) [https]
14: Canada (ON 3) [https]
15: Chile (Santiago) [https]
16: China (Beijing 2) [https]
17: China (Beijing 3) [https]
18: China (Hefei) [https]
19: China (Hong Kong) [https]
20: China (Guangzhou) [https]
21: China (Lanzhou) [https]
22: China (Nanjing) [https]
23: China (Shanghai 2) [https]
24: China (Shenzhen) [https]
25: Colombia (Cali) [https]
26: Costa Rica [https]
27: Cyprus [https]
28: Czech Republic [https]
29: Denmark [https]
30: East Asia [https]
31: Ecuador (Cuenca) [https]
32: Ecuador (Quito) [https]
33: France (Lyon 1) [https]
34: France (Lyon 2) [https]
35: France (Marseille) [https]
36: France (Paris 1) [https]
37: Germany (Erlangen) [https]
38: Germany (Leipzig) [https]
39: Germany (G?ttingen) [https]
40: Germany (M?nster) [https]
41: Germany (Regensburg) [https]
42: Greece [https]
43: Hungary [https]
44: Iceland [https]
45: India [https]
46: Indonesia (Banda Aceh) [https]
47: Iran (Mashhad) [https]
48: Italy (Milano) [https]
49: Italy (Padua) [https]
50: Japan (Tokyo) [https]
51: Japan (Yonezawa) [https]
52: Korea (Gyeongsan-si) [https]
53: Korea (Ulsan) [https]
54: Malaysia [https]
55: Mexico (Mexico City) [https]
56: Mexico (Texcoco) [https]
57: Morocco [https]
58: Netherlands (Dronten) [https]
59: New Zealand [https]
60: Norway [https]
61: South Africa (Johannesburg) [https]
62: Spain (A Coru?a) [https]
63: Spain (Madrid) [https]
64: Sweden (Bor?s) [https]
65: Sweden (Ume?) [https]
66: Switzerland [https]
67: Taiwan (Taipei) [https]
68: Turkey (Denizli) [https]
69: Turkey (Istanbul) [https]
70: Turkey (Mersin) [https]
71: UK (Bristol) [https]
72: UK (London 1) [https]
73: USA (IA) [https]
74: USA (MI) [https]
75: USA (MO) [https]
76: USA (OH) [https]
77: USA (OR) [https]
78: USA (TN) [https]
79: USA (TX 1) [https]
80: Uruguay [https]
81: (other mirrors)

Selection: 1
also installing the dependencies ?httpuv?, ?shiny?, ?miniUI?

trying URL 'https://cloud.r-project.org/src/contrib/httpuv_1.6.6.tar.gz'
Content type 'application/x-gzip' length 1875264 bytes (1.8 MB)
==================================================
downloaded 1.8 MB

trying URL 'https://cloud.r-project.org/src/contrib/shiny_1.7.2.tar.gz'
Content type 'application/x-gzip' length 2982507 bytes (2.8 MB)
==================================================
downloaded 2.8 MB

trying URL 'https://cloud.r-project.org/src/contrib/miniUI_0.1.1.1.tar.gz'
Content type 'application/x-gzip' length 97958 bytes (95 KB)
==================================================
downloaded 95 KB

trying URL 'https://cloud.r-project.org/src/contrib/devtools_2.4.4.tar.gz'
Content type 'application/x-gzip' length 374492 bytes (365 KB)
==================================================
downloaded 365 KB

* installing *source* package ?httpuv? ...
** package ?httpuv? successfully unpacked and MD5 sums checked
** using staged installation
** libs
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c RcppExports-legacy.cpp -o RcppExports-legacy.o

g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c RcppExports.cpp -o RcppExports.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c callback.cpp -o callback.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c callbackqueue.cpp -o callbackqueue.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c filedatasource-unix.cpp -o filedatasource-unix.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c filedatasource-win.cpp -o filedatasource-win.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c fs.cpp -o fs.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c gzipdatasource.cpp -o gzipdatasource.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c http.cpp -o http.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c httprequest.cpp -o httprequest.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c httpresponse.cpp -o httpresponse.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c httpuv.cpp -o httpuv.o
gcc -std=gnu11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c md5.c -o md5.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c mime.cpp -o mime.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c socket.cpp -o socket.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c staticpath.cpp -o staticpath.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c thread.cpp -o thread.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c timegm.cpp -o timegm.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c utils.cpp -o utils.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c uvutil.cpp -o uvutil.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c webapplication.cpp -o webapplication.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c websockets-base.cpp -o websockets-base.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c websockets-hixie76.cpp -o websockets-hixie76.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c websockets-hybi03.cpp -o websockets-hybi03.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c websockets-ietf.cpp -o websockets-ietf.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c websockets.cpp -o websockets.o
g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c winutils.cpp -o winutils.o
cp -p -f libuv/m4/lt_obsolete.m4 libuv/m4/lt~obsolete.m4
cd libuv; \
if ! command -v automake >/dev/null 2>&1 ; then \
??????echo "automake not found. Touching files so configure will not try to run automake."; \
??????touch aclocal.m4; \
??????touch -r aclocal.m4 configure Makefile.in; \
else \
??????echo "automake found. Running autoupdate and autogen.sh."; \
??????autoupdate; \
??????sh autogen.sh; \
fi; \
chmod +x configure; \
CC="gcc -std=gnu11" CFLAGS="-g -O2  -fpic -fvisibility=hidden" AR="ar" RANLIB="ranlib" LDFLAGS="-L/usr/local/lib64" ./configure "--quiet"
automake found. Running autoupdate and autogen.sh.
aclocal.m4:17: warning: this file was generated for autoconf 2.71.
You have another version of autoconf.  It may work, but is not guaranteed to.
If you have problems, you may need to regenerate the build system entirely.
To do so, use the procedure documented by the package, typically 'autoreconf'.
+ libtoolize --copy
autogen.sh: line 43: libtoolize: command not found
make --directory=libuv \
??????HAVE_DTRACE=0
make[1]: Entering directory `/tmp/RtmpMjF6Ns/R.INSTALL4a3cb2204b0da/httpuv/src/libuv'
CDPATH="${ZSH_VERSION+.}:" && cd . && /bin/sh '/tmp/RtmpMjF6Ns/R.INSTALL4a3cb2204b0da/httpuv/src/libuv/missing' aclocal-1.16 -I m4
/tmp/RtmpMjF6Ns/R.INSTALL4a3cb2204b0da/httpuv/src/libuv/missing: line 81: aclocal-1.16: command not found
WARNING: 'aclocal-1.16' is missing on your system.
         You should only need it if you modified 'acinclude.m4' or
         'configure.ac' or m4 files included by 'configure.ac'.
         The 'aclocal' program is part of the GNU Automake package:
         <https://www.gnu.org/software/automake>
         It also requires GNU Autoconf, GNU m4 and Perl in order to run:
         <https://www.gnu.org/software/autoconf>
         <https://www.gnu.org/software/m4/>
         <https://www.perl.org/>
make[1]: *** [aclocal.m4] Error 127
make[1]: Leaving directory `/tmp/RtmpMjF6Ns/R.INSTALL4a3cb2204b0da/httpuv/src/libuv'
make: *** [libuv/.libs/libuv.a] Error 2
ERROR: compilation failed for package ?httpuv?
* removing ?/home/ericrhon/R/x86_64-pc-linux-gnu-library/4.2/httpuv?
ERROR: dependency ?httpuv? is not available for package ?shiny?
* removing ?/home/ericrhon/R/x86_64-pc-linux-gnu-library/4.2/shiny?
ERROR: dependency ?shiny? is not available for package ?miniUI?
* removing ?/home/ericrhon/R/x86_64-pc-linux-gnu-library/4.2/miniUI?
ERROR: dependency ?miniUI? is not available for package ?devtools?
* removing ?/home/ericrhon/R/x86_64-pc-linux-gnu-library/4.2/devtools?

The downloaded source packages are in
???????/tmp/RtmpZELkpr/downloaded_packages?
Warning messages:
1: In install.packages("devtools") :
  installation of package ?httpuv? had non-zero exit status
2: In install.packages("devtools") :
  installation of package ?shiny? had non-zero exit status
3: In install.packages("devtools") :
  installation of package ?miniUI? had non-zero exit status
4: In install.packages("devtools") :
  installation of package ?devtools? had non-zero exit status


Thanks.

Eric


	[[alternative HTML version deleted]]


From @kw@|mmo @end|ng |rom gm@||@com  Thu Oct  6 08:57:41 2022
From: @kw@|mmo @end|ng |rom gm@||@com (Andrew Simmons)
Date: Thu, 6 Oct 2022 02:57:41 -0400
Subject: [R] Help installing devtools plus other packages in R terminal
In-Reply-To: <MN2PR04MB6400967EAC2449BB0F2A528BCB5D9@MN2PR04MB6400.namprd04.prod.outlook.com>
References: <MN2PR04MB6400967EAC2449BB0F2A528BCB5D9@MN2PR04MB6400.namprd04.prod.outlook.com>
Message-ID: <CAPcHnpSiNdFcZ4OtoFeyNo3_T7GhiajpN--Azg+gm7H4ALWp+A@mail.gmail.com>

To install the packages from source, you need to install make, gcc, and g++:
?sudo apt install make?
?sudo apt install gcc?
?sudo apt install g++

then try installing them again

On Thu, Oct 6, 2022 at 2:54 AM Rhon Calderon, Eric
<Eric.RhonCalderon at pennmedicine.upenn.edu> wrote:
>
> Hi,
>
> I am using R in my HPC terminal. After many tries, I was able to install and exec successfully R on my HPC but now I cannot install devtools and other dependencies. I need some of theses packages to install some others from bioconductor. I was wondering if anybody has a solution.
>
> The script I got from my R session is (the highlighted part is the errors I keep getting):
>
> > install.packages('devtools')
> Installing package into ?/home/ericrhon/R/x86_64-pc-linux-gnu-library/4.2?
> (as ?lib? is unspecified)
> --- Please select a CRAN mirror for use in this session ---
> Secure CRAN mirrors
>
>  1: 0-Cloud [https]
>  2: Australia (Canberra) [https]
>  3: Australia (Melbourne 1) [https]
>  4: Australia (Melbourne 2) [https]
>  5: Australia (Perth) [https]
>  6: Austria [https]
>  7: Belgium (Brussels) [https]
>  8: Brazil (PR) [https]
>  9: Brazil (RJ) [https]
> 10: Brazil (SP 1) [https]
> 11: Brazil (SP 2) [https]
> 12: Bulgaria [https]
> 13: Canada (MB) [https]
> 14: Canada (ON 3) [https]
> 15: Chile (Santiago) [https]
> 16: China (Beijing 2) [https]
> 17: China (Beijing 3) [https]
> 18: China (Hefei) [https]
> 19: China (Hong Kong) [https]
> 20: China (Guangzhou) [https]
> 21: China (Lanzhou) [https]
> 22: China (Nanjing) [https]
> 23: China (Shanghai 2) [https]
> 24: China (Shenzhen) [https]
> 25: Colombia (Cali) [https]
> 26: Costa Rica [https]
> 27: Cyprus [https]
> 28: Czech Republic [https]
> 29: Denmark [https]
> 30: East Asia [https]
> 31: Ecuador (Cuenca) [https]
> 32: Ecuador (Quito) [https]
> 33: France (Lyon 1) [https]
> 34: France (Lyon 2) [https]
> 35: France (Marseille) [https]
> 36: France (Paris 1) [https]
> 37: Germany (Erlangen) [https]
> 38: Germany (Leipzig) [https]
> 39: Germany (G?ttingen) [https]
> 40: Germany (M?nster) [https]
> 41: Germany (Regensburg) [https]
> 42: Greece [https]
> 43: Hungary [https]
> 44: Iceland [https]
> 45: India [https]
> 46: Indonesia (Banda Aceh) [https]
> 47: Iran (Mashhad) [https]
> 48: Italy (Milano) [https]
> 49: Italy (Padua) [https]
> 50: Japan (Tokyo) [https]
> 51: Japan (Yonezawa) [https]
> 52: Korea (Gyeongsan-si) [https]
> 53: Korea (Ulsan) [https]
> 54: Malaysia [https]
> 55: Mexico (Mexico City) [https]
> 56: Mexico (Texcoco) [https]
> 57: Morocco [https]
> 58: Netherlands (Dronten) [https]
> 59: New Zealand [https]
> 60: Norway [https]
> 61: South Africa (Johannesburg) [https]
> 62: Spain (A Coru?a) [https]
> 63: Spain (Madrid) [https]
> 64: Sweden (Bor?s) [https]
> 65: Sweden (Ume?) [https]
> 66: Switzerland [https]
> 67: Taiwan (Taipei) [https]
> 68: Turkey (Denizli) [https]
> 69: Turkey (Istanbul) [https]
> 70: Turkey (Mersin) [https]
> 71: UK (Bristol) [https]
> 72: UK (London 1) [https]
> 73: USA (IA) [https]
> 74: USA (MI) [https]
> 75: USA (MO) [https]
> 76: USA (OH) [https]
> 77: USA (OR) [https]
> 78: USA (TN) [https]
> 79: USA (TX 1) [https]
> 80: Uruguay [https]
> 81: (other mirrors)
>
> Selection: 1
> also installing the dependencies ?httpuv?, ?shiny?, ?miniUI?
>
> trying URL 'https://cloud.r-project.org/src/contrib/httpuv_1.6.6.tar.gz'
> Content type 'application/x-gzip' length 1875264 bytes (1.8 MB)
> ==================================================
> downloaded 1.8 MB
>
> trying URL 'https://cloud.r-project.org/src/contrib/shiny_1.7.2.tar.gz'
> Content type 'application/x-gzip' length 2982507 bytes (2.8 MB)
> ==================================================
> downloaded 2.8 MB
>
> trying URL 'https://cloud.r-project.org/src/contrib/miniUI_0.1.1.1.tar.gz'
> Content type 'application/x-gzip' length 97958 bytes (95 KB)
> ==================================================
> downloaded 95 KB
>
> trying URL 'https://cloud.r-project.org/src/contrib/devtools_2.4.4.tar.gz'
> Content type 'application/x-gzip' length 374492 bytes (365 KB)
> ==================================================
> downloaded 365 KB
>
> * installing *source* package ?httpuv? ...
> ** package ?httpuv? successfully unpacked and MD5 sums checked
> ** using staged installation
> ** libs
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c RcppExports-legacy.cpp -o RcppExports-legacy.o
>
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c RcppExports.cpp -o RcppExports.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c callback.cpp -o callback.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c callbackqueue.cpp -o callbackqueue.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c filedatasource-unix.cpp -o filedatasource-unix.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c filedatasource-win.cpp -o filedatasource-win.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c fs.cpp -o fs.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c gzipdatasource.cpp -o gzipdatasource.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c http.cpp -o http.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c httprequest.cpp -o httprequest.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c httpresponse.cpp -o httpresponse.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c httpuv.cpp -o httpuv.o
> gcc -std=gnu11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c md5.c -o md5.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c mime.cpp -o mime.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c socket.cpp -o socket.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c staticpath.cpp -o staticpath.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c thread.cpp -o thread.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c timegm.cpp -o timegm.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c utils.cpp -o utils.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c uvutil.cpp -o uvutil.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c webapplication.cpp -o webapplication.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c websockets-base.cpp -o websockets-base.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c websockets-hixie76.cpp -o websockets-hixie76.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c websockets-hybi03.cpp -o websockets-hybi03.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c websockets-ietf.cpp -o websockets-ietf.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c websockets.cpp -o websockets.o
> g++ -std=gnu++11 -I"/home/ericrhon/R/4.2/R-4.2.1/include" -DNDEBUG -Ilibuv/include -pthread -I'/home/ericrhon/R/4.2/R-4.2.1/library/Rcpp/include' -I'/home/ericrhon/R/4.2/R-4.2.1/library/later/include' -I/usr/local/include  -fvisibility=hidden -DSTRICT_R_HEADERS -fpic  -g -O2  -c winutils.cpp -o winutils.o
> cp -p -f libuv/m4/lt_obsolete.m4 libuv/m4/lt~obsolete.m4
> cd libuv; \
> if ! command -v automake >/dev/null 2>&1 ; then \
> echo "automake not found. Touching files so configure will not try to run automake."; \
> touch aclocal.m4; \
> touch -r aclocal.m4 configure Makefile.in; \
> else \
> echo "automake found. Running autoupdate and autogen.sh."; \
> autoupdate; \
> sh autogen.sh; \
> fi; \
> chmod +x configure; \
> CC="gcc -std=gnu11" CFLAGS="-g -O2  -fpic -fvisibility=hidden" AR="ar" RANLIB="ranlib" LDFLAGS="-L/usr/local/lib64" ./configure "--quiet"
> automake found. Running autoupdate and autogen.sh.
> aclocal.m4:17: warning: this file was generated for autoconf 2.71.
> You have another version of autoconf.  It may work, but is not guaranteed to.
> If you have problems, you may need to regenerate the build system entirely.
> To do so, use the procedure documented by the package, typically 'autoreconf'.
> + libtoolize --copy
> autogen.sh: line 43: libtoolize: command not found
> make --directory=libuv \
> HAVE_DTRACE=0
> make[1]: Entering directory `/tmp/RtmpMjF6Ns/R.INSTALL4a3cb2204b0da/httpuv/src/libuv'
> CDPATH="${ZSH_VERSION+.}:" && cd . && /bin/sh '/tmp/RtmpMjF6Ns/R.INSTALL4a3cb2204b0da/httpuv/src/libuv/missing' aclocal-1.16 -I m4
> /tmp/RtmpMjF6Ns/R.INSTALL4a3cb2204b0da/httpuv/src/libuv/missing: line 81: aclocal-1.16: command not found
> WARNING: 'aclocal-1.16' is missing on your system.
>          You should only need it if you modified 'acinclude.m4' or
>          'configure.ac' or m4 files included by 'configure.ac'.
>          The 'aclocal' program is part of the GNU Automake package:
>          <https://www.gnu.org/software/automake>
>          It also requires GNU Autoconf, GNU m4 and Perl in order to run:
>          <https://www.gnu.org/software/autoconf>
>          <https://www.gnu.org/software/m4/>
>          <https://www.perl.org/>
> make[1]: *** [aclocal.m4] Error 127
> make[1]: Leaving directory `/tmp/RtmpMjF6Ns/R.INSTALL4a3cb2204b0da/httpuv/src/libuv'
> make: *** [libuv/.libs/libuv.a] Error 2
> ERROR: compilation failed for package ?httpuv?
> * removing ?/home/ericrhon/R/x86_64-pc-linux-gnu-library/4.2/httpuv?
> ERROR: dependency ?httpuv? is not available for package ?shiny?
> * removing ?/home/ericrhon/R/x86_64-pc-linux-gnu-library/4.2/shiny?
> ERROR: dependency ?shiny? is not available for package ?miniUI?
> * removing ?/home/ericrhon/R/x86_64-pc-linux-gnu-library/4.2/miniUI?
> ERROR: dependency ?miniUI? is not available for package ?devtools?
> * removing ?/home/ericrhon/R/x86_64-pc-linux-gnu-library/4.2/devtools?
>
> The downloaded source packages are in
> ?/tmp/RtmpZELkpr/downloaded_packages?
> Warning messages:
> 1: In install.packages("devtools") :
>   installation of package ?httpuv? had non-zero exit status
> 2: In install.packages("devtools") :
>   installation of package ?shiny? had non-zero exit status
> 3: In install.packages("devtools") :
>   installation of package ?miniUI? had non-zero exit status
> 4: In install.packages("devtools") :
>   installation of package ?devtools? had non-zero exit status
>
>
> Thanks.
>
> Eric
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From kry|ov@r00t @end|ng |rom gm@||@com  Thu Oct  6 09:26:47 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Thu, 6 Oct 2022 10:26:47 +0300
Subject: [R] Help installing devtools plus other packages in R terminal
In-Reply-To: <MN2PR04MB6400967EAC2449BB0F2A528BCB5D9@MN2PR04MB6400.namprd04.prod.outlook.com>
References: <MN2PR04MB6400967EAC2449BB0F2A528BCB5D9@MN2PR04MB6400.namprd04.prod.outlook.com>
Message-ID: <20221006102647.11bca9b5@Tarkus>

On Wed, 5 Oct 2022 20:02:02 +0000
"Rhon Calderon, Eric" <Eric.RhonCalderon at pennmedicine.upenn.edu> wrote:

> automake found. Running autoupdate and autogen.sh.
<...>
> + libtoolize --copy
> autogen.sh: line 43: libtoolize: command not found

Since you have automake installed, you also need libtool
<https://www.gnu.org/software/libtool/> installed in order to compile
this particular package from source. Depending on the HPC, there may be
a particular command to "activate" the installation already made by the
HPC administrator.

I guess you could also report this as a bug in devtools: they check for
automake but not libtool. If you can temporarily chmod -x automake, the
installation should succeed too, because then the package will not try
to regenerate its build system. I don't see why they even try to do
that, but maybe that's a workaround for some kind of compatibility
problem.

> CDPATH="${ZSH_VERSION+.}:" && cd . && /bin/sh
> '/tmp/RtmpMjF6Ns/R.INSTALL4a3cb2204b0da/httpuv/src/libuv/missing'
> aclocal-1.16 -I m4
> /tmp/RtmpMjF6Ns/R.INSTALL4a3cb2204b0da/httpuv/src/libuv/missing: line
> 81: aclocal-1.16: command not found

Make sure your automake installation is working. I think the error is
caused by the previous error and may go away once you install libtool,
but I may be mistaken regarding that.

Do Bioconductor packages really depend on devtools? What do their
errors look like?

-- 
Best regards,
Ivan


From tder@mu@ @end|ng |rom p@rtner@@org  Wed Oct  5 15:32:00 2022
From: tder@mu@ @end|ng |rom p@rtner@@org (Deramus, Thomas Patrick)
Date: Wed, 5 Oct 2022 13:32:00 +0000
Subject: [R] Getting "Error in ect,
 plot.new has not been called yet" despite grouping plot call
In-Reply-To: <20221005230608.793c8b9f@rolf-Latitude-E7470>
References: <PH0PR04MB7493E39389D0196BEC260CB6BE5A9@PH0PR04MB7493.namprd04.prod.outlook.com>
 <20221005230608.793c8b9f@rolf-Latitude-E7470>
Message-ID: <PH0PR04MB7493CE9332F02B56C0AFE31FBE5D9@PH0PR04MB7493.namprd04.prod.outlook.com>

Hi Rolf.

I followed your suggestion (though it's probably not as trimmed as it could be), but the problem unfortunately persists.

Does this make it any clearer or still too many moving parts to make sense of?

rm(list = ls(all.names = TRUE)) #will clear all objects includes hidden objects.

#Loads the packages
library(plyr)
library(dplyr)
library(ggplot2)
library(Kendall)
library(lubridate)
library(xts)
library(TTR)
library(trend)
library(forecast)
library(openxlsx)

#Uses the learningCurve Package from Github:
#https://github.com/AFIT-R/learningCurve
library(learningCurve)

#Only load this if using VS Studio because it changes the plot function
#https://stackoverflow.com/questions/52284345/how-to-show-r-graph-from-visual-studio-code
library(httpgd)
library(languageserver)

#Loads the Excel files to Dataframes and cleans the data
Game_Metrics_Word_Task <- read.xlsx("GamePack_Analytics_ALL_TIME_Short.xlsx", "Boggle")
Game_Metrics_Word_Task <- Game_Metrics_Word_Task %>% filter(grepl('1440', StudyId))
Game_Metrics_Word_Task$DeviceTime <- ymd_hms(Game_Metrics_Word_Task$DeviceTime,  tz = "America/New_York")
Game_Metrics_Word_Task <- Game_Metrics_Word_Task[!duplicated(Game_Metrics_Word_Task[1:2,])]

#Splits the dataframe into a tibble containing each participant
Participant_Word_Task <- split(arrange(Game_Metrics_Word_Task,StudyId,DeviceTime), arrange(Game_Metrics_Word_Task,StudyId,DeviceTime,StudyId,DeviceTime)$StudyId)

#Generates a blank output dataframe
WordFrame <- data.frame(Participant = c(0), Task = c(0), MannKendall_Tau = c(0), MannKendall_P = c(0), Sen_Slope_Value = c(0), Sen_Slope_Pval = c(0), Pettitts_CIV = c(0), Pettitts_Pval = c(0), ARIMA_Model = c(0), Time_to_Petit = c(0), Number_of_Trials_to_Pettitt = c(0), Playtime_to_Petit_seconds = c(0), Time_Start_to_end_days = c(0), Number_of_Total_Trials = c(0), Total_Playtime_seconds = c(0), Learning_rate_days = c(0), Learning_rate_seconds = c(0), Learned_Task = c(0))

#The number of subjects in the xlsx file
#Reduced to 2 for ease of use
for (i in 1:2){
  #This timeseries only includes the trials where the participant completed the task
  success_series <- xts(filter(Participant_Word_Task[[i]], GameEndReason == "TIMER_UP")$NumberOfSuccesfulWords , order.by=as.POSIXct(filter(Participant_Word_Task[[i]], GameEndReason == "TIMER_UP")$DeviceTime))
  #This timeseries includes ALL the trials for the sake of plotting
  original_series <- xts(Participant_Word_Task[[i]]$NumberOfSuccesfulWords, order.by=as.POSIXct(Participant_Word_Task[[i]]$DeviceTime))

  #This is a decomposing process that xts seems to need for plotting.
  #nweeks is needed for xts to plot the x-axis
  success_decomp <- ts(success_series, frequency = nweeks(success_series))
  original_decomp <- ts(original_series, frequency = nweeks(success_series))

  #Values which will be included in the plots
  WordFrame[i,1] <- unique(Participant_Word_Task[[i]]$StudyId)
  WordFrame[i,5] <- sens.slope(success_decomp)$estimates
  WordFrame[i,6] <- sens.slope(success_decomp)$p.value
  WordFrame[i,7] <- pettitt.test(success_decomp)$estimate
  WordFrame[i,8] <- pettitt.test(success_decomp)$p.value

  #The simple moving average that will be overlayed with the plotted data
  simplemovingaverage <- SMA(original_series, n = nweeks(original_series))

  #If the three tests are statistically significant, add a green horizontal like to value WordFrame[i,7]
  #Which would be where the slope changes in the series
  #Fluid variables have been removed from all pdf() and paste() functions for ease-of-use
  if (WordFrame[i,4] <= 0.05 & WordFrame[i,6] <= 0.05 & WordFrame[i,8] <= 0.05){
     {
      pdf(file = "Word_Task_Acquisition.pdf")
      plout <- plot(original_series)
      lines(simplemovingaverage)
      abline(v = index(original_series[WordFrame[i,7]]),lty=2, col='green', lwd=3)
      title(paste("Word Task Acquisition for Subject"))
      dev.off()
     }
  #If the three tests are NOT statistically significant, generate a plot with NO horizontal line at WordFrame[i,7]
  } else {
    {
      pdf(file = "Word_Task_Acquisition.pdf")
      plout <- plot(original_series)
      lines(simplemovingaverage)
      title(paste("Word Task Acquisition for Subject"))
      dev.off()
    }
  }
}

________________________________
From: Rolf Turner <r.turner at auckland.ac.nz>
Sent: Wednesday, October 5, 2022 6:06 AM
To: Deramus, Thomas Patrick <tderamus at partners.org>
Cc: r-help at r-project.org <r-help at r-project.org>
Subject: Re: [R] Getting "Error in ect, plot.new has not been called yet" despite grouping plot call

        External Email - Use Caution

What you doing or trying to do is far too complex for my poor feeble
and senile brain to come anywhere near comprehending.  The code that
you present exceeds my complexity tolerance by many orders of magnitude.

I have a suggestion, but.  Strip your code down to the *essentials*.
Construct a simple sequence of plotting commands, with *simple* names
for the pdf files involved.  You should require only two or three such
files and two or three index levels associated with each of your
nested loops.

Run the stripped down code and the source of the problem will almost
surely become clear.

cheers,

Rolf Turner

On Tue, 4 Oct 2022 23:35:09 +0000
"Deramus, Thomas Patrick" <tderamus at partners.org> wrote:

> Sorry to cross-post on Stackoverflow and here but I'm having some
> difficulty.
> https://secure-web.cisco.com/1_juqv4RvefQFJofsnOQcQA3Ixge89s4uC26pjoPBaYOSxSLGisKtgUTZkanxeHNRqNmjl30B8wYKfsppHje4T8Su77i7t8UbMKzs3GBKEyQva4yTjPH76Q9-l6tT24bB4qNMPQeFAxrkG5lpozNpGrDIAjfKCMvgS-5Qjs-QmvhWZfo84_3SK9rHhJjJvO9CqXb0MewWwI-dEmkZemjxnliGe_D9nooo7Ebjuw0dpBuMnrdaTzQxDdivsbkujPnrGurdjLARh93RW5IWPszNwaoziRD7P-30McF1PrAP8_yjWrhxQ_S3AgG6k40EoQJU/https%3A%2F%2Fstackoverflow.com%2Fquestions%2F73942794%2Fstill-getting-error-in-ect-plot-new-has-not-been-called-yet-despite-grouping
>
> Trying to make a nested loop that produces PDFs off different graphs,
> one for ACF/PACF diagnostics and another for the actual data, based
> on some time-series analyses I'm doing.
>
> Unfortunately, I keep getting the dreaded: Error plot.new has not
> been called yet
>
> The code is meant to write a PDF containing the ACF and PACF graphs,
> then do some analyses on the timeseries, and then make a separate PDF
> containing a plot describing the timeseries based on the p-values of
> each test for each individual.
>
> library(plyr)
> library(dplyr)
> library(ggplot2)
> library(Kendall)
> library(lubridate)
> library(xts)
> library(TTR)
> library(trend)
> library(forecast)
> library(openxlsx)
>
> Game_Metrics_Word_Task <-
> read.xlsx("GamePack_Analytics_ALL_TIME_Short.xlsx", "Boggle")
> Game_Metrics_Word_Task <- Game_Metrics_Word_Task %>%
> filter(grepl('1440', StudyId)) Game_Metrics_Word_Task$DeviceTime <-
> ymd_hms(Game_Metrics_Word_Task$DeviceTime,  tz = "America/New_York")
> Game_Metrics_Word_Task <-
> Game_Metrics_Word_Task[!duplicated(Game_Metrics_Word_Task[1:2,])]
>
> Participant_Word_Task <-
> split(arrange(Game_Metrics_Word_Task,StudyId,DeviceTime),
> arrange(Game_Metrics_Word_Task,StudyId,DeviceTime,StudyId,DeviceTime)$StudyId)
>
> WordFrame <- data.frame(Participant = c(0), Task = c(0),
> MannKendall_Tau = c(0), MannKendall_P = c(0), Sen_Slope_Value = c(0),
> Sen_Slope_Pval = c(0), Pettitts_CIV = c(0), Pettitts_Pval = c(0),
> ARIMA_Model = c(0), Time_to_Petit = c(0), Number_of_Trials_to_Pettitt
> = c(0), Playtime_to_Petit_seconds = c(0), Time_Start_to_end_days =
> c(0), Number_of_Total_Trials = c(0), Total_Playtime_seconds = c(0),
> Learning_rate_days = c(0), Learning_rate_seconds = c(0), Learned_Task
> = c(0))
>
> for (i in 1:length(Participant_Word_Task)){
>     success_series <- xts(filter(Participant_Word_Task[[i]],
> GameEndReason == "TIMER_UP")$NumberOfSuccesfulWords ,
> order.by=as.POSIXct(filter(Participant_Word_Task[[i]], GameEndReason
> == "TIMER_UP")$DeviceTime)) original_series <-
> xts(Participant_Word_Task[[i]]$NumberOfSuccesfulWords,
> order.by=as.POSIXct(Participant_Word_Task[[i]]$DeviceTime))
> success_decomp <- ts(success_series, frequency =
> nweeks(success_series)) original_decomp <- ts(original_series,
> frequency = nweeks(success_series))
>
>     pdf(paste("Word_Task_Autocorrelation_plots_for_subject_",unique(Participant_Word_Task[[i]]$StudyId),".pdf"
> ,collapse = NULL, sep = "")) par(mfrow=c(1,2))
>     Autocorrelationplot <- acf(success_decomp, main=paste(""))
>     PartialAutocorrelationplot <- pacf(success_decomp, main=paste(""))
>     mtext(paste("Word Task Auto and Partialauto correlations for
> subject ",unique(Participant_Word_Task[[i]]$StudyId)), side = 3, line
> = -3, outer = TRUE) dev.off()
>
>     AutomatedArimaoutputs <- auto.arima(success_decomp)
>     p <- length(AutomatedArimaoutputs$model$phi)
>     #AR component
>     q <- length(AutomatedArimaoutputs$model$theta)
>     #MA component
>     d <- AutomatedArimaoutputs$model$Delta
>     #order of difference
>     WordFrame[i,1] <- unique(Participant_Word_Task[[i]]$StudyId)
>     WordFrame[i,2] <- "Word"
>     WordFrame[i,3] <- MannKendall(success_decomp)$tau[1]
>     WordFrame[i,4] <- MannKendall(success_decomp)$sl[1]
>     WordFrame[i,5] <- sens.slope(success_decomp)$estimates
>     WordFrame[i,6] <- sens.slope(success_decomp)$p.value
>     WordFrame[i,7] <- pettitt.test(success_decomp)$estimate
>     WordFrame[i,8] <- pettitt.test(success_decomp)$p.value
>     WordFrame[i,9] <- paste("ARIMA(",p,",",q,",",d,")", collapse =
> NULL, sep = "") WordFrame[i,10] <-
> difftime(time(success_series[WordFrame[i,7]]),time(original_series[1]))
> WordFrame[i,11] <- tail(which(grepl(success_series[WordFrame[i,7]],
> original_series)), n=1) WordFrame[i,12] <-
> sum(Participant_Word_Task[[i]]$TotalDuration[1:WordFrame[i,11]])-sum(Participant_Word_Task[[i]]$TotalTimePaused[1:WordFrame[i,11]])
> WordFrame[i,13] <-
> difftime(time(original_series[length(original_series)]),time(original_series[1]))
> WordFrame[i,14] <- length(original_series) WordFrame[i,15] <-
> sum(Participant_Word_Task[[i]]$TotalDuration[1:length(original_series)])-sum(Participant_Word_Task[[i]]$TotalTimePaused[1:length(original_series)])
>
>
>     simplemovingaverage <- SMA(original_series, n =
> nweeks(original_series))
>
>     if (WordFrame[i,4] <= 0.05 & WordFrame[i,6] <= 0.05 &
> WordFrame[i,8] <= 0.05){ {
>               pdf(paste(WordFrame[i,1],"_Word_Task_Acquisition.pdf",collapse
> = NULL, sep = "")) plout <-
> plot(original_series,type='l',col='blue',xlab="Date of
> Play",ylab="Number of Successful Words")
> lines(simplemovingaverage,type='l',col='red') title(paste("Word Task
> Acquisition for Subject", WordFrame[i,1])) abline(v =
> index(original_series[WordFrame[i,7]]),lty=2, col='green', lwd=3)
> dev.off() } WordFrame[i,18] <- T
>               WordFrame[i,16] <- (1-(WordFrame[i,10]/WordFrame[i,13]))
>               WordFrame[i,17] <- (1-(WordFrame[i,12]/WordFrame[i,15]))
>     } else {
>               {
>               pdf(paste(WordFrame[i,1],"_Word_Task_Acquisition.pdf",collapse
> = NULL, sep = "")) plout <-
> plot(original_series,type='l',col='blue',xlab="Date of
> Play",ylab="Number of Successful Words")
> lines(simplemovingaverage,type='l',col='red') title(paste("Word Task
> Acquisition for Subject", WordFrame[i,1])) dev.off() }
>               WordFrame[i,18] <- F
>               WordFrame[i,16] <- 0
>               WordFrame[i,17] <- 0
>     }
> }
>
> It will work just fine if I run the lines individually (e.g. set i =
> 1, 2, ect), and if I comment out abline and title (lines seems to
> work fine). But it will throw the error everytime I try to run the
> loop without these commented.
>
> Have tried just about everything I could find on the Stack forums to
> run everything as a single argument and I'm just not sure what is
> wrong with it.
>
> dev.list() spits out:
>
> pdf
>   2
> following the error.
>
> With abline and title commented out and lines run individually it's
> NULL.
>
> Happens in both RStudio
>
> 2022.07.2+576 "Spotted Wakerobin" Release
> (e7373ef832b49b2a9b88162cfe7eac5f22c40b34, 2022-09-06) for Ubuntu
> Bionic Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML,
> like Gecko) QtWebEngine/5.12.8 Chrome/69.0.3497.128 Safari/537.36
>
> And R:
>
> platform       x86_64-pc-linux-gnu
> arch           x86_64
> os             linux-gnu
> system         x86_64, linux-gnu
> status
> major          4
> minor          2.1
> year           2022
> month          06
> day            23
> svn rev        82513
> language       R
> version.string R version 4.2.1 (2022-06-23)
> nickname       Funny-Looking Kid
>
>
> My OS:
> PRETTY_NAME="Debian GNU/Linux 11 (bullseye)"
> NAME="Debian GNU/Linux"
> VERSION_ID="11"
> VERSION="11 (bullseye)"
> VERSION_CODENAME=bullseye
> ID=debian
> HOME_URL="https://secure-web.cisco.com/1Ruvt90Q90ixR-GE-RDiKJgzRpfDjlNz-lZTqQQGM8Tf4GAoj5QOfE2vXMaMWxMoexuf1npQrX7uAjFuU2viz28h42RPmHQK7jGDX7BpRLkTNcERyxHVKJTxgYegXo-n9N7rqegcKsrr47xlGmTcMOJcBAqH7SpTPQlYDOGgjz1ErtetQRzUsd-eKs9l4oCVPiF6SKV40C7s_NXm0tuCswL2Jhyfv70-edCtBO_4j9-3dSi5ZdFLYaWsMScnwwxNIGYU2n0vw5NH4GJcZNsv6Scu-r6W8ndJaGL4UmX9J3PX0LrdFyjLbGtA7RqPpKFUQ/https%3A%2F%2Fwww.debian.org"
> SUPPORT_URL="https://secure-web.cisco.com/1gveQttVrJNRSM85857IiydpLraxrrtJobMyCNkRvQ4V2f00DH67Z0hEa50LLpCVYQvIjMsQZxHAVMZvYQV_Cp2-e82TDZzPY4aSR2td2th3bwuXGxtI7CTgSUudOWgPpmnwVLT5r34EnwXEmwnMoiPVnOEC7slpF1fLGq11wSynuyttcTagMfpN6qdYfgtbu_mz0JOBUecQ-etUQYw5BDmXEKv5JZ_y5Uyt8Q89Kirhi7Hk8FMbCVcxRZpOZZmghxlPMxYaNVIOnln-R0H8J2QIzqE49cQQPKkFZ9O29zpr8odlBXqjObKn24ReYPDhH/https%3A%2F%2Fwww.debian.org%2Fsupport"
> BUG_REPORT_URL="https://secure-web.cisco.com/1tepDnCjDgHsmvw9Eth-7nfyKi3doVSOFKVzz83wskdyf8lsrEVkG2NYw7am6ePhSFfjQXdDyceMyc21Un-vqTirSQYKdPavRdKJy85HgHMP66Xk-OgxFf-5KXiPzmFreDfuuJlYizGSUNOLcADyNVTCo47xFfRgtB83Hs8j3yYAJFrff7TqNOFWzSzTcfrycio_WSSfbQkLpUl-1xGzg-dvP16tKuwkRr62bkPeydXJC_iH1FfnWv5b1G04au3aFmRTem8t2RS40LPMS9Mh0UmMvHD_9qwX16cFMHQ8U4x9Sp9IUcAFhgnbffOyPQm1C/https%3A%2F%2Fbugs.debian.org"
> No LSB modules are available.
> Distributor ID:???Debian
> Description:??????Debian GNU/Linux 11 (bullseye)
> Release:????11
> Codename:???bullseye
>          Icon name: computer-desktop
>            Chassis: desktop
>         Machine ID: 053ebf23707f49c8ad4e0684f4cf19d3
>            Boot ID: d0e6294d3b944286bef10e76c21e6401
>   Operating System: Debian GNU/Linux 11 (bullseye)
>             Kernel: Linux 5.10.0-18-amd64
>       Architecture: x86-64
>
>
> Any suggestions would be greatly appreciated.
>
> --
>
> Thomas DeRamus (He/Him/His)
>
> Data Analyst
>
> Massachusetts General Hospital Brigham
>
> Alzheimer?s Clinical & Translational Research Unit
>
> 149 13th Street
>
> Charlestown, MA 02129
>
> Phone: 205-834-5066
>
> Email: tderamus at partners.org<mailto:tderamus at partners.org>,
> tpderamus at gmail.com<mailto:tpderamus at gmail.com>
>
>
> [https://secure-web.cisco.com/1AI4S4rz4bDZGM8naa-19GTAeSORO5ZmNe056Q_nhPRk4JVAzPiRKUBWitBK5TpxoKBLoLvNfoMDanGd1n5Bnf4SJFT7l7HnaLcjjH7oVk2BZdDfCLHo8a8eePvD4XrF2Fw3iuxKgIZY5dwdesP3P8pSvkmVGvyZ-HiEKRetk4uJHhRa6gSgOQ8MbCVKmi6XP1dtozTEH1RpDrFJ4EyevPO52UzaTAY6CR8USLWNbsxXJsnsjUz1G6_4P7B3ULuMu9mEPeQz_GnTrSXTrGZooK_idhoEougti7I8NYV0CS09Yahmp4Fe_vh9wu4Jkdal3/https%3A%2F%2Fci3.googleusercontent.com%2Fmail-sig%2FAIorK4we2sU30P2HyfDQF5hpEjYTt-9FTBK7cAVsP7EenrZ0nsKCf48fuYMtElj6Szn_2fpSPWr66eQ][https://ci3.googleusercontent.com/mail-sig/AIorK4yyY0DlImU0UONJrHTbPc5T3lJj8Kmu8SbDKJJ3XjcX6CgvVsvSueYKwficYFz4zXt6fZV8YIY]
>
> ?If knowledge can create problems, it is not through ignorance that
> we can solve them.?
>
> ?Issac Asimov

The information in this e-mail is intended only for the person to whom it is addressed.  If you believe this e-mail was sent to you in error and the e-mail contains patient information, please contact the Mass General Brigham Compliance HelpLine at https://www.massgeneralbrigham.org/complianceline <https://www.massgeneralbrigham.org/complianceline> .
Please note that this e-mail is not secure (encrypted).  If you do not wish to continue communication over unencrypted e-mail, please notify the sender of this message immediately.  Continuing to send or respond to e-mail after receiving this message means you understand and accept this risk and wish to continue to communicate over unencrypted e-mail. 

From tder@mu@ @end|ng |rom p@rtner@@org  Thu Oct  6 02:38:51 2022
From: tder@mu@ @end|ng |rom p@rtner@@org (Deramus, Thomas Patrick)
Date: Thu, 6 Oct 2022 00:38:51 +0000
Subject: [R] Getting "Error in ect,
 plot.new has not been called yet" despite grouping plot call
In-Reply-To: <20221006112802.6897cd27@rolf-Latitude-E7470>
References: <PH0PR04MB7493E39389D0196BEC260CB6BE5A9@PH0PR04MB7493.namprd04.prod.outlook.com>
 <20221005230608.793c8b9f@rolf-Latitude-E7470>
 <PH0PR04MB7493CE9332F02B56C0AFE31FBE5D9@PH0PR04MB7493.namprd04.prod.outlook.com>
 <20221006112802.6897cd27@rolf-Latitude-E7470>
Message-ID: <PH0PR04MB7493C8F0A1BA20AF9840BCD0BE5C9@PH0PR04MB7493.namprd04.prod.outlook.com>

Odd. Thought I had attached it.

Would love to go that route, but the problem is a lot of the sub-bits are actually dependent on the values of the timeseries analysis, which has its own dependencies......

Would using the following link to download the excel file help at all?
https://docs.google.com/spreadsheets/d/1rPd8bv4WADCdEUhmem-u1-6HWUXKne7b/edit?usp=sharing&ouid=110307531005009211602&rtpof=true&sd=true


________________________________
From: Rolf Turner <r.turner at auckland.ac.nz>
Sent: Wednesday, October 5, 2022 6:28 PM
To: Deramus, Thomas Patrick <tderamus at partners.org>
Cc: r-help at r-project.org <r-help at r-project.org>
Subject: Re: [R] Getting "Error in ect, plot.new has not been called yet" despite grouping plot call

        External Email - Use Caution


Your code is still much too complex for my feeble brain.

Without trying to understand very much, I get the impression that the
example is *not* reproducible.  It requires reading in Excel (yeucchh!)
files to which no-one but you has access.

Skip the reading-in completely.  Create toy data using rnorm() instead.
Then someone may be able to help you.

On Wed, 5 Oct 2022 13:32:00 +0000
"Deramus, Thomas Patrick" <tderamus at partners.org> wrote:

> Hi Rolf.
>
> I followed your suggestion (though it's probably not as trimmed as it
> could be), but the problem unfortunately persists.

If the problem *didn't* persist, then *that* would have been
unfortunate!  The idea is to reproduce the problem in a simpler context
so that one can deduce what is causing the problem!

> Does this make it any clearer or still too many moving parts to make
> sense of?

There are still (far) too many moving parts, for me anyway.  Someone
cleverer than I might be able to see what the problem is.

cheers,

Rolf

>
> rm(list = ls(all.names = TRUE)) #will clear all objects includes
> hidden objects.
>
> #Loads the packages
> library(plyr)
> library(dplyr)
> library(ggplot2)
> library(Kendall)
> library(lubridate)
> library(xts)
> library(TTR)
> library(trend)
> library(forecast)
> library(openxlsx)
>
> #Uses the learningCurve Package from Github:
> #https://secure-web.cisco.com/1GUXNs4DRqUHykKAjZUB89_m2M_KU7oUJ6jl9VAWbtn8YCzSy8qRCHe-LJf3ovhQXKpQcXQe9Bf_BwKHFn4-A8AvtoD_tuXR-jsEcSsEQp-B3sET59hXmBKs_B1M7u2zUxnGNqVZnxYNeip71STXGupngENp0IjZfxd48SZHkztp5CLHFpsdHgz7wHHwePlSTMG8yKmYcS7N6OSkoxENvsL-vCxACXlyPFQTynaQNNjFjV7Ngl8mJpBP0G8pXX8WbogbQlE9ArbYCph6j_3IoVIN8Y6dKqRe44yoi8S3hjJ1PFgdr4JW7nve07XYaC_M-/https%3A%2F%2Fgithub.com%2FAFIT-R%2FlearningCurve
> library(learningCurve)
>
> #Only load this if using VS Studio because it changes the plot
> function
> #https://secure-web.cisco.com/14TdkUQ3Ymy411VwAMhagZmvgDM4nborDvLmLccRSdK1n3ZgXfjjdH9Xn1dVxO2s5Y9R4fZJoitgys453O-kPVFt73W5s3Qa_D078MPMxoTGV6UP55ozAuPwt9nzMGBqak6abbcX1Er2q8CwEMGQJA8AmcdQf0GyGCz8b1qYV-ck9_L4N-Yq5eTWLs2NHrklR0XpUzWvbUBGRH2LpeWPHRLtMZjW8-9T3_1sGyvCHTXDhQ-FXzifBiFtE13_qL50iO1kl8A6p3EeOR0e0-AgW-kGEfpBHGgA53VBlscnA9nqfb60sCgLaAeMz-Pc49ITI/https%3A%2F%2Fstackoverflow.com%2Fquestions%2F52284345%2Fhow-to-show-r-graph-from-visual-studio-code
> library(httpgd) library(languageserver)
>
> #Loads the Excel files to Dataframes and cleans the data
> Game_Metrics_Word_Task <-
> read.xlsx("GamePack_Analytics_ALL_TIME_Short.xlsx", "Boggle")
> Game_Metrics_Word_Task <- Game_Metrics_Word_Task %>%
> filter(grepl('1440', StudyId)) Game_Metrics_Word_Task$DeviceTime <-
> ymd_hms(Game_Metrics_Word_Task$DeviceTime,  tz = "America/New_York")
> Game_Metrics_Word_Task <-
> Game_Metrics_Word_Task[!duplicated(Game_Metrics_Word_Task[1:2,])]
>
> #Splits the dataframe into a tibble containing each participant
> Participant_Word_Task <-
> split(arrange(Game_Metrics_Word_Task,StudyId,DeviceTime),
> arrange(Game_Metrics_Word_Task,StudyId,DeviceTime,StudyId,DeviceTime)$StudyId)
>
> #Generates a blank output dataframe
> WordFrame <- data.frame(Participant = c(0), Task = c(0),
> MannKendall_Tau = c(0), MannKendall_P = c(0), Sen_Slope_Value = c(0),
> Sen_Slope_Pval = c(0), Pettitts_CIV = c(0), Pettitts_Pval = c(0),
> ARIMA_Model = c(0), Time_to_Petit = c(0), Number_of_Trials_to_Pettitt
> = c(0), Playtime_to_Petit_seconds = c(0), Time_Start_to_end_days =
> c(0), Number_of_Total_Trials = c(0), Total_Playtime_seconds = c(0),
> Learning_rate_days = c(0), Learning_rate_seconds = c(0), Learned_Task
> = c(0))
>
> #The number of subjects in the xlsx file
> #Reduced to 2 for ease of use
> for (i in 1:2){
>   #This timeseries only includes the trials where the participant
> completed the task success_series <-
> xts(filter(Participant_Word_Task[[i]], GameEndReason ==
> "TIMER_UP")$NumberOfSuccesfulWords ,
> order.by=as.POSIXct(filter(Participant_Word_Task[[i]], GameEndReason
> == "TIMER_UP")$DeviceTime)) #This timeseries includes ALL the trials
> for the sake of plotting original_series <-
> xts(Participant_Word_Task[[i]]$NumberOfSuccesfulWords,
> order.by=as.POSIXct(Participant_Word_Task[[i]]$DeviceTime))
>
>   #This is a decomposing process that xts seems to need for plotting.
>   #nweeks is needed for xts to plot the x-axis
>   success_decomp <- ts(success_series, frequency =
> nweeks(success_series)) original_decomp <- ts(original_series,
> frequency = nweeks(success_series))
>
>   #Values which will be included in the plots
>   WordFrame[i,1] <- unique(Participant_Word_Task[[i]]$StudyId)
>   WordFrame[i,5] <- sens.slope(success_decomp)$estimates
>   WordFrame[i,6] <- sens.slope(success_decomp)$p.value
>   WordFrame[i,7] <- pettitt.test(success_decomp)$estimate
>   WordFrame[i,8] <- pettitt.test(success_decomp)$p.value
>
>   #The simple moving average that will be overlayed with the plotted
> data simplemovingaverage <- SMA(original_series, n =
> nweeks(original_series))
>
>   #If the three tests are statistically significant, add a green
> horizontal like to value WordFrame[i,7] #Which would be where the
> slope changes in the series #Fluid variables have been removed from
> all pdf() and paste() functions for ease-of-use if (WordFrame[i,4] <=
> 0.05 & WordFrame[i,6] <= 0.05 & WordFrame[i,8] <= 0.05){ {
>       pdf(file = "Word_Task_Acquisition.pdf")
>       plout <- plot(original_series)
>       lines(simplemovingaverage)
>       abline(v = index(original_series[WordFrame[i,7]]),lty=2,
> col='green', lwd=3) title(paste("Word Task Acquisition for Subject"))
>       dev.off()
>      }
>   #If the three tests are NOT statistically significant, generate a
> plot with NO horizontal line at WordFrame[i,7] } else {
>     {
>       pdf(file = "Word_Task_Acquisition.pdf")
>       plout <- plot(original_series)
>       lines(simplemovingaverage)
>       title(paste("Word Task Acquisition for Subject"))
>       dev.off()
>     }
>   }
> }
>
> ________________________________
> From: Rolf Turner <r.turner at auckland.ac.nz>
> Sent: Wednesday, October 5, 2022 6:06 AM
> To: Deramus, Thomas Patrick <tderamus at partners.org>
> Cc: r-help at r-project.org <r-help at r-project.org>
> Subject: Re: [R] Getting "Error in ect, plot.new has not been called
> yet" despite grouping plot call
>
>         External Email - Use Caution
>
> What you doing or trying to do is far too complex for my poor feeble
> and senile brain to come anywhere near comprehending.  The code that
> you present exceeds my complexity tolerance by many orders of
> magnitude.
>
> I have a suggestion, but.  Strip your code down to the *essentials*.
> Construct a simple sequence of plotting commands, with *simple* names
> for the pdf files involved.  You should require only two or three such
> files and two or three index levels associated with each of your
> nested loops.
>
> Run the stripped down code and the source of the problem will almost
> surely become clear.
>
> cheers,
>
> Rolf Turner
>
> On Tue, 4 Oct 2022 23:35:09 +0000
> "Deramus, Thomas Patrick" <tderamus at partners.org> wrote:
>
> > Sorry to cross-post on Stackoverflow and here but I'm having some
> > difficulty.
> > https://secure-web.cisco.com/1_juqv4RvefQFJofsnOQcQA3Ixge89s4uC26pjoPBaYOSxSLGisKtgUTZkanxeHNRqNmjl30B8wYKfsppHje4T8Su77i7t8UbMKzs3GBKEyQva4yTjPH76Q9-l6tT24bB4qNMPQeFAxrkG5lpozNpGrDIAjfKCMvgS-5Qjs-QmvhWZfo84_3SK9rHhJjJvO9CqXb0MewWwI-dEmkZemjxnliGe_D9nooo7Ebjuw0dpBuMnrdaTzQxDdivsbkujPnrGurdjLARh93RW5IWPszNwaoziRD7P-30McF1PrAP8_yjWrhxQ_S3AgG6k40EoQJU/https%3A%2F%2Fstackoverflow.com%2Fquestions%2F73942794%2Fstill-getting-error-in-ect-plot-new-has-not-been-called-yet-despite-grouping
> >
> > Trying to make a nested loop that produces PDFs off different
> > graphs, one for ACF/PACF diagnostics and another for the actual
> > data, based on some time-series analyses I'm doing.
> >
> > Unfortunately, I keep getting the dreaded: Error plot.new has not
> > been called yet
> >
> > The code is meant to write a PDF containing the ACF and PACF graphs,
> > then do some analyses on the timeseries, and then make a separate
> > PDF containing a plot describing the timeseries based on the
> > p-values of each test for each individual.
> >
> > library(plyr)
> > library(dplyr)
> > library(ggplot2)
> > library(Kendall)
> > library(lubridate)
> > library(xts)
> > library(TTR)
> > library(trend)
> > library(forecast)
> > library(openxlsx)
> >
> > Game_Metrics_Word_Task <-
> > read.xlsx("GamePack_Analytics_ALL_TIME_Short.xlsx", "Boggle")
> > Game_Metrics_Word_Task <- Game_Metrics_Word_Task %>%
> > filter(grepl('1440', StudyId)) Game_Metrics_Word_Task$DeviceTime <-
> > ymd_hms(Game_Metrics_Word_Task$DeviceTime,  tz = "America/New_York")
> > Game_Metrics_Word_Task <-
> > Game_Metrics_Word_Task[!duplicated(Game_Metrics_Word_Task[1:2,])]
> >
> > Participant_Word_Task <-
> > split(arrange(Game_Metrics_Word_Task,StudyId,DeviceTime),
> > arrange(Game_Metrics_Word_Task,StudyId,DeviceTime,StudyId,DeviceTime)$StudyId)
> >
> > WordFrame <- data.frame(Participant = c(0), Task = c(0),
> > MannKendall_Tau = c(0), MannKendall_P = c(0), Sen_Slope_Value =
> > c(0), Sen_Slope_Pval = c(0), Pettitts_CIV = c(0), Pettitts_Pval =
> > c(0), ARIMA_Model = c(0), Time_to_Petit = c(0),
> > Number_of_Trials_to_Pettitt = c(0), Playtime_to_Petit_seconds =
> > c(0), Time_Start_to_end_days = c(0), Number_of_Total_Trials = c(0),
> > Total_Playtime_seconds = c(0), Learning_rate_days = c(0),
> > Learning_rate_seconds = c(0), Learned_Task = c(0))
> >
> > for (i in 1:length(Participant_Word_Task)){
> >     success_series <- xts(filter(Participant_Word_Task[[i]],
> > GameEndReason == "TIMER_UP")$NumberOfSuccesfulWords ,
> > order.by=as.POSIXct(filter(Participant_Word_Task[[i]], GameEndReason
> > == "TIMER_UP")$DeviceTime)) original_series <-
> > xts(Participant_Word_Task[[i]]$NumberOfSuccesfulWords,
> > order.by=as.POSIXct(Participant_Word_Task[[i]]$DeviceTime))
> > success_decomp <- ts(success_series, frequency =
> > nweeks(success_series)) original_decomp <- ts(original_series,
> > frequency = nweeks(success_series))
> >
> >     pdf(paste("Word_Task_Autocorrelation_plots_for_subject_",unique(Participant_Word_Task[[i]]$StudyId),".pdf"
> > ,collapse = NULL, sep = "")) par(mfrow=c(1,2))
> >     Autocorrelationplot <- acf(success_decomp, main=paste(""))
> >     PartialAutocorrelationplot <- pacf(success_decomp,
> > main=paste("")) mtext(paste("Word Task Auto and Partialauto
> > correlations for subject
> > ",unique(Participant_Word_Task[[i]]$StudyId)), side = 3, line = -3,
> > outer = TRUE) dev.off()
> >
> >     AutomatedArimaoutputs <- auto.arima(success_decomp)
> >     p <- length(AutomatedArimaoutputs$model$phi)
> >     #AR component
> >     q <- length(AutomatedArimaoutputs$model$theta)
> >     #MA component
> >     d <- AutomatedArimaoutputs$model$Delta
> >     #order of difference
> >     WordFrame[i,1] <- unique(Participant_Word_Task[[i]]$StudyId)
> >     WordFrame[i,2] <- "Word"
> >     WordFrame[i,3] <- MannKendall(success_decomp)$tau[1]
> >     WordFrame[i,4] <- MannKendall(success_decomp)$sl[1]
> >     WordFrame[i,5] <- sens.slope(success_decomp)$estimates
> >     WordFrame[i,6] <- sens.slope(success_decomp)$p.value
> >     WordFrame[i,7] <- pettitt.test(success_decomp)$estimate
> >     WordFrame[i,8] <- pettitt.test(success_decomp)$p.value
> >     WordFrame[i,9] <- paste("ARIMA(",p,",",q,",",d,")", collapse =
> > NULL, sep = "") WordFrame[i,10] <-
> > difftime(time(success_series[WordFrame[i,7]]),time(original_series[1]))
> > WordFrame[i,11] <- tail(which(grepl(success_series[WordFrame[i,7]],
> > original_series)), n=1) WordFrame[i,12] <-
> > sum(Participant_Word_Task[[i]]$TotalDuration[1:WordFrame[i,11]])-sum(Participant_Word_Task[[i]]$TotalTimePaused[1:WordFrame[i,11]])
> > WordFrame[i,13] <-
> > difftime(time(original_series[length(original_series)]),time(original_series[1]))
> > WordFrame[i,14] <- length(original_series) WordFrame[i,15] <-
> > sum(Participant_Word_Task[[i]]$TotalDuration[1:length(original_series)])-sum(Participant_Word_Task[[i]]$TotalTimePaused[1:length(original_series)])
> >
> >
> >     simplemovingaverage <- SMA(original_series, n =
> > nweeks(original_series))
> >
> >     if (WordFrame[i,4] <= 0.05 & WordFrame[i,6] <= 0.05 &
> > WordFrame[i,8] <= 0.05){ {
> >               pdf(paste(WordFrame[i,1],"_Word_Task_Acquisition.pdf",collapse
> > = NULL, sep = "")) plout <-
> > plot(original_series,type='l',col='blue',xlab="Date of
> > Play",ylab="Number of Successful Words")
> > lines(simplemovingaverage,type='l',col='red') title(paste("Word Task
> > Acquisition for Subject", WordFrame[i,1])) abline(v =
> > index(original_series[WordFrame[i,7]]),lty=2, col='green', lwd=3)
> > dev.off() } WordFrame[i,18] <- T
> >               WordFrame[i,16] <-
> > (1-(WordFrame[i,10]/WordFrame[i,13])) WordFrame[i,17] <-
> > (1-(WordFrame[i,12]/WordFrame[i,15])) } else {
> >               {
> >               pdf(paste(WordFrame[i,1],"_Word_Task_Acquisition.pdf",collapse
> > = NULL, sep = "")) plout <-
> > plot(original_series,type='l',col='blue',xlab="Date of
> > Play",ylab="Number of Successful Words")
> > lines(simplemovingaverage,type='l',col='red') title(paste("Word Task
> > Acquisition for Subject", WordFrame[i,1])) dev.off() }
> >               WordFrame[i,18] <- F
> >               WordFrame[i,16] <- 0
> >               WordFrame[i,17] <- 0
> >     }
> > }
> >
> > It will work just fine if I run the lines individually (e.g. set i =
> > 1, 2, ect), and if I comment out abline and title (lines seems to
> > work fine). But it will throw the error everytime I try to run the
> > loop without these commented.
> >
> > Have tried just about everything I could find on the Stack forums to
> > run everything as a single argument and I'm just not sure what is
> > wrong with it.
> >
> > dev.list() spits out:
> >
> > pdf
> >   2
> > following the error.
> >
> > With abline and title commented out and lines run individually it's
> > NULL.
> >
> > Happens in both RStudio
> >
> > 2022.07.2+576 "Spotted Wakerobin" Release
> > (e7373ef832b49b2a9b88162cfe7eac5f22c40b34, 2022-09-06) for Ubuntu
> > Bionic Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML,
> > like Gecko) QtWebEngine/5.12.8 Chrome/69.0.3497.128 Safari/537.36
> >
> > And R:
> >
> > platform       x86_64-pc-linux-gnu
> > arch           x86_64
> > os             linux-gnu
> > system         x86_64, linux-gnu
> > status
> > major          4
> > minor          2.1
> > year           2022
> > month          06
> > day            23
> > svn rev        82513
> > language       R
> > version.string R version 4.2.1 (2022-06-23)
> > nickname       Funny-Looking Kid
> >
> >
> > My OS:
> > PRETTY_NAME="Debian GNU/Linux 11 (bullseye)"
> > NAME="Debian GNU/Linux"
> > VERSION_ID="11"
> > VERSION="11 (bullseye)"
> > VERSION_CODENAME=bullseye
> > ID=debian
> > HOME_URL="https://secure-web.cisco.com/1Ruvt90Q90ixR-GE-RDiKJgzRpfDjlNz-lZTqQQGM8Tf4GAoj5QOfE2vXMaMWxMoexuf1npQrX7uAjFuU2viz28h42RPmHQK7jGDX7BpRLkTNcERyxHVKJTxgYegXo-n9N7rqegcKsrr47xlGmTcMOJcBAqH7SpTPQlYDOGgjz1ErtetQRzUsd-eKs9l4oCVPiF6SKV40C7s_NXm0tuCswL2Jhyfv70-edCtBO_4j9-3dSi5ZdFLYaWsMScnwwxNIGYU2n0vw5NH4GJcZNsv6Scu-r6W8ndJaGL4UmX9J3PX0LrdFyjLbGtA7RqPpKFUQ/https%3A%2F%2Fwww.debian.org"
> > SUPPORT_URL="https://secure-web.cisco.com/1gveQttVrJNRSM85857IiydpLraxrrtJobMyCNkRvQ4V2f00DH67Z0hEa50LLpCVYQvIjMsQZxHAVMZvYQV_Cp2-e82TDZzPY4aSR2td2th3bwuXGxtI7CTgSUudOWgPpmnwVLT5r34EnwXEmwnMoiPVnOEC7slpF1fLGq11wSynuyttcTagMfpN6qdYfgtbu_mz0JOBUecQ-etUQYw5BDmXEKv5JZ_y5Uyt8Q89Kirhi7Hk8FMbCVcxRZpOZZmghxlPMxYaNVIOnln-R0H8J2QIzqE49cQQPKkFZ9O29zpr8odlBXqjObKn24ReYPDhH/https%3A%2F%2Fwww.debian.org%2Fsupport"
> > BUG_REPORT_URL="https://secure-web.cisco.com/1tepDnCjDgHsmvw9Eth-7nfyKi3doVSOFKVzz83wskdyf8lsrEVkG2NYw7am6ePhSFfjQXdDyceMyc21Un-vqTirSQYKdPavRdKJy85HgHMP66Xk-OgxFf-5KXiPzmFreDfuuJlYizGSUNOLcADyNVTCo47xFfRgtB83Hs8j3yYAJFrff7TqNOFWzSzTcfrycio_WSSfbQkLpUl-1xGzg-dvP16tKuwkRr62bkPeydXJC_iH1FfnWv5b1G04au3aFmRTem8t2RS40LPMS9Mh0UmMvHD_9qwX16cFMHQ8U4x9Sp9IUcAFhgnbffOyPQm1C/https%3A%2F%2Fbugs.debian.org"
> > No LSB modules are available.
> > Distributor ID:   Debian
> > Description:      Debian GNU/Linux 11 (bullseye)
> > Release:    11
> > Codename:   bullseye
> >          Icon name: computer-desktop
> >            Chassis: desktop
> >         Machine ID: 053ebf23707f49c8ad4e0684f4cf19d3
> >            Boot ID: d0e6294d3b944286bef10e76c21e6401
> >   Operating System: Debian GNU/Linux 11 (bullseye)
> >             Kernel: Linux 5.10.0-18-amd64
> >       Architecture: x86-64
> >
> >
> > Any suggestions would be greatly appreciated.
> >
> > --
> >
> > Thomas DeRamus (He/Him/His)
> >
> > Data Analyst
> >
> > Massachusetts General Hospital Brigham
> >
> > Alzheimer's Clinical & Translational Research Unit
> >
> > 149 13th Street
> >
> > Charlestown, MA 02129
> >
> > Phone: 205-834-5066
> >
> > Email: tderamus at partners.org<mailto:tderamus at partners.org>,
> > tpderamus at gmail.com<mailto:tpderamus at gmail.com>
> >
> >
> > [https://secure-web.cisco.com/1AI4S4rz4bDZGM8naa-19GTAeSORO5ZmNe056Q_nhPRk4JVAzPiRKUBWitBK5TpxoKBLoLvNfoMDanGd1n5Bnf4SJFT7l7HnaLcjjH7oVk2BZdDfCLHo8a8eePvD4XrF2Fw3iuxKgIZY5dwdesP3P8pSvkmVGvyZ-HiEKRetk4uJHhRa6gSgOQ8MbCVKmi6XP1dtozTEH1RpDrFJ4EyevPO52UzaTAY6CR8USLWNbsxXJsnsjUz1G6_4P7B3ULuMu9mEPeQz_GnTrSXTrGZooK_idhoEougti7I8NYV0CS09Yahmp4Fe_vh9wu4Jkdal3/https://ci3.googleusercontent.com/mail-sig/AIorK4we2sU30P2HyfDQF5hpEjYTt-9FTBK7cAVsP7EenrZ0nsKCf48fuYMtElj6Szn_2fpSPWr66eQ][https://ci3.googleusercontent.com/mail-sig/AIorK4yyY0DlImU0UONJrHTbPc5T3lJj8Kmu8SbDKJJ3XjcX6CgvVsvSueYKwficYFz4zXt6fZV8YIY]
> >
> > "If knowledge can create problems, it is not through ignorance that
> > we can solve them."
> >
> > -Issac Asimo

The information in this e-mail is intended only for the ...{{dropped:14}}


From tder@mu@ @end|ng |rom p@rtner@@org  Thu Oct  6 03:32:31 2022
From: tder@mu@ @end|ng |rom p@rtner@@org (Deramus, Thomas Patrick)
Date: Thu, 6 Oct 2022 01:32:31 +0000
Subject: [R] Getting "Error in ect,
 plot.new has not been called yet" despite grouping plot call
In-Reply-To: <CAPPM_gRn-HVg2oc8fkNDsJtqm1VSpa4C68z0tCHxPN7b7qQWEw@mail.gmail.com>
References: <PH0PR04MB7493E39389D0196BEC260CB6BE5A9@PH0PR04MB7493.namprd04.prod.outlook.com>
 <CAPPM_gRn-HVg2oc8fkNDsJtqm1VSpa4C68z0tCHxPN7b7qQWEw@mail.gmail.com>
Message-ID: <PH0PR04MB74936D008822D2D660E2392ABE5C9@PH0PR04MB7493.namprd04.prod.outlook.com>

I had to place it right before the title and abline functions like so:

for (i in 1:length(Participant_Word_Task)){
    success_series <- xts(filter(Participant_Word_Task[[i]], GameEndReason == "TIMER_UP")$NumberOfSuccesfulWords , order.by=as.POSIXct(filter(Participant_Word_Task[[i]], GameEndReason == "TIMER_UP")$DeviceTime))
    original_series <- xts(Participant_Word_Task[[i]]$NumberOfSuccesfulWords, order.by=as.POSIXct(Participant_Word_Task[[i]]$DeviceTime))
    success_decomp <- ts(success_series, frequency = nweeks(success_series))
    original_decomp <- ts(original_series, frequency = nweeks(success_series))
    WordFrame[i,1] <- unique(Participant_Word_Task[[i]]$StudyId)
    WordFrame[i,2] <- "Boggle"
    WordFrame[i,3] <- MannKendall(success_decomp)$tau[1]
    WordFrame[i,4] <- MannKendall(success_decomp)$sl[1]
    WordFrame[i,5] <- sens.slope(success_decomp)$estimates
    WordFrame[i,6] <- sens.slope(success_decomp)$p.value
    WordFrame[i,7] <- pettitt.test(success_decomp)$estimate
    WordFrame[i,8] <- pettitt.test(success_decomp)$p.value
    WordFrame[i,10] <- difftime(time(success_series[WordFrame[i,7]]),time(original_series[1]))
    WordFrame[i,11] <- tail(which(grepl(success_series[WordFrame[i,7]], original_series)), n=1)
    WordFrame[i,12] <- sum(Participant_Word_Task[[i]]$TotalDuration[1:WordFrame[i,11]])-sum(Participant_Word_Task[[i]]$TotalTimePaused[1:WordFrame[i,11]])
    WordFrame[i,13] <- difftime(time(original_series[length(original_series)]),time(original_series[1]))
    WordFrame[i,14] <- length(original_series)
    WordFrame[i,15] <- sum(Participant_Word_Task[[i]]$TotalDuration[1:length(original_series)])-sum(Participant_Word_Task[[i]]$TotalTimePaused[1:length(original_series)])


    simplemovingaverage <- SMA(original_series, n = nweeks(original_series))
    if (WordFrame[i,4] <= 0.05 & WordFrame[i,6] <= 0.05 & WordFrame[i,8] <= 0.05){

 lines(simplemovingaverage,type='l',col='red'); title(paste("Word Task Acquisition for Subject", WordFrame[i,1])); abline(v = index(original_series[WordFrame[i,7]]),lty=2, col='green', lwd=3); dev.off()
      {
      pdf(file = paste(WordFrame[i,1],"_Word_Task_Acquisition.pdf",collapse = NULL, sep = ""))
      plout <- plot(original_series,type='l',col='blue',xlab="Date of Play",ylab="Number of Successful Words")
      lines(simplemovingaverage,type='l',col='red')
      print(plout)
      title(paste("Word Task Acquisition for Subject", WordFrame[i,1]))
      abline(v = index(original_series[WordFrame[i,7]]),lty=2, col='green', lwd=3)
      dev.off()
      }

      WordFrame[i,18] <- T
      WordFrame[i,16] <- (1-(WordFrame[i,10]/WordFrame[i,13]))
      WordFrame[i,17] <- (1-(WordFrame[i,12]/WordFrame[i,15]))
    } else {
      {
      pdf(file = paste(WordFrame[i,1],"_Word_Task_Acquisition.pdf",collapse = NULL, sep = ""))
      plout <- plot(original_series,type='l',col='blue',xlab="Date of Play",ylab="Number of Successful Words")
      lines(simplemovingaverage,type='l',col='red')
      print(plout)
      title(paste("Word Task Acquisition for Subject", WordFrame[i,1]))
      dev.off()
      }

      WordFrame[i,18] <- F
      WordFrame[i,16] <- 0
      WordFrame[i,17] <- 0
    }
}
?
But as soon as I did that it worked!

Thank you so much!
________________________________
From: Joshua Ulrich <josh.m.ulrich at gmail.com>
Sent: Wednesday, October 5, 2022 9:16 PM
To: Deramus, Thomas Patrick <tderamus at partners.org>
Cc: R-Help <r-help at r-project.org>
Subject: Re: [R] Getting "Error in ect, plot.new has not been called yet" despite grouping plot call


        External Email - Use Caution

Hi,

My hunch is that you need to add print(plout) before you call dev.off(). See https://stackoverflow.com/a/39853861<https://secure-web.cisco.com/1hPT2Maoird0h5FIvJrkRlN2QFkkujjs4YnHgtB5wYLuhRcHZGZ5SmvPC6x4VQ-rT2HqRBreJ_YeWM8Ug8HtScdp7g_E7nS4BfkHFtjiAKRId_AjYMKIvoJa-YojoOECa97gbnLx2QU535CBNKtd0Z-dzQns8z-C4Du8Jh6K3rEvmlP25DscJvrNcRUbisHQ67um6b6a-H9bqYYN-7QtBp2OGBjnh4LBzDR3TnMNVEF0dbhYTuP5zgP2NsHtCvRrwRUUApS1ZqUT0iiiQCrto3zWrSVlQ6aVOqTBgneUBEk_-8SkwVLgOccgGZyw37JTo/https%3A%2F%2Fstackoverflow.com%2Fa%2F39853861>

Try that and let me know if that works. If not, I'll take a closer look later.

Best,
Josh


On Wed, Oct 5, 2022, 1:40 AM Deramus, Thomas Patrick <tderamus at partners.org<mailto:tderamus at partners.org>> wrote:
Sorry to cross-post on Stackoverflow and here but I'm having some difficulty.
https://stackoverflow.com/questions/73942794/still-getting-error-in-ect-plot-new-has-not-been-called-yet-despite-grouping<https://secure-web.cisco.com/1Xaq1EClv5yIy5MQnXyJBRP44YCvR9TkouPyPXmenkL1IktK5tDxQ_MynVlVIbnlxMlCViUOwZZPfM6GNcEI1NlAqV7y-6RhsR6Qy1m90ENv5mp19zbOX-f-IqNkbFHuGZZLCBFkq0sMS_waWZZSj3Su0bNo5Y1b3zCkVoVLl1Go2J2A1jWX3fvSvOP2ArzpHWt9qX8HZpoGVkadBfUmANamoUw5ucuBsXvvaWdl1skYiJzSVyLOaudIgsCzzRq71RtSGcI0wu7pqSjecwy87CNo2IwYi4hzHW45NiTjzbVUsvvb2AXC4G3Ctoh9c15CM/https%3A%2F%2Fstackoverflow.com%2Fquestions%2F73942794%2Fstill-getting-error-in-ect-plot-new-has-not-been-called-yet-despite-grouping>

Trying to make a nested loop that produces PDFs off different graphs, one for ACF/PACF diagnostics and another for the actual data, based on some time-series analyses I'm doing.

Unfortunately, I keep getting the dreaded: Error plot.new has not been called yet

The code is meant to write a PDF containing the ACF and PACF graphs, then do some analyses on the timeseries, and then make a separate PDF containing a plot describing the timeseries based on the p-values of each test for each individual.

library(plyr)
library(dplyr)
library(ggplot2)
library(Kendall)
library(lubridate)
library(xts)
library(TTR)
library(trend)
library(forecast)
library(openxlsx)

Game_Metrics_Word_Task <- read.xlsx("GamePack_Analytics_ALL_TIME_Short.xlsx", "Boggle")
Game_Metrics_Word_Task <- Game_Metrics_Word_Task %>% filter(grepl('1440', StudyId))
Game_Metrics_Word_Task$DeviceTime <- ymd_hms(Game_Metrics_Word_Task$DeviceTime,  tz = "America/New_York")
Game_Metrics_Word_Task <- Game_Metrics_Word_Task[!duplicated(Game_Metrics_Word_Task[1:2,])]

Participant_Word_Task <- split(arrange(Game_Metrics_Word_Task,StudyId,DeviceTime), arrange(Game_Metrics_Word_Task,StudyId,DeviceTime,StudyId,DeviceTime)$StudyId)

WordFrame <- data.frame(Participant = c(0), Task = c(0), MannKendall_Tau = c(0), MannKendall_P = c(0), Sen_Slope_Value = c(0), Sen_Slope_Pval = c(0), Pettitts_CIV = c(0), Pettitts_Pval = c(0), ARIMA_Model = c(0), Time_to_Petit = c(0), Number_of_Trials_to_Pettitt = c(0), Playtime_to_Petit_seconds = c(0), Time_Start_to_end_days = c(0), Number_of_Total_Trials = c(0), Total_Playtime_seconds = c(0), Learning_rate_days = c(0), Learning_rate_seconds = c(0), Learned_Task = c(0))

for (i in 1:length(Participant_Word_Task)){
    success_series <- xts(filter(Participant_Word_Task[[i]], GameEndReason == "TIMER_UP")$NumberOfSuccesfulWords , order.by<http://secure-web.cisco.com/10boIOil_1j37yFHh_eAQC6S-GAWujDCUxF8SFXlL05I4ABkjAjfCpv636hC2_D9ZcnRJNo07NJLs1husggxCVibrINE_e4DkPNcX0JYVosd5gut0FGPSMyIREh9RQoZW3GPaCVyAjIqzeAuKYHJz1C9DZqEdN-SFLGFqZaWzvaYwep785sKgQJCb4FlZA7G7jjr42MjSg97lgbRnFXj7vopsZ3gXb_EoSNtkIHNP7y5bMYQio505DE0WHrz1FFFbt_WehSBrNEAx5UXdrD5gkNwp1jzLMONBJA_2Dj3gZUhAP1AQOyHrI_qYEQKtFpiO/http%3A%2F%2Forder.by>=as.POSIXct(filter(Participant_Word_Task[[i]], GameEndReason == "TIMER_UP")$DeviceTime))
    original_series <- xts(Participant_Word_Task[[i]]$NumberOfSuccesfulWords, order.by<http://secure-web.cisco.com/10boIOil_1j37yFHh_eAQC6S-GAWujDCUxF8SFXlL05I4ABkjAjfCpv636hC2_D9ZcnRJNo07NJLs1husggxCVibrINE_e4DkPNcX0JYVosd5gut0FGPSMyIREh9RQoZW3GPaCVyAjIqzeAuKYHJz1C9DZqEdN-SFLGFqZaWzvaYwep785sKgQJCb4FlZA7G7jjr42MjSg97lgbRnFXj7vopsZ3gXb_EoSNtkIHNP7y5bMYQio505DE0WHrz1FFFbt_WehSBrNEAx5UXdrD5gkNwp1jzLMONBJA_2Dj3gZUhAP1AQOyHrI_qYEQKtFpiO/http%3A%2F%2Forder.by>=as.POSIXct(Participant_Word_Task[[i]]$DeviceTime))
    success_decomp <- ts(success_series, frequency = nweeks(success_series))
    original_decomp <- ts(original_series, frequency = nweeks(success_series))

    pdf(paste("Word_Task_Autocorrelation_plots_for_subject_",unique(Participant_Word_Task[[i]]$StudyId),".pdf" ,collapse = NULL, sep = ""))
    par(mfrow=c(1,2))
    Autocorrelationplot <- acf(success_decomp, main=paste(""))
    PartialAutocorrelationplot <- pacf(success_decomp, main=paste(""))
    mtext(paste("Word Task Auto and Partialauto correlations for subject ",unique(Participant_Word_Task[[i]]$StudyId)), side = 3, line = -3, outer = TRUE)
    dev.off()

    AutomatedArimaoutputs <- auto.arima(success_decomp)
    p <- length(AutomatedArimaoutputs$model$phi)
    #AR component
    q <- length(AutomatedArimaoutputs$model$theta)
    #MA component
    d <- AutomatedArimaoutputs$model$Delta
    #order of difference
    WordFrame[i,1] <- unique(Participant_Word_Task[[i]]$StudyId)
    WordFrame[i,2] <- "Word"
    WordFrame[i,3] <- MannKendall(success_decomp)$tau[1]
    WordFrame[i,4] <- MannKendall(success_decomp)$sl[1]
    WordFrame[i,5] <- sens.slope(success_decomp)$estimates
    WordFrame[i,6] <- sens.slope(success_decomp)$p.value
    WordFrame[i,7] <- pettitt.test(success_decomp)$estimate
    WordFrame[i,8] <- pettitt.test(success_decomp)$p.value
    WordFrame[i,9] <- paste("ARIMA(",p,",",q,",",d,")", collapse = NULL, sep = "")
    WordFrame[i,10] <- difftime(time(success_series[WordFrame[i,7]]),time(original_series[1]))
    WordFrame[i,11] <- tail(which(grepl(success_series[WordFrame[i,7]], original_series)), n=1)
    WordFrame[i,12] <- sum(Participant_Word_Task[[i]]$TotalDuration[1:WordFrame[i,11]])-sum(Participant_Word_Task[[i]]$TotalTimePaused[1:WordFrame[i,11]])
    WordFrame[i,13] <- difftime(time(original_series[length(original_series)]),time(original_series[1]))
    WordFrame[i,14] <- length(original_series)
    WordFrame[i,15] <- sum(Participant_Word_Task[[i]]$TotalDuration[1:length(original_series)])-sum(Participant_Word_Task[[i]]$TotalTimePaused[1:length(original_series)])


    simplemovingaverage <- SMA(original_series, n = nweeks(original_series))

    if (WordFrame[i,4] <= 0.05 & WordFrame[i,6] <= 0.05 & WordFrame[i,8] <= 0.05){
              {
              pdf(paste(WordFrame[i,1],"_Word_Task_Acquisition.pdf",collapse = NULL, sep = ""))
              plout <- plot(original_series,type='l',col='blue',xlab="Date of Play",ylab="Number of Successful Words")
              lines(simplemovingaverage,type='l',col='red')
              title(paste("Word Task Acquisition for Subject", WordFrame[i,1]))
              abline(v = index(original_series[WordFrame[i,7]]),lty=2, col='green', lwd=3)
              dev.off()
              }
              WordFrame[i,18] <- T
              WordFrame[i,16] <- (1-(WordFrame[i,10]/WordFrame[i,13]))
              WordFrame[i,17] <- (1-(WordFrame[i,12]/WordFrame[i,15]))
    } else {
              {
              pdf(paste(WordFrame[i,1],"_Word_Task_Acquisition.pdf",collapse = NULL, sep = ""))
              plout <- plot(original_series,type='l',col='blue',xlab="Date of Play",ylab="Number of Successful Words")
              lines(simplemovingaverage,type='l',col='red')
              title(paste("Word Task Acquisition for Subject", WordFrame[i,1]))
              dev.off()
              }
              WordFrame[i,18] <- F
              WordFrame[i,16] <- 0
              WordFrame[i,17] <- 0
    }
}

It will work just fine if I run the lines individually (e.g. set i = 1, 2, ect), and if I comment out abline and title (lines seems to work fine). But it will throw the error everytime I try to run the loop without these commented.

Have tried just about everything I could find on the Stack forums to run everything as a single argument and I'm just not sure what is wrong with it.

dev.list() spits out:

pdf
  2
following the error.

With abline and title commented out and lines run individually it's NULL.

Happens in both RStudio

2022.07.2+576 "Spotted Wakerobin" Release (e7373ef832b49b2a9b88162cfe7eac5f22c40b34, 2022-09-06) for Ubuntu Bionic
Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) QtWebEngine/5.12.8 Chrome/69.0.3497.128 Safari/537.36

And R:

platform       x86_64-pc-linux-gnu
arch           x86_64
os             linux-gnu
system         x86_64, linux-gnu
status
major          4
minor          2.1
year           2022
month          06
day            23
svn rev        82513
language       R
version.string R version 4.2.1 (2022-06-23)
nickname       Funny-Looking Kid


My OS:
PRETTY_NAME="Debian GNU/Linux 11 (bullseye)"
NAME="Debian GNU/Linux"
VERSION_ID="11"
VERSION="11 (bullseye)"
VERSION_CODENAME=bullseye
ID=debian
HOME_URL="https://www.debian.org/<https://secure-web.cisco.com/1ACDhN-pLD9mzYG0v4VTzMKxAyLmTIADEHLJIuzQBX8KrUHWm1giGPYPmZCHAPpLY42jxDLfqh6eM_dWl9xJg-NmLD-dzpJqBQ-Yy3WuhZONfcn8ZwoK19G46Dm_hBu-Hrl9eV2uzZsEDY_38eQoRMVILy98SEEufRocF9YyjPAW8Y-euSSmPOLDK2PF9CGMABP9qNF6O_sYhykJnPf2_2ptZHvGAEuDDwY925wnRVsvLdc7Rl5zSJE5n45yGOXFaeihwRearfnxKPi8vufhoDC0LOKRYIVSTRAPJJEq3dqTgtDJXkq4UKyJToMfCtF0x/https%3A%2F%2Fwww.debian.org%2F>"
SUPPORT_URL="https://www.debian.org/support<https://secure-web.cisco.com/1Ck4yTAQD273G1LHpBEXmkgIu4kavtz3379Nq-aX3Btcot2VBSq9lKAZN5X2tWi6yT-GMfbuJYp3U621mE6Vk4vf9MJQ3SNMkBn19QcLWgLVnsQvOupmnVd31EWpgYIsutKyJ6Gro4S47Ac8b0GQLFE8VZNrWlbs5YKY3hcPuctYD13LVyjL5zlhP5zvg8wbUX73GBYMHp94c2qKPUfNnsUH1VxXudeB4ZtlnPl66TcO8gJAIYdQmVlw0tIOTdr5VVJ6EbdrRRHKJ7AJvsJWMIn8SAHHusAf7Kc8kCGc0obyScRr-5hU-ImcSro2vFhUe/https%3A%2F%2Fwww.debian.org%2Fsupport>"
BUG_REPORT_URL="https://bugs.debian.org/<https://secure-web.cisco.com/1Kma-rbfMkalSm7CWHd2_J7JxCIrLBWgbW7-6BMP4GaNfBdSR7Y1Cb-8OMMnZjLZbNWg60FnjHKbHrwdsX_noY5nvLC_EaTbhL883q3UtHb3j3i0-Ebdd1vMvHvgn-xWeuYwRTmIZjWV8elT_g_phphQB7EMdaPCS6lHSGC1wkpOKYg9V_cNlEHHMsrtuRMXD-kkjj9h_ziH6Nu-25zVvTIfUbr0ODIxrtThOkJ4wopWByCBXPKInKG_-1gBNV8q_oPar_NJDH3N6D8Zil9T2dPkgZrSUkvP42xw2XnvQ_fYD1x9_57P8KPtPpCik1Sdc/https%3A%2F%2Fbugs.debian.org%2F>"
No LSB modules are available.
Distributor ID:???Debian
Description:??????Debian GNU/Linux 11 (bullseye)
Release:????11
Codename:???bullseye
         Icon name: computer-desktop
           Chassis: desktop
        Machine ID: 053ebf23707f49c8ad4e0684f4cf19d3
           Boot ID: d0e6294d3b944286bef10e76c21e6401
  Operating System: Debian GNU/Linux 11 (bullseye)
            Kernel: Linux 5.10.0-18-amd64
      Architecture: x86-64


Any suggestions would be greatly appreciated.

--

Thomas DeRamus (He/Him/His)

Data Analyst

Massachusetts General Hospital Brigham

Alzheimer?s Clinical & Translational Research Unit

149 13th Street

Charlestown, MA 02129

Phone: 205-834-5066

Email: tderamus at partners.org<mailto:tderamus at partners.org><mailto:tderamus at partners.org<mailto:tderamus at partners.org>>, tpderamus at gmail.com<mailto:tpderamus at gmail.com><mailto:tpderamus at gmail.com<mailto:tpderamus at gmail.com>>


[https://ci3.googleusercontent.com/mail-sig/AIorK4we2sU30P2HyfDQF5hpEjYTt-9FTBK7cAVsP7EenrZ0nsKCf48fuYMtElj6Szn_2fpSPWr66eQ][https://ci3.googleusercontent.com/mail-sig/AIorK4yyY0DlImU0UONJrHTbPc5T3lJj8Kmu8SbDKJJ3XjcX6CgvVsvSueYKwficYFz4zXt6fZV8YIY<https://secure-web.cisco.com/1p4CoOEfGfFgyADIKdZuTyxCAxu1iAL4dl_xBOs0kNACeZBlKqxOU1hdF4bmbj_pz-ZhvRQyetDE_Br_g_kCZNaTln8L0uSdieFdFVX6W2p81hni5pzndOTrQPuenlZezHkcZDaXhr566__QDE7iZutarcm6bGONz_PdpQMeFGoqy9DtDbvmJLEf8x4C_4H1cFd1xYpj4sXozZ1vhTpbayy4IHfK9qLHsnzyPWDEtccLFMO2DjOQu1Kguw_rBvVlQlef7u_XufAbLPWJ5c6FUUC8K1vLFg1xB4-YJctdg4he3hvvz_e8kue-C0qn7a_Iw/https%3A%2F%2Fci3.googleusercontent.com%2Fmail-sig%2FAIorK4we2sU30P2HyfDQF5hpEjYTt-9FTBK7cAVsP7EenrZ0nsKCf48fuYMtElj6Szn_2fpSPWr66eQ%255D%255Bhttps%3A%2F%2Fci3.googleusercontent.com%2Fmail-sig%2FAIorK4yyY0DlImU0UONJrHTbPc5T3lJj8Kmu8SbDKJJ3XjcX6CgvVsvSueYKwficYFz4zXt6fZV8YIY>]

?If knowledge can create problems, it is not through ignorance that we can solve them.?

?Issac Asimov
The information in this e-mail is intended only for the person to whom it is addressed.  If you believe this e-mail was sent to you in error and the e-mail contains patient information, please contact the Mass General Brigham Compliance HelpLine at https://www.massgeneralbrigham.org/complianceline<https://secure-web.cisco.com/1nLR3j5jLEy6A5yyLXTgiSEPglT5zpYBKY0XNFwmEgtrG9PV13Lfd015mRGeFTVsVSFliuG7VXmI-O3Fw0DpFvFKA0GR9lj4jtJ3BQL8MblvkUTO-F6rUjk5jgtDZtSmOeRU6wInl00IqoCwYR3FSQD9_XBe3uQzm6mAviB2SqvIE4u4BFQbNnhQSh-z6E6eGVGAIuG64OGuTByh1AYgf2O3xP3PcXwQiUa6M504snWIaHca1eJ7HB03HRx91JqKUnwhXhOMXidWvZ8djcHw59faZKzc68R55-8RkBTvcDJ1Ln_5ouA6Z0VgC2oHGWPkW/https%3A%2F%2Fwww.massgeneralbrigham.org%2Fcomplianceline> <https://www.massgeneralbrigham.org/complianceline<https://secure-web.cisco.com/1nLR3j5jLEy6A5yyLXTgiSEPglT5zpYBKY0XNFwmEgtrG9PV13Lfd015mRGeFTVsVSFliuG7VXmI-O3Fw0DpFvFKA0GR9lj4jtJ3BQL8MblvkUTO-F6rUjk5jgtDZtSmOeRU6wInl00IqoCwYR3FSQD9_XBe3uQzm6mAviB2SqvIE4u4BFQbNnhQSh-z6E6eGVGAIuG64OGuTByh1AYgf2O3xP3PcXwQiUa6M504snWIaHca1eJ7HB03HRx91JqKUnwhXhOMXidWvZ8djcHw59faZKzc68R55-8RkBTvcDJ1Ln_5ouA6Z0VgC2oHGWPkW/https%3A%2F%2Fwww.massgeneralbrigham.org%2Fcomplianceline>> .
Please note that this e-mail is not secure (encrypted).  If you do not wish to continue communication over unencrypted e-mail, please notify the sender of this message immediately.  Continuing to send or respond to e-mail after receiving this message means you understand and accept this risk and wish to continue to communicate over unencrypted e-mail.
______________________________________________
R-help at r-project.org<mailto:R-help at r-project.org> mailing list -- To UNSUBSCRIBE and more, see
https://stat.ethz.ch/mailman/listinfo/r-help<https://secure-web.cisco.com/169zqX-6K1A_ERyLXXpVduo-L_bdP58wU0tW6976VBgCPzCLprqR3-s8od_SWvcEnJWclWMXLbDu8eHwBNlKcyrCpUuuMxKuz3xGbpVjkqDLLHD7C45e3EKTiUq5JIEFLQ8XvR-IsvhuHJjqfmHKzaeEzciR71ac-nMIG0ZJHmMuQyVv3Yuety2ReZ0Xa5vdHW5zcq0HUKH16bzLXeqSWc6rRkE-i-y9WK_OX959hz6gDnIMSu8RNuwe0TndTxMQyHcG-fK9Ph0sG_12ZjFdw3qL2yzWsEI3sXZ6mFU2v7npLKE1634X53nJ-FnqFhRQ6/https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help>
PLEASE do read the posting guide http://www.R-project.org/posting-guide.html<http://secure-web.cisco.com/1q--2yVlI7EkpVlbb7cUxHfn03FTKwZsan7XtRgYCrbX98T0WAQn7WNr8Hqt2ZVUuBgmAA5i5zh5M8nfzRoj6CFtWvdyzMvxMdS6eXYA3rlGcZ8LsHDHoUQbsEE9ui-hVicew7e5Ocd1Ed5OSDVeGDecKIEjUUZwTmS3DDa_ilt8dNQOGZaBGOdbnjk0bNYRDT_FiB077ShZRBmKmTX8838zgtFk-hVIGcfvbywCmhpGibHuQ7zyZhd-5wgj9b-c8d2XA6A8yno_2I9DNltls3YoqZcjFoczsuvvTx24DjXJGmaz8wRm3CEg1fuTONU0a/http%3A%2F%2Fwww.R-project.org%2Fposting-guide.html>
and provide commented, minimal, self-contained, reproducible code.
The information in this e-mail is intended only for the person to whom it is addressed.  If you believe this e-mail was sent to you in error and the e-mail contains patient information, please contact the Mass General Brigham Compliance HelpLine at https://www.massgeneralbrigham.org/complianceline <https://www.massgeneralbrigham.org/complianceline> .
Please note that this e-mail is not secure (encrypted).  If you do not wish to continue communication over unencrypted e-mail, please notify the sender of this message immediately.  Continuing to send or respond to e-mail after receiving this message means you understand and accept this risk and wish to continue to communicate over unencrypted e-mail. 

	[[alternative HTML version deleted]]


From t|m@how@rd @end|ng |rom dec@ny@gov  Thu Oct  6 13:08:51 2022
From: t|m@how@rd @end|ng |rom dec@ny@gov (Howard, Tim G (DEC))
Date: Thu, 6 Oct 2022 11:08:51 +0000
Subject: [R] 
 =?iso-8859-1?q?R_version_4=2E2=2E1_install=2Epackages_does_n?=
 =?iso-8859-1?q?ot_work_with_IE_proxy_setting?=
In-Reply-To: <mailman.367970.1.1665050401.59673.r-help@r-project.org>
References: <mailman.367970.1.1665050401.59673.r-help@r-project.org>
Message-ID: <SA1PR09MB7792998783FE251D30BB58A6A85C9@SA1PR09MB7792.namprd09.prod.outlook.com>

Petr, 
You also might want to check out the bug reported here:

https://bugs.r-project.org/show_bug.cgi?id=18379

it was fixed and the last two comments discuss how to handle it in Windows:

you add a new User Environment Variable:
R_LIBCURL_SSL_REVOKE_BEST_EFFORT and set it to TRUE

This fix is in R-4.2.1 Patched (I don't know if it has made it out to the full distribution) and works in my 'corporate' environment.  Perhaps it also applies to your environment. 

Tim


Date: Wed, 5 Oct 2022 10:34:02 +0000
From: PIKAL Petr <petr.pikal at precheza.cz>
To: Ivan Krylov <krylov.r00t at gmail.com>
Cc: r-help mailing list <r-help at r-project.org>
Subject: Re: [R]? R version 4.2.1 install.packages does not work with
??????? IE proxy setting
Message-ID:
??????? <9b38aacf51d746bb87a9cc3765a16b99 at SRVEXCHCM1302.precheza.cz>
Content-Type: text/plain; charset="us-ascii"

Thanks,

the workaround works but we need try the "permanent" solution with
Renviron.site file in future.

Cheers
Petr

> -----Original Message-----
> From: Ivan Krylov <krylov.r00t at gmail.com>
> Sent: Tuesday, October 4, 2022 5:43 PM
> To: PIKAL Petr <petr.pikal at precheza.cz>
> Cc: r-help mailing list <r-help at r-project.org>
> Subject: Re: [R] R version 4.2.1 install.packages does not work with IE
proxy
> setting
>
> On Tue, 4 Oct 2022 11:01:14 +0000
> PIKAL Petr <petr.pikal at precheza.cz> wrote:
>
> > After we installed new R version R 4.2.1 installing packages through
> > IE proxy setting is compromised with warning that R could not connect
> > to server (tested in vanilla R).
>
> R 4.1 deprecated the use of download.file(method = 'wininet'). R 4.2
switched
> the default download method to 'libcurl' and started giving warnings for
> 'wininet' and http[s]:// URLs.
>
> A workaround to get it working right now would be to set
> options(download.file.method = 'wininet') and live with the resulting
warnings
> while R downloads the files, but a next version of R may remove 'wininet'
> support altogether.
>
> In order to get it working with the 'libcurl' method, you'll need to
provide some
> environment variables to curl:
> https://gcc02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fpipermail%2Fr-help%2F2022-September%2F475917.html&amp;data=05%7C01%7Ctim.howard%40dec.ny.gov%7C1b8601d6e602486b347508daa781d26e%7Cf46cb8ea79004d108ceb80e8c1c81ee7%7C0%7C0%7C638006473285010034%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=7w1P6Sfu7V3DUM4a3Ezgmf87bXn8CnC%2FipTvXfBpI0c%3D&amp;reserved=0
>
> Not sure if libcurl would accept a patch to discover the Windows proxy
settings
> automatically, but I don't think it does that now.
>
> --
> Best regards,
> Ivan



From @c|@bo|@zz@ @end|ng |rom gm@||@com  Thu Oct  6 13:23:23 2022
From: @c|@bo|@zz@ @end|ng |rom gm@||@com (Valerio Leone Sciabolazza)
Date: Thu, 6 Oct 2022 13:23:23 +0200
Subject: [R] Fixed effect model: different estimation approaches with R
 return different results
Message-ID: <CABZtLWwwgUfZ24tLA-Ub2w6kzMwsSuDWkCkWu2rapS7Gs+psaw@mail.gmail.com>

Good morning,
I am trying to use R to estimate a fixed effects model (i.e., a panel
regression model controlling for unobserved time-invariant
heterogeneities across agents) using different estimation approaches
(e.g. replicating xtreg from Stata, see e.g.
https://www.stata.com/support/faqs/statistics/intercept-in-fixed-effects-model/).
I have already asked this question on different stacks exchange forums
and contacted package creators who dealt with this issue before, but I
wasn't able to obtain an answer to my doubts.
I hope to have better luck on this list.

Let me introduce the problem, and note that I am using an unbalanced panel.

The easiest way to estimate my fixed effect model is using the function lm.

Example:

# load packages
library(dplyr)
# set seed for replication purposes
set.seed(123)
# create toy dataset
x <- rnorm(4000)
x2 <- rnorm(length(x))
id <- factor(sample(500,length(x),replace=TRUE))
firm <- data.frame(id = id) %>%
group_by(id) %>%
mutate(firm = 1:n()) %>%
pull(firm)
id.eff <- rlnorm(nlevels(id))
firm.eff <- rexp(length(unique(firm)))
y <- x + 0.25*x2 + id.eff[id] + firm.eff[firm] + rnorm(length(x))
db = data.frame(y = y, x = x, id = id, firm = firm)
rm <- db %>% group_by(id) %>% summarise(firm = max(firm)) %>%
filter(firm == 1) %>% pull(id)
db = db[-which(db$id %in% rm), ]
# Run regression
test <- lm(y ~ x + id, data = db)

Another approach is demeaning the variables included into the model
specification.
In this way, one can exclude the fixed effects from the model. Of
course, point estimates will be correct, while standard errors will be
not (because we are not accounting for the degrees of freedom used in
the demeaning).

# demean data
dbm <- as_tibble(db) %>%
group_by(id) %>%
mutate(y = y - mean(y),
       x = x - mean(x)) %>%
ungroup()
# run regression
test2 <- lm(y ~ x, data = dbm)
# compare results
summary(test)$coefficients[2,1]
> 0.9753364
summary(test2)$coefficients[2,1]
> 0.9753364

Another way to do this is to demean the variables and add their grand
average (I believe that this is what xtreg from Stata does)

# create data
n = length(unique(db$id))
dbh <- dbm %>%
mutate(yh = y + (sum(db$y)/n),
       xh = x + (sum(db$x)/n))
# run regression
test3 <- lm(yh ~ xh, dbh)
# compare results
summary(test)$coefficients[2,1]
> 0.9753364
summary(test2)$coefficients[2,1]
> 0.9753364
summary(test3)$coefficients[2,1]
> 0.9753364

As one can see, the three approaches report the same point estimates
(again, standard errors will be different instead).

When I include an additional set of fixed effects in the model
specification, the three approaches no longer return the same point
estimate. However, differences seem to be negligible and they could be
due to rounding.

db$firm <- as.factor(db$firm)
dbm$firm <- as.factor(dbm$firm)
dbh$firm <- as.factor(dbh$firm)
testB <- lm(y ~ x + id + firm, data = db)
testB2 <- lm(y ~ x + firm, data = dbm)
testB3 <- lm(yh ~ xh + firm, data = dbh)
summary(testB)$coefficients[2,1]
> 0.9834414
summary(testB2)$coefficients[2,1]
> 0.9833334
summary(testB3)$coefficients[2,1]
> 0.9833334

A similar behavior occurs if I use a dummy variable rather than a
continous one. For the only purpose of the example, I show this by
transforming my target variable x from a continuous to a dummy
variable.

# create data
x3 <- ifelse(db$x > 0, 1, 0)
db <- db %>% mutate(x3 = x3)
dbm <- dbm %>%
mutate(x3 = x3) %>%
group_by(id) %>%
mutate(x3 = x3 - mean(x3)) %>%
ungroup()
dbh <- dbh %>% mutate(x3 = dbm$x3) %>%
mutate(x3 = x3 + (sum(db$x3)/n)) %>%
ungroup()
# Run regressions
testC <- lm(y ~ x3 + id + firm, data = db)
testC2 <- lm(y ~ x3 + firm, data = dbm)
testC3 <- lm(yh ~ x3 + firm, data = dbh)
summary(testC)$coefficients[2, 1]
> 1.579883
summary(testC2)$coefficients[2, 1]
> 1.579159
summary(testC3)$coefficients[2, 1]
> 1.579159

Now, I want to estimate both the impact of x when this is higher than
0 (i.e., x3) and when this is lower or equal to zero (call it x4).
Again, observe that x3 might as well be a real dummy variable, not a
transformation of a continuous variable.

In order to do that, I exclude the intercept from my model.
Specifically, I do the following:

# create data
x4 <- ifelse(db$x <= 0, 1, 0)
db <- db %>% mutate(x4 = x4)
dbm <- dbm %>%
mutate(x4 = x4) %>%
group_by(id) %>%
mutate(x4 = x4 - mean(x4)) %>%
ungroup()
dbh <- dbh %>% mutate(x4 = dbm$x4) %>%
mutate(x4 = x4 + (sum(db$x4)/n)) %>%
ungroup()
testD <- lm(y ~ x3 + x4 + id + firm - 1, data = db)
testD2 <- lm(y ~ x3 + x4 + firm - 1, data = dbm)
testD3 <- lm(yh ~ x3 + x4 + firm - 1, data = dbh)
summary(testD)$coefficients[1:2, ]
> 1.2372816 -0.3426011
summary(testD2)
> Call:
lm(formula = y ~ x3 + x4 + firm - 1, data = dbm)

Residuals:
    Min      1Q  Median      3Q     Max
-3.8794 -0.7497  0.0010  0.7442  3.8486

Coefficients: (1 not defined because of singularities)
       Estimate Std. Error t value Pr(>|t|)
x3      1.57916    0.03779  41.788  < 2e-16 ***
x4           NA         NA      NA       NA
... redacted
summary(testD3)$coefficients[1:2]
> 3.254654 1.675495

As you can see, the second approach is not able to estimate the impact
of x4 on y. At the same time, the first and the third approach return
very different point estimates.

Is anyone able to explain me why I cannot obtain the same point
estimates for this last exercise?

Is there anything wrong in the way I include the second set of fixed effects?
Is there anything wrong in the way I include the variables x3 and x4?
Or this is simply a problem due to some internal functions in R?

Any hint would be much appreciated.

Best,
Valerio


From petr@p|k@| @end|ng |rom prechez@@cz  Thu Oct  6 13:51:53 2022
From: petr@p|k@| @end|ng |rom prechez@@cz (PIKAL Petr)
Date: Thu, 6 Oct 2022 11:51:53 +0000
Subject: [R] 
 =?iso-8859-2?q?R_version_4=2E2=2E1_install=2Epackages_does_n?=
 =?iso-8859-2?q?ot_work_with_IE_proxy_setting?=
In-Reply-To: <SA1PR09MB7792998783FE251D30BB58A6A85C9@SA1PR09MB7792.namprd09.prod.outlook.com>
References: <mailman.367970.1.1665050401.59673.r-help@r-project.org>
 <SA1PR09MB7792998783FE251D30BB58A6A85C9@SA1PR09MB7792.namprd09.prod.outlook.com>
Message-ID: <64b4637a750d43bbbd7a31a593c30921@SRVEXCHCM1302.precheza.cz>

Hallo Howard

Thanks, for the time being the previous workaround with wininet options
works for me. I will wait for the new R version and then try to persuade our
IT to make relevant changes.

Cheers
Petr

> -----Original Message-----
> From: Howard, Tim G (DEC) <tim.howard at dec.ny.gov>
> Sent: Thursday, October 6, 2022 1:09 PM
> To: r-help at r-project.org; PIKAL Petr <petr.pikal at precheza.cz>
> Subject: Re: [R]? R version 4.2.1 install.packages does not work with IE
proxy
> setting
> 
> Petr,
> You also might want to check out the bug reported here:
> 
> https://bugs.r-project.org/show_bug.cgi?id=18379
> 
> it was fixed and the last two comments discuss how to handle it in
Windows:
> 
> you add a new User Environment Variable:
> R_LIBCURL_SSL_REVOKE_BEST_EFFORT and set it to TRUE
> 
> This fix is in R-4.2.1 Patched (I don't know if it has made it out to the
full
> distribution) and works in my 'corporate' environment.  Perhaps it also
applies
> to your environment.
> 
> Tim
> 
> 
> Date: Wed, 5 Oct 2022 10:34:02 +0000
> From: PIKAL Petr <petr.pikal at precheza.cz>
> To: Ivan Krylov <krylov.r00t at gmail.com>
> Cc: r-help mailing list <r-help at r-project.org>
> Subject: Re: [R]? R version 4.2.1 install.packages does not work with
> ??????? IE proxy setting
> Message-ID:
> ??????? <9b38aacf51d746bb87a9cc3765a16b99 at SRVEXCHCM1302.precheza.cz>
> Content-Type: text/plain; charset="us-ascii"
> 
> Thanks,
> 
> the workaround works but we need try the "permanent" solution with
> Renviron.site file in future.
> 
> Cheers
> Petr
> 
> > -----Original Message-----
> > From: Ivan Krylov <krylov.r00t at gmail.com>
> > Sent: Tuesday, October 4, 2022 5:43 PM
> > To: PIKAL Petr <petr.pikal at precheza.cz>
> > Cc: r-help mailing list <r-help at r-project.org>
> > Subject: Re: [R] R version 4.2.1 install.packages does not work with
> > IE
> proxy
> > setting
> >
> > On Tue, 4 Oct 2022 11:01:14 +0000
> > PIKAL Petr <petr.pikal at precheza.cz> wrote:
> >
> > > After we installed new R version R 4.2.1 installing packages through
> > > IE proxy setting is compromised with warning that R could not
> > > connect to server (tested in vanilla R).
> >
> > R 4.1 deprecated the use of download.file(method = 'wininet'). R 4.2
> switched
> > the default download method to 'libcurl' and started giving warnings
> > for 'wininet' and http[s]:// URLs.
> >
> > A workaround to get it working right now would be to set
> > options(download.file.method = 'wininet') and live with the resulting
> warnings
> > while R downloads the files, but a next version of R may remove
'wininet'
> > support altogether.
> >
> > In order to get it working with the 'libcurl' method, you'll need to
> provide some
> > environment variables to curl:
> > https://gcc02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat
> > .ethz.ch%2Fpipermail%2Fr-help%2F2022-
> September%2F475917.html&amp;data=
> >
> 05%7C01%7Ctim.howard%40dec.ny.gov%7C1b8601d6e602486b347508daa7
> 81d26e%7
> >
> Cf46cb8ea79004d108ceb80e8c1c81ee7%7C0%7C0%7C63800647328501003
> 4%7CUnkno
> >
> wn%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1ha
> WwiL
> >
> CJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=7w1P6Sfu7V3DUM4a3Ez
> gmf87bXn8Cn
> > C%2FipTvXfBpI0c%3D&amp;reserved=0
> >
> > Not sure if libcurl would accept a patch to discover the Windows proxy
> settings
> > automatically, but I don't think it does that now.
> >
> > --
> > Best regards,
> > Ivan


From bgunter@4567 @end|ng |rom gm@||@com  Thu Oct  6 16:31:26 2022
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Thu, 6 Oct 2022 07:31:26 -0700
Subject: [R] Fixed effect model: different estimation approaches with R
 return different results
In-Reply-To: <CABZtLWwwgUfZ24tLA-Ub2w6kzMwsSuDWkCkWu2rapS7Gs+psaw@mail.gmail.com>
References: <CABZtLWwwgUfZ24tLA-Ub2w6kzMwsSuDWkCkWu2rapS7Gs+psaw@mail.gmail.com>
Message-ID: <CAGxFJbR_ACsLpms9VgPeN18FgHk5F6iNqhfsSvusrcdMxh_Xeg@mail.gmail.com>

You could get lucky here, but strictly speaking, this list is about R
programming and statistical issues are typically off topic Someone might
respond privately, though.

Cheers,
Bert

On Thu, Oct 6, 2022 at 4:24 AM Valerio Leone Sciabolazza <
sciabolazza at gmail.com> wrote:

> Good morning,
> I am trying to use R to estimate a fixed effects model (i.e., a panel
> regression model controlling for unobserved time-invariant
> heterogeneities across agents) using different estimation approaches
> (e.g. replicating xtreg from Stata, see e.g.
>
> https://www.stata.com/support/faqs/statistics/intercept-in-fixed-effects-model/
> ).
> I have already asked this question on different stacks exchange forums
> and contacted package creators who dealt with this issue before, but I
> wasn't able to obtain an answer to my doubts.
> I hope to have better luck on this list.
>
> Let me introduce the problem, and note that I am using an unbalanced panel.
>
> The easiest way to estimate my fixed effect model is using the function lm.
>
> Example:
>
> # load packages
> library(dplyr)
> # set seed for replication purposes
> set.seed(123)
> # create toy dataset
> x <- rnorm(4000)
> x2 <- rnorm(length(x))
> id <- factor(sample(500,length(x),replace=TRUE))
> firm <- data.frame(id = id) %>%
> group_by(id) %>%
> mutate(firm = 1:n()) %>%
> pull(firm)
> id.eff <- rlnorm(nlevels(id))
> firm.eff <- rexp(length(unique(firm)))
> y <- x + 0.25*x2 + id.eff[id] + firm.eff[firm] + rnorm(length(x))
> db = data.frame(y = y, x = x, id = id, firm = firm)
> rm <- db %>% group_by(id) %>% summarise(firm = max(firm)) %>%
> filter(firm == 1) %>% pull(id)
> db = db[-which(db$id %in% rm), ]
> # Run regression
> test <- lm(y ~ x + id, data = db)
>
> Another approach is demeaning the variables included into the model
> specification.
> In this way, one can exclude the fixed effects from the model. Of
> course, point estimates will be correct, while standard errors will be
> not (because we are not accounting for the degrees of freedom used in
> the demeaning).
>
> # demean data
> dbm <- as_tibble(db) %>%
> group_by(id) %>%
> mutate(y = y - mean(y),
>        x = x - mean(x)) %>%
> ungroup()
> # run regression
> test2 <- lm(y ~ x, data = dbm)
> # compare results
> summary(test)$coefficients[2,1]
> > 0.9753364
> summary(test2)$coefficients[2,1]
> > 0.9753364
>
> Another way to do this is to demean the variables and add their grand
> average (I believe that this is what xtreg from Stata does)
>
> # create data
> n = length(unique(db$id))
> dbh <- dbm %>%
> mutate(yh = y + (sum(db$y)/n),
>        xh = x + (sum(db$x)/n))
> # run regression
> test3 <- lm(yh ~ xh, dbh)
> # compare results
> summary(test)$coefficients[2,1]
> > 0.9753364
> summary(test2)$coefficients[2,1]
> > 0.9753364
> summary(test3)$coefficients[2,1]
> > 0.9753364
>
> As one can see, the three approaches report the same point estimates
> (again, standard errors will be different instead).
>
> When I include an additional set of fixed effects in the model
> specification, the three approaches no longer return the same point
> estimate. However, differences seem to be negligible and they could be
> due to rounding.
>
> db$firm <- as.factor(db$firm)
> dbm$firm <- as.factor(dbm$firm)
> dbh$firm <- as.factor(dbh$firm)
> testB <- lm(y ~ x + id + firm, data = db)
> testB2 <- lm(y ~ x + firm, data = dbm)
> testB3 <- lm(yh ~ xh + firm, data = dbh)
> summary(testB)$coefficients[2,1]
> > 0.9834414
> summary(testB2)$coefficients[2,1]
> > 0.9833334
> summary(testB3)$coefficients[2,1]
> > 0.9833334
>
> A similar behavior occurs if I use a dummy variable rather than a
> continous one. For the only purpose of the example, I show this by
> transforming my target variable x from a continuous to a dummy
> variable.
>
> # create data
> x3 <- ifelse(db$x > 0, 1, 0)
> db <- db %>% mutate(x3 = x3)
> dbm <- dbm %>%
> mutate(x3 = x3) %>%
> group_by(id) %>%
> mutate(x3 = x3 - mean(x3)) %>%
> ungroup()
> dbh <- dbh %>% mutate(x3 = dbm$x3) %>%
> mutate(x3 = x3 + (sum(db$x3)/n)) %>%
> ungroup()
> # Run regressions
> testC <- lm(y ~ x3 + id + firm, data = db)
> testC2 <- lm(y ~ x3 + firm, data = dbm)
> testC3 <- lm(yh ~ x3 + firm, data = dbh)
> summary(testC)$coefficients[2, 1]
> > 1.579883
> summary(testC2)$coefficients[2, 1]
> > 1.579159
> summary(testC3)$coefficients[2, 1]
> > 1.579159
>
> Now, I want to estimate both the impact of x when this is higher than
> 0 (i.e., x3) and when this is lower or equal to zero (call it x4).
> Again, observe that x3 might as well be a real dummy variable, not a
> transformation of a continuous variable.
>
> In order to do that, I exclude the intercept from my model.
> Specifically, I do the following:
>
> # create data
> x4 <- ifelse(db$x <= 0, 1, 0)
> db <- db %>% mutate(x4 = x4)
> dbm <- dbm %>%
> mutate(x4 = x4) %>%
> group_by(id) %>%
> mutate(x4 = x4 - mean(x4)) %>%
> ungroup()
> dbh <- dbh %>% mutate(x4 = dbm$x4) %>%
> mutate(x4 = x4 + (sum(db$x4)/n)) %>%
> ungroup()
> testD <- lm(y ~ x3 + x4 + id + firm - 1, data = db)
> testD2 <- lm(y ~ x3 + x4 + firm - 1, data = dbm)
> testD3 <- lm(yh ~ x3 + x4 + firm - 1, data = dbh)
> summary(testD)$coefficients[1:2, ]
> > 1.2372816 -0.3426011
> summary(testD2)
> > Call:
> lm(formula = y ~ x3 + x4 + firm - 1, data = dbm)
>
> Residuals:
>     Min      1Q  Median      3Q     Max
> -3.8794 -0.7497  0.0010  0.7442  3.8486
>
> Coefficients: (1 not defined because of singularities)
>        Estimate Std. Error t value Pr(>|t|)
> x3      1.57916    0.03779  41.788  < 2e-16 ***
> x4           NA         NA      NA       NA
> ... redacted
> summary(testD3)$coefficients[1:2]
> > 3.254654 1.675495
>
> As you can see, the second approach is not able to estimate the impact
> of x4 on y. At the same time, the first and the third approach return
> very different point estimates.
>
> Is anyone able to explain me why I cannot obtain the same point
> estimates for this last exercise?
>
> Is there anything wrong in the way I include the second set of fixed
> effects?
> Is there anything wrong in the way I include the variables x3 and x4?
> Or this is simply a problem due to some internal functions in R?
>
> Any hint would be much appreciated.
>
> Best,
> Valerio
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From w||||@mwdun|@p @end|ng |rom gm@||@com  Thu Oct  6 16:43:56 2022
From: w||||@mwdun|@p @end|ng |rom gm@||@com (Bill Dunlap)
Date: Thu, 6 Oct 2022 07:43:56 -0700
Subject: [R] Getting "Error in ect,
 plot.new has not been called yet" despite grouping plot call
In-Reply-To: <PH0PR04MB7493CE9332F02B56C0AFE31FBE5D9@PH0PR04MB7493.namprd04.prod.outlook.com>
References: <PH0PR04MB7493E39389D0196BEC260CB6BE5A9@PH0PR04MB7493.namprd04.prod.outlook.com>
 <20221005230608.793c8b9f@rolf-Latitude-E7470>
 <PH0PR04MB7493CE9332F02B56C0AFE31FBE5D9@PH0PR04MB7493.namprd04.prod.outlook.com>
Message-ID: <CAHqSRuQmJoXwhho2KcHijv9PcEo1fARQZ824OeqV_2X3aFmNmg@mail.gmail.com>

Here is how you could have made an example that helpers could easily run.
It also includes the fix.

f <- function(print.it = FALSE) {
   pdf(file.pdf <- tempfile(fileext=".pdf"))
   series <- as.xts(setNames(sin(seq(0,10,by=.1)),
seq(as.Date("2022-10-06"),by="weeks",len=101)))
   p <- plot(series)
   if (print.it) {
       print(p)
   }
   sm_series_2 <- smooth(series / 2)
   lines(sm_series_2, col="red")
   abline(h=0.1, col="blue")
   dev.off()
   file.pdf
}
> f()
Error in plot.xy(xy.coords(x, y), type = type, ...) :
  plot.new has not been called yet
> f(TRUE)
[1]
"C:\\Users\\willi\\AppData\\Local\\Temp\\Rtmp0wX7rO\\file34843df652c.pdf"

If you remove the pdf() and dev.off() I think you will see that the added
lines do not show up.  I think plot.xts fiddles with the coordinate system
before and after it plots so that add-ons must be done in a special way.

-Bill

On Thu, Oct 6, 2022 at 12:42 AM Deramus, Thomas Patrick <
tderamus at partners.org> wrote:

> Hi Rolf.
>
> I followed your suggestion (though it's probably not as trimmed as it
> could be), but the problem unfortunately persists.
>
> Does this make it any clearer or still too many moving parts to make sense
> of?
>
> rm(list = ls(all.names = TRUE)) #will clear all objects includes hidden
> objects.
>
> #Loads the packages
> library(plyr)
> library(dplyr)
> library(ggplot2)
> library(Kendall)
> library(lubridate)
> library(xts)
> library(TTR)
> library(trend)
> library(forecast)
> library(openxlsx)
>
> #Uses the learningCurve Package from Github:
> #https://github.com/AFIT-R/learningCurve
> library(learningCurve)
>
> #Only load this if using VS Studio because it changes the plot function
> #
> https://stackoverflow.com/questions/52284345/how-to-show-r-graph-from-visual-studio-code
> library(httpgd)
> library(languageserver)
>
> #Loads the Excel files to Dataframes and cleans the data
> Game_Metrics_Word_Task <-
> read.xlsx("GamePack_Analytics_ALL_TIME_Short.xlsx", "Boggle")
> Game_Metrics_Word_Task <- Game_Metrics_Word_Task %>% filter(grepl('1440',
> StudyId))
> Game_Metrics_Word_Task$DeviceTime <-
> ymd_hms(Game_Metrics_Word_Task$DeviceTime,  tz = "America/New_York")
> Game_Metrics_Word_Task <-
> Game_Metrics_Word_Task[!duplicated(Game_Metrics_Word_Task[1:2,])]
>
> #Splits the dataframe into a tibble containing each participant
> Participant_Word_Task <-
> split(arrange(Game_Metrics_Word_Task,StudyId,DeviceTime),
> arrange(Game_Metrics_Word_Task,StudyId,DeviceTime,StudyId,DeviceTime)$StudyId)
>
> #Generates a blank output dataframe
> WordFrame <- data.frame(Participant = c(0), Task = c(0), MannKendall_Tau =
> c(0), MannKendall_P = c(0), Sen_Slope_Value = c(0), Sen_Slope_Pval = c(0),
> Pettitts_CIV = c(0), Pettitts_Pval = c(0), ARIMA_Model = c(0),
> Time_to_Petit = c(0), Number_of_Trials_to_Pettitt = c(0),
> Playtime_to_Petit_seconds = c(0), Time_Start_to_end_days = c(0),
> Number_of_Total_Trials = c(0), Total_Playtime_seconds = c(0),
> Learning_rate_days = c(0), Learning_rate_seconds = c(0), Learned_Task =
> c(0))
>
> #The number of subjects in the xlsx file
> #Reduced to 2 for ease of use
> for (i in 1:2){
>   #This timeseries only includes the trials where the participant
> completed the task
>   success_series <- xts(filter(Participant_Word_Task[[i]], GameEndReason
> == "TIMER_UP")$NumberOfSuccesfulWords , order.by=as.POSIXct(filter(Participant_Word_Task[[i]],
> GameEndReason == "TIMER_UP")$DeviceTime))
>   #This timeseries includes ALL the trials for the sake of plotting
>   original_series <-
> xts(Participant_Word_Task[[i]]$NumberOfSuccesfulWords, order.by
> =as.POSIXct(Participant_Word_Task[[i]]$DeviceTime))
>
>   #This is a decomposing process that xts seems to need for plotting.
>   #nweeks is needed for xts to plot the x-axis
>   success_decomp <- ts(success_series, frequency = nweeks(success_series))
>   original_decomp <- ts(original_series, frequency =
> nweeks(success_series))
>
>   #Values which will be included in the plots
>   WordFrame[i,1] <- unique(Participant_Word_Task[[i]]$StudyId)
>   WordFrame[i,5] <- sens.slope(success_decomp)$estimates
>   WordFrame[i,6] <- sens.slope(success_decomp)$p.value
>   WordFrame[i,7] <- pettitt.test(success_decomp)$estimate
>   WordFrame[i,8] <- pettitt.test(success_decomp)$p.value
>
>   #The simple moving average that will be overlayed with the plotted data
>   simplemovingaverage <- SMA(original_series, n = nweeks(original_series))
>
>   #If the three tests are statistically significant, add a green
> horizontal like to value WordFrame[i,7]
>   #Which would be where the slope changes in the series
>   #Fluid variables have been removed from all pdf() and paste() functions
> for ease-of-use
>   if (WordFrame[i,4] <= 0.05 & WordFrame[i,6] <= 0.05 & WordFrame[i,8] <=
> 0.05){
>      {
>       pdf(file = "Word_Task_Acquisition.pdf")
>       plout <- plot(original_series)
>       lines(simplemovingaverage)
>       abline(v = index(original_series[WordFrame[i,7]]),lty=2,
> col='green', lwd=3)
>       title(paste("Word Task Acquisition for Subject"))
>       dev.off()
>      }
>   #If the three tests are NOT statistically significant, generate a plot
> with NO horizontal line at WordFrame[i,7]
>   } else {
>     {
>       pdf(file = "Word_Task_Acquisition.pdf")
>       plout <- plot(original_series)
>       lines(simplemovingaverage)
>       title(paste("Word Task Acquisition for Subject"))
>       dev.off()
>     }
>   }
> }
>
> ________________________________
> From: Rolf Turner <r.turner at auckland.ac.nz>
> Sent: Wednesday, October 5, 2022 6:06 AM
> To: Deramus, Thomas Patrick <tderamus at partners.org>
> Cc: r-help at r-project.org <r-help at r-project.org>
> Subject: Re: [R] Getting "Error in ect, plot.new has not been called yet"
> despite grouping plot call
>
>         External Email - Use Caution
>
> What you doing or trying to do is far too complex for my poor feeble
> and senile brain to come anywhere near comprehending.  The code that
> you present exceeds my complexity tolerance by many orders of magnitude.
>
> I have a suggestion, but.  Strip your code down to the *essentials*.
> Construct a simple sequence of plotting commands, with *simple* names
> for the pdf files involved.  You should require only two or three such
> files and two or three index levels associated with each of your
> nested loops.
>
> Run the stripped down code and the source of the problem will almost
> surely become clear.
>
> cheers,
>
> Rolf Turner
>
> On Tue, 4 Oct 2022 23:35:09 +0000
> "Deramus, Thomas Patrick" <tderamus at partners.org> wrote:
>
> > Sorry to cross-post on Stackoverflow and here but I'm having some
> > difficulty.
> >
> https://secure-web.cisco.com/1_juqv4RvefQFJofsnOQcQA3Ixge89s4uC26pjoPBaYOSxSLGisKtgUTZkanxeHNRqNmjl30B8wYKfsppHje4T8Su77i7t8UbMKzs3GBKEyQva4yTjPH76Q9-l6tT24bB4qNMPQeFAxrkG5lpozNpGrDIAjfKCMvgS-5Qjs-QmvhWZfo84_3SK9rHhJjJvO9CqXb0MewWwI-dEmkZemjxnliGe_D9nooo7Ebjuw0dpBuMnrdaTzQxDdivsbkujPnrGurdjLARh93RW5IWPszNwaoziRD7P-30McF1PrAP8_yjWrhxQ_S3AgG6k40EoQJU/https%3A%2F%2Fstackoverflow.com%2Fquestions%2F73942794%2Fstill-getting-error-in-ect-plot-new-has-not-been-called-yet-despite-grouping
> >
> > Trying to make a nested loop that produces PDFs off different graphs,
> > one for ACF/PACF diagnostics and another for the actual data, based
> > on some time-series analyses I'm doing.
> >
> > Unfortunately, I keep getting the dreaded: Error plot.new has not
> > been called yet
> >
> > The code is meant to write a PDF containing the ACF and PACF graphs,
> > then do some analyses on the timeseries, and then make a separate PDF
> > containing a plot describing the timeseries based on the p-values of
> > each test for each individual.
> >
> > library(plyr)
> > library(dplyr)
> > library(ggplot2)
> > library(Kendall)
> > library(lubridate)
> > library(xts)
> > library(TTR)
> > library(trend)
> > library(forecast)
> > library(openxlsx)
> >
> > Game_Metrics_Word_Task <-
> > read.xlsx("GamePack_Analytics_ALL_TIME_Short.xlsx", "Boggle")
> > Game_Metrics_Word_Task <- Game_Metrics_Word_Task %>%
> > filter(grepl('1440', StudyId)) Game_Metrics_Word_Task$DeviceTime <-
> > ymd_hms(Game_Metrics_Word_Task$DeviceTime,  tz = "America/New_York")
> > Game_Metrics_Word_Task <-
> > Game_Metrics_Word_Task[!duplicated(Game_Metrics_Word_Task[1:2,])]
> >
> > Participant_Word_Task <-
> > split(arrange(Game_Metrics_Word_Task,StudyId,DeviceTime),
> >
> arrange(Game_Metrics_Word_Task,StudyId,DeviceTime,StudyId,DeviceTime)$StudyId)
> >
> > WordFrame <- data.frame(Participant = c(0), Task = c(0),
> > MannKendall_Tau = c(0), MannKendall_P = c(0), Sen_Slope_Value = c(0),
> > Sen_Slope_Pval = c(0), Pettitts_CIV = c(0), Pettitts_Pval = c(0),
> > ARIMA_Model = c(0), Time_to_Petit = c(0), Number_of_Trials_to_Pettitt
> > = c(0), Playtime_to_Petit_seconds = c(0), Time_Start_to_end_days =
> > c(0), Number_of_Total_Trials = c(0), Total_Playtime_seconds = c(0),
> > Learning_rate_days = c(0), Learning_rate_seconds = c(0), Learned_Task
> > = c(0))
> >
> > for (i in 1:length(Participant_Word_Task)){
> >     success_series <- xts(filter(Participant_Word_Task[[i]],
> > GameEndReason == "TIMER_UP")$NumberOfSuccesfulWords ,
> > order.by=as.POSIXct(filter(Participant_Word_Task[[i]], GameEndReason
> > == "TIMER_UP")$DeviceTime)) original_series <-
> > xts(Participant_Word_Task[[i]]$NumberOfSuccesfulWords,
> > order.by=as.POSIXct(Participant_Word_Task[[i]]$DeviceTime))
> > success_decomp <- ts(success_series, frequency =
> > nweeks(success_series)) original_decomp <- ts(original_series,
> > frequency = nweeks(success_series))
> >
> >
>  pdf(paste("Word_Task_Autocorrelation_plots_for_subject_",unique(Participant_Word_Task[[i]]$StudyId),".pdf"
> > ,collapse = NULL, sep = "")) par(mfrow=c(1,2))
> >     Autocorrelationplot <- acf(success_decomp, main=paste(""))
> >     PartialAutocorrelationplot <- pacf(success_decomp, main=paste(""))
> >     mtext(paste("Word Task Auto and Partialauto correlations for
> > subject ",unique(Participant_Word_Task[[i]]$StudyId)), side = 3, line
> > = -3, outer = TRUE) dev.off()
> >
> >     AutomatedArimaoutputs <- auto.arima(success_decomp)
> >     p <- length(AutomatedArimaoutputs$model$phi)
> >     #AR component
> >     q <- length(AutomatedArimaoutputs$model$theta)
> >     #MA component
> >     d <- AutomatedArimaoutputs$model$Delta
> >     #order of difference
> >     WordFrame[i,1] <- unique(Participant_Word_Task[[i]]$StudyId)
> >     WordFrame[i,2] <- "Word"
> >     WordFrame[i,3] <- MannKendall(success_decomp)$tau[1]
> >     WordFrame[i,4] <- MannKendall(success_decomp)$sl[1]
> >     WordFrame[i,5] <- sens.slope(success_decomp)$estimates
> >     WordFrame[i,6] <- sens.slope(success_decomp)$p.value
> >     WordFrame[i,7] <- pettitt.test(success_decomp)$estimate
> >     WordFrame[i,8] <- pettitt.test(success_decomp)$p.value
> >     WordFrame[i,9] <- paste("ARIMA(",p,",",q,",",d,")", collapse =
> > NULL, sep = "") WordFrame[i,10] <-
> > difftime(time(success_series[WordFrame[i,7]]),time(original_series[1]))
> > WordFrame[i,11] <- tail(which(grepl(success_series[WordFrame[i,7]],
> > original_series)), n=1) WordFrame[i,12] <-
> >
> sum(Participant_Word_Task[[i]]$TotalDuration[1:WordFrame[i,11]])-sum(Participant_Word_Task[[i]]$TotalTimePaused[1:WordFrame[i,11]])
> > WordFrame[i,13] <-
> >
> difftime(time(original_series[length(original_series)]),time(original_series[1]))
> > WordFrame[i,14] <- length(original_series) WordFrame[i,15] <-
> >
> sum(Participant_Word_Task[[i]]$TotalDuration[1:length(original_series)])-sum(Participant_Word_Task[[i]]$TotalTimePaused[1:length(original_series)])
> >
> >
> >     simplemovingaverage <- SMA(original_series, n =
> > nweeks(original_series))
> >
> >     if (WordFrame[i,4] <= 0.05 & WordFrame[i,6] <= 0.05 &
> > WordFrame[i,8] <= 0.05){ {
> >
>  pdf(paste(WordFrame[i,1],"_Word_Task_Acquisition.pdf",collapse
> > = NULL, sep = "")) plout <-
> > plot(original_series,type='l',col='blue',xlab="Date of
> > Play",ylab="Number of Successful Words")
> > lines(simplemovingaverage,type='l',col='red') title(paste("Word Task
> > Acquisition for Subject", WordFrame[i,1])) abline(v =
> > index(original_series[WordFrame[i,7]]),lty=2, col='green', lwd=3)
> > dev.off() } WordFrame[i,18] <- T
> >               WordFrame[i,16] <- (1-(WordFrame[i,10]/WordFrame[i,13]))
> >               WordFrame[i,17] <- (1-(WordFrame[i,12]/WordFrame[i,15]))
> >     } else {
> >               {
> >
>  pdf(paste(WordFrame[i,1],"_Word_Task_Acquisition.pdf",collapse
> > = NULL, sep = "")) plout <-
> > plot(original_series,type='l',col='blue',xlab="Date of
> > Play",ylab="Number of Successful Words")
> > lines(simplemovingaverage,type='l',col='red') title(paste("Word Task
> > Acquisition for Subject", WordFrame[i,1])) dev.off() }
> >               WordFrame[i,18] <- F
> >               WordFrame[i,16] <- 0
> >               WordFrame[i,17] <- 0
> >     }
> > }
> >
> > It will work just fine if I run the lines individually (e.g. set i =
> > 1, 2, ect), and if I comment out abline and title (lines seems to
> > work fine). But it will throw the error everytime I try to run the
> > loop without these commented.
> >
> > Have tried just about everything I could find on the Stack forums to
> > run everything as a single argument and I'm just not sure what is
> > wrong with it.
> >
> > dev.list() spits out:
> >
> > pdf
> >   2
> > following the error.
> >
> > With abline and title commented out and lines run individually it's
> > NULL.
> >
> > Happens in both RStudio
> >
> > 2022.07.2+576 "Spotted Wakerobin" Release
> > (e7373ef832b49b2a9b88162cfe7eac5f22c40b34, 2022-09-06) for Ubuntu
> > Bionic Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML,
> > like Gecko) QtWebEngine/5.12.8 Chrome/69.0.3497.128 Safari/537.36
> >
> > And R:
> >
> > platform       x86_64-pc-linux-gnu
> > arch           x86_64
> > os             linux-gnu
> > system         x86_64, linux-gnu
> > status
> > major          4
> > minor          2.1
> > year           2022
> > month          06
> > day            23
> > svn rev        82513
> > language       R
> > version.string R version 4.2.1 (2022-06-23)
> > nickname       Funny-Looking Kid
> >
> >
> > My OS:
> > PRETTY_NAME="Debian GNU/Linux 11 (bullseye)"
> > NAME="Debian GNU/Linux"
> > VERSION_ID="11"
> > VERSION="11 (bullseye)"
> > VERSION_CODENAME=bullseye
> > ID=debian
> > HOME_URL="
> https://secure-web.cisco.com/1Ruvt90Q90ixR-GE-RDiKJgzRpfDjlNz-lZTqQQGM8Tf4GAoj5QOfE2vXMaMWxMoexuf1npQrX7uAjFuU2viz28h42RPmHQK7jGDX7BpRLkTNcERyxHVKJTxgYegXo-n9N7rqegcKsrr47xlGmTcMOJcBAqH7SpTPQlYDOGgjz1ErtetQRzUsd-eKs9l4oCVPiF6SKV40C7s_NXm0tuCswL2Jhyfv70-edCtBO_4j9-3dSi5ZdFLYaWsMScnwwxNIGYU2n0vw5NH4GJcZNsv6Scu-r6W8ndJaGL4UmX9J3PX0LrdFyjLbGtA7RqPpKFUQ/https%3A%2F%2Fwww.debian.org
> "
> > SUPPORT_URL="
> https://secure-web.cisco.com/1gveQttVrJNRSM85857IiydpLraxrrtJobMyCNkRvQ4V2f00DH67Z0hEa50LLpCVYQvIjMsQZxHAVMZvYQV_Cp2-e82TDZzPY4aSR2td2th3bwuXGxtI7CTgSUudOWgPpmnwVLT5r34EnwXEmwnMoiPVnOEC7slpF1fLGq11wSynuyttcTagMfpN6qdYfgtbu_mz0JOBUecQ-etUQYw5BDmXEKv5JZ_y5Uyt8Q89Kirhi7Hk8FMbCVcxRZpOZZmghxlPMxYaNVIOnln-R0H8J2QIzqE49cQQPKkFZ9O29zpr8odlBXqjObKn24ReYPDhH/https%3A%2F%2Fwww.debian.org%2Fsupport
> "
> > BUG_REPORT_URL="
> https://secure-web.cisco.com/1tepDnCjDgHsmvw9Eth-7nfyKi3doVSOFKVzz83wskdyf8lsrEVkG2NYw7am6ePhSFfjQXdDyceMyc21Un-vqTirSQYKdPavRdKJy85HgHMP66Xk-OgxFf-5KXiPzmFreDfuuJlYizGSUNOLcADyNVTCo47xFfRgtB83Hs8j3yYAJFrff7TqNOFWzSzTcfrycio_WSSfbQkLpUl-1xGzg-dvP16tKuwkRr62bkPeydXJC_iH1FfnWv5b1G04au3aFmRTem8t2RS40LPMS9Mh0UmMvHD_9qwX16cFMHQ8U4x9Sp9IUcAFhgnbffOyPQm1C/https%3A%2F%2Fbugs.debian.org
> "
> > No LSB modules are available.
> > Distributor ID: Debian
> > Description: Debian GNU/Linux 11 (bullseye)
> > Release: 11
> > Codename: bullseye
> >          Icon name: computer-desktop
> >            Chassis: desktop
> >         Machine ID: 053ebf23707f49c8ad4e0684f4cf19d3
> >            Boot ID: d0e6294d3b944286bef10e76c21e6401
> >   Operating System: Debian GNU/Linux 11 (bullseye)
> >             Kernel: Linux 5.10.0-18-amd64
> >       Architecture: x86-64
> >
> >
> > Any suggestions would be greatly appreciated.
> >
> > --
> >
> > Thomas DeRamus (He/Him/His)
> >
> > Data Analyst
> >
> > Massachusetts General Hospital Brigham
> >
> > Alzheimer?s Clinical & Translational Research Unit
> >
> > 149 13th Street
> >
> > Charlestown, MA 02129
> >
> > Phone: 205-834-5066
> >
> > Email: tderamus at partners.org<mailto:tderamus at partners.org>,
> > tpderamus at gmail.com<mailto:tpderamus at gmail.com>
> >
> >
> > [
> https://secure-web.cisco.com/1AI4S4rz4bDZGM8naa-19GTAeSORO5ZmNe056Q_nhPRk4JVAzPiRKUBWitBK5TpxoKBLoLvNfoMDanGd1n5Bnf4SJFT7l7HnaLcjjH7oVk2BZdDfCLHo8a8eePvD4XrF2Fw3iuxKgIZY5dwdesP3P8pSvkmVGvyZ-HiEKRetk4uJHhRa6gSgOQ8MbCVKmi6XP1dtozTEH1RpDrFJ4EyevPO52UzaTAY6CR8USLWNbsxXJsnsjUz1G6_4P7B3ULuMu9mEPeQz_GnTrSXTrGZooK_idhoEougti7I8NYV0CS09Yahmp4Fe_vh9wu4Jkdal3/https%3A%2F%2Fci3.googleusercontent.com%2Fmail-sig%2FAIorK4we2sU30P2HyfDQF5hpEjYTt-9FTBK7cAVsP7EenrZ0nsKCf48fuYMtElj6Szn_2fpSPWr66eQ][https://ci3.googleusercontent.com/mail-sig/AIorK4yyY0DlImU0UONJrHTbPc5T3lJj8Kmu8SbDKJJ3XjcX6CgvVsvSueYKwficYFz4zXt6fZV8YIY
> <https://secure-web.cisco.com/1AI4S4rz4bDZGM8naa-19GTAeSORO5ZmNe056Q_nhPRk4JVAzPiRKUBWitBK5TpxoKBLoLvNfoMDanGd1n5Bnf4SJFT7l7HnaLcjjH7oVk2BZdDfCLHo8a8eePvD4XrF2Fw3iuxKgIZY5dwdesP3P8pSvkmVGvyZ-HiEKRetk4uJHhRa6gSgOQ8MbCVKmi6XP1dtozTEH1RpDrFJ4EyevPO52UzaTAY6CR8USLWNbsxXJsnsjUz1G6_4P7B3ULuMu9mEPeQz_GnTrSXTrGZooK_idhoEougti7I8NYV0CS09Yahmp4Fe_vh9wu4Jkdal3/https%3A%2F%2Fci3.googleusercontent.com%2Fmail-sig%2FAIorK4we2sU30P2HyfDQF5hpEjYTt-9FTBK7cAVsP7EenrZ0nsKCf48fuYMtElj6Szn_2fpSPWr66eQ%5D%5Bhttps://ci3.googleusercontent.com/mail-sig/AIorK4yyY0DlImU0UONJrHTbPc5T3lJj8Kmu8SbDKJJ3XjcX6CgvVsvSueYKwficYFz4zXt6fZV8YIY>
> ]
> >
> > ?If knowledge can create problems, it is not through ignorance that
> > we can solve them.?
> >
> > ?Issac Asimov
>
> The information in this e-mail is intended only for th...{{dropped:22}}


From @c|@bo|@zz@ @end|ng |rom gm@||@com  Thu Oct  6 16:45:18 2022
From: @c|@bo|@zz@ @end|ng |rom gm@||@com (Valerio Leone Sciabolazza)
Date: Thu, 6 Oct 2022 16:45:18 +0200
Subject: [R] Fixed effect model: different estimation approaches with R
 return different results
In-Reply-To: <CAGxFJbR_ACsLpms9VgPeN18FgHk5F6iNqhfsSvusrcdMxh_Xeg@mail.gmail.com>
References: <CABZtLWwwgUfZ24tLA-Ub2w6kzMwsSuDWkCkWu2rapS7Gs+psaw@mail.gmail.com>
 <CAGxFJbR_ACsLpms9VgPeN18FgHk5F6iNqhfsSvusrcdMxh_Xeg@mail.gmail.com>
Message-ID: <CABZtLWwPtnFKhOjEeR7V3aU4SCoq=5VgaZLWQdcVCBwy-iiONA@mail.gmail.com>

Thank you Bert, I see your point.
The problem is that I am not sure if this is a statistical issue -
i.e., there is something wrong with my procedure - or, in a manner of
speaking, a software issue: e.g. lm is not expected to return the same
estimates for different approaches because of the way in which the
function estimates the solution, and it should not be used the way I
do. Maybe I should have better stressed this.
Valerio


On Thu, Oct 6, 2022 at 4:31 PM Bert Gunter <bgunter.4567 at gmail.com> wrote:
>
> You could get lucky here, but strictly speaking, this list is about R programming and statistical issues are typically off topic Someone might respond privately, though.
>
> Cheers,
> Bert
>
> On Thu, Oct 6, 2022 at 4:24 AM Valerio Leone Sciabolazza <sciabolazza at gmail.com> wrote:
>>
>> Good morning,
>> I am trying to use R to estimate a fixed effects model (i.e., a panel
>> regression model controlling for unobserved time-invariant
>> heterogeneities across agents) using different estimation approaches
>> (e.g. replicating xtreg from Stata, see e.g.
>> https://www.stata.com/support/faqs/statistics/intercept-in-fixed-effects-model/).
>> I have already asked this question on different stacks exchange forums
>> and contacted package creators who dealt with this issue before, but I
>> wasn't able to obtain an answer to my doubts.
>> I hope to have better luck on this list.
>>
>> Let me introduce the problem, and note that I am using an unbalanced panel.
>>
>> The easiest way to estimate my fixed effect model is using the function lm.
>>
>> Example:
>>
>> # load packages
>> library(dplyr)
>> # set seed for replication purposes
>> set.seed(123)
>> # create toy dataset
>> x <- rnorm(4000)
>> x2 <- rnorm(length(x))
>> id <- factor(sample(500,length(x),replace=TRUE))
>> firm <- data.frame(id = id) %>%
>> group_by(id) %>%
>> mutate(firm = 1:n()) %>%
>> pull(firm)
>> id.eff <- rlnorm(nlevels(id))
>> firm.eff <- rexp(length(unique(firm)))
>> y <- x + 0.25*x2 + id.eff[id] + firm.eff[firm] + rnorm(length(x))
>> db = data.frame(y = y, x = x, id = id, firm = firm)
>> rm <- db %>% group_by(id) %>% summarise(firm = max(firm)) %>%
>> filter(firm == 1) %>% pull(id)
>> db = db[-which(db$id %in% rm), ]
>> # Run regression
>> test <- lm(y ~ x + id, data = db)
>>
>> Another approach is demeaning the variables included into the model
>> specification.
>> In this way, one can exclude the fixed effects from the model. Of
>> course, point estimates will be correct, while standard errors will be
>> not (because we are not accounting for the degrees of freedom used in
>> the demeaning).
>>
>> # demean data
>> dbm <- as_tibble(db) %>%
>> group_by(id) %>%
>> mutate(y = y - mean(y),
>>        x = x - mean(x)) %>%
>> ungroup()
>> # run regression
>> test2 <- lm(y ~ x, data = dbm)
>> # compare results
>> summary(test)$coefficients[2,1]
>> > 0.9753364
>> summary(test2)$coefficients[2,1]
>> > 0.9753364
>>
>> Another way to do this is to demean the variables and add their grand
>> average (I believe that this is what xtreg from Stata does)
>>
>> # create data
>> n = length(unique(db$id))
>> dbh <- dbm %>%
>> mutate(yh = y + (sum(db$y)/n),
>>        xh = x + (sum(db$x)/n))
>> # run regression
>> test3 <- lm(yh ~ xh, dbh)
>> # compare results
>> summary(test)$coefficients[2,1]
>> > 0.9753364
>> summary(test2)$coefficients[2,1]
>> > 0.9753364
>> summary(test3)$coefficients[2,1]
>> > 0.9753364
>>
>> As one can see, the three approaches report the same point estimates
>> (again, standard errors will be different instead).
>>
>> When I include an additional set of fixed effects in the model
>> specification, the three approaches no longer return the same point
>> estimate. However, differences seem to be negligible and they could be
>> due to rounding.
>>
>> db$firm <- as.factor(db$firm)
>> dbm$firm <- as.factor(dbm$firm)
>> dbh$firm <- as.factor(dbh$firm)
>> testB <- lm(y ~ x + id + firm, data = db)
>> testB2 <- lm(y ~ x + firm, data = dbm)
>> testB3 <- lm(yh ~ xh + firm, data = dbh)
>> summary(testB)$coefficients[2,1]
>> > 0.9834414
>> summary(testB2)$coefficients[2,1]
>> > 0.9833334
>> summary(testB3)$coefficients[2,1]
>> > 0.9833334
>>
>> A similar behavior occurs if I use a dummy variable rather than a
>> continous one. For the only purpose of the example, I show this by
>> transforming my target variable x from a continuous to a dummy
>> variable.
>>
>> # create data
>> x3 <- ifelse(db$x > 0, 1, 0)
>> db <- db %>% mutate(x3 = x3)
>> dbm <- dbm %>%
>> mutate(x3 = x3) %>%
>> group_by(id) %>%
>> mutate(x3 = x3 - mean(x3)) %>%
>> ungroup()
>> dbh <- dbh %>% mutate(x3 = dbm$x3) %>%
>> mutate(x3 = x3 + (sum(db$x3)/n)) %>%
>> ungroup()
>> # Run regressions
>> testC <- lm(y ~ x3 + id + firm, data = db)
>> testC2 <- lm(y ~ x3 + firm, data = dbm)
>> testC3 <- lm(yh ~ x3 + firm, data = dbh)
>> summary(testC)$coefficients[2, 1]
>> > 1.579883
>> summary(testC2)$coefficients[2, 1]
>> > 1.579159
>> summary(testC3)$coefficients[2, 1]
>> > 1.579159
>>
>> Now, I want to estimate both the impact of x when this is higher than
>> 0 (i.e., x3) and when this is lower or equal to zero (call it x4).
>> Again, observe that x3 might as well be a real dummy variable, not a
>> transformation of a continuous variable.
>>
>> In order to do that, I exclude the intercept from my model.
>> Specifically, I do the following:
>>
>> # create data
>> x4 <- ifelse(db$x <= 0, 1, 0)
>> db <- db %>% mutate(x4 = x4)
>> dbm <- dbm %>%
>> mutate(x4 = x4) %>%
>> group_by(id) %>%
>> mutate(x4 = x4 - mean(x4)) %>%
>> ungroup()
>> dbh <- dbh %>% mutate(x4 = dbm$x4) %>%
>> mutate(x4 = x4 + (sum(db$x4)/n)) %>%
>> ungroup()
>> testD <- lm(y ~ x3 + x4 + id + firm - 1, data = db)
>> testD2 <- lm(y ~ x3 + x4 + firm - 1, data = dbm)
>> testD3 <- lm(yh ~ x3 + x4 + firm - 1, data = dbh)
>> summary(testD)$coefficients[1:2, ]
>> > 1.2372816 -0.3426011
>> summary(testD2)
>> > Call:
>> lm(formula = y ~ x3 + x4 + firm - 1, data = dbm)
>>
>> Residuals:
>>     Min      1Q  Median      3Q     Max
>> -3.8794 -0.7497  0.0010  0.7442  3.8486
>>
>> Coefficients: (1 not defined because of singularities)
>>        Estimate Std. Error t value Pr(>|t|)
>> x3      1.57916    0.03779  41.788  < 2e-16 ***
>> x4           NA         NA      NA       NA
>> ... redacted
>> summary(testD3)$coefficients[1:2]
>> > 3.254654 1.675495
>>
>> As you can see, the second approach is not able to estimate the impact
>> of x4 on y. At the same time, the first and the third approach return
>> very different point estimates.
>>
>> Is anyone able to explain me why I cannot obtain the same point
>> estimates for this last exercise?
>>
>> Is there anything wrong in the way I include the second set of fixed effects?
>> Is there anything wrong in the way I include the variables x3 and x4?
>> Or this is simply a problem due to some internal functions in R?
>>
>> Any hint would be much appreciated.
>>
>> Best,
>> Valerio
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.


From jo@h@m@u|r|ch @end|ng |rom gm@||@com  Thu Oct  6 17:26:11 2022
From: jo@h@m@u|r|ch @end|ng |rom gm@||@com (Joshua Ulrich)
Date: Thu, 6 Oct 2022 10:26:11 -0500
Subject: [R] Getting "Error in ect,
 plot.new has not been called yet" despite grouping plot call
In-Reply-To: <CAHqSRuQmJoXwhho2KcHijv9PcEo1fARQZ824OeqV_2X3aFmNmg@mail.gmail.com>
References: <PH0PR04MB7493E39389D0196BEC260CB6BE5A9@PH0PR04MB7493.namprd04.prod.outlook.com>
 <20221005230608.793c8b9f@rolf-Latitude-E7470>
 <PH0PR04MB7493CE9332F02B56C0AFE31FBE5D9@PH0PR04MB7493.namprd04.prod.outlook.com>
 <CAHqSRuQmJoXwhho2KcHijv9PcEo1fARQZ824OeqV_2X3aFmNmg@mail.gmail.com>
Message-ID: <CAPPM_gSq9VLwEiyB6HkfdUj6gMRtJTJKW4nWFFqB-K=ta9ny_w@mail.gmail.com>

On Thu, Oct 6, 2022 at 9:44 AM Bill Dunlap <williamwdunlap at gmail.com> wrote:
>
> Here is how you could have made an example that helpers could easily run.
> It also includes the fix.
>
> f <- function(print.it = FALSE) {
>    pdf(file.pdf <- tempfile(fileext=".pdf"))
>    series <- as.xts(setNames(sin(seq(0,10,by=.1)),
> seq(as.Date("2022-10-06"),by="weeks",len=101)))
>    p <- plot(series)
>    if (print.it) {
>        print(p)
>    }
>    sm_series_2 <- smooth(series / 2)
>    lines(sm_series_2, col="red")
>    abline(h=0.1, col="blue")
>    dev.off()
>    file.pdf
> }
> > f()
> Error in plot.xy(xy.coords(x, y), type = type, ...) :
>   plot.new has not been called yet
> > f(TRUE)
> [1]
> "C:\\Users\\willi\\AppData\\Local\\Temp\\Rtmp0wX7rO\\file34843df652c.pdf"
>
> If you remove the pdf() and dev.off() I think you will see that the added
> lines do not show up.  I think plot.xts fiddles with the coordinate system
> before and after it plots so that add-ons must be done in a special way.
>

plot.xts() waits until the plot is rendered before calculating the
coordinate system. That allows users to add multiple series that have
different values for the index (x-axis) and data (y-axis).

lines() doesn't show up in your example because it's called after the
plot is rendered, and it's not rendered again after they're added.
`sm_series_2` also needs to be an xts object, otherwise lines.xts() is
not dispatched.

title() and abline() need to be called after the plot is rendered
because they are standard graphics functions. I admit that's very
confusing... I'll see what I can do to fix that.

Here's a revised example that works for me:

f <- function(print.it = FALSE)
{
    pdf(file.pdf <- tempfile(fileext=".pdf"))
    series <- xts(sin(seq(0,10,by=.1)),
seq(as.Date("2022-10-06"),by="weeks",length.out=101))
    p <- plot(series)
    sm2 <- xts(smooth(series/2), index(series))
    lines(sm2, col="red")
    if (print.it) {
        print(p)
        title("Sine curve example")
        abline(h=0.1, col="green")
    }
    dev.off()
    file.pdf
}
f(TRUE)



> -Bill
>
> On Thu, Oct 6, 2022 at 12:42 AM Deramus, Thomas Patrick <
> tderamus at partners.org> wrote:
>
> > Hi Rolf.
> >
> > I followed your suggestion (though it's probably not as trimmed as it
> > could be), but the problem unfortunately persists.
> >
> > Does this make it any clearer or still too many moving parts to make sense
> > of?
> >
> > rm(list = ls(all.names = TRUE)) #will clear all objects includes hidden
> > objects.
> >
> > #Loads the packages
> > library(plyr)
> > library(dplyr)
> > library(ggplot2)
> > library(Kendall)
> > library(lubridate)
> > library(xts)
> > library(TTR)
> > library(trend)
> > library(forecast)
> > library(openxlsx)
> >
> > #Uses the learningCurve Package from Github:
> > #https://github.com/AFIT-R/learningCurve
> > library(learningCurve)
> >
> > #Only load this if using VS Studio because it changes the plot function
> > #
> > https://stackoverflow.com/questions/52284345/how-to-show-r-graph-from-visual-studio-code
> > library(httpgd)
> > library(languageserver)
> >
> > #Loads the Excel files to Dataframes and cleans the data
> > Game_Metrics_Word_Task <-
> > read.xlsx("GamePack_Analytics_ALL_TIME_Short.xlsx", "Boggle")
> > Game_Metrics_Word_Task <- Game_Metrics_Word_Task %>% filter(grepl('1440',
> > StudyId))
> > Game_Metrics_Word_Task$DeviceTime <-
> > ymd_hms(Game_Metrics_Word_Task$DeviceTime,  tz = "America/New_York")
> > Game_Metrics_Word_Task <-
> > Game_Metrics_Word_Task[!duplicated(Game_Metrics_Word_Task[1:2,])]
> >
> > #Splits the dataframe into a tibble containing each participant
> > Participant_Word_Task <-
> > split(arrange(Game_Metrics_Word_Task,StudyId,DeviceTime),
> > arrange(Game_Metrics_Word_Task,StudyId,DeviceTime,StudyId,DeviceTime)$StudyId)
> >
> > #Generates a blank output dataframe
> > WordFrame <- data.frame(Participant = c(0), Task = c(0), MannKendall_Tau =
> > c(0), MannKendall_P = c(0), Sen_Slope_Value = c(0), Sen_Slope_Pval = c(0),
> > Pettitts_CIV = c(0), Pettitts_Pval = c(0), ARIMA_Model = c(0),
> > Time_to_Petit = c(0), Number_of_Trials_to_Pettitt = c(0),
> > Playtime_to_Petit_seconds = c(0), Time_Start_to_end_days = c(0),
> > Number_of_Total_Trials = c(0), Total_Playtime_seconds = c(0),
> > Learning_rate_days = c(0), Learning_rate_seconds = c(0), Learned_Task =
> > c(0))
> >
> > #The number of subjects in the xlsx file
> > #Reduced to 2 for ease of use
> > for (i in 1:2){
> >   #This timeseries only includes the trials where the participant
> > completed the task
> >   success_series <- xts(filter(Participant_Word_Task[[i]], GameEndReason
> > == "TIMER_UP")$NumberOfSuccesfulWords , order.by=as.POSIXct(filter(Participant_Word_Task[[i]],
> > GameEndReason == "TIMER_UP")$DeviceTime))
> >   #This timeseries includes ALL the trials for the sake of plotting
> >   original_series <-
> > xts(Participant_Word_Task[[i]]$NumberOfSuccesfulWords, order.by
> > =as.POSIXct(Participant_Word_Task[[i]]$DeviceTime))
> >
> >   #This is a decomposing process that xts seems to need for plotting.
> >   #nweeks is needed for xts to plot the x-axis
> >   success_decomp <- ts(success_series, frequency = nweeks(success_series))
> >   original_decomp <- ts(original_series, frequency =
> > nweeks(success_series))
> >
> >   #Values which will be included in the plots
> >   WordFrame[i,1] <- unique(Participant_Word_Task[[i]]$StudyId)
> >   WordFrame[i,5] <- sens.slope(success_decomp)$estimates
> >   WordFrame[i,6] <- sens.slope(success_decomp)$p.value
> >   WordFrame[i,7] <- pettitt.test(success_decomp)$estimate
> >   WordFrame[i,8] <- pettitt.test(success_decomp)$p.value
> >
> >   #The simple moving average that will be overlayed with the plotted data
> >   simplemovingaverage <- SMA(original_series, n = nweeks(original_series))
> >
> >   #If the three tests are statistically significant, add a green
> > horizontal like to value WordFrame[i,7]
> >   #Which would be where the slope changes in the series
> >   #Fluid variables have been removed from all pdf() and paste() functions
> > for ease-of-use
> >   if (WordFrame[i,4] <= 0.05 & WordFrame[i,6] <= 0.05 & WordFrame[i,8] <=
> > 0.05){
> >      {
> >       pdf(file = "Word_Task_Acquisition.pdf")
> >       plout <- plot(original_series)
> >       lines(simplemovingaverage)
> >       abline(v = index(original_series[WordFrame[i,7]]),lty=2,
> > col='green', lwd=3)
> >       title(paste("Word Task Acquisition for Subject"))
> >       dev.off()
> >      }
> >   #If the three tests are NOT statistically significant, generate a plot
> > with NO horizontal line at WordFrame[i,7]
> >   } else {
> >     {
> >       pdf(file = "Word_Task_Acquisition.pdf")
> >       plout <- plot(original_series)
> >       lines(simplemovingaverage)
> >       title(paste("Word Task Acquisition for Subject"))
> >       dev.off()
> >     }
> >   }
> > }
> >
> > ________________________________
> > From: Rolf Turner <r.turner at auckland.ac.nz>
> > Sent: Wednesday, October 5, 2022 6:06 AM
> > To: Deramus, Thomas Patrick <tderamus at partners.org>
> > Cc: r-help at r-project.org <r-help at r-project.org>
> > Subject: Re: [R] Getting "Error in ect, plot.new has not been called yet"
> > despite grouping plot call
> >
> >         External Email - Use Caution
> >
> > What you doing or trying to do is far too complex for my poor feeble
> > and senile brain to come anywhere near comprehending.  The code that
> > you present exceeds my complexity tolerance by many orders of magnitude.
> >
> > I have a suggestion, but.  Strip your code down to the *essentials*.
> > Construct a simple sequence of plotting commands, with *simple* names
> > for the pdf files involved.  You should require only two or three such
> > files and two or three index levels associated with each of your
> > nested loops.
> >
> > Run the stripped down code and the source of the problem will almost
> > surely become clear.
> >
> > cheers,
> >
> > Rolf Turner
> >
> > On Tue, 4 Oct 2022 23:35:09 +0000
> > "Deramus, Thomas Patrick" <tderamus at partners.org> wrote:
> >
<snip>
> > > ?Issac Asimov
> >
> > The information in this e-mail is intended only for th...{{dropped:22}}
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


From jcough||n @end|ng |rom um@@@@edu  Thu Oct  6 16:58:51 2022
From: jcough||n @end|ng |rom um@@@@edu (Julie Coughlin)
Date: Thu, 6 Oct 2022 10:58:51 -0400
Subject: [R] (no subject)
Message-ID: <CAAsvtakY89Vi5Uk0rZJtXfBy1-4AvpYEe7fBbRWoKD_t+7sqAQ@mail.gmail.com>

Hi ,
Can you send me a later version of r programming to use on my macos version
10.12.6? The newest r program is not compatible with my macbook.
Thank you, Julie :)

	[[alternative HTML version deleted]]


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Thu Oct  6 17:42:59 2022
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Thu, 6 Oct 2022 16:42:59 +0100
Subject: [R] (no subject)
In-Reply-To: <CAAsvtakY89Vi5Uk0rZJtXfBy1-4AvpYEe7fBbRWoKD_t+7sqAQ@mail.gmail.com>
References: <CAAsvtakY89Vi5Uk0rZJtXfBy1-4AvpYEe7fBbRWoKD_t+7sqAQ@mail.gmail.com>
Message-ID: <c073357c-4d2b-fb20-3633-f1993b1c6d36@sapo.pt>

Hello,

I am not a Mac user but have you tried the official R downloads web 
site, The Comprehensive R Archive Network - CRAN?
Here is the link:

https://cran.r-project.org/

Hope this helps,

Rui Barradas

?s 15:58 de 06/10/2022, Julie Coughlin escreveu:
> Hi ,
> Can you send me a later version of r programming to use on my macos version
> 10.12.6? The newest r program is not compatible with my macbook.
> Thank you, Julie :)
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From tder@mu@ @end|ng |rom p@rtner@@org  Thu Oct  6 17:49:11 2022
From: tder@mu@ @end|ng |rom p@rtner@@org (Deramus, Thomas Patrick)
Date: Thu, 6 Oct 2022 15:49:11 +0000
Subject: [R] Getting "Error in ect,
 plot.new has not been called yet" despite grouping plot call
In-Reply-To: <CAPPM_gSq9VLwEiyB6HkfdUj6gMRtJTJKW4nWFFqB-K=ta9ny_w@mail.gmail.com>
References: <PH0PR04MB7493E39389D0196BEC260CB6BE5A9@PH0PR04MB7493.namprd04.prod.outlook.com>
 <20221005230608.793c8b9f@rolf-Latitude-E7470>
 <PH0PR04MB7493CE9332F02B56C0AFE31FBE5D9@PH0PR04MB7493.namprd04.prod.outlook.com>
 <CAHqSRuQmJoXwhho2KcHijv9PcEo1fARQZ824OeqV_2X3aFmNmg@mail.gmail.com>
 <CAPPM_gSq9VLwEiyB6HkfdUj6gMRtJTJKW4nWFFqB-K=ta9ny_w@mail.gmail.com>
Message-ID: <PH0PR04MB74937BB697BA2C3F61868804BE5C9@PH0PR04MB7493.namprd04.prod.outlook.com>

Truly appreciate it Bill.

Will try to make something more trimmed down in the future, but unfortunately have to admit I am more of an R neophyte than I would like to be.
________________________________
From: Joshua Ulrich <josh.m.ulrich at gmail.com>
Sent: Thursday, October 6, 2022 11:26 AM
To: Bill Dunlap <williamwdunlap at gmail.com>
Cc: Deramus, Thomas Patrick <tderamus at partners.org>; r-help at r-project.org <r-help at r-project.org>
Subject: Re: [R] Getting "Error in ect, plot.new has not been called yet" despite grouping plot call

        External Email - Use Caution

On Thu, Oct 6, 2022 at 9:44 AM Bill Dunlap <williamwdunlap at gmail.com> wrote:
>
> Here is how you could have made an example that helpers could easily run.
> It also includes the fix.
>
> f <- function(print.it = FALSE) {
>    pdf(file.pdf <- tempfile(fileext=".pdf"))
>    series <- as.xts(setNames(sin(seq(0,10,by=.1)),
> seq(as.Date("2022-10-06"),by="weeks",len=101)))
>    p <- plot(series)
>    if (print.it) {
>        print(p)
>    }
>    sm_series_2 <- smooth(series / 2)
>    lines(sm_series_2, col="red")
>    abline(h=0.1, col="blue")
>    dev.off()
>    file.pdf
> }
> > f()
> Error in plot.xy(xy.coords(x, y), type = type, ...) :
>   plot.new has not been called yet
> > f(TRUE)
> [1]
> "C:\\Users\\willi\\AppData\\Local\\Temp\\Rtmp0wX7rO\\file34843df652c.pdf"
>
> If you remove the pdf() and dev.off() I think you will see that the added
> lines do not show up.  I think plot.xts fiddles with the coordinate system
> before and after it plots so that add-ons must be done in a special way.
>

plot.xts() waits until the plot is rendered before calculating the
coordinate system. That allows users to add multiple series that have
different values for the index (x-axis) and data (y-axis).

lines() doesn't show up in your example because it's called after the
plot is rendered, and it's not rendered again after they're added.
`sm_series_2` also needs to be an xts object, otherwise lines.xts() is
not dispatched.

title() and abline() need to be called after the plot is rendered
because they are standard graphics functions. I admit that's very
confusing... I'll see what I can do to fix that.

Here's a revised example that works for me:

f <- function(print.it = FALSE)
{
    pdf(file.pdf <- tempfile(fileext=".pdf"))
    series <- xts(sin(seq(0,10,by=.1)),
seq(as.Date("2022-10-06"),by="weeks",length.out=101))
    p <- plot(series)
    sm2 <- xts(smooth(series/2), index(series))
    lines(sm2, col="red")
    if (print.it) {
        print(p)
        title("Sine curve example")
        abline(h=0.1, col="green")
    }
    dev.off()
    file.pdf
}
f(TRUE)



> -Bill
>
> On Thu, Oct 6, 2022 at 12:42 AM Deramus, Thomas Patrick <
> tderamus at partners.org> wrote:
>
> > Hi Rolf.
> >
> > I followed your suggestion (though it's probably not as trimmed as it
> > could be), but the problem unfortunately persists.
> >
> > Does this make it any clearer or still too many moving parts to make sense
> > of?
> >
> > rm(list = ls(all.names = TRUE)) #will clear all objects includes hidden
> > objects.
> >
> > #Loads the packages
> > library(plyr)
> > library(dplyr)
> > library(ggplot2)
> > library(Kendall)
> > library(lubridate)
> > library(xts)
> > library(TTR)
> > library(trend)
> > library(forecast)
> > library(openxlsx)
> >
> > #Uses the learningCurve Package from Github:
> > #https://secure-web.cisco.com/1GC2a24rvTQn4ZsRD2yEzdiU8p0VcreF81tS2HTnyYa7VJF5IpO2yI1E7CRvAjkTDIaj6KEYqjTGRSAenLfIdC6jV3OEUiCZS17V58pTwQ-55guIdhru6Sek8uJuW1ts44qoo8ZbniSWEwzzch1DcQTxCe9raR3xZavXdeOins1Yzg7le2LJWuRBEk8s9CxpKUsKa9l3qmWmjRszIWVX7nZSBTjnNOFTcJgqc8MQu8qZojb4GwCZ8mlP7U4dQdClXlDxxlTL6kF-Awi1NmycuaWn8MYEjxDTpdyqw97MAkHjESJbjB7Hfv93No-E5_9cp/https%3A%2F%2Fgithub.com%2FAFIT-R%2FlearningCurve
> > library(learningCurve)
> >
> > #Only load this if using VS Studio because it changes the plot function
> > #
> > https://secure-web.cisco.com/19uRRA2OdQiP-LFePtct8U8sQ1opEP7PrOFLjX3GDTAREApng8FFteGdDY-n8lnkoclvIekYRw4YgvqG24Tsovdeq3hKnKx6iBpWoAy-tOijBFwH0AKBvugicSxwCStU9yZANYx2BTYDd8bYZoEkwTYnthGTH4AKLybu5ek_wJMX0hCEzx9IxjRZ-03ISDvocEUUspf4uxi841j1qW7mAZ3WMj4pjTUa8mlUznIxtkTeEdGYN0X4j3Q5iiwLin6l0gntobwjoaTMv_0kq8hQe6_cYJCxBVxU-CEYcY8KPjsM9YBC-oYeFhUt13Wqlj-mO/https%3A%2F%2Fstackoverflow.com%2Fquestions%2F52284345%2Fhow-to-show-r-graph-from-visual-studio-code
> > library(httpgd)
> > library(languageserver)
> >
> > #Loads the Excel files to Dataframes and cleans the data
> > Game_Metrics_Word_Task <-
> > read.xlsx("GamePack_Analytics_ALL_TIME_Short.xlsx", "Boggle")
> > Game_Metrics_Word_Task <- Game_Metrics_Word_Task %>% filter(grepl('1440',
> > StudyId))
> > Game_Metrics_Word_Task$DeviceTime <-
> > ymd_hms(Game_Metrics_Word_Task$DeviceTime,  tz = "America/New_York")
> > Game_Metrics_Word_Task <-
> > Game_Metrics_Word_Task[!duplicated(Game_Metrics_Word_Task[1:2,])]
> >
> > #Splits the dataframe into a tibble containing each participant
> > Participant_Word_Task <-
> > split(arrange(Game_Metrics_Word_Task,StudyId,DeviceTime),
> > arrange(Game_Metrics_Word_Task,StudyId,DeviceTime,StudyId,DeviceTime)$StudyId)
> >
> > #Generates a blank output dataframe
> > WordFrame <- data.frame(Participant = c(0), Task = c(0), MannKendall_Tau =
> > c(0), MannKendall_P = c(0), Sen_Slope_Value = c(0), Sen_Slope_Pval = c(0),
> > Pettitts_CIV = c(0), Pettitts_Pval = c(0), ARIMA_Model = c(0),
> > Time_to_Petit = c(0), Number_of_Trials_to_Pettitt = c(0),
> > Playtime_to_Petit_seconds = c(0), Time_Start_to_end_days = c(0),
> > Number_of_Total_Trials = c(0), Total_Playtime_seconds = c(0),
> > Learning_rate_days = c(0), Learning_rate_seconds = c(0), Learned_Task =
> > c(0))
> >
> > #The number of subjects in the xlsx file
> > #Reduced to 2 for ease of use
> > for (i in 1:2){
> >   #This timeseries only includes the trials where the participant
> > completed the task
> >   success_series <- xts(filter(Participant_Word_Task[[i]], GameEndReason
> > == "TIMER_UP")$NumberOfSuccesfulWords , order.by=as.POSIXct(filter(Participant_Word_Task[[i]],
> > GameEndReason == "TIMER_UP")$DeviceTime))
> >   #This timeseries includes ALL the trials for the sake of plotting
> >   original_series <-
> > xts(Participant_Word_Task[[i]]$NumberOfSuccesfulWords, order.by
> > =as.POSIXct(Participant_Word_Task[[i]]$DeviceTime))
> >
> >   #This is a decomposing process that xts seems to need for plotting.
> >   #nweeks is needed for xts to plot the x-axis
> >   success_decomp <- ts(success_series, frequency = nweeks(success_series))
> >   original_decomp <- ts(original_series, frequency =
> > nweeks(success_series))
> >
> >   #Values which will be included in the plots
> >   WordFrame[i,1] <- unique(Participant_Word_Task[[i]]$StudyId)
> >   WordFrame[i,5] <- sens.slope(success_decomp)$estimates
> >   WordFrame[i,6] <- sens.slope(success_decomp)$p.value
> >   WordFrame[i,7] <- pettitt.test(success_decomp)$estimate
> >   WordFrame[i,8] <- pettitt.test(success_decomp)$p.value
> >
> >   #The simple moving average that will be overlayed with the plotted data
> >   simplemovingaverage <- SMA(original_series, n = nweeks(original_series))
> >
> >   #If the three tests are statistically significant, add a green
> > horizontal like to value WordFrame[i,7]
> >   #Which would be where the slope changes in the series
> >   #Fluid variables have been removed from all pdf() and paste() functions
> > for ease-of-use
> >   if (WordFrame[i,4] <= 0.05 & WordFrame[i,6] <= 0.05 & WordFrame[i,8] <=
> > 0.05){
> >      {
> >       pdf(file = "Word_Task_Acquisition.pdf")
> >       plout <- plot(original_series)
> >       lines(simplemovingaverage)
> >       abline(v = index(original_series[WordFrame[i,7]]),lty=2,
> > col='green', lwd=3)
> >       title(paste("Word Task Acquisition for Subject"))
> >       dev.off()
> >      }
> >   #If the three tests are NOT statistically significant, generate a plot
> > with NO horizontal line at WordFrame[i,7]
> >   } else {
> >     {
> >       pdf(file = "Word_Task_Acquisition.pdf")
> >       plout <- plot(original_series)
> >       lines(simplemovingaverage)
> >       title(paste("Word Task Acquisition for Subject"))
> >       dev.off()
> >     }
> >   }
> > }
> >
> > ________________________________
> > From: Rolf Turner <r.turner at auckland.ac.nz>
> > Sent: Wednesday, October 5, 2022 6:06 AM
> > To: Deramus, Thomas Patrick <tderamus at partners.org>
> > Cc: r-help at r-project.org <r-help at r-project.org>
> > Subject: Re: [R] Getting "Error in ect, plot.new has not been called yet"
> > despite grouping plot call
> >
> >         External Email - Use Caution
> >
> > What you doing or trying to do is far too complex for my poor feeble
> > and senile brain to come anywhere near comprehending.  The code that
> > you present exceeds my complexity tolerance by many orders of magnitude.
> >
> > I have a suggestion, but.  Strip your code down to the *essentials*.
> > Construct a simple sequence of plotting commands, with *simple* names
> > for the pdf files involved.  You should require only two or three such
> > files and two or three index levels associated with each of your
> > nested loops.
> >
> > Run the stripped down code and the source of the problem will almost
> > surely become clear.
> >
> > cheers,
> >
> > Rolf Turner
> >
> > On Tue, 4 Oct 2022 23:35:09 +0000
> > "Deramus, Thomas Patrick" <tderamus at partners.org> wrote:
> >
<snip>
> > > ?Issac Asimov
> >
> > The information in this e-mail is intended only for th...{{dropped:22}}
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://secure-web.cisco.com/1SgVzv3MhZxjS8lVtL-AremtzH9si_AP6nzXeP88cMer7WPpSbOcW6bQxA1_OS8tZfnCR4A2dnkLji0Xp6WSmRSij8pKrLyRC88Hs_VerYcbpwTmmsgMvWy-fJqib7KS0Pe3sz6uw8bjRWL1kqrus4AEumxFWNkTUdne-TFZJSuNOREO0uZ2-TQIu-Xb6N4Dts3snQ7ChYqiEZbiv009G2CofS-41urHFmbmtfEXay8g9SlLFflx1YVNoU2VK8lToEb-0BFCetotnxGlK_wLqGKAF11eE4HGUA_uZuBHB9zwWAiNpEPZ0RaZ5oleTjlRY/https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help
> PLEASE do read the posting guide http://secure-web.cisco.com/128DnoUBGpXNKPpn-_IIbo2_5a9sLNJXREjbFp3cT2Ho_IxpgACzE8mFRNc3SzHQtfOzJ7UGe-7kbG4pMAw6xbxdx5U0P4WtBPr4etT4P1F4zmWvXwthbNt1gleb4i2WNnIXgrne6n5jGt0Aj3mZCVuUft56CCVyopOOVaA-8O093biCfDFWuT2Mgi0UZC6jKiUoBb4jpGoAwrvWIt8BatRnhER5zyL4EeEjR4Hztxlw0sdOQX71AT7bclT9UtV7ZcYPpCw8MSPYNEXd2rUIeYqbPaYwwLJYIfhpMCq2fimy6N1BLxClytQzF1IUo77Rv/http%3A%2F%2Fwww.R-project.org%2Fposting-guide.html
> and provide commented, minimal, self-contained, reproducible code.



--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  http://secure-web.cisco.com/1a6xFSrjm-kcAD3kFpY-MqFccS9tOSo60B0iS6Vc-3YL2jcoq-n2LgKPqVzbQ5ir8uo_2QTYF5GdGxAAniCa47MXagKCxQLoHf-QDEpHuk0HUSvYaXhf3mMKt6FA9Gyao_ZDezq8FCdAeyqdDbuf2UpRQWX7h6AlgMfRZgoxY1j7cr15jkXNPjs7nR9Jr6S5VH37YmzyrbIfBlYqY2rIPUt2BgnyqUDbXknZbB2JVHKw5giicByw9dzXuIhiEm357Wjcy5vwCvn8BuoAuymq17BRKc98dGSO1cbflw94gPWR5m8x6kZq1sa-Li8l7BB62/http%3A%2F%2Fwww.fosstrading.com
The information in this e-mail is intended only for the ...{{dropped:15}}


From kry|ov@r00t @end|ng |rom gm@||@com  Thu Oct  6 17:52:46 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Thu, 6 Oct 2022 18:52:46 +0300
Subject: [R] (no subject)
In-Reply-To: <CAAsvtakY89Vi5Uk0rZJtXfBy1-4AvpYEe7fBbRWoKD_t+7sqAQ@mail.gmail.com>
References: <CAAsvtakY89Vi5Uk0rZJtXfBy1-4AvpYEe7fBbRWoKD_t+7sqAQ@mail.gmail.com>
Message-ID: <20221006185246.5bec0ea9@arachnoid>

Hi Julie,

? Thu, 6 Oct 2022 10:58:51 -0400
Julie Coughlin <jcoughlin at umass.edu> ?????:

> Can you send me a later version of r programming to use on my macos
> version 10.12.6? The newest r program is not compatible with my
> macbook.

Since R 4.0.0, the official builds of R require macOS ? 10.13. The
Homebrew project doesn't seem to have any binaries for 10.12 either,
but it should be able to build R for you:
https://formulae.brew.sh/formula/r#default

Alternatively, you can follow the guide at
https://cran.r-project.org/doc/manuals/r-release/R-admin.html and build
the source code yourself.

We have a special mailing list dedicated to Mac-related questions:
r-sig-mac at r-project.org

-- 
Best regards,
Ivan


From m@r|ne@@nder@@on @end|ng |rom k|@@e  Fri Oct  7 13:57:36 2022
From: m@r|ne@@nder@@on @end|ng |rom k|@@e (Marine Andersson)
Date: Fri, 7 Oct 2022 11:57:36 +0000
Subject: [R] Ids with matching number combinations?
Message-ID: <GV3P280MB0691B68DAEE14884207FEDE88F5F9@GV3P280MB0691.SWEP280.PROD.OUTLOOK.COM>

Hi,

If I have two datasets like this:
df=data.frame("id"=rep(1:10,10, each=10), "item1"=sample(1:20, 100, replace=T)
df2=data.frame("a"=c(8, 8,10,9, 5, 1,2,1), "b"=c(16,18,11, 19,18, 11,17,12))

How do I find out which ids in the df dataset that has a match for both the numbers occuring in the same row in the df2 dataframe? In the output I would like to get the matching id and the rownumber from the df2.

Output something like this
Id                        Rownr
2                         1
5                         1
7                         4

My actual problem is more complex with even more columns to be matched and the datasets are large, hence the solution needs to be efficient.

Kind regards,





N?r du skickar e-post till Karolinska Institutet (KI) inneb?r detta att KI kommer att behandla dina personuppgifter. H?r finns information om hur KI behandlar personuppgifter<https://ki.se/medarbetare/integritetsskyddspolicy>.


Sending email to Karolinska Institutet (KI) will result in KI processing your personal data. You can read more about KI's processing of personal data here<https://ki.se/en/staff/data-protection-policy>.

	[[alternative HTML version deleted]]


From petr@p|k@| @end|ng |rom prechez@@cz  Fri Oct  7 16:02:01 2022
From: petr@p|k@| @end|ng |rom prechez@@cz (PIKAL Petr)
Date: Fri, 7 Oct 2022 14:02:01 +0000
Subject: [R] Ids with matching number combinations?
In-Reply-To: <GV3P280MB0691B68DAEE14884207FEDE88F5F9@GV3P280MB0691.SWEP280.PROD.OUTLOOK.COM>
References: <GV3P280MB0691B68DAEE14884207FEDE88F5F9@GV3P280MB0691.SWEP280.PROD.OUTLOOK.COM>
Message-ID: <c6b363da531c457d92349b90d9622562@SRVEXCHCM1302.precheza.cz>

Hallo Marine

Could you please make your example more reproducible by using set.seed (and
maybe smaller)?

If I understand correctly, you want to know if let say row 1 items from df2
(8,16) are both in item column of specific id?

If I am correct in guessing, I cannot find another solution than split your
df according to id
x <- split(df, df$id)[[1]]

and for each row of df2 test if within the specified id you can find both
numbers.
sum(is.element(df2[1,], x$item))==2
[1] FALSE

So basically 2 cycles, one for df ids and the other for df2 rows.

But maybe somebody will give you more ingenious answer.

Cheers
Petr


> -----Original Message-----
> From: R-help <r-help-bounces at r-project.org> On Behalf Of Marine Andersson
> Sent: Friday, October 7, 2022 1:58 PM
> To: r-help at r-project.org
> Subject: [R] Ids with matching number combinations?
> 
> Hi,
> 
> If I have two datasets like this:
> df=data.frame("id"=rep(1:10,10, each=10), "item1"=sample(1:20, 100,
> replace=T)
> df2=data.frame("a"=c(8, 8,10,9, 5, 1,2,1), "b"=c(16,18,11, 19,18,
11,17,12))
> 
> How do I find out which ids in the df dataset that has a match for both
the
> numbers occuring in the same row in the df2 dataframe? In the output I
would
> like to get the matching id and the rownumber from the df2.
> 
> Output something like this
> Id                        Rownr
> 2                         1
> 5                         1
> 7                         4
> 
> My actual problem is more complex with even more columns to be matched and
> the datasets are large, hence the solution needs to be efficient.
> 
> Kind regards,
> 
> 
> 
> 
> 
> N?r du skickar e-post till Karolinska Institutet (KI) inneb?r detta att KI
kommer
> att behandla dina personuppgifter. H?r finns information om hur KI
behandlar
> personuppgifter<https://ki.se/medarbetare/integritetsskyddspolicy>.
> 
> 
> Sending email to Karolinska Institutet (KI) will result in KI processing
your
> personal data. You can read more about KI's processing of personal data
> here<https://ki.se/en/staff/data-protection-policy>.
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.

From tebert @end|ng |rom u||@edu  Fri Oct  7 17:16:11 2022
From: tebert @end|ng |rom u||@edu (Ebert,Timothy Aaron)
Date: Fri, 7 Oct 2022 15:16:11 +0000
Subject: [R] Ids with matching number combinations?
In-Reply-To: <c6b363da531c457d92349b90d9622562@SRVEXCHCM1302.precheza.cz>
References: <GV3P280MB0691B68DAEE14884207FEDE88F5F9@GV3P280MB0691.SWEP280.PROD.OUTLOOK.COM>
 <c6b363da531c457d92349b90d9622562@SRVEXCHCM1302.precheza.cz>
Message-ID: <BN6PR2201MB1553C2DAEB2446765597435CCF5F9@BN6PR2201MB1553.namprd22.prod.outlook.com>

Would an inner_join work? If not, please describe why so that we can improve our answer. This answer requires the dplyr package.
https://statisticsglobe.com/r-dplyr-join-inner-left-right-full-semi-anti

Regards,
Tim

-----Original Message-----
From: R-help <r-help-bounces at r-project.org> On Behalf Of PIKAL Petr
Sent: Friday, October 7, 2022 10:02 AM
To: Marine Andersson <marine.andersson at ki.se>; r-help at r-project.org
Subject: Re: [R] Ids with matching number combinations?

[External Email]

Hallo Marine

Could you please make your example more reproducible by using set.seed (and maybe smaller)?

If I understand correctly, you want to know if let say row 1 items from df2
(8,16) are both in item column of specific id?

If I am correct in guessing, I cannot find another solution than split your df according to id x <- split(df, df$id)[[1]]

and for each row of df2 test if within the specified id you can find both numbers.
sum(is.element(df2[1,], x$item))==2
[1] FALSE

So basically 2 cycles, one for df ids and the other for df2 rows.

But maybe somebody will give you more ingenious answer.

Cheers
Petr


> -----Original Message-----
> From: R-help <r-help-bounces at r-project.org> On Behalf Of Marine 
> Andersson
> Sent: Friday, October 7, 2022 1:58 PM
> To: r-help at r-project.org
> Subject: [R] Ids with matching number combinations?
>
> Hi,
>
> If I have two datasets like this:
> df=data.frame("id"=rep(1:10,10, each=10), "item1"=sample(1:20, 100,
> replace=T)
> df2=data.frame("a"=c(8, 8,10,9, 5, 1,2,1), "b"=c(16,18,11, 19,18,
11,17,12))
>
> How do I find out which ids in the df dataset that has a match for 
> both
the
> numbers occuring in the same row in the df2 dataframe? In the output I
would
> like to get the matching id and the rownumber from the df2.
>
> Output something like this
> Id                        Rownr
> 2                         1
> 5                         1
> 7                         4
>
> My actual problem is more complex with even more columns to be matched 
> and the datasets are large, hence the solution needs to be efficient.
>
> Kind regards,
>
>
>
>
>
> N?r du skickar e-post till Karolinska Institutet (KI) inneb?r detta 
> att KI
kommer
> att behandla dina personuppgifter. H?r finns information om hur KI
behandlar
> personuppgifter<https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fki.se%2Fmedarbetare%2Fintegritetsskyddspolicy&amp;data=05%7C01%7Ctebert%40ufl.edu%7C7346e6bc695846d7264508daa86cac5a%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638007482638899002%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000%7C%7C%7C&amp;sdata=%2F17yDHhLyAUZFLVC9g73jTSLvncGW89KB5SiBpMo1u8%3D&amp;reserved=0>.
>
>
> Sending email to Karolinska Institutet (KI) will result in KI 
> processing
your
> personal data. You can read more about KI's processing of personal 
> data here<https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fki.se%2Fen%2Fstaff%2Fdata-protection-policy&amp;data=05%7C01%7Ctebert%40ufl.edu%7C7346e6bc695846d7264508daa86cac5a%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638007482638899002%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000%7C%7C%7C&amp;sdata=E6valRizvf2Ff5TSUUp6ut30E6D3BF%2BiMNDrmDOZxfs%3D&amp;reserved=0>.
>
>       [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat
> .ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl
> .edu%7C7346e6bc695846d7264508daa86cac5a%7C0d4da0f84a314d76ace60a62331e
> 1b84%7C0%7C0%7C638007482638899002%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4w
> LjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000%7C%7C%7C
> &amp;sdata=hKFMIJOKSUHjM7GRTn9RkTAMocHRQQwO5lB6tUMe%2FUI%3D&amp;reserv
> ed=0
> PLEASE do read the posting guide
https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%7C7346e6bc695846d7264508daa86cac5a%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638007482638899002%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000%7C%7C%7C&amp;sdata=dM%2BvORlAYU2%2F0uHF9d%2F3sEl4GdurEGDjgk%2Bs6QxazZQ%3D&amp;reserved=0
> and provide commented, minimal, self-contained, reproducible code.


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Fri Oct  7 17:20:28 2022
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Fri, 07 Oct 2022 08:20:28 -0700
Subject: [R] Ids with matching number combinations?
In-Reply-To: <BN6PR2201MB1553C2DAEB2446765597435CCF5F9@BN6PR2201MB1553.namprd22.prod.outlook.com>
References: <GV3P280MB0691B68DAEE14884207FEDE88F5F9@GV3P280MB0691.SWEP280.PROD.OUTLOOK.COM>
 <c6b363da531c457d92349b90d9622562@SRVEXCHCM1302.precheza.cz>
 <BN6PR2201MB1553C2DAEB2446765597435CCF5F9@BN6PR2201MB1553.namprd22.prod.outlook.com>
Message-ID: <880DC400-42AF-40E2-9AFD-A1CA1F20A831@dcn.davis.ca.us>

The merge function doesn't require a package.

But inner_join may be faster than merge.

On October 7, 2022 8:16:11 AM PDT, "Ebert,Timothy Aaron" <tebert at ufl.edu> wrote:
>Would an inner_join work? If not, please describe why so that we can improve our answer. This answer requires the dplyr package.
>https://statisticsglobe.com/r-dplyr-join-inner-left-right-full-semi-anti
>
>Regards,
>Tim
>
>-----Original Message-----
>From: R-help <r-help-bounces at r-project.org> On Behalf Of PIKAL Petr
>Sent: Friday, October 7, 2022 10:02 AM
>To: Marine Andersson <marine.andersson at ki.se>; r-help at r-project.org
>Subject: Re: [R] Ids with matching number combinations?
>
>[External Email]
>
>Hallo Marine
>
>Could you please make your example more reproducible by using set.seed (and maybe smaller)?
>
>If I understand correctly, you want to know if let say row 1 items from df2
>(8,16) are both in item column of specific id?
>
>If I am correct in guessing, I cannot find another solution than split your df according to id x <- split(df, df$id)[[1]]
>
>and for each row of df2 test if within the specified id you can find both numbers.
>sum(is.element(df2[1,], x$item))==2
>[1] FALSE
>
>So basically 2 cycles, one for df ids and the other for df2 rows.
>
>But maybe somebody will give you more ingenious answer.
>
>Cheers
>Petr
>
>
>> -----Original Message-----
>> From: R-help <r-help-bounces at r-project.org> On Behalf Of Marine 
>> Andersson
>> Sent: Friday, October 7, 2022 1:58 PM
>> To: r-help at r-project.org
>> Subject: [R] Ids with matching number combinations?
>>
>> Hi,
>>
>> If I have two datasets like this:
>> df=data.frame("id"=rep(1:10,10, each=10), "item1"=sample(1:20, 100,
>> replace=T)
>> df2=data.frame("a"=c(8, 8,10,9, 5, 1,2,1), "b"=c(16,18,11, 19,18,
>11,17,12))
>>
>> How do I find out which ids in the df dataset that has a match for 
>> both
>the
>> numbers occuring in the same row in the df2 dataframe? In the output I
>would
>> like to get the matching id and the rownumber from the df2.
>>
>> Output something like this
>> Id                        Rownr
>> 2                         1
>> 5                         1
>> 7                         4
>>
>> My actual problem is more complex with even more columns to be matched 
>> and the datasets are large, hence the solution needs to be efficient.
>>
>> Kind regards,
>>
>>
>>
>>
>>
>> N?r du skickar e-post till Karolinska Institutet (KI) inneb?r detta 
>> att KI
>kommer
>> att behandla dina personuppgifter. H?r finns information om hur KI
>behandlar
>> personuppgifter<https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fki.se%2Fmedarbetare%2Fintegritetsskyddspolicy&amp;data=05%7C01%7Ctebert%40ufl.edu%7C7346e6bc695846d7264508daa86cac5a%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638007482638899002%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000%7C%7C%7C&amp;sdata=%2F17yDHhLyAUZFLVC9g73jTSLvncGW89KB5SiBpMo1u8%3D&amp;reserved=0>.
>>
>>
>> Sending email to Karolinska Institutet (KI) will result in KI 
>> processing
>your
>> personal data. You can read more about KI's processing of personal 
>> data here<https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fki.se%2Fen%2Fstaff%2Fdata-protection-policy&amp;data=05%7C01%7Ctebert%40ufl.edu%7C7346e6bc695846d7264508daa86cac5a%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638007482638899002%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000%7C%7C%7C&amp;sdata=E6valRizvf2Ff5TSUUp6ut30E6D3BF%2BiMNDrmDOZxfs%3D&amp;reserved=0>.
>>
>>       [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat
>> .ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl
>> .edu%7C7346e6bc695846d7264508daa86cac5a%7C0d4da0f84a314d76ace60a62331e
>> 1b84%7C0%7C0%7C638007482638899002%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4w
>> LjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000%7C%7C%7C
>> &amp;sdata=hKFMIJOKSUHjM7GRTn9RkTAMocHRQQwO5lB6tUMe%2FUI%3D&amp;reserv
>> ed=0
>> PLEASE do read the posting guide
>https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%7C7346e6bc695846d7264508daa86cac5a%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638007482638899002%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000%7C%7C%7C&amp;sdata=dM%2BvORlAYU2%2F0uHF9d%2F3sEl4GdurEGDjgk%2Bs6QxazZQ%3D&amp;reserved=0
>> and provide commented, minimal, self-contained, reproducible code.
>
>______________________________________________
>R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>https://stat.ethz.ch/mailman/listinfo/r-help
>PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>and provide commented, minimal, self-contained, reproducible code.

-- 
Sent from my phone. Please excuse my brevity.


From bgunter@4567 @end|ng |rom gm@||@com  Fri Oct  7 18:19:16 2022
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Fri, 7 Oct 2022 09:19:16 -0700
Subject: [R] Ids with matching number combinations?
In-Reply-To: <GV3P280MB0691B68DAEE14884207FEDE88F5F9@GV3P280MB0691.SWEP280.PROD.OUTLOOK.COM>
References: <GV3P280MB0691B68DAEE14884207FEDE88F5F9@GV3P280MB0691.SWEP280.PROD.OUTLOOK.COM>
Message-ID: <CAGxFJbQb1LOy3X5LeOHMLS+E66fYCMy4969iPztwN_UCE6dh+A@mail.gmail.com>

Well, for a start, you might give us a reproducible example that actually
runs -- yours doesn't. Did you check? You seem to b.e missing a final
")"(Also, you do not need to quote the column names in data.frame(), though
it works fine also if you do).

Also note that in df, your id column has length 1000 and item1 column has
length 100 and will be replicated to match id. This seems to me likely to
be misspecified. Or is this what you meant?

Finally, note that that none of the rows in df2 have identical numbers, so
there is no id in df that can match both members of the row. So did you
mean that the 'id' and 'item1' value in a row of df must match the
corresponding 'a' and 'b' values of some row in df2 ?

Under the above interpretation and with the following reprex(note the use
of set.seed() to make it reproducible)...

set.seed(1234)  ## for reproducibility
df=data.frame(id=c(10,rep(1:10, each=10), item1=sample(1:20, 100,
replace=T))
df2=data.frame(a=c(8, 8,10,9, 5, 1,2,1), b=c(16,18,11, 19,18, 11,17,12))

... you can paste0() the column vectors together in each data frame(as
character values) and then just match on the single character vectors, like
this:

both <- match(do.call(paste0,df),  do.call(paste0, df2))
## subscript the data frames if you have more columns that are not used for
matching

> both
  [1] NA NA  8 NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
 [21] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
 [41] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
 [61] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
 [81] NA NA NA NA NA NA NA NA NA NA  3 NA NA NA NA NA NA NA NA  3

Then
> both[!is.na(both)] ## the rows of df2 that matched
[1] 8 3 3

> which(!is.na(both)) ## the rows of df that were matched
[1]   3  91 100

This should be very efficient, as hashing is used for matching.

I think there is a slicker way to do this that combines the paste and match
functions together (other than using merge() or the like, as has already
been suggested). But I have forgotten the details or I may just be thinking
of merge(), which may indeed be a better option.

All presuming this is what you meant, of course, which it may not be. :-(

Cheers,
Bert









On Fri, Oct 7, 2022 at 5:57 AM Marine Andersson <marine.andersson at ki.se>
wrote:

> Hi,
>
> If I have two datasets like this:
> df=data.frame("id"=rep(1:10,10, each=10), "item1"=sample(1:20, 100,
> replace=T)
> df2=data.frame("a"=c(8, 8,10,9, 5, 1,2,1), "b"=c(16,18,11, 19,18,
> 11,17,12))
>
> How do I find out which ids in the df dataset that has a match for both
> the numbers occuring in the same row in the df2 dataframe? In the output I
> would like to get the matching id and the rownumber from the df2.
>
> Output something like this
> Id                        Rownr
> 2                         1
> 5                         1
> 7                         4
>
> My actual problem is more complex with even more columns to be matched and
> the datasets are large, hence the solution needs to be efficient.
>
> Kind regards,
>
>
>
>
>
> N?r du skickar e-post till Karolinska Institutet (KI) inneb?r detta att KI
> kommer att behandla dina personuppgifter. H?r finns information om hur KI
> behandlar personuppgifter<
> https://ki.se/medarbetare/integritetsskyddspolicy>.
>
>
> Sending email to Karolinska Institutet (KI) will result in KI processing
> your personal data. You can read more about KI's processing of personal
> data here<https://ki.se/en/staff/data-protection-policy>.
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From drj|m|emon @end|ng |rom gm@||@com  Sat Oct  8 12:58:03 2022
From: drj|m|emon @end|ng |rom gm@||@com (Jim Lemon)
Date: Sat, 8 Oct 2022 21:58:03 +1100
Subject: [R] Ids with matching number combinations?
In-Reply-To: <GV3P280MB0691B68DAEE14884207FEDE88F5F9@GV3P280MB0691.SWEP280.PROD.OUTLOOK.COM>
References: <GV3P280MB0691B68DAEE14884207FEDE88F5F9@GV3P280MB0691.SWEP280.PROD.OUTLOOK.COM>
Message-ID: <CA+8X3fWzADdqGdxbFo2rifQOgNSuD5jNZi386=cFKuTSP0wf=Q@mail.gmail.com>

Hi Marine,
I'm not sure that I have the right idea, but this worked for me and may help.

# I had to fix this line
df<-data.frame(id=rep(1:10,each=10),item1=sample(1:20, 100, replace=TRUE))
df2<-data.frame(a=c(8, 8,10,9, 5, 1,2,1),b=c(16,18,11, 19,18, 11,17,12))
result<-data.frame(id=df[,1],rown=1:dim(df)[1],matched=rep(FALSE,dim(dfw)[1]))
# function that checks that all entries in vector a exist in vector x
match_all_a<-function(a,x,index) {
 inx<-TRUE
 for(i in 1:length(a)) inx <- inx && a[i] %in% x[-1]
 return(list(id=x[1],rown=index,matched=inx))
}
# step through the data frame
for(i in df[,1]) result[i,]<-match_all_a(df2[i,],df[i,],i)
# display the result id, row in df, whether matched
result
# select the rows of result for which matched is TRUE

Jim

On Fri, Oct 7, 2022 at 11:57 PM Marine Andersson <marine.andersson at ki.se> wrote:
>
> Hi,
>
> If I have two datasets like this:
> df=data.frame("id"=rep(1:10,10, each=10), "item1"=sample(1:20, 100, replace=T)
> df2=data.frame("a"=c(8, 8,10,9, 5, 1,2,1), "b"=c(16,18,11, 19,18, 11,17,12))
>
> How do I find out which ids in the df dataset that has a match for both the numbers occuring in the same row in the df2 dataframe? In the output I would like to get the matching id and the rownumber from the df2.
>
> Output something like this
> Id                        Rownr
> 2                         1
> 5                         1
> 7                         4
>
> My actual problem is more complex with even more columns to be matched and the datasets are large, hence the solution needs to be efficient.
>
> Kind regards,
>
>
>
>
>
> N?r du skickar e-post till Karolinska Institutet (KI) inneb?r detta att KI kommer att behandla dina personuppgifter. H?r finns information om hur KI behandlar personuppgifter<https://ki.se/medarbetare/integritetsskyddspolicy>.
>
>
> Sending email to Karolinska Institutet (KI) will result in KI processing your personal data. You can read more about KI's processing of personal data here<https://ki.se/en/staff/data-protection-policy>.
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From n|ckmwr@y @end|ng |rom gm@||@com  Sun Oct  9 13:01:27 2022
From: n|ckmwr@y @end|ng |rom gm@||@com (Nick Wray)
Date: Sun, 9 Oct 2022 12:01:27 +0100
Subject: [R] Reading Text files from UK Met Office into R again...
Message-ID: <CABxY9BNPKdWh=0TRqiQ_3UNqcvuzBToUQ5hRY8gLBZhYnnJLAA@mail.gmail.com>

Hello I've had some invaluable help from folk about downloading files from
the UK Met Office - unfortunately I now have another one which I can't
solve and I wonder whether anyone's got any ideas.

I'm trying to download hourly weather records from the Met Office

 https://data.ceda.ac.uk/badc/ukmo-midas/data/WH/yearly_files



Up to 2010 everything's fine and dandy - the data is in nice neat columns
and I can download it and filter out what I don't want.  But after 2010 the
format changes (The Met Office in fact say on their guidelines that it
changes)  - it's still a text doc but instead of columns it seems to be one
long vector.  Here is a short sample:



2015-01-01 00:00, 03002, WMO, SYNOP, 1, 12, 1011, 4, 7, 200, 18, 82, , , 8,
, , , , 100, 450, 1005.4, 5, , 102, 4, , 129, , , , , , , , 8.7, 7.5, 8.1,
1003.6, , , , , , , 1, 1, 1, , , 1, , , , , 1, 1, 1, 1, 1, 1, , 1, , 1, 1,
, 1, , , , , , , , 1, , , , , 2014-12-31 23:53, 0, , , , , , , , , , , , K,
, , , , 91.7, A, , , ,
2015-01-01 00:00, 03005, WMO, SYNOP, 1, 9, 1011, 4, 1, 210, 26, 62, 8, 6,
8, 8, , , 8, 30, 700, 1006, 1, 8, 54, 7, 6, 105, , , , , , , , 8.6, 7.3, 8,
996.1, , 01, , , , , 1, 1, 1, 1, 1, 1, 1, , , 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
1, 1, 1, 1, , , , , , , , 1, , , , , 2014-12-31 23:55, 0, , , , , , , , , ,
, , K, , , , , 91.7, A, , , 0, 1
2015-01-01 00:00, 03006, WMO, SYNOP, 1, 10, 1011, 4, 6, 210, 23, , , , , ,
, , , , , , , , , , , , , , , , , , , , , , , , , , , , , 1, 1, , , , , , ,
, , , , , , , , , , , , , , , , , , , , , , , , , , , 2014-12-31 23:53, 0,
, , , , , , , , , , , , , , , , , A, , , ,
2015-01-01 00:00, 03010, WMO, SYNOP, 1, 17, 1011, 4, 6, 230, 21, , , , , ,
, , , , , 1006.1, , , , , , , , , , , , , , 9.4, 6.2, 7.9, , , , , , , , 1,
1, , , , , , , , , , , 1, 1, 1, 1, , , , , , , , , , , , , , , , , , , ,





If I could download it I should still be able to use it as I could identify
each separate line as it will be headed by a date.   The files are v large
c 1GB and when I start to download in R it works for a while and then
after maybe 30 seconds I get this error message:



Error in read.table("midas_wxhrly_201501-201512.txt", fill = T) :
  duplicate 'row.names' are not allowed


The instruction in the error message works perfectly well up to 2010, and I
can?t see where a ?duplicate rowname? would come in this data anyway


Is there a way of either downloading the file without getting the error
message or of being able to identify at what point in the file the error
message is being generated so that I could, by hand possibly, take out
whatever the problem is?



I?ve tried putting the downloaded text doc into other formats but nothing
seems to work

If anyone has any ideas I?d be v grateful   Thanks Nick Wray

	[[alternative HTML version deleted]]


From j@zh@o @end|ng |rom ye@h@net  Sun Oct  9 16:54:53 2022
From: j@zh@o @end|ng |rom ye@h@net (Jinsong Zhao)
Date: Sun, 9 Oct 2022 22:54:53 +0800
Subject: [R] how to enlarge the legend
Message-ID: <ec42dba5-5ea0-a029-20e9-3b77edd9c375@yeah.net>

Hi there,

in the following code, I'd like to enlarge the filled box but not the 
legend text.

plot.new()

legend("topleft", "text", fill = "gray") # filled box is too small

legend("top", "text", fill = "gray", cex = 2) # filled box is ok but 
text is too large

# I can use point to mimic filled box, but can not fill it with pattern

legend("left", "text", pch = 22, pt.bg = "gray", pt.cex =3)

I'd like to get filled box enlarged but with text not to be changed. Is 
it possible?

Thanks in advance!

Best,

Jinsong


From bgunter@4567 @end|ng |rom gm@||@com  Sun Oct  9 17:08:05 2022
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Sun, 9 Oct 2022 08:08:05 -0700
Subject: [R] how to enlarge the legend
In-Reply-To: <ec42dba5-5ea0-a029-20e9-3b77edd9c375@yeah.net>
References: <ec42dba5-5ea0-a029-20e9-3b77edd9c375@yeah.net>
Message-ID: <CAGxFJbTFiiDWJxP1KK_iiyafxFuZTd99qw9CVGFS9kiNSrJRUA@mail.gmail.com>

Did you use the 'box.lwd' argument to set the width of the box? If so, why
does this not work for you? If not, set it to a bigger value.

Cheers,
Bert

On Sun, Oct 9, 2022 at 7:55 AM Jinsong Zhao <jszhao at yeah.net> wrote:

> Hi there,
>
> in the following code, I'd like to enlarge the filled box but not the
> legend text.
>
> plot.new()
>
> legend("topleft", "text", fill = "gray") # filled box is too small
>
> legend("top", "text", fill = "gray", cex = 2) # filled box is ok but
> text is too large
>
> # I can use point to mimic filled box, but can not fill it with pattern
>
> legend("left", "text", pch = 22, pt.bg = "gray", pt.cex =3)
>
> I'd like to get filled box enlarged but with text not to be changed. Is
> it possible?
>
> Thanks in advance!
>
> Best,
>
> Jinsong
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From bgunter@4567 @end|ng |rom gm@||@com  Sun Oct  9 17:10:06 2022
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Sun, 9 Oct 2022 08:10:06 -0700
Subject: [R] how to enlarge the legend
In-Reply-To: <CAGxFJbTFiiDWJxP1KK_iiyafxFuZTd99qw9CVGFS9kiNSrJRUA@mail.gmail.com>
References: <ec42dba5-5ea0-a029-20e9-3b77edd9c375@yeah.net>
 <CAGxFJbTFiiDWJxP1KK_iiyafxFuZTd99qw9CVGFS9kiNSrJRUA@mail.gmail.com>
Message-ID: <CAGxFJbRWpYeqfJMXeb+80kQWiRvmzbGEzFHC_9VqOdjMXpp_mg@mail.gmail.com>

Nope. Sorry. Ignore my comment. box.lwd changes the width of the box line,
bot the width of the box.

-- Bert

On Sun, Oct 9, 2022 at 8:08 AM Bert Gunter <bgunter.4567 at gmail.com> wrote:

> Did you use the 'box.lwd' argument to set the width of the box? If so, why
> does this not work for you? If not, set it to a bigger value.
>
> Cheers,
> Bert
>
> On Sun, Oct 9, 2022 at 7:55 AM Jinsong Zhao <jszhao at yeah.net> wrote:
>
>> Hi there,
>>
>> in the following code, I'd like to enlarge the filled box but not the
>> legend text.
>>
>> plot.new()
>>
>> legend("topleft", "text", fill = "gray") # filled box is too small
>>
>> legend("top", "text", fill = "gray", cex = 2) # filled box is ok but
>> text is too large
>>
>> # I can use point to mimic filled box, but can not fill it with pattern
>>
>> legend("left", "text", pch = 22, pt.bg = "gray", pt.cex =3)
>>
>> I'd like to get filled box enlarged but with text not to be changed. Is
>> it possible?
>>
>> Thanks in advance!
>>
>> Best,
>>
>> Jinsong
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide
>> http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
>>
>

	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Sun Oct  9 17:50:41 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Sun, 9 Oct 2022 18:50:41 +0300
Subject: [R] Reading Text files from UK Met Office into R again...
In-Reply-To: <CABxY9BNPKdWh=0TRqiQ_3UNqcvuzBToUQ5hRY8gLBZhYnnJLAA@mail.gmail.com>
References: <CABxY9BNPKdWh=0TRqiQ_3UNqcvuzBToUQ5hRY8gLBZhYnnJLAA@mail.gmail.com>
Message-ID: <20221009185041.1fcd708c@Tarkus>

On Sun, 9 Oct 2022 12:01:27 +0100
Nick Wray <nickmwray at gmail.com> wrote:

> Error in read.table("midas_wxhrly_201501-201512.txt", fill = T) :
>   duplicate 'row.names' are not allowed

Since you don't pass the `header` argument, I think that the automatic
header detection is here at play. This is what ?read.table has to say
about row names:

>> If there is a header and the first row contains one fewer field than
>> the number of columns, the first column in the input is used for the
>> row names.  Otherwise if ?row.names? is missing, the rows are
>> numbered.

Perhaps the "one fewer field in the header than the number of columns"
condition is true for files after 2010? I'm too lazy to sign up for a
CEDA account and I'm not sure I'd be given access to hourly datasets
anyway.

If this is the reason for the failure (first column used as rownames()
and turns out to be non-unique), there's an easy way to fix that:

>> Using ?row.names = NULL? forces row numbering.

I don't see a header in your example. If there's actually no header
containing column names, passing `header = FALSE` will both prevent the
error and avoid eating the first line of the file.

-- 
Best regards,
Ivan


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Sun Oct  9 21:48:24 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Sun, 9 Oct 2022 21:48:24 +0200
Subject: [R] how to enlarge the legend
In-Reply-To: <ec42dba5-5ea0-a029-20e9-3b77edd9c375@yeah.net>
References: <ec42dba5-5ea0-a029-20e9-3b77edd9c375@yeah.net>
Message-ID: <0211aa20-1f31-719f-3165-b6f7b2534719@statistik.tu-dortmund.de>

I'd propose:

plot.new()
ltext <- "text"
lobj <- legend("bottom", "", text.width=strwidth(ltext), fill = "gray", 
cex = 2)
text(lobj$text, ltext)

Best,
Uwe Ligges


On 09.10.2022 16:54, Jinsong Zhao wrote:
> Hi there,
> 
> in the following code, I'd like to enlarge the filled box but not the 
> legend text.
> 
> plot.new()
> 
> legend("topleft", "text", fill = "gray") # filled box is too small
> 
> legend("top", "text", fill = "gray", cex = 2) # filled box is ok but 
> text is too large
> 
> # I can use point to mimic filled box, but can not fill it with pattern
> 
> legend("left", "text", pch = 22, pt.bg = "gray", pt.cex =3)
> 
> I'd like to get filled box enlarged but with text not to be changed. Is 
> it possible?
> 
> Thanks in advance!
> 
> Best,
> 
> Jinsong
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide 
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From no@p@m @end|ng |rom ||@@e@NA  Sun Oct  9 23:30:44 2022
From: no@p@m @end|ng |rom ||@@e@NA (Dr Eberhard W Lisse)
Date: Sun, 9 Oct 2022 23:30:44 +0200
Subject: [R] Reading Text files from UK Met Office into R again...
In-Reply-To: <CABxY9BNPKdWh=0TRqiQ_3UNqcvuzBToUQ5hRY8gLBZhYnnJLAA@mail.gmail.com>
References: <CABxY9BNPKdWh=0TRqiQ_3UNqcvuzBToUQ5hRY8gLBZhYnnJLAA@mail.gmail.com>
Message-ID: <thvei4$114j$2@ciao.gmane.io>

Does it say what the new format is?

On 2022-10-09 13:01 , Nick Wray wrote:
[...]
> Up to 2010 everything's fine and dandy - the data is in nice neat columns
> and I can download it and filter out what I don't want.  But after 2010 the
> format changes (The Met Office in fact say on their guidelines that it
> changes)  - it's still a text doc but instead of columns it seems to be one
> long vector.  Here is a short sample:
[...]


From j@zh@o @end|ng |rom ye@h@net  Mon Oct 10 03:01:36 2022
From: j@zh@o @end|ng |rom ye@h@net (Jinsong Zhao)
Date: Mon, 10 Oct 2022 09:01:36 +0800
Subject: [R] how to enlarge the legend
In-Reply-To: <0211aa20-1f31-719f-3165-b6f7b2534719@statistik.tu-dortmund.de>
References: <ec42dba5-5ea0-a029-20e9-3b77edd9c375@yeah.net>
 <0211aa20-1f31-719f-3165-b6f7b2534719@statistik.tu-dortmund.de>
Message-ID: <1cb44de8-69dc-100a-58cf-de4f15df97c0@yeah.net>

Thank you very much for the example. It works well.

Best,
Jinsong

On 2022/10/10 3:48, Uwe Ligges wrote:
> I'd propose:
> 
> plot.new()
> ltext <- "text"
> lobj <- legend("bottom", "", text.width=strwidth(ltext), fill = "gray", 
> cex = 2)
> text(lobj$text, ltext)
> 
> Best,
> Uwe Ligges
> 
> 
> On 09.10.2022 16:54, Jinsong Zhao wrote:
>> Hi there,
>>
>> in the following code, I'd like to enlarge the filled box but not the 
>> legend text.
>>
>> plot.new()
>>
>> legend("topleft", "text", fill = "gray") # filled box is too small
>>
>> legend("top", "text", fill = "gray", cex = 2) # filled box is ok but 
>> text is too large
>>
>> # I can use point to mimic filled box, but can not fill it with pattern
>>
>> legend("left", "text", pch = 22, pt.bg = "gray", pt.cex =3)
>>
>> I'd like to get filled box enlarged but with text not to be changed. 
>> Is it possible?
>>
>> Thanks in advance!
>>
>> Best,
>>
>> Jinsong
>>


From mputt @end|ng |rom pennmed|c|ne@upenn@edu  Mon Oct 10 02:34:07 2022
From: mputt @end|ng |rom pennmed|c|ne@upenn@edu (Putt, Mary)
Date: Mon, 10 Oct 2022 00:34:07 +0000
Subject: [R] Forestplot, grid graphics Viewplot grid.arange
Message-ID: <MN2PR04MB6702AE692142D79F71F213BC97209@MN2PR04MB6702.namprd04.prod.outlook.com>


I have created several plots using the forestplot package and the link shown here. <https://cran.r-project.org/web/packages/forestplot/vignettes/forestplot.html > Great package !
Next step is to combine two plots into a single graphic. The code provided on the link results in 'bleeding' of the graphics/text into each other. I don't want to clip it as I need the text elements. I am guessing the problem involves the combination of text and graphics in the 'plot'. I fooled around with the original post and also did some hunting online but no luck Thanks in advance.
library(foresplot)
data("dfHRQoL")

#create individual forest plots for Sweden and Denmark
fp_sweden <- dfHRQoL |>
  filter(group == "Sweden") |>
  mutate(est = sprintf("%.2f", mean), .after = labeltext) |>
  forestplot(labeltext = c(labeltext, est),
             title = "Sweden",
             clip = c(-.1, Inf),
             xlab = "EQ-5D index",
             new_page = FALSE)

fp_denmark <- dfHRQoL |>
  filter(group == "Denmark") |>
  mutate(est = sprintf("%.2f", mean), .after = labeltext) |>
  forestplot(labeltext = c(labeltext, est),
             title = "Denmark",
             clip = c(-.1, Inf),
             xlab = "EQ-5D index",
             new_page = FALSE)



#now combine into a single plot using the web code; but this one bleeds into each other
library(grid)

#####
#Put plots together using grid graphics
#Attempt 1 from website

#####
grid.newpage()
borderWidth <- unit(4, "pt")
width <- unit(convertX(unit(1, "npc") - borderWidth, unitTo = "npc", valueOnly = TRUE)/2, "npc")
pushViewport(viewport(layout = grid.layout(nrow = 1,
                                           ncol = 3,
                                           widths = unit.c(width,
                                                           borderWidth,
                                                           width))
)
)
pushViewport(viewport(layout.pos.row = 1,
                      layout.pos.col = 1))
fp_sweden
upViewport()
pushViewport(viewport(layout.pos.row = 1,
                      layout.pos.col = 2))
grid.rect(gp = gpar(fill = "grey", col = "red"))
upViewport()
pushViewport(viewport(layout.pos.row = 1,
                      layout.pos.col = 3))
fp_denmark
upViewport(2)


####
#Attempt 2 from website, still a problem.
####
grid.newpage()
borderWidth <- unit(4, "pt")
width <- unit(convertX(unit(1, "npc") - borderWidth, unitTo = "npc", valueOnly = TRUE)/2, "npc")
pushViewport(viewport(layout = grid.layout(nrow = 1,
                                           ncol = 3,
                                           widths = c(0.45, 0.1, 0.45))
)
)
pushViewport(viewport(layout.pos.row = 1,
                      layout.pos.col = 1))
fp_sweden
upViewport()

pushViewport(viewport(layout.pos.row = 1,
                      layout.pos.col = 3))
fp_denmark
upViewport(2)

###
#Attempt 3 converting to grobs and use patchwork
###
library(ggplotify)
library(patchwork)

fpd_grob <- grid2grob(print(fp_denmark))

p1 <- grid2grob(print(fp_denmark))
p2 <- grid2grob(print(fp_sweden))
p_both <- wrap_elements(p1) + wrap_elements(p2)
p_both

#same problem with grid.arrange()**strong text**



Mary Putt, PhD, ScD
Professor of Biostatistics
Department of Biostatistics, Epidemiology & Informatics
Pereleman School of Medicine
University of Pennsylvania

215-573-7020

	[[alternative HTML version deleted]]


From sibyiie@stoeckii m@iii@g oii gmx@ch  Mon Oct 10 15:32:33 2022
From: sibyiie@stoeckii m@iii@g oii gmx@ch (sibyiie@stoeckii m@iii@g oii gmx@ch)
Date: Mon, 10 Oct 2022 15:32:33 +0200
Subject: [R] ggplot2 install.package
Message-ID: <003d01d8dcac$c14c5340$43e4f9c0$@gmx.ch>

Dear R members

 

I am working with RStudio R 4.2.0 and using ggplot2 and gridExtra. 

Since some windows updates I get some error when loading  ggplot2.

*	It seems that I am able to install ggplot2. The problem is when
loading ggplot2 with library().
*	Do you have any ideas to solve the problem?

 

 

Kind regards

Sibylle

 

****************************************************************************
******************************

install.packages("ggplot2", dependencies = TRUE)

WARNING: Rtools is required to build R packages but is not currently
installed. Please download and install the appropriate version of Rtools
before proceeding:



https://cran.rstudio.com/bin/windows/Rtools/

Installiere Paket nach ?C:/Users/Sibylle
St?ckli/AppData/Local/R/win-library/4.2?

(da ?lib? nicht spezifiziert)

trying URL
'https://cran.rstudio.com/bin/windows/contrib/4.2/ggplot2_3.3.6.zip'

Content type 'application/zip' length 4122980 bytes (3.9 MB)

downloaded 3.9 MB



Paket ?ggplot2? erfolgreich ausgepackt und MD5 Summen abgeglichen



Die heruntergeladenen Bin?rpakete sind in 

                C:\Users\Sibylle
St?ckli\AppData\Local\Temp\RtmpcBknba\downloaded_packages

Error in nchar(homeDir) : invalid multibyte string, element 1


	[[alternative HTML version deleted]]


From tebert @end|ng |rom u||@edu  Tue Oct 11 02:42:03 2022
From: tebert @end|ng |rom u||@edu (Ebert,Timothy Aaron)
Date: Tue, 11 Oct 2022 00:42:03 +0000
Subject: [R] ggplot2 install.package
In-Reply-To: <003d01d8dcac$c14c5340$43e4f9c0$@gmx.ch>
References: <003d01d8dcac$c14c5340$43e4f9c0$@gmx.ch>
Message-ID: <BN6PR2201MB1553B1367546A8CD29ACE91DCF239@BN6PR2201MB1553.namprd22.prod.outlook.com>

Can you please provide us with a copy of the error msg? I have used ggplot2 with R 4.2.1, and probably R 4.2.0 in RStudio on Windows 11 and not had trouble. You might need to update R, or RStudio. R and RStudio need to be compatible versions.

Tim

-----Original Message-----
From: R-help <r-help-bounces at r-project.org> On Behalf Of sibylle.stoeckli at gmx.ch
Sent: Monday, October 10, 2022 9:33 AM
To: R-help at r-project.org
Subject: [R] ggplot2 install.package

[External Email]

Dear R members



I am working with RStudio R 4.2.0 and using ggplot2 and gridExtra.

Since some windows updates I get some error when loading  ggplot2.

*       It seems that I am able to install ggplot2. The problem is when
loading ggplot2 with library().
*       Do you have any ideas to solve the problem?





Kind regards

Sibylle



****************************************************************************
******************************

install.packages("ggplot2", dependencies = TRUE)

WARNING: Rtools is required to build R packages but is not currently installed. Please download and install the appropriate version of Rtools before proceeding:



https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fcran.rstudio.com%2Fbin%2Fwindows%2FRtools%2F&amp;data=05%7C01%7Ctebert%40ufl.edu%7C05f8820150e648d4f29108daab015484%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638010323276937614%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000%7C%7C%7C&amp;sdata=PKqDjS%2FEfL4Mtho3TRywJUuy%2FpGQ9A3seBjgGr6IScM%3D&amp;reserved=0

Installiere Paket nach  C:/Users/Sibylle St ckli/AppData/Local/R/win-library/4.2 

(da  lib  nicht spezifiziert)

trying URL
'https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fcran.rstudio.com%2Fbin%2Fwindows%2Fcontrib%2F4.2%2Fggplot2_3.3.6.zip&amp;data=05%7C01%7Ctebert%40ufl.edu%7C05f8820150e648d4f29108daab015484%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638010323276937614%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000%7C%7C%7C&amp;sdata=b5dcFImQLYrE850p5SnbOyibj9KV0JrZIvfL8trNI84%3D&amp;reserved=0'

Content type 'application/zip' length 4122980 bytes (3.9 MB)

downloaded 3.9 MB



Paket  ggplot2  erfolgreich ausgepackt und MD5 Summen abgeglichen



Die heruntergeladenen Bin rpakete sind in

                C:\Users\Sibylle
St ckli\AppData\Local\Temp\RtmpcBknba\downloaded_packages

Error in nchar(homeDir) : invalid multibyte string, element 1


        [[alternative HTML version deleted]]


From sibyiie@stoeckii m@iii@g oii gmx@ch  Tue Oct 11 08:01:10 2022
From: sibyiie@stoeckii m@iii@g oii gmx@ch (sibyiie@stoeckii m@iii@g oii gmx@ch)
Date: Tue, 11 Oct 2022 08:01:10 +0200
Subject: [R] ggplot2 install.package
In-Reply-To: <BN6PR2201MB1553B1367546A8CD29ACE91DCF239@BN6PR2201MB1553.namprd22.prod.outlook.com>
References: <003d01d8dcac$c14c5340$43e4f9c0$@gmx.ch>
 <BN6PR2201MB1553B1367546A8CD29ACE91DCF239@BN6PR2201MB1553.namprd22.prod.outlook.com>
Message-ID: <008b01d8dd36$dce53150$96af93f0$@gmx.ch>

Dear R users

Thanks a lot. I will try again. The error code was below the email, but there was some encryption:
- Error in nchar(homeDir:invalid multibyte string, element 1
- I realised that I was able to install ggplot2, but the error is afterwards when loading ggplot2 (library()). 

Kind regards
Sibylle

install.packages("ggplot2", dependencies = TRUE)
WARNING: Rtools is required to build R packages but is not currently installed. Please download and install the appropriate version of Rtools before proceeding:

Installiere Paket nach ?C:/Users/Sibylle St?ckli/AppData/Local/R/win-library/4.2?
(da ?lib? nicht spezifiziert)
trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.2/ggplot2_3.3.6.zip'
Content type 'application/zip' length 4122980 bytes (3.9 MB)
downloaded 3.9 MB

Paket ?ggplot2? erfolgreich ausgepackt und MD5 Summen abgeglichen

Die heruntergeladenen Bin?rpakete sind in 
                C:\Users\Sibylle St?ckli\AppData\Local\Temp\RtmpcBknba\downloaded_packages
Error in nchar(homeDir) : invalid multibyte string, element 1

-----Urspr?ngliche Nachricht-----
Von: Ebert,Timothy Aaron <tebert at ufl.edu> 
Gesendet: Dienstag, 11. Oktober 2022 02:42
An: sibylle.stoeckli at gmx.ch; R-help at r-project.org
Betreff: RE: [R] ggplot2 install.package

Can you please provide us with a copy of the error msg? I have used ggplot2 with R 4.2.1, and probably R 4.2.0 in RStudio on Windows 11 and not had trouble. You might need to update R, or RStudio. R and RStudio need to be compatible versions.

Tim

-----Original Message-----
From: R-help <r-help-bounces at r-project.org> On Behalf Of sibylle.stoeckli at gmx.ch
Sent: Monday, October 10, 2022 9:33 AM
To: R-help at r-project.org
Subject: [R] ggplot2 install.package

[External Email]

Dear R members



I am working with RStudio R 4.2.0 and using ggplot2 and gridExtra.

Since some windows updates I get some error when loading  ggplot2.

*       It seems that I am able to install ggplot2. The problem is when
loading ggplot2 with library().
*       Do you have any ideas to solve the problem?





Kind regards

Sibylle



****************************************************************************
******************************

install.packages("ggplot2", dependencies = TRUE)

WARNING: Rtools is required to build R packages but is not currently installed. Please download and install the appropriate version of Rtools before proceeding:



https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fcran.rstudio.com%2Fbin%2Fwindows%2FRtools%2F&amp;data=05%7C01%7Ctebert%40ufl.edu%7C05f8820150e648d4f29108daab015484%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638010323276937614%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000%7C%7C%7C&amp;sdata=PKqDjS%2FEfL4Mtho3TRywJUuy%2FpGQ9A3seBjgGr6IScM%3D&amp;reserved=0

Installiere Paket nach  C:/Users/Sibylle St ckli/AppData/Local/R/win-library/4.2 

(da  lib  nicht spezifiziert)

trying URL
'https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fcran.rstudio.com%2Fbin%2Fwindows%2Fcontrib%2F4.2%2Fggplot2_3.3.6.zip&amp;data=05%7C01%7Ctebert%40ufl.edu%7C05f8820150e648d4f29108daab015484%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638010323276937614%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000%7C%7C%7C&amp;sdata=b5dcFImQLYrE850p5SnbOyibj9KV0JrZIvfL8trNI84%3D&amp;reserved=0'

Content type 'application/zip' length 4122980 bytes (3.9 MB)

downloaded 3.9 MB



Paket  ggplot2  erfolgreich ausgepackt und MD5 Summen abgeglichen



Die heruntergeladenen Bin rpakete sind in

                C:\Users\Sibylle
St ckli\AppData\Local\Temp\RtmpcBknba\downloaded_packages

Error in nchar(homeDir) : invalid multibyte string, element 1


        [[alternative HTML version deleted]]


From @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org  Tue Oct 11 08:15:52 2022
From: @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org (Spencer Graves)
Date: Tue, 11 Oct 2022 01:15:52 -0500
Subject: [R] ggplot2 install.package
In-Reply-To: <008b01d8dd36$dce53150$96af93f0$@gmx.ch>
References: <003d01d8dcac$c14c5340$43e4f9c0$@gmx.ch>
 <BN6PR2201MB1553B1367546A8CD29ACE91DCF239@BN6PR2201MB1553.namprd22.prod.outlook.com>
 <008b01d8dd36$dce53150$96af93f0$@gmx.ch>
Message-ID: <155c1efe-fe32-8c7a-3b0e-d54fce63601c@effectivedefense.org>

	  From long and unhappy experience, I routinely reboot before reporting 
problems like this, then upgrade all software where feasible ... 
including "update.packages".  Some problems magically disappear after 
doing this.


	  If they persist, then, as it says at the end of each email on this 
thread, "PLEASE do read the posting guide 
http://www.R-project.org/posting-guide.html and provide commented, 
minimal, self-contained, reproducible code."  If you do that, it 
increases the chances that the help you get will actually be helpful ;-)


	  Spencer


On 10/11/22 1:01 AM, sibylle.stoeckli at gmx.ch wrote:
> Dear R users
> 
> Thanks a lot. I will try again. The error code was below the email, but there was some encryption:
> - Error in nchar(homeDir:invalid multibyte string, element 1
> - I realised that I was able to install ggplot2, but the error is afterwards when loading ggplot2 (library()).
> 
> Kind regards
> Sibylle
> 
> install.packages("ggplot2", dependencies = TRUE)
> WARNING: Rtools is required to build R packages but is not currently installed. Please download and install the appropriate version of Rtools before proceeding:
> 
> Installiere Paket nach ?C:/Users/Sibylle St?ckli/AppData/Local/R/win-library/4.2?
> (da ?lib? nicht spezifiziert)
> trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.2/ggplot2_3.3.6.zip'
> Content type 'application/zip' length 4122980 bytes (3.9 MB)
> downloaded 3.9 MB
> 
> Paket ?ggplot2? erfolgreich ausgepackt und MD5 Summen abgeglichen
> 
> Die heruntergeladenen Bin?rpakete sind in
>                  C:\Users\Sibylle St?ckli\AppData\Local\Temp\RtmpcBknba\downloaded_packages
> Error in nchar(homeDir) : invalid multibyte string, element 1
> 
> -----Urspr?ngliche Nachricht-----
> Von: Ebert,Timothy Aaron <tebert at ufl.edu>
> Gesendet: Dienstag, 11. Oktober 2022 02:42
> An: sibylle.stoeckli at gmx.ch; R-help at r-project.org
> Betreff: RE: [R] ggplot2 install.package
> 
> Can you please provide us with a copy of the error msg? I have used ggplot2 with R 4.2.1, and probably R 4.2.0 in RStudio on Windows 11 and not had trouble. You might need to update R, or RStudio. R and RStudio need to be compatible versions.
> 
> Tim
> 
> -----Original Message-----
> From: R-help <r-help-bounces at r-project.org> On Behalf Of sibylle.stoeckli at gmx.ch
> Sent: Monday, October 10, 2022 9:33 AM
> To: R-help at r-project.org
> Subject: [R] ggplot2 install.package
> 
> [External Email]
> 
> Dear R members
> 
> 
> 
> I am working with RStudio R 4.2.0 and using ggplot2 and gridExtra.
> 
> Since some windows updates I get some error when loading  ggplot2.
> 
> *       It seems that I am able to install ggplot2. The problem is when
> loading ggplot2 with library().
> *       Do you have any ideas to solve the problem?
> 
> 
> 
> 
> 
> Kind regards
> 
> Sibylle
> 
> 
> 
> ****************************************************************************
> ******************************
> 
> install.packages("ggplot2", dependencies = TRUE)
> 
> WARNING: Rtools is required to build R packages but is not currently installed. Please download and install the appropriate version of Rtools before proceeding:
> 
> 
> 
> https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fcran.rstudio.com%2Fbin%2Fwindows%2FRtools%2F&amp;data=05%7C01%7Ctebert%40ufl.edu%7C05f8820150e648d4f29108daab015484%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638010323276937614%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000%7C%7C%7C&amp;sdata=PKqDjS%2FEfL4Mtho3TRywJUuy%2FpGQ9A3seBjgGr6IScM%3D&amp;reserved=0
> 
> Installiere Paket nach  C:/Users/Sibylle St ckli/AppData/Local/R/win-library/4.2
> 
> (da  lib  nicht spezifiziert)
> 
> trying URL
> 'https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fcran.rstudio.com%2Fbin%2Fwindows%2Fcontrib%2F4.2%2Fggplot2_3.3.6.zip&amp;data=05%7C01%7Ctebert%40ufl.edu%7C05f8820150e648d4f29108daab015484%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638010323276937614%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000%7C%7C%7C&amp;sdata=b5dcFImQLYrE850p5SnbOyibj9KV0JrZIvfL8trNI84%3D&amp;reserved=0'
> 
> Content type 'application/zip' length 4122980 bytes (3.9 MB)
> 
> downloaded 3.9 MB
> 
> 
> 
> Paket  ggplot2  erfolgreich ausgepackt und MD5 Summen abgeglichen
> 
> 
> 
> Die heruntergeladenen Bin rpakete sind in
> 
>                  C:\Users\Sibylle
> St ckli\AppData\Local\Temp\RtmpcBknba\downloaded_packages
> 
> Error in nchar(homeDir) : invalid multibyte string, element 1
> 
> 
>          [[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From kry|ov@r00t @end|ng |rom gm@||@com  Tue Oct 11 09:18:32 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 11 Oct 2022 10:18:32 +0300
Subject: [R] ggplot2 install.package
In-Reply-To: <003d01d8dcac$c14c5340$43e4f9c0$@gmx.ch>
References: <003d01d8dcac$c14c5340$43e4f9c0$@gmx.ch>
Message-ID: <20221011101832.6faadd81@Tarkus>

On Mon, 10 Oct 2022 15:32:33 +0200
<sibylle.stoeckli at gmx.ch> wrote:

> Error in nchar(homeDir) : invalid multibyte string, element 1

I searched for nchar(homeDir) in the R source code and on CRAN (as
indexed by GitHub), and the only CRAN match was probably unrelated (in
the ibmdbR package).

There's also a few matches in the RStudio source code:
https://github.com/rstudio/rstudio/blob/3742521ab2e67528090358a42d9f13933f4400df/src/cpp/session/modules/SessionPackages.R

A search of "nchar(homeDir)" on RStudio website gives a lot of
seemingly relevant results.

However, I don't see them doing anything obviously wrong. This could be
related to stricter handling of invalid strings that was recently
improved in R:
https://blog.r-project.org/2022/10/10/improvements-in-handling-bytes-encoding/

What does path.expand("~/") return on your machine? What is Encoding(.)
of the value? What are its actual byte values, i.e. charToRaw(.)? What
is your sessionInfo()?

-- 
Best regards,
Ivan


From @@h|mk@poor @end|ng |rom gm@||@com  Wed Oct 12 13:48:26 2022
From: @@h|mk@poor @end|ng |rom gm@||@com (Ashim Kapoor)
Date: Wed, 12 Oct 2022 17:18:26 +0530
Subject: [R] prcomp - arbitrary direction of the returned principal
 components
Message-ID: <CAC8=1eqUJoYUqq_bDeUCpWL79ootuV44+oSkZ5=oPHnrCsGY5Q@mail.gmail.com>

Dear R experts,

>From ?prcomp,

---- snip -----
Note:

     The signs of the columns of the rotation matrix are arbitrary, and
     so may differ between different programs for PCA, and even between
     different builds of R.
---- snip ------

My problem is that I am building an index based on Principal
Components Analysis.
When the index is high it should indicate stress in the market. Due to
the arbitrary sign sometimes I get an index which is HIGH when there
is stress and sometimes I get  the OPPOSITE - an index which is LOW
when there is stress.
This program is shared with other people who may have a different build of R.

I can forcefully use a NEGATIVE sign to FLIP the index when it is LOW.
That works.

Now my query is : Just like we do set.seed(1234) and force the pattern
of generation of random number and make it REPRODUCIBLE, can I do
something like :

set.direction.for.vector.in.pca(1234)

Now each time I do prcomp it should choose the SAME ( high or low )
direction of the principle component on ANY computer having ANY
version of R installed.

That's what I want. I don't want the the returned principal component
to be HIGH(LOW) on my computer and LOW(HIGH) on someone else's
computer.
That would confuse the people the code is shared with.

Is this possible ? How do people deal with this ?

Many thanks,
Ashim


From tebert @end|ng |rom u||@edu  Wed Oct 12 13:53:06 2022
From: tebert @end|ng |rom u||@edu (Ebert,Timothy Aaron)
Date: Wed, 12 Oct 2022 11:53:06 +0000
Subject: [R] prcomp - arbitrary direction of the returned principal
 components
In-Reply-To: <CAC8=1eqUJoYUqq_bDeUCpWL79ootuV44+oSkZ5=oPHnrCsGY5Q@mail.gmail.com>
References: <CAC8=1eqUJoYUqq_bDeUCpWL79ootuV44+oSkZ5=oPHnrCsGY5Q@mail.gmail.com>
Message-ID: <BN6PR2201MB15533913DCFC93FB55E87351CF229@BN6PR2201MB1553.namprd22.prod.outlook.com>

Use absolute value

Tim

-----Original Message-----
From: R-help <r-help-bounces at r-project.org> On Behalf Of Ashim Kapoor
Sent: Wednesday, October 12, 2022 7:48 AM
To: R Help <r-help at r-project.org>
Subject: [R] prcomp - arbitrary direction of the returned principal components

[External Email]

Dear R experts,

>From ?prcomp,

---- snip -----
Note:

     The signs of the columns of the rotation matrix are arbitrary, and
     so may differ between different programs for PCA, and even between
     different builds of R.
---- snip ------

My problem is that I am building an index based on Principal Components Analysis.
When the index is high it should indicate stress in the market. Due to the arbitrary sign sometimes I get an index which is HIGH when there is stress and sometimes I get  the OPPOSITE - an index which is LOW when there is stress.
This program is shared with other people who may have a different build of R.

I can forcefully use a NEGATIVE sign to FLIP the index when it is LOW.
That works.

Now my query is : Just like we do set.seed(1234) and force the pattern of generation of random number and make it REPRODUCIBLE, can I do something like :

set.direction.for.vector.in.pca(1234)

Now each time I do prcomp it should choose the SAME ( high or low ) direction of the principle component on ANY computer having ANY version of R installed.

That's what I want. I don't want the the returned principal component to be HIGH(LOW) on my computer and LOW(HIGH) on someone else's computer.
That would confuse the people the code is shared with.

Is this possible ? How do people deal with this ?

Many thanks,
Ashim

______________________________________________
R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl.edu%7C258ecdf67d1342e9785508daac47cdf3%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638011721656997427%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=Jh00DHZnx%2FbRGgsdqkgEp7qcMzzqcjhxYfJGF1d13PI%3D&amp;reserved=0
PLEASE do read the posting guide https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%7C258ecdf67d1342e9785508daac47cdf3%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638011721656997427%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=p%2BYrpIUZTD1msNJFsE34J1iLCt8yAPsCe334GKm%2BAtk%3D&amp;reserved=0
and provide commented, minimal, self-contained, reproducible code.


From dw|n@em|u@ @end|ng |rom comc@@t@net  Wed Oct 12 17:02:26 2022
From: dw|n@em|u@ @end|ng |rom comc@@t@net (David Winsemius)
Date: Wed, 12 Oct 2022 16:02:26 +0100
Subject: [R] Reading Text files from UK Met Office into R again...
In-Reply-To: <20221009185041.1fcd708c@Tarkus>
References: <CABxY9BNPKdWh=0TRqiQ_3UNqcvuzBToUQ5hRY8gLBZhYnnJLAA@mail.gmail.com>
 <20221009185041.1fcd708c@Tarkus>
Message-ID: <D389E2D5-CC9A-427D-9043-8111DD15BE19@comcast.net>

First one needs to remove the extraneous line-ends that you created by using an editor that inserts those line-ends (or perhaps it was your mail-client that added them because you failed to post in plain-text. I removed those files "by hand" and then created a text "file".

txt <- "2015-01-01 00:00, 03002, WMO, SYNOP, 1, 12, 1011, 4, 7, 200, 18, 82, , , 8, , , , , 100, 450, 1005.4, 5, , 102, 4, , 129, , , , , , , , 8.7, 7.5, 8.1,1003.6, , , , , , , 1, 1, 1, , , 1, , , , , 1, 1, 1, 1, 1, 1, , 1, , 1, 1, , , , , , , , , , 1, , , , , 2014-12-31 23:53, 0, , , , , , , , , , , , K, , , , , 91.7, A, , , ,
2015-01-01 00:00, 03005, WMO, SYNOP, 1, 9, 1011, 4, 1, 210, 26, 62, 8, 6, ,8, 8, , , 8, 30, 700, 1006, 1, 8, 54, 7, 6, 105, , , , , , , , 8.6, 7.3, 8, 996.1, , 01, , , , , 1, 1, 1, 1, 1, 1, 1, , , 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, , , , , , , , 1, , , , , 2014-12-31 23:55, 0, , , , , , , , , , , , K, , , , , 91.7, A, , , 0, 1
2015-01-01 00:00, 03006, WMO, SYNOP, 1, 10, 1011, 4, 6, 210, 23, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , 1, 1, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , 2014-12-31 23:53, 0, , , , , , , , , , , , , , , , , , A, , , ,
2015-01-01 00:00, 03010, WMO, SYNOP, 1, 17, 1011, 4, 6, 230, 21, , , , , , , , , , , 1006.1, , , , , , , , , , , , , , 9.4, 6.2, 7.9, , , , , , , , 1, 1, , , , , , , , , , , 1, 1, 1, 1, , , , , , , , , , , , , , , , , , , ,"

# Then use `count.fields`
count.fields(file=textConnection(txt))
[1] 104 106 105  81

# So i'm guessing you arbitrarily snipped in the middl of own of the text lines

dat <- read.table(text=txt, sep=",", fill=TRUE, row.names=NULL, head=FALSE)
 str(dat)
'data.frame':	4 obs. of  105 variables:
 $ V1  : chr  "2015-01-01 00:00" "2015-01-01 00:00" "2015-01-01 00:00" "2015-01-01 00:00"
 $ V2  : int  3002 3005 3006 3010
 $ V3  : chr  " WMO" " WMO" " WMO" " WMO"
 $ V4  : chr  " SYNOP" " SYNOP" " SYNOP" " SYNOP"
 $ V5  : int  1 1 1 1
 $ V6  : int  12 9 10 17
 $ V7  : int  1011 1011 1011 1011
 $ V8  : int  4 4 4 4
 $ V9  : int  7 1 6 6
 $ V10 : int  200 210 210 230
 $ V11 : int  18 26 23 21
 $ V12 : int  82 62 NA NA
 $ V13 : int  NA 8 NA NA
 $ V14 : int  NA 6 NA NA
 $ V15 : int  8 NA NA NA
 $ V16 : int  NA 8 NA NA
 $ V17 : int  NA 8 NA NA
 $ V18 : logi  NA NA NA NA
 $ V19 : logi  NA NA NA NA
 $ V20 : int  100 8 NA NA
 #snipped about 80 lines .......
 $ V99 : num  91.7 NA NA NA
  [list output truncated]


ALWAYS use a programming editor and always post in plain-text.

-- David.

> On Oct 9, 2022, at 4:50 PM, Ivan Krylov <krylov.r00t at gmail.com> wrote:
> 
> On Sun, 9 Oct 2022 12:01:27 +0100
> Nick Wray <nickmwray at gmail.com> wrote:
> 
>> Error in read.table("midas_wxhrly_201501-201512.txt", fill = T) :
>>  duplicate 'row.names' are not allowed
> 
> Since you don't pass the `header` argument, I think that the automatic
> header detection is here at play. This is what ?read.table has to say
> about row names:
> 
>>> If there is a header and the first row contains one fewer field than
>>> the number of columns, the first column in the input is used for the
>>> row names.  Otherwise if ?row.names? is missing, the rows are
>>> numbered.
> 
> Perhaps the "one fewer field in the header than the number of columns"
> condition is true for files after 2010? I'm too lazy to sign up for a
> CEDA account and I'm not sure I'd be given access to hourly datasets
> anyway.
> 
> If this is the reason for the failure (first column used as rownames()
> and turns out to be non-unique), there's an easy way to fix that:
> 
>>> Using ?row.names = NULL? forces row numbering.
> 
> I don't see a header in your example. If there's actually no header
> containing column names, passing `header = FALSE` will both prevent the
> error and avoid eating the first line of the file.
> 
> -- 
> Best regards,
> Ivan
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From @@h|mk@poor @end|ng |rom gm@||@com  Thu Oct 13 06:28:25 2022
From: @@h|mk@poor @end|ng |rom gm@||@com (Ashim Kapoor)
Date: Thu, 13 Oct 2022 09:58:25 +0530
Subject: [R] prcomp - arbitrary direction of the returned principal
 components
In-Reply-To: <BN6PR2201MB15533913DCFC93FB55E87351CF229@BN6PR2201MB1553.namprd22.prod.outlook.com>
References: <CAC8=1eqUJoYUqq_bDeUCpWL79ootuV44+oSkZ5=oPHnrCsGY5Q@mail.gmail.com>
 <BN6PR2201MB15533913DCFC93FB55E87351CF229@BN6PR2201MB1553.namprd22.prod.outlook.com>
Message-ID: <CAC8=1epb18uQ9yPvA98dTkCoqnszfB6Ys61Ej3LouMo3jRMzjA@mail.gmail.com>

Dear Aaron,

Many thanks for your reply.

Please allow me to illustrate my query a bit.

I take some data, throw it to prcomp and extract the x data frame from prcomp.

>From ?prcomp:

       x: if ?retx? is true the value of the rotated data (the centred
          (and scaled if requested) data multiplied by the ?rotation?
          matrix) is returned.  Hence, ?cov(x)? is the diagonal matrix
          ?diag(sdev^2)?.  For the formula method, ?napredict()? is
          applied to handle the treatment of values omitted by the
          ?na.action?.

I consider x[,1] as my index. This makes sense as x[,1] is the
projection of the data on the FIRST principal component.
Now this x[,1] can be a high +ve number or a low -ve number. I can't
ignore the sign.

If I ignore the sign by taking the absolute value, the HIGH / LOW
stress values will be indistinguishable.

Hence I do not think using absolute values of x[,1] is the solution.
Yes it will make the results REPRODUCIBLE but that will be at the cost
of losing information.

Any other idea ?

Many thanks,
Ashim

On Wed, Oct 12, 2022 at 5:23 PM Ebert,Timothy Aaron <tebert at ufl.edu> wrote:
>
> Use absolute value
>
> Tim
>
> -----Original Message-----
> From: R-help <r-help-bounces at r-project.org> On Behalf Of Ashim Kapoor
> Sent: Wednesday, October 12, 2022 7:48 AM
> To: R Help <r-help at r-project.org>
> Subject: [R] prcomp - arbitrary direction of the returned principal components
>
> [External Email]
>
> Dear R experts,
>
> From ?prcomp,
>
> ---- snip -----
> Note:
>
>      The signs of the columns of the rotation matrix are arbitrary, and
>      so may differ between different programs for PCA, and even between
>      different builds of R.
> ---- snip ------
>
> My problem is that I am building an index based on Principal Components Analysis.
> When the index is high it should indicate stress in the market. Due to the arbitrary sign sometimes I get an index which is HIGH when there is stress and sometimes I get  the OPPOSITE - an index which is LOW when there is stress.
> This program is shared with other people who may have a different build of R.
>
> I can forcefully use a NEGATIVE sign to FLIP the index when it is LOW.
> That works.
>
> Now my query is : Just like we do set.seed(1234) and force the pattern of generation of random number and make it REPRODUCIBLE, can I do something like :
>
> set.direction.for.vector.in.pca(1234)
>
> Now each time I do prcomp it should choose the SAME ( high or low ) direction of the principle component on ANY computer having ANY version of R installed.
>
> That's what I want. I don't want the the returned principal component to be HIGH(LOW) on my computer and LOW(HIGH) on someone else's computer.
> That would confuse the people the code is shared with.
>
> Is this possible ? How do people deal with this ?
>
> Many thanks,
> Ashim
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl.edu%7C258ecdf67d1342e9785508daac47cdf3%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638011721656997427%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=Jh00DHZnx%2FbRGgsdqkgEp7qcMzzqcjhxYfJGF1d13PI%3D&amp;reserved=0
> PLEASE do read the posting guide https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%7C258ecdf67d1342e9785508daac47cdf3%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638011721656997427%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=p%2BYrpIUZTD1msNJFsE34J1iLCt8yAPsCe334GKm%2BAtk%3D&amp;reserved=0
> and provide commented, minimal, self-contained, reproducible code.


From chr|@ho|d @end|ng |rom p@yctc@org  Thu Oct 13 08:19:28 2022
From: chr|@ho|d @end|ng |rom p@yctc@org (Chris Evans)
Date: Thu, 13 Oct 2022 08:19:28 +0200
Subject: [R] prcomp - arbitrary direction of the returned principal
 components
In-Reply-To: <CAC8=1epb18uQ9yPvA98dTkCoqnszfB6Ys61Ej3LouMo3jRMzjA@mail.gmail.com>
References: <CAC8=1eqUJoYUqq_bDeUCpWL79ootuV44+oSkZ5=oPHnrCsGY5Q@mail.gmail.com>
 <BN6PR2201MB15533913DCFC93FB55E87351CF229@BN6PR2201MB1553.namprd22.prod.outlook.com>
 <CAC8=1epb18uQ9yPvA98dTkCoqnszfB6Ys61Ej3LouMo3jRMzjA@mail.gmail.com>
Message-ID: <0383cb4cd77c988d9c0c02f978446c0ffe0b94b6.camel@psyctc.org>

I agree with this and I'm not very sure why you feel you need the signs
fixed one way: they are arbitrary and how they come out is generally a
function of things in the handling of rounding as values hit the limit
of the finite arithmetic in the particular program and OS and hardware
on which it's running.? Can't you just say that?!

If you must have it aligned one way then I think the only thing you can
do is to select the row/item/variable with the highest absolute loading
on the component and set that to be positive (say, whether you choose
positive or negative is up to you).? I think this does it:

### create some data to analyse
set.seed(12345)
n <- 500 # number of observations
k <- 8 # number of variables
fuzz <- .1 # used to add noise
varLatent <- rnorm(n) # create the values of the dominant PC
vecLoadings <- c(rep(1, k/2), rep(-1, k/2)) # binary loadings 

### make the raw data
matData <- matrix(rep(NA, n * k), ncol = k)
for (i in 1:k) {
? matData[, i] <- vecLoadings[i] * varLatent + rnorm(n, fuzz)
}
head(matData)

### get the PCA
matPrcomp <- prcomp(matData)$rotation
round(matPrcomp, 2)
# PC1?? PC2?? PC3?? PC4?? PC5?? PC6?? PC7?? PC8
# [1,]? 0.34? 0.00 -0.74? 0.32 -0.38 -0.25? 0.15? 0.00
# [2,]? 0.37 -0.19? 0.49? 0.33 -0.57? 0.38? 0.07 -0.01
# [3,]? 0.34? 0.80? 0.14? 0.11? 0.10 -0.05 -0.16 -0.43
# [4,]? 0.33 -0.47 -0.16? 0.10? 0.34? 0.17 -0.61 -0.35
# [5,] -0.35? 0.15 -0.15 -0.34 -0.61? 0.10 -0.57 -0.08
# [6,] -0.37 -0.25? 0.11? 0.13 -0.14 -0.30? 0.27 -0.77
# [7,] -0.35? 0.07? 0.17? 0.72? 0.04 -0.32 -0.38? 0.28
# [8,] -0.38? 0.17 -0.32? 0.33? 0.14? 0.75? 0.16 -0.12

### find the sign of the maximum absolute loading for each component
vecMaxItemSigns <- apply(matPrcomp, 2,
function(x){sign(x[(which.max(abs(x)))])})
vecMaxItemSigns
# PC1 PC2 PC3 PC4 PC5 PC6 PC7 PC8 
# -1?? 1? -1?? 1? -1?? 1? -1? -1

### now use that to create a new PCA where the strongest loadings are
always positive
newMatPrcomp <- matrix(rep(NA, k * k), ncol = k)
colnames(newMatPrcomp) <- colnames(matPrcomp)
rownames(newMatPrcomp) <- rownames(matPrcomp)
for (i in 1:k) {
? newMatPrcomp[, i] <- matPrcomp[, i] * vecMaxItems[i]
}
round(newMatPrcomp, 2)
# PC1?? PC2?? PC3?? PC4?? PC5?? PC6?? PC7?? PC8
# [1,] -0.34? 0.00? 0.74? 0.32? 0.38 -0.25 -0.15? 0.00
# [2,] -0.37 -0.19 -0.49? 0.33? 0.57? 0.38 -0.07? 0.01
# [3,] -0.34? 0.80 -0.14? 0.11 -0.10 -0.05? 0.16? 0.43
# [4,] -0.33 -0.47? 0.16? 0.10 -0.34? 0.17? 0.61? 0.35
# [5,]? 0.35? 0.15? 0.15 -0.34? 0.61? 0.10? 0.57? 0.08
# [6,]? 0.37 -0.25 -0.11? 0.13? 0.14 -0.30 -0.27? 0.77
# [7,]? 0.35? 0.07 -0.17? 0.72 -0.04 -0.32? 0.38 -0.28
# [8,]? 0.38? 0.17? 0.32? 0.33 -0.14? 0.75 -0.16? 0.12


Apologies for the coding: I'm a better therapist than coder and
it's a while since I've done much in base R like this.? Quite fun
to get back to it!? R artistes can probably do that in four lines!

But I'm not convinced doing this to "fix" the signs is really 
worth it however many lines one uses to code it!!

Very best all,

Chris

?On Thu, 2022-10-13 at 09:58 +0530, Ashim Kapoor wrote:
> Dear Aaron,
> 
> Many thanks for your reply.
> 
> Please allow me to illustrate my query a bit.
> 
> I take some data, throw it to prcomp and extract the x data frame
> from prcomp.
> 
> From ?prcomp:
> 
> ?????? x: if ?retx? is true the value of the rotated data (the
> centred
> ????????? (and scaled if requested) data multiplied by the ?rotation?
> ????????? matrix) is returned.? Hence, ?cov(x)? is the diagonal
> matrix
> ????????? ?diag(sdev^2)?.? For the formula method, ?napredict()? is
> ????????? applied to handle the treatment of values omitted by the
> ????????? ?na.action?.
> 
> I consider x[,1] as my index. This makes sense as x[,1] is the
> projection of the data on the FIRST principal component.
> Now this x[,1] can be a high +ve number or a low -ve number. I can't
> ignore the sign.
> 
> If I ignore the sign by taking the absolute value, the HIGH / LOW
> stress values will be indistinguishable.
> 
> Hence I do not think using absolute values of x[,1] is the solution.
> Yes it will make the results REPRODUCIBLE but that will be at the
> cost
> of losing information.
> 
> Any other idea ?
> 
> Many thanks,
> Ashim
> 
> On Wed, Oct 12, 2022 at 5:23 PM Ebert,Timothy Aaron <tebert at ufl.edu>
> wrote:
> > 
> > Use absolute value
> > 
> > Tim
> > 
> > -----Original Message-----
> > From: R-help <r-help-bounces at r-project.org> On Behalf Of Ashim
> > Kapoor
> > Sent: Wednesday, October 12, 2022 7:48 AM
> > To: R Help <r-help at r-project.org>
> > Subject: [R] prcomp - arbitrary direction of the returned principal
> > components
> > 
> > [External Email]
> > 
> > Dear R experts,
> > 
> > From ?prcomp,
> > 
> > ---- snip -----
> > Note:
> > 
> > ???? The signs of the columns of the rotation matrix are arbitrary,
> > and
> > ???? so may differ between different programs for PCA, and even
> > between
> > ???? different builds of R.
> > ---- snip ------
> > 
> > My problem is that I am building an index based on Principal
> > Components Analysis.
> > When the index is high it should indicate stress in the market. Due
> > to the arbitrary sign sometimes I get an index which is HIGH when
> > there is stress and sometimes I get? the OPPOSITE - an index which
> > is LOW when there is stress.
> > This program is shared with other people who may have a different
> > build of R.
> > 
> > I can forcefully use a NEGATIVE sign to FLIP the index when it is
> > LOW.
> > That works.
> > 
> > Now my query is : Just like we do set.seed(1234) and force the
> > pattern of generation of random number and make it REPRODUCIBLE,
> > can I do something like :
> > 
> > set.direction.for.vector.in.pca(1234)
> > 
> > Now each time I do prcomp it should choose the SAME ( high or low )
> > direction of the principle component on ANY computer having ANY
> > version of R installed.
> > 
> > That's what I want. I don't want the the returned principal
> > component to be HIGH(LOW) on my computer and LOW(HIGH) on someone
> > else's computer.
> > That would confuse the people the code is shared with.
> > 
> > Is this possible ? How do people deal with this ?
> > 
> > Many thanks,
> > Ashim
> > 
> > 
> 
> ______________________________________________
> R-help at r-project.org?mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-
> guide.html
> and provide commented, minimal, self-contained, reproducible code.


-- 
Chris Evans (he/him)? ? ? ? <chris at psyctc.org> ? ??
Visiting Professor,?UDLA, Quito, Ecuador?& Honorary
Professor,?University of Roehampton, London, UK.
Work web site:? ? ? ? ? ? ? ? ??https://www.psyctc.org/psyctc/?
CORE site:? ? ? ? ? ? ? ? ? ? ? ??http://www.coresystemtrust.org.uk/?
Personal site:? ? ? ? ? ? ? ? ?
??https://www.psyctc.org/pelerinage2016/?
Emeetings (Thursdays): ?https://link.psyctc.org/booking?(Beware: French
time, generally an hour ahead of UK)


	[[alternative HTML version deleted]]


From @tyen @end|ng |rom ntu@edu@tw  Thu Oct 13 09:34:39 2022
From: @tyen @end|ng |rom ntu@edu@tw (Steven T. Yen)
Date: Thu, 13 Oct 2022 15:34:39 +0800
Subject: [R] cat in a subroutine
Message-ID: <3b66dae8-73dc-dbbb-3cb9-20b265f2f0e3@ntu.edu.tw>

I have had an issue with printing (with cat) in a subroutine for which I 
do not have a applicable example, but I am still hoping to get some 
help. In the following, the first block of code works fine.

...

t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
sig<-my.sig.levels(p)
out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
rownames(out)<-names(me)
colnames(out)<-c("est","se","t","p","sig")
j<-grep(".one\\b",rownames(out))
out<-out[-j,]
return(out)
}

But as soon as I insert lines to print (cat) soething simple, it spits 
out message that appears to be nonsence (unrelated). Any idea. Please 
help. Thanks.

t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
sig<-my.sig.levels(p)
out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
rownames(out)<-names(me)
colnames(out)<-c("est","se","t","p","sig")
cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit 
Probabilities",
 ??? "\n\nlogistic =",logistic)
j<-grep(".one\\b",rownames(out))
out<-out[-j,]
return(out)
}

In this particular case, the error message was as follows:

Error in cat("\nMarginal and Discrete Effects of Gen Ordered Logit / 
Probit Probabilities",? :
 ? unused argument (logistic)

I have printed this way in numerous routines without problem and do not 
see why this is happending.


From er|nm@hodge@@ @end|ng |rom gm@||@com  Thu Oct 13 09:37:07 2022
From: er|nm@hodge@@ @end|ng |rom gm@||@com (Erin Hodgess)
Date: Thu, 13 Oct 2022 01:37:07 -0600
Subject: [R] cat in a subroutine
In-Reply-To: <3b66dae8-73dc-dbbb-3cb9-20b265f2f0e3@ntu.edu.tw>
References: <3b66dae8-73dc-dbbb-3cb9-20b265f2f0e3@ntu.edu.tw>
Message-ID: <CACxE24kypddR_oXXX_tBuu02U8HrRWKS1APSCQBjQ4smP1Er-g@mail.gmail.com>

Hi Steven:

Do you have a variable called logistic, please?  I think that might be the
culprit.

Thanks,
Erin

On Thu, Oct 13, 2022 at 1:35 AM Steven T. Yen <styen at ntu.edu.tw> wrote:

> I have had an issue with printing (with cat) in a subroutine for which I
> do not have a applicable example, but I am still hoping to get some
> help. In the following, the first block of code works fine.
>
> ...
>
> t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
> sig<-my.sig.levels(p)
> out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
> rownames(out)<-names(me)
> colnames(out)<-c("est","se","t","p","sig")
> j<-grep(".one\\b",rownames(out))
> out<-out[-j,]
> return(out)
> }
>
> But as soon as I insert lines to print (cat) soething simple, it spits
> out message that appears to be nonsence (unrelated). Any idea. Please
> help. Thanks.
>
> t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
> sig<-my.sig.levels(p)
> out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
> rownames(out)<-names(me)
> colnames(out)<-c("est","se","t","p","sig")
> cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit
> Probabilities",
>      "\n\nlogistic =",logistic)
> j<-grep(".one\\b",rownames(out))
> out<-out[-j,]
> return(out)
> }
>
> In this particular case, the error message was as follows:
>
> Error in cat("\nMarginal and Discrete Effects of Gen Ordered Logit /
> Probit Probabilities",  :
>    unused argument (logistic)
>
> I have printed this way in numerous routines without problem and do not
> see why this is happending.
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>
-- 
Erin Hodgess, PhD
mailto: erinm.hodgess at gmail.com

	[[alternative HTML version deleted]]


From @tyen @end|ng |rom ntu@edu@tw  Thu Oct 13 09:49:57 2022
From: @tyen @end|ng |rom ntu@edu@tw (Steven T. Yen)
Date: Thu, 13 Oct 2022 15:49:57 +0800
Subject: [R] cat in a subroutine
In-Reply-To: <CACxE24kypddR_oXXX_tBuu02U8HrRWKS1APSCQBjQ4smP1Er-g@mail.gmail.com>
References: <3b66dae8-73dc-dbbb-3cb9-20b265f2f0e3@ntu.edu.tw>
 <CACxE24kypddR_oXXX_tBuu02U8HrRWKS1APSCQBjQ4smP1Er-g@mail.gmail.com>
Message-ID: <8b43a181-743d-8b11-b16c-b8aeb68b3964@ntu.edu.tw>

Thanks Erin.

No. Removing the second line (so that cat simply prints something else),

cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit 
Probabilities")
#??? "\n\nlogistic =",logistic)

I get yet another nonsense:

Error in cat("\nMarginal and Discrete Effects of Gen Ordered Logit / 
Probit Probabilities") :
 ? argument "j" is missing, with no default
 >

On 10/13/2022 3:37 PM, Erin Hodgess wrote:
> Hi?Steven:
>
> Do you have a variable called logistic, please?? I think that might be 
> the culprit.
>
> Thanks,
> Erin
>
> On Thu, Oct 13, 2022 at 1:35 AM Steven T. Yen <styen at ntu.edu.tw> wrote:
>
>     I have had an issue with printing (with cat) in a subroutine for
>     which I
>     do not have a applicable example, but I am still hoping to get some
>     help. In the following, the first block of code works fine.
>
>     ...
>
>     t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
>     sig<-my.sig.levels(p)
>     out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
>     rownames(out)<-names(me)
>     colnames(out)<-c("est","se","t","p","sig")
>     j<-grep(".one\\b",rownames(out))
>     out<-out[-j,]
>     return(out)
>     }
>
>     But as soon as I insert lines to print (cat) soething simple, it
>     spits
>     out message that appears to be nonsence (unrelated). Any idea. Please
>     help. Thanks.
>
>     t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
>     sig<-my.sig.levels(p)
>     out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
>     rownames(out)<-names(me)
>     colnames(out)<-c("est","se","t","p","sig")
>     cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit
>     Probabilities",
>     ???? "\n\nlogistic =",logistic)
>     j<-grep(".one\\b",rownames(out))
>     out<-out[-j,]
>     return(out)
>     }
>
>     In this particular case, the error message was as follows:
>
>     Error in cat("\nMarginal and Discrete Effects of Gen Ordered Logit /
>     Probit Probabilities",? :
>     ?? unused argument (logistic)
>
>     I have printed this way in numerous routines without problem and
>     do not
>     see why this is happending.
>
>     ______________________________________________
>     R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>     https://stat.ethz.ch/mailman/listinfo/r-help
>     PLEASE do read the posting guide
>     http://www.R-project.org/posting-guide.html
>     <http://www.R-project.org/posting-guide.html>
>     and provide commented, minimal, self-contained, reproducible code.
>
> -- 
> Erin Hodgess, PhD
> mailto: erinm.hodgess at gmail.com
	[[alternative HTML version deleted]]


From er|nm@hodge@@ @end|ng |rom gm@||@com  Thu Oct 13 09:54:40 2022
From: er|nm@hodge@@ @end|ng |rom gm@||@com (Erin Hodgess)
Date: Thu, 13 Oct 2022 01:54:40 -0600
Subject: [R] cat in a subroutine
In-Reply-To: <8b43a181-743d-8b11-b16c-b8aeb68b3964@ntu.edu.tw>
References: <3b66dae8-73dc-dbbb-3cb9-20b265f2f0e3@ntu.edu.tw>
 <CACxE24kypddR_oXXX_tBuu02U8HrRWKS1APSCQBjQ4smP1Er-g@mail.gmail.com>
 <8b43a181-743d-8b11-b16c-b8aeb68b3964@ntu.edu.tw>
Message-ID: <CACxE24nHvv3HnDnWhhGm06k1BBcn7xt6O4Q7Wov+VUM9-z9jSA@mail.gmail.com>

All right.  Are these lines of code part of a larger function, please?  Is
that function possibly calling a loop, please?

Thanks,
Erin

On Thu, Oct 13, 2022 at 1:49 AM Steven T. Yen <styen at ntu.edu.tw> wrote:

> Thanks Erin.
>
> No. Removing the second line (so that cat simply prints something else),
>
> cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit
> Probabilities")
> #    "\n\nlogistic =",logistic)
>
> I get yet another nonsense:
>
> Error in cat("\nMarginal and Discrete Effects of Gen Ordered Logit /
> Probit Probabilities") :
>   argument "j" is missing, with no default
> >
> On 10/13/2022 3:37 PM, Erin Hodgess wrote:
>
> Hi Steven:
>
> Do you have a variable called logistic, please?  I think that might be the
> culprit.
>
> Thanks,
> Erin
>
> On Thu, Oct 13, 2022 at 1:35 AM Steven T. Yen <styen at ntu.edu.tw> wrote:
>
>> I have had an issue with printing (with cat) in a subroutine for which I
>> do not have a applicable example, but I am still hoping to get some
>> help. In the following, the first block of code works fine.
>>
>> ...
>>
>> t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
>> sig<-my.sig.levels(p)
>> out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
>> rownames(out)<-names(me)
>> colnames(out)<-c("est","se","t","p","sig")
>> j<-grep(".one\\b",rownames(out))
>> out<-out[-j,]
>> return(out)
>> }
>>
>> But as soon as I insert lines to print (cat) soething simple, it spits
>> out message that appears to be nonsence (unrelated). Any idea. Please
>> help. Thanks.
>>
>> t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
>> sig<-my.sig.levels(p)
>> out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
>> rownames(out)<-names(me)
>> colnames(out)<-c("est","se","t","p","sig")
>> cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit
>> Probabilities",
>>      "\n\nlogistic =",logistic)
>> j<-grep(".one\\b",rownames(out))
>> out<-out[-j,]
>> return(out)
>> }
>>
>> In this particular case, the error message was as follows:
>>
>> Error in cat("\nMarginal and Discrete Effects of Gen Ordered Logit /
>> Probit Probabilities",  :
>>    unused argument (logistic)
>>
>> I have printed this way in numerous routines without problem and do not
>> see why this is happending.
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide
>> http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
>>
> --
> Erin Hodgess, PhD
> mailto: erinm.hodgess at gmail.com
>
> --
Erin Hodgess, PhD
mailto: erinm.hodgess at gmail.com

	[[alternative HTML version deleted]]


From @tyen @end|ng |rom ntu@edu@tw  Thu Oct 13 09:59:08 2022
From: @tyen @end|ng |rom ntu@edu@tw (Steven Yen)
Date: Thu, 13 Oct 2022 15:59:08 +0800
Subject: [R] cat in a subroutine
In-Reply-To: <CACxE24nHvv3HnDnWhhGm06k1BBcn7xt6O4Q7Wov+VUM9-z9jSA@mail.gmail.com>
References: <CACxE24nHvv3HnDnWhhGm06k1BBcn7xt6O4Q7Wov+VUM9-z9jSA@mail.gmail.com>
Message-ID: <06DC0934-A81C-4BE4-BABD-1BAED38BC5FB@ntu.edu.tw>

Yes, these lines are part of a subroutine calling yet more procedures. What frustrated me was, I am not doing anything different from other routines. My cat command in the recent code does not do anything other than printing a line of plain text. I am clueless.

Steven from iPhone

> On Oct 13, 2022, at 3:54 PM, Erin Hodgess <erinm.hodgess at gmail.com> wrote:
> 
> ?
> All right.  Are these lines of code part of a larger function, please?  Is that function possibly calling a loop, please?
> 
> Thanks,
> Erin 
> 
>> On Thu, Oct 13, 2022 at 1:49 AM Steven T. Yen <styen at ntu.edu.tw> wrote:
>> Thanks Erin. 
>> 
>> No. Removing the second line (so that cat simply prints something else),
>> 
>> cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit Probabilities")
>> #    "\n\nlogistic =",logistic)
>> 
>> I get yet another nonsense:
>> 
>> Error in cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit Probabilities") : 
>>   argument "j" is missing, with no default
>> > 
>> On 10/13/2022 3:37 PM, Erin Hodgess wrote:
>>> Hi Steven:
>>> 
>>> Do you have a variable called logistic, please?  I think that might be the culprit.
>>> 
>>> Thanks,
>>> Erin 
>>> 
>>> On Thu, Oct 13, 2022 at 1:35 AM Steven T. Yen <styen at ntu.edu.tw> wrote:
>>>> I have had an issue with printing (with cat) in a subroutine for which I 
>>>> do not have a applicable example, but I am still hoping to get some 
>>>> help. In the following, the first block of code works fine.
>>>> 
>>>> ...
>>>> 
>>>> t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
>>>> sig<-my.sig.levels(p)
>>>> out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
>>>> rownames(out)<-names(me)
>>>> colnames(out)<-c("est","se","t","p","sig")
>>>> j<-grep(".one\\b",rownames(out))
>>>> out<-out[-j,]
>>>> return(out)
>>>> }
>>>> 
>>>> But as soon as I insert lines to print (cat) soething simple, it spits 
>>>> out message that appears to be nonsence (unrelated). Any idea. Please 
>>>> help. Thanks.
>>>> 
>>>> t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
>>>> sig<-my.sig.levels(p)
>>>> out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
>>>> rownames(out)<-names(me)
>>>> colnames(out)<-c("est","se","t","p","sig")
>>>> cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit 
>>>> Probabilities",
>>>>      "\n\nlogistic =",logistic)
>>>> j<-grep(".one\\b",rownames(out))
>>>> out<-out[-j,]
>>>> return(out)
>>>> }
>>>> 
>>>> In this particular case, the error message was as follows:
>>>> 
>>>> Error in cat("\nMarginal and Discrete Effects of Gen Ordered Logit / 
>>>> Probit Probabilities",  :
>>>>    unused argument (logistic)
>>>> 
>>>> I have printed this way in numerous routines without problem and do not 
>>>> see why this is happending.
>>>> 
>>>> ______________________________________________
>>>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>>>> and provide commented, minimal, self-contained, reproducible code.
>>> -- 
>>> Erin Hodgess, PhD
>>> mailto: erinm.hodgess at gmail.com
> -- 
> Erin Hodgess, PhD
> mailto: erinm.hodgess at gmail.com

	[[alternative HTML version deleted]]


From drj|m|emon @end|ng |rom gm@||@com  Thu Oct 13 10:13:48 2022
From: drj|m|emon @end|ng |rom gm@||@com (Jim Lemon)
Date: Thu, 13 Oct 2022 19:13:48 +1100
Subject: [R] cat in a subroutine
In-Reply-To: <8b43a181-743d-8b11-b16c-b8aeb68b3964@ntu.edu.tw>
References: <3b66dae8-73dc-dbbb-3cb9-20b265f2f0e3@ntu.edu.tw>
 <CACxE24kypddR_oXXX_tBuu02U8HrRWKS1APSCQBjQ4smP1Er-g@mail.gmail.com>
 <8b43a181-743d-8b11-b16c-b8aeb68b3964@ntu.edu.tw>
Message-ID: <CA+8X3fXWf4=KJtsKN=z4YohS24WpD-u=ShceYBU3CQqo+FaQHw@mail.gmail.com>

Hi Steven,
I think Erin is right, unless there is a variable named "logistic"
visible within the function, "cat" will think it is either an argument
or an R object. If you have the "psych" package loaded, it may see it
as a closure. There is also a "Logistic" in the stats package, but
that shouldn't be visible due to the capital L

Jim

On Thu, Oct 13, 2022 at 6:55 PM Steven T. Yen <styen at ntu.edu.tw> wrote:
>
> Thanks Erin.
>
> No. Removing the second line (so that cat simply prints something else),
>
> cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit
> Probabilities")
> #    "\n\nlogistic =",logistic)
>
> I get yet another nonsense:
>
> Error in cat("\nMarginal and Discrete Effects of Gen Ordered Logit /
> Probit Probabilities") :
>    argument "j" is missing, with no default
>  >
>
> On 10/13/2022 3:37 PM, Erin Hodgess wrote:
> > Hi Steven:
> >
> > Do you have a variable called logistic, please?  I think that might be
> > the culprit.
> >
> > Thanks,
> > Erin
> >
> > On Thu, Oct 13, 2022 at 1:35 AM Steven T. Yen <styen at ntu.edu.tw> wrote:
> >
> >     I have had an issue with printing (with cat) in a subroutine for
> >     which I
> >     do not have a applicable example, but I am still hoping to get some
> >     help. In the following, the first block of code works fine.
> >
> >     ...
> >
> >     t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
> >     sig<-my.sig.levels(p)
> >     out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
> >     rownames(out)<-names(me)
> >     colnames(out)<-c("est","se","t","p","sig")
> >     j<-grep(".one\\b",rownames(out))
> >     out<-out[-j,]
> >     return(out)
> >     }
> >
> >     But as soon as I insert lines to print (cat) soething simple, it
> >     spits
> >     out message that appears to be nonsence (unrelated). Any idea. Please
> >     help. Thanks.
> >
> >     t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
> >     sig<-my.sig.levels(p)
> >     out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
> >     rownames(out)<-names(me)
> >     colnames(out)<-c("est","se","t","p","sig")
> >     cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit
> >     Probabilities",
> >          "\n\nlogistic =",logistic)
> >     j<-grep(".one\\b",rownames(out))
> >     out<-out[-j,]
> >     return(out)
> >     }
> >
> >     In this particular case, the error message was as follows:
> >
> >     Error in cat("\nMarginal and Discrete Effects of Gen Ordered Logit /
> >     Probit Probabilities",  :
> >        unused argument (logistic)
> >
> >     I have printed this way in numerous routines without problem and
> >     do not
> >     see why this is happending.
> >
> >     ______________________________________________
> >     R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> >     https://stat.ethz.ch/mailman/listinfo/r-help
> >     PLEASE do read the posting guide
> >     http://www.R-project.org/posting-guide.html
> >     <http://www.R-project.org/posting-guide.html>
> >     and provide commented, minimal, self-contained, reproducible code.
> >
> > --
> > Erin Hodgess, PhD
> > mailto: erinm.hodgess at gmail.com
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From er|nm@hodge@@ @end|ng |rom gm@||@com  Thu Oct 13 10:19:00 2022
From: er|nm@hodge@@ @end|ng |rom gm@||@com (Erin Hodgess)
Date: Thu, 13 Oct 2022 02:19:00 -0600
Subject: [R] cat in a subroutine
In-Reply-To: <CA+8X3fXWf4=KJtsKN=z4YohS24WpD-u=ShceYBU3CQqo+FaQHw@mail.gmail.com>
References: <3b66dae8-73dc-dbbb-3cb9-20b265f2f0e3@ntu.edu.tw>
 <CACxE24kypddR_oXXX_tBuu02U8HrRWKS1APSCQBjQ4smP1Er-g@mail.gmail.com>
 <8b43a181-743d-8b11-b16c-b8aeb68b3964@ntu.edu.tw>
 <CA+8X3fXWf4=KJtsKN=z4YohS24WpD-u=ShceYBU3CQqo+FaQHw@mail.gmail.com>
Message-ID: <CACxE24mMD90ysOTk26_EtLBM11ALqdedHbpr4eWV8mEbY0WozQ@mail.gmail.com>

Steven, would you mind putting that section of code in again, with the cat
statement, please?

I have an idea...
Erin Hodgess, PhD
mailto: erinm.hodgess at gmail.com


On Thu, Oct 13, 2022 at 2:13 AM Jim Lemon <drjimlemon at gmail.com> wrote:

> Hi Steven,
> I think Erin is right, unless there is a variable named "logistic"
> visible within the function, "cat" will think it is either an argument
> or an R object. If you have the "psych" package loaded, it may see it
> as a closure. There is also a "Logistic" in the stats package, but
> that shouldn't be visible due to the capital L
>
> Jim
>
> On Thu, Oct 13, 2022 at 6:55 PM Steven T. Yen <styen at ntu.edu.tw> wrote:
> >
> > Thanks Erin.
> >
> > No. Removing the second line (so that cat simply prints something else),
> >
> > cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit
> > Probabilities")
> > #    "\n\nlogistic =",logistic)
> >
> > I get yet another nonsense:
> >
> > Error in cat("\nMarginal and Discrete Effects of Gen Ordered Logit /
> > Probit Probabilities") :
> >    argument "j" is missing, with no default
> >  >
> >
> > On 10/13/2022 3:37 PM, Erin Hodgess wrote:
> > > Hi Steven:
> > >
> > > Do you have a variable called logistic, please?  I think that might be
> > > the culprit.
> > >
> > > Thanks,
> > > Erin
> > >
> > > On Thu, Oct 13, 2022 at 1:35 AM Steven T. Yen <styen at ntu.edu.tw>
> wrote:
> > >
> > >     I have had an issue with printing (with cat) in a subroutine for
> > >     which I
> > >     do not have a applicable example, but I am still hoping to get some
> > >     help. In the following, the first block of code works fine.
> > >
> > >     ...
> > >
> > >     t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
> > >     sig<-my.sig.levels(p)
> > >     out<-data.frame(round(cbind(me,se,t,p),digits));
> out<-cbind(out,sig)
> > >     rownames(out)<-names(me)
> > >     colnames(out)<-c("est","se","t","p","sig")
> > >     j<-grep(".one\\b",rownames(out))
> > >     out<-out[-j,]
> > >     return(out)
> > >     }
> > >
> > >     But as soon as I insert lines to print (cat) soething simple, it
> > >     spits
> > >     out message that appears to be nonsence (unrelated). Any idea.
> Please
> > >     help. Thanks.
> > >
> > >     t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
> > >     sig<-my.sig.levels(p)
> > >     out<-data.frame(round(cbind(me,se,t,p),digits));
> out<-cbind(out,sig)
> > >     rownames(out)<-names(me)
> > >     colnames(out)<-c("est","se","t","p","sig")
> > >     cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit
> > >     Probabilities",
> > >          "\n\nlogistic =",logistic)
> > >     j<-grep(".one\\b",rownames(out))
> > >     out<-out[-j,]
> > >     return(out)
> > >     }
> > >
> > >     In this particular case, the error message was as follows:
> > >
> > >     Error in cat("\nMarginal and Discrete Effects of Gen Ordered Logit
> /
> > >     Probit Probabilities",  :
> > >        unused argument (logistic)
> > >
> > >     I have printed this way in numerous routines without problem and
> > >     do not
> > >     see why this is happending.
> > >
> > >     ______________________________________________
> > >     R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > >     https://stat.ethz.ch/mailman/listinfo/r-help
> > >     PLEASE do read the posting guide
> > >     http://www.R-project.org/posting-guide.html
> > >     <http://www.R-project.org/posting-guide.html>
> > >     and provide commented, minimal, self-contained, reproducible code.
> > >
> > > --
> > > Erin Hodgess, PhD
> > > mailto: erinm.hodgess at gmail.com
> >         [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From @tyen @end|ng |rom ntu@edu@tw  Thu Oct 13 10:27:47 2022
From: @tyen @end|ng |rom ntu@edu@tw (Steven Yen)
Date: Thu, 13 Oct 2022 16:27:47 +0800
Subject: [R] cat in a subroutine
In-Reply-To: <CACxE24kypddR_oXXX_tBuu02U8HrRWKS1APSCQBjQ4smP1Er-g@mail.gmail.com>
References: <CACxE24kypddR_oXXX_tBuu02U8HrRWKS1APSCQBjQ4smP1Er-g@mail.gmail.com>
Message-ID: <B77D5794-3752-4C10-9E98-19111F777F7D@ntu.edu.tw>

t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
sig<-my.sig.levels(p)
out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
rownames(out)<-names(me)
colnames(out)<-c("est","se","t","p","sig")
cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit 
Probabilities",
     "\n\nlogistic =",logistic)
j<-grep(".one\\b",rownames(out))
out<-out[-j,]
return(out)
}

Steven from iPhone

> On Oct 13, 2022, at 3:37 PM, Erin Hodgess <erinm.hodgess at gmail.com> wrote:
> 
> t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
> sig<-my.sig.levels(p)
> out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
> rownames(out)<-names(me)
> colnames(out)<-c("est","se","t","p","sig")
> cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit 
> Probabilities",
>      "\n\nlogistic =",logistic)
> j<-grep(".one\\b",rownames(out))
> out<-out[-j,]
> return(out)
> }

	[[alternative HTML version deleted]]


From drj|m|emon @end|ng |rom gm@||@com  Thu Oct 13 10:46:12 2022
From: drj|m|emon @end|ng |rom gm@||@com (Jim Lemon)
Date: Thu, 13 Oct 2022 19:46:12 +1100
Subject: [R] cat in a subroutine
In-Reply-To: <B77D5794-3752-4C10-9E98-19111F777F7D@ntu.edu.tw>
References: <CACxE24kypddR_oXXX_tBuu02U8HrRWKS1APSCQBjQ4smP1Er-g@mail.gmail.com>
 <B77D5794-3752-4C10-9E98-19111F777F7D@ntu.edu.tw>
Message-ID: <CA+8X3fWtvJHRDo7WG5XCjZ5ZsmdAy9eczzswR2YKu0NpbKwaJQ@mail.gmail.com>

Hi Steven & Erin,
This works:

fortytwo<-42
cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit
Probabilities","logisitic =",fortytwo,"\n")
j<-grep(".one\\b",c(".one\\a",".one\\b"))

Marginal and Discrete Effects of Gen Ordered Logit / Probit
Probabilities logisitic = 42

If I don't define fortytwo before calling cat, it doesn't.
So we know what the answer is.

Jim

On Thu, Oct 13, 2022 at 7:36 PM Steven Yen <styen at ntu.edu.tw> wrote:
>
> t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
> sig<-my.sig.levels(p)
> out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
> rownames(out)<-names(me)
> colnames(out)<-c("est","se","t","p","sig")
> cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit
> Probabilities",
>      "\n\nlogistic =",logistic)
> j<-grep(".one\\b",rownames(out))
> out<-out[-j,]
> return(out)
> }
>
> Steven from iPhone
>
> > On Oct 13, 2022, at 3:37 PM, Erin Hodgess <erinm.hodgess at gmail.com> wrote:
> >
> > t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
> > sig<-my.sig.levels(p)
> > out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
> > rownames(out)<-names(me)
> > colnames(out)<-c("est","se","t","p","sig")
> > cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit
> > Probabilities",
> >      "\n\nlogistic =",logistic)
> > j<-grep(".one\\b",rownames(out))
> > out<-out[-j,]
> > return(out)
> > }
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From @tyen @end|ng |rom ntu@edu@tw  Thu Oct 13 11:02:55 2022
From: @tyen @end|ng |rom ntu@edu@tw (Steven T. Yen)
Date: Thu, 13 Oct 2022 17:02:55 +0800
Subject: [R] cat in a subroutine
In-Reply-To: <CA+8X3fWtvJHRDo7WG5XCjZ5ZsmdAy9eczzswR2YKu0NpbKwaJQ@mail.gmail.com>
References: <CACxE24kypddR_oXXX_tBuu02U8HrRWKS1APSCQBjQ4smP1Er-g@mail.gmail.com>
 <B77D5794-3752-4C10-9E98-19111F777F7D@ntu.edu.tw>
 <CA+8X3fWtvJHRDo7WG5XCjZ5ZsmdAy9eczzswR2YKu0NpbKwaJQ@mail.gmail.com>
Message-ID: <e49a8dfe-c758-534f-dd5f-7aec0b68e804@ntu.edu.tw>

Not really.

fortytwo<-42
cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit 
Probabilities",
 ??? "logisitic =",fortytwo,"\n")

 > goprobit1.r.me.kr<-me.gologit.r(goprobit1,embellished=TRUE,
+???????????????????????????????? resampling=TRUE,ndraws=5); 
goprobit1.r.me.kr
Error in cat("\nMarginal and Discrete Effects of Gen Ordered Logit / 
Probit Probabilities",? :
 ? unused arguments (fortytwo, "\n")

On 10/13/2022 4:46 PM, Jim Lemon wrote:
> Hi Steven & Erin,
> This works:
>
> fortytwo<-42
> cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit
> Probabilities","logisitic =",fortytwo,"\n")
> j<-grep(".one\\b",c(".one\\a",".one\\b"))
>
> Marginal and Discrete Effects of Gen Ordered Logit / Probit
> Probabilities logisitic = 42
>
> If I don't define fortytwo before calling cat, it doesn't.
> So we know what the answer is.
>
> Jim
>
> On Thu, Oct 13, 2022 at 7:36 PM Steven Yen <styen at ntu.edu.tw> wrote:
>> t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
>> sig<-my.sig.levels(p)
>> out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
>> rownames(out)<-names(me)
>> colnames(out)<-c("est","se","t","p","sig")
>> cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit
>> Probabilities",
>>       "\n\nlogistic =",logistic)
>> j<-grep(".one\\b",rownames(out))
>> out<-out[-j,]
>> return(out)
>> }
>>
>> Steven from iPhone
>>
>>> On Oct 13, 2022, at 3:37 PM, Erin Hodgess <erinm.hodgess at gmail.com> wrote:
>>>
>>> t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
>>> sig<-my.sig.levels(p)
>>> out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
>>> rownames(out)<-names(me)
>>> colnames(out)<-c("est","se","t","p","sig")
>>> cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit
>>> Probabilities",
>>>       "\n\nlogistic =",logistic)
>>> j<-grep(".one\\b",rownames(out))
>>> out<-out[-j,]
>>> return(out)
>>> }
>>          [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.


From drj|m|emon @end|ng |rom gm@||@com  Thu Oct 13 11:09:42 2022
From: drj|m|emon @end|ng |rom gm@||@com (Jim Lemon)
Date: Thu, 13 Oct 2022 20:09:42 +1100
Subject: [R] cat in a subroutine
In-Reply-To: <e49a8dfe-c758-534f-dd5f-7aec0b68e804@ntu.edu.tw>
References: <CACxE24kypddR_oXXX_tBuu02U8HrRWKS1APSCQBjQ4smP1Er-g@mail.gmail.com>
 <B77D5794-3752-4C10-9E98-19111F777F7D@ntu.edu.tw>
 <CA+8X3fWtvJHRDo7WG5XCjZ5ZsmdAy9eczzswR2YKu0NpbKwaJQ@mail.gmail.com>
 <e49a8dfe-c758-534f-dd5f-7aec0b68e804@ntu.edu.tw>
Message-ID: <CA+8X3fWcmE7M-MT93i6sx17+VapN+vkWDVAwOwu7Xkh_6v2s9A@mail.gmail.com>

Have you assigned the valuie of goprobit1.r.me.kr to "fortytwo", or
indeed anything?

Jim

On Thu, Oct 13, 2022 at 8:02 PM Steven T. Yen <styen at ntu.edu.tw> wrote:
>
> Not really.
>
> fortytwo<-42
> cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit
> Probabilities",
>      "logisitic =",fortytwo,"\n")
>
>  > goprobit1.r.me.kr<-me.gologit.r(goprobit1,embellished=TRUE,
> +                                 resampling=TRUE,ndraws=5);
> goprobit1.r.me.kr
> Error in cat("\nMarginal and Discrete Effects of Gen Ordered Logit /
> Probit Probabilities",  :
>    unused arguments (fortytwo, "\n")
>
> On 10/13/2022 4:46 PM, Jim Lemon wrote:
> > Hi Steven & Erin,
> > This works:
> >
> > fortytwo<-42
> > cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit
> > Probabilities","logisitic =",fortytwo,"\n")
> > j<-grep(".one\\b",c(".one\\a",".one\\b"))
> >
> > Marginal and Discrete Effects of Gen Ordered Logit / Probit
> > Probabilities logisitic = 42
> >
> > If I don't define fortytwo before calling cat, it doesn't.
> > So we know what the answer is.
> >
> > Jim
> >
> > On Thu, Oct 13, 2022 at 7:36 PM Steven Yen <styen at ntu.edu.tw> wrote:
> >> t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
> >> sig<-my.sig.levels(p)
> >> out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
> >> rownames(out)<-names(me)
> >> colnames(out)<-c("est","se","t","p","sig")
> >> cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit
> >> Probabilities",
> >>       "\n\nlogistic =",logistic)
> >> j<-grep(".one\\b",rownames(out))
> >> out<-out[-j,]
> >> return(out)
> >> }
> >>
> >> Steven from iPhone
> >>
> >>> On Oct 13, 2022, at 3:37 PM, Erin Hodgess <erinm.hodgess at gmail.com> wrote:
> >>>
> >>> t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
> >>> sig<-my.sig.levels(p)
> >>> out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
> >>> rownames(out)<-names(me)
> >>> colnames(out)<-c("est","se","t","p","sig")
> >>> cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit
> >>> Probabilities",
> >>>       "\n\nlogistic =",logistic)
> >>> j<-grep(".one\\b",rownames(out))
> >>> out<-out[-j,]
> >>> return(out)
> >>> }
> >>          [[alternative HTML version deleted]]
> >>
> >> ______________________________________________
> >> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> >> https://stat.ethz.ch/mailman/listinfo/r-help
> >> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> >> and provide commented, minimal, self-contained, reproducible code.


From @tyen @end|ng |rom ntu@edu@tw  Thu Oct 13 11:18:27 2022
From: @tyen @end|ng |rom ntu@edu@tw (Steven Yen)
Date: Thu, 13 Oct 2022 17:18:27 +0800
Subject: [R] cat in a subroutine
In-Reply-To: <CA+8X3fWcmE7M-MT93i6sx17+VapN+vkWDVAwOwu7Xkh_6v2s9A@mail.gmail.com>
References: <CA+8X3fWcmE7M-MT93i6sx17+VapN+vkWDVAwOwu7Xkh_6v2s9A@mail.gmail.com>
Message-ID: <DD68C071-F086-4FA9-B84B-6F103C3C010C@ntu.edu.tw>

No. I just run the subroutine containing those line? with result going to destination go probit1.r.me.it and printed it.

Steven from iPhone

> On Oct 13, 2022, at 5:09 PM, Jim Lemon <drjimlemon at gmail.com> wrote:
> 
> ?Have you assigned the valuie of goprobit1.r.me.kr to "fortytwo", or
> indeed anything?
> 
> Jim
> 
>> On Thu, Oct 13, 2022 at 8:02 PM Steven T. Yen <styen at ntu.edu.tw> wrote:
>> 
>> Not really.
>> 
>> fortytwo<-42
>> cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit
>> Probabilities",
>>     "logisitic =",fortytwo,"\n")
>> 
>>> goprobit1.r.me.kr<-me.gologit.r(goprobit1,embellished=TRUE,
>> +                                 resampling=TRUE,ndraws=5);
>> goprobit1.r.me.kr
>> Error in cat("\nMarginal and Discrete Effects of Gen Ordered Logit /
>> Probit Probabilities",  :
>>   unused arguments (fortytwo, "\n")
>> 
>>> On 10/13/2022 4:46 PM, Jim Lemon wrote:
>>> Hi Steven & Erin,
>>> This works:
>>> 
>>> fortytwo<-42
>>> cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit
>>> Probabilities","logisitic =",fortytwo,"\n")
>>> j<-grep(".one\\b",c(".one\\a",".one\\b"))
>>> 
>>> Marginal and Discrete Effects of Gen Ordered Logit / Probit
>>> Probabilities logisitic = 42
>>> 
>>> If I don't define fortytwo before calling cat, it doesn't.
>>> So we know what the answer is.
>>> 
>>> Jim
>>> 
>>> On Thu, Oct 13, 2022 at 7:36 PM Steven Yen <styen at ntu.edu.tw> wrote:
>>>> t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))

	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Thu Oct 13 11:33:15 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Thu, 13 Oct 2022 12:33:15 +0300
Subject: [R] cat in a subroutine
In-Reply-To: <8b43a181-743d-8b11-b16c-b8aeb68b3964@ntu.edu.tw>
References: <3b66dae8-73dc-dbbb-3cb9-20b265f2f0e3@ntu.edu.tw>
 <CACxE24kypddR_oXXX_tBuu02U8HrRWKS1APSCQBjQ4smP1Er-g@mail.gmail.com>
 <8b43a181-743d-8b11-b16c-b8aeb68b3964@ntu.edu.tw>
Message-ID: <20221013123315.1b221573@arachnoid>

? Thu, 13 Oct 2022 15:49:57 +0800
"Steven T. Yen" <styen at ntu.edu.tw> ?????:

> No. Removing the second line (so that cat simply prints something
> else),
> 
> cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit 
> Probabilities")
> #??? "\n\nlogistic =",logistic)
> 
> I get yet another nonsense:
> 
> Error in cat("\nMarginal and Discrete Effects of Gen Ordered Logit / 
> Probit Probabilities") :
>  ? argument "j" is missing, with no default

I don't see any problems with quoting or parentheses in the parts of
the code you're showing us, but they may be present elsewhere.

If you step the function in debugger (see ?debugonce and ?browser),
does it crash in the call to cat()?

If you take your function apart by applying as.list(body(fun)) (and
furthermore applying as.list() to any parts of the function), do you
see the call to cat() taking exactly the arguments you mean it to take?

-- 
Best regards,
Ivan


From kry|ov@r00t @end|ng |rom gm@||@com  Thu Oct 13 12:04:59 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Thu, 13 Oct 2022 13:04:59 +0300
Subject: [R] prcomp - arbitrary direction of the returned principal
 components
In-Reply-To: <CAC8=1eqUJoYUqq_bDeUCpWL79ootuV44+oSkZ5=oPHnrCsGY5Q@mail.gmail.com>
References: <CAC8=1eqUJoYUqq_bDeUCpWL79ootuV44+oSkZ5=oPHnrCsGY5Q@mail.gmail.com>
Message-ID: <20221013130459.32611181@arachnoid>

? Wed, 12 Oct 2022 17:18:26 +0530
Ashim Kapoor <ashimkapoor at gmail.com> ?????:

> My problem is that I am building an index based on Principal
> Components Analysis.
> When the index is high it should indicate stress in the market.

Have you considered using supervised methods, like PLS, to predict
stress in the market?

Imagine what happens when you take the points where there's stress in
the market and feed only those to PCA. The first principal direction is
now gone (if there is a variation along this axis, it's much smaller
than it was), so now some other direction occupies its place. Even if
the first direction is preserved, after centering, there are now points
with low values of PC1, despite all points should correspond to stress
in the market.

Apologies if the paragraph above is complete nonsense, a reasonable
researched would always conduct the analysis on a representative sample
of the points, and the whole point of the proposed index is that high
stress is indicated by points on the positive end of the multivariate
sausage that PCA considers the data to be. If that's the case,
post-processing the signs as described by Chris Evans could be the
right solution.

-- 
Best regards,
Ivan


From tebert @end|ng |rom u||@edu  Thu Oct 13 14:03:17 2022
From: tebert @end|ng |rom u||@edu (Ebert,Timothy Aaron)
Date: Thu, 13 Oct 2022 12:03:17 +0000
Subject: [R] prcomp - arbitrary direction of the returned principal
 components
In-Reply-To: <CAC8=1epb18uQ9yPvA98dTkCoqnszfB6Ys61Ej3LouMo3jRMzjA@mail.gmail.com>
References: <CAC8=1eqUJoYUqq_bDeUCpWL79ootuV44+oSkZ5=oPHnrCsGY5Q@mail.gmail.com>
 <BN6PR2201MB15533913DCFC93FB55E87351CF229@BN6PR2201MB1553.namprd22.prod.outlook.com>
 <CAC8=1epb18uQ9yPvA98dTkCoqnszfB6Ys61Ej3LouMo3jRMzjA@mail.gmail.com>
Message-ID: <BN6PR2201MB1553FEB192FBB1F8E56D1AF2CF259@BN6PR2201MB1553.namprd22.prod.outlook.com>

I still do not understand. However, the general approach would be to identify a specific value to test. If the test is TRUE then do "this" otherwise do nothing. Once the test condition is properly identified, the coding easily follows.

 abs() is the same as
if x<0 then x = -x   (non-R code, just idea)
The R code might look something more like
for (number in 1:ncol(x)){
   if (x[3,2] < 0) {
         x[number, number] = -x[number, number] #only change the diagonal
   }
}

Depending on what values need to be changed you may need a nested for loop to go through all values of x[number1, number2]. 

Your words: " I can forcefully use a NEGATIVE sign to FLIP the index when it is LOW." Where it appeared that "low" was defined as values that are negative. You still will have low values (close to zero) and high values (far from zero). 

You could make the condition some other value:

if x< -4 then x = -x

If you just want to rotate about zero then 
x = -x
In this case the positive values will become negative and the negative values positive.
Add an if test to selectively rotate based on the value of a single test element in x (as in x[3,2]). 

In debugging or trouble shooting setting seed is useful. For actual data analysis you should not set seed, or possibly better yet use set.seed(NULL).

Tim



-----Original Message-----
From: Ashim Kapoor <ashimkapoor at gmail.com> 
Sent: Thursday, October 13, 2022 12:28 AM
To: Ebert,Timothy Aaron <tebert at ufl.edu>
Cc: R Help <r-help at r-project.org>
Subject: Re: [R] prcomp - arbitrary direction of the returned principal components

[External Email]

Dear Aaron,

Many thanks for your reply.

Please allow me to illustrate my query a bit.

I take some data, throw it to prcomp and extract the x data frame from prcomp.

>From ?prcomp:

       x: if 'retx' is true the value of the rotated data (the centred
          (and scaled if requested) data multiplied by the 'rotation'
          matrix) is returned.  Hence, 'cov(x)' is the diagonal matrix
          'diag(sdev^2)'.  For the formula method, 'napredict()' is
          applied to handle the treatment of values omitted by the
          'na.action'.

I consider x[,1] as my index. This makes sense as x[,1] is the projection of the data on the FIRST principal component.
Now this x[,1] can be a high +ve number or a low -ve number. I can't ignore the sign.

If I ignore the sign by taking the absolute value, the HIGH / LOW stress values will be indistinguishable.

Hence I do not think using absolute values of x[,1] is the solution.
Yes it will make the results REPRODUCIBLE but that will be at the cost of losing information.

Any other idea ?

Many thanks,
Ashim

On Wed, Oct 12, 2022 at 5:23 PM Ebert,Timothy Aaron <tebert at ufl.edu> wrote:
>
> Use absolute value
>
> Tim
>
> -----Original Message-----
> From: R-help <r-help-bounces at r-project.org> On Behalf Of Ashim Kapoor
> Sent: Wednesday, October 12, 2022 7:48 AM
> To: R Help <r-help at r-project.org>
> Subject: [R] prcomp - arbitrary direction of the returned principal 
> components
>
> [External Email]
>
> Dear R experts,
>
> From ?prcomp,
>
> ---- snip -----
> Note:
>
>      The signs of the columns of the rotation matrix are arbitrary, and
>      so may differ between different programs for PCA, and even between
>      different builds of R.
> ---- snip ------
>
> My problem is that I am building an index based on Principal Components Analysis.
> When the index is high it should indicate stress in the market. Due to the arbitrary sign sometimes I get an index which is HIGH when there is stress and sometimes I get  the OPPOSITE - an index which is LOW when there is stress.
> This program is shared with other people who may have a different build of R.
>
> I can forcefully use a NEGATIVE sign to FLIP the index when it is LOW.
> That works.
>
> Now my query is : Just like we do set.seed(1234) and force the pattern of generation of random number and make it REPRODUCIBLE, can I do something like :
>
> set.direction.for.vector.in.pca(1234)
>
> Now each time I do prcomp it should choose the SAME ( high or low ) direction of the principle component on ANY computer having ANY version of R installed.
>
> That's what I want. I don't want the the returned principal component to be HIGH(LOW) on my computer and LOW(HIGH) on someone else's computer.
> That would confuse the people the code is shared with.
>
> Is this possible ? How do people deal with this ?
>
> Many thanks,
> Ashim
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat
> .ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl
> .edu%7C60e6d6ae8645462db99b08daacd36b76%7C0d4da0f84a314d76ace60a62331e
> 1b84%7C0%7C0%7C638012321302591064%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4w
> LjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C
> &amp;sdata=AHMEDU%2BTyInvW%2FH6EZQteO1qZ%2BtW3JZfybfaveTD8Yk%3D&amp;re
> served=0 PLEASE do read the posting guide 
> https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r
> -project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%
> 7C60e6d6ae8645462db99b08daacd36b76%7C0d4da0f84a314d76ace60a62331e1b84%
> 7C0%7C0%7C638012321302591064%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwM
> DAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;
> sdata=yavXAiQorhZjPTozG4Ulo8SuNmR6XFhvA%2FLX9Tfwgi0%3D&amp;reserved=0
> and provide commented, minimal, self-contained, reproducible code.


From n@re@h_gurbux@n| @end|ng |rom hotm@||@com  Thu Oct 13 14:31:15 2022
From: n@re@h_gurbux@n| @end|ng |rom hotm@||@com (Naresh Gurbuxani)
Date: Thu, 13 Oct 2022 08:31:15 -0400
Subject: [R] replicate results of tree package
Message-ID: <IA1P223MB04992F54CAE0FE14E877E6A9FA259@IA1P223MB0499.NAMP223.PROD.OUTLOOK.COM>


I am trying to understand ``deviance'' in classification tree output
from tree package.

library(tree)

set.seed(911)
mydf <- data.frame(
    name = as.factor(rep(c("A", "B"), c(10, 10))),
    x = c(rnorm(10, -1), rnorm(10, 1)),
    y = c(rnorm(10, 1), rnorm(10, -1)))

mytree <- tree(name ~ ., data = mydf)

mytree
# node), split, n, deviance, yval, (yprob)
#       * denotes terminal node

# 1) root 20 27.730 A ( 0.5 0.5 )  
#   2) y < -0.00467067 10  6.502 B ( 0.1 0.9 )  
#     4) x < 1.50596 5  5.004 B ( 0.2 0.8 ) *
#     5) x > 1.50596 5  0.000 B ( 0.0 1.0 ) *
#   3) y > -0.00467067 10  6.502 A ( 0.9 0.1 )  
#     6) x < -0.578851 5  0.000 A ( 1.0 0.0 ) *
#     7) x > -0.578851 5  5.004 A ( 0.8 0.2 ) *

# Replicate results for node 2
# Probabilities tie out
with(subset(mydf, y < -0.00457), table(name))
# name
# A B 
# 1 9

# Cannot replicate deviance = -1 * sum(p_mk * log(p_mk))
0.1 * log(0.1) + 0.9 * log(0.9)
# [1] 0.325083

1.  In the documentation, is it possible to find the definition of
deviance?
2.  Is it possible to see the code where it calculates deviance?

Thanks,
Naresh


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Thu Oct 13 15:24:48 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Thu, 13 Oct 2022 15:24:48 +0200
Subject: [R] Problem with Windows clipboard and UTF-8
In-Reply-To: <764a72b6-64c0-c8e4-595e-410f6b247774@dim.uchile.cl>
References: <764a72b6-64c0-c8e4-595e-410f6b247774@dim.uchile.cl>
Message-ID: <5a9954b7-0255-ae4b-5fa7-64bd28610c46@gmail.com>

Hi Andrew,

On 9/30/22 15:05, Andrew Hart via R-help wrote:
> Hi everyone,
>
> Recently I upgraded to R 4.2.1 which now uses UTF-8 internally as its 
> native encoding. Very nice. However, I've discovered that if I use 
> writeClipboard to try and move a string containing accented characters 
> to the Windows clipboard and then try and paste that into another 
> application (e.g. notepad, Eclipse, etc.), the accents turn out all 
> garbled. Here's an example:
>
> writeClipboard("categor?a")
> Pasting the result into this e-mail message yields
> Categor??a
>
> As near as I can tell, the problem seems to have something to do with 
> the format parameter of writeClipboard. By default, format has a value 
> of 1, which tells the clipboard to receive Text in the machine's 
> locale. If I set format=13 in the call, the accents transfer to the 
> clipboard correctly:
>
> writeClipboard("categor?a", format=13)
> and the result is
> Categor?a

Ivan Krylov has kindly turned this into a bug report, please see

https://bugs.r-project.org/show_bug.cgi?id=18412

for more details. In short, yes, using format=13 is recommended, but 
please note it has already been documented in ?writeClipboard.

> It seems that format=13 may be a better default now that R is using 
> UTF-8. It would be nice not to have to specify the format every time I 
> want to copy text to the clipboard with writeClipboard.

Yes, I agree, I've changed the default to format=13.

> Is writeClipboard supposed to perform any kind of encoding conversion 
> or is the format parameter merely informing the clipboard of the kind 
> of payload it's being handed?
>
> Btw, with pre-4.2.0 versions of R, this wasn't a problem. I am very 
> much in favour of R using some kind of Unicode encoding natively, but 
> this wrinkle seems to be something the user shouldn't have to deal 
> with since the Windows clipboard is capable of holding Unicode text. 
> Any advice would be gratefully received.

This is a bit complicated and more can be found in the bug report 
response. In short, the clipboard is capable of holding either "text" 
(then with locale information) or "Unicode text". One can ask Windows 
for either content and Windows will do the conversion, it would convert 
from "text" to "Unicode text" using that locale. If that locale is not 
filled in explicitly, it is the current input language (so the 
"keyboard" the user has selected at the time of the copying to 
clipboard, e.g. of writeClipboard). If that locale encoding doesn't 
match the R current native encoding, and you are using "text", 
characters may be mis-represented. This could have happened even before 
R 4.2.0, but is more likely from R 4.2.0 when it uses UTF-8. Going via 
"Unicode text" resolves the issue as the conversion to/from UTF-16LE is 
done by readClipboard/writeClipboard using the R current native encoding.

Users who don't want to deal with these complexities can use the 
higher-level connections interface (?connections, "clipboard").

Best
Tomas

>
> Thanks,
> ????Andrew.
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide 
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From @@h|mk@poor @end|ng |rom gm@||@com  Thu Oct 13 16:05:16 2022
From: @@h|mk@poor @end|ng |rom gm@||@com (Ashim Kapoor)
Date: Thu, 13 Oct 2022 19:35:16 +0530
Subject: [R] prcomp - arbitrary direction of the returned principal
 components
In-Reply-To: <BN6PR2201MB1553FEB192FBB1F8E56D1AF2CF259@BN6PR2201MB1553.namprd22.prod.outlook.com>
References: <CAC8=1eqUJoYUqq_bDeUCpWL79ootuV44+oSkZ5=oPHnrCsGY5Q@mail.gmail.com>
 <BN6PR2201MB15533913DCFC93FB55E87351CF229@BN6PR2201MB1553.namprd22.prod.outlook.com>
 <CAC8=1epb18uQ9yPvA98dTkCoqnszfB6Ys61Ej3LouMo3jRMzjA@mail.gmail.com>
 <BN6PR2201MB1553FEB192FBB1F8E56D1AF2CF259@BN6PR2201MB1553.namprd22.prod.outlook.com>
Message-ID: <CAC8=1erX-HD1vM86EBVK-tS1ZdooTAfGbub0+TTBwYaSwhEE3g@mail.gmail.com>

Dear All,

Many thanks for your replies.

My PC1 loading turns out to be :

1/sqrt(2) , -1/sqrt(2)

In simple words : I had 2 variables and I ran prcomp on them. I got my
PC1 as :  .7071068 var1 - .7071068 var2

PC2 turned out to be the same as PC1 with a PLUS replacing the minus,
ie. .7071068 var1 + .7071068 var2

But forget PC2 for the time being.

Now my question is : I am not able to use the rule that : choose the
variable with a bigger magnitude of loading and multiply PC1 by -1 if
needed (to flip the PC1 since any vector x and it's flipped version -x
 are the same vector but with opposite direction) if the variable with
bigger magnitude is of negative sign.

I have an alternative measure of stress which is trending UP and has 2
peaks during 2 recessions and I can see that PC1 is trending DOWN and
has 2 TROUGHS during the same recessions. That's how I wish to FLIP
PC1 with a negative sign.

The data is not mine and I am not at liberty to share it. I can
construct an artificial example but I would need time to do that.

That's what's happening.

Best Regards and
Many thanks.
Ashim









On Thu, Oct 13, 2022 at 5:38 PM Ebert,Timothy Aaron <tebert at ufl.edu> wrote:
>
> I still do not understand. However, the general approach would be to identify a specific value to test. If the test is TRUE then do "this" otherwise do nothing. Once the test condition is properly identified, the coding easily follows.
>
>  abs() is the same as
> if x<0 then x = -x   (non-R code, just idea)
> The R code might look something more like
> for (number in 1:ncol(x)){
>    if (x[3,2] < 0) {
>          x[number, number] = -x[number, number] #only change the diagonal
>    }
> }
>
> Depending on what values need to be changed you may need a nested for loop to go through all values of x[number1, number2].
>
> Your words: " I can forcefully use a NEGATIVE sign to FLIP the index when it is LOW." Where it appeared that "low" was defined as values that are negative. You still will have low values (close to zero) and high values (far from zero).
>
> You could make the condition some other value:
>
> if x< -4 then x = -x
>
> If you just want to rotate about zero then
> x = -x
> In this case the positive values will become negative and the negative values positive.
> Add an if test to selectively rotate based on the value of a single test element in x (as in x[3,2]).
>
> In debugging or trouble shooting setting seed is useful. For actual data analysis you should not set seed, or possibly better yet use set.seed(NULL).
>
> Tim
>
>
>
> -----Original Message-----
> From: Ashim Kapoor <ashimkapoor at gmail.com>
> Sent: Thursday, October 13, 2022 12:28 AM
> To: Ebert,Timothy Aaron <tebert at ufl.edu>
> Cc: R Help <r-help at r-project.org>
> Subject: Re: [R] prcomp - arbitrary direction of the returned principal components
>
> [External Email]
>
> Dear Aaron,
>
> Many thanks for your reply.
>
> Please allow me to illustrate my query a bit.
>
> I take some data, throw it to prcomp and extract the x data frame from prcomp.
>
> From ?prcomp:
>
>        x: if 'retx' is true the value of the rotated data (the centred
>           (and scaled if requested) data multiplied by the 'rotation'
>           matrix) is returned.  Hence, 'cov(x)' is the diagonal matrix
>           'diag(sdev^2)'.  For the formula method, 'napredict()' is
>           applied to handle the treatment of values omitted by the
>           'na.action'.
>
> I consider x[,1] as my index. This makes sense as x[,1] is the projection of the data on the FIRST principal component.
> Now this x[,1] can be a high +ve number or a low -ve number. I can't ignore the sign.
>
> If I ignore the sign by taking the absolute value, the HIGH / LOW stress values will be indistinguishable.
>
> Hence I do not think using absolute values of x[,1] is the solution.
> Yes it will make the results REPRODUCIBLE but that will be at the cost of losing information.
>
> Any other idea ?
>
> Many thanks,
> Ashim
>
> On Wed, Oct 12, 2022 at 5:23 PM Ebert,Timothy Aaron <tebert at ufl.edu> wrote:
> >
> > Use absolute value
> >
> > Tim
> >
> > -----Original Message-----
> > From: R-help <r-help-bounces at r-project.org> On Behalf Of Ashim Kapoor
> > Sent: Wednesday, October 12, 2022 7:48 AM
> > To: R Help <r-help at r-project.org>
> > Subject: [R] prcomp - arbitrary direction of the returned principal
> > components
> >
> > [External Email]
> >
> > Dear R experts,
> >
> > From ?prcomp,
> >
> > ---- snip -----
> > Note:
> >
> >      The signs of the columns of the rotation matrix are arbitrary, and
> >      so may differ between different programs for PCA, and even between
> >      different builds of R.
> > ---- snip ------
> >
> > My problem is that I am building an index based on Principal Components Analysis.
> > When the index is high it should indicate stress in the market. Due to the arbitrary sign sometimes I get an index which is HIGH when there is stress and sometimes I get  the OPPOSITE - an index which is LOW when there is stress.
> > This program is shared with other people who may have a different build of R.
> >
> > I can forcefully use a NEGATIVE sign to FLIP the index when it is LOW.
> > That works.
> >
> > Now my query is : Just like we do set.seed(1234) and force the pattern of generation of random number and make it REPRODUCIBLE, can I do something like :
> >
> > set.direction.for.vector.in.pca(1234)
> >
> > Now each time I do prcomp it should choose the SAME ( high or low ) direction of the principle component on ANY computer having ANY version of R installed.
> >
> > That's what I want. I don't want the the returned principal component to be HIGH(LOW) on my computer and LOW(HIGH) on someone else's computer.
> > That would confuse the people the code is shared with.
> >
> > Is this possible ? How do people deal with this ?
> >
> > Many thanks,
> > Ashim
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat
> > .ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl
> > .edu%7C60e6d6ae8645462db99b08daacd36b76%7C0d4da0f84a314d76ace60a62331e
> > 1b84%7C0%7C0%7C638012321302591064%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4w
> > LjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C
> > &amp;sdata=AHMEDU%2BTyInvW%2FH6EZQteO1qZ%2BtW3JZfybfaveTD8Yk%3D&amp;re
> > served=0 PLEASE do read the posting guide
> > https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r
> > -project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%
> > 7C60e6d6ae8645462db99b08daacd36b76%7C0d4da0f84a314d76ace60a62331e1b84%
> > 7C0%7C0%7C638012321302591064%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwM
> > DAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;
> > sdata=yavXAiQorhZjPTozG4Ulo8SuNmR6XFhvA%2FLX9Tfwgi0%3D&amp;reserved=0
> > and provide commented, minimal, self-contained, reproducible code.


From w||||@mwdun|@p @end|ng |rom gm@||@com  Thu Oct 13 16:30:58 2022
From: w||||@mwdun|@p @end|ng |rom gm@||@com (Bill Dunlap)
Date: Thu, 13 Oct 2022 07:30:58 -0700
Subject: [R] cat in a subroutine
In-Reply-To: <3b66dae8-73dc-dbbb-3cb9-20b265f2f0e3@ntu.edu.tw>
References: <3b66dae8-73dc-dbbb-3cb9-20b265f2f0e3@ntu.edu.tw>
Message-ID: <CAHqSRuRRrxFzcka5gyue_tYkO=4eo9yZuic9HG9Hr2L0hqksFA@mail.gmail.com>

Do you have another function called "cat" in scope? (with an argument
called "j")?  Before calling cat("...") call print(cat) and
print(find("cat")).

-Bill


On Thu, Oct 13, 2022 at 12:35 AM Steven T. Yen <styen at ntu.edu.tw> wrote:

> I have had an issue with printing (with cat) in a subroutine for which I
> do not have a applicable example, but I am still hoping to get some
> help. In the following, the first block of code works fine.
>
> ...
>
> t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
> sig<-my.sig.levels(p)
> out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
> rownames(out)<-names(me)
> colnames(out)<-c("est","se","t","p","sig")
> j<-grep(".one\\b",rownames(out))
> out<-out[-j,]
> return(out)
> }
>
> But as soon as I insert lines to print (cat) soething simple, it spits
> out message that appears to be nonsence (unrelated). Any idea. Please
> help. Thanks.
>
> t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
> sig<-my.sig.levels(p)
> out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
> rownames(out)<-names(me)
> colnames(out)<-c("est","se","t","p","sig")
> cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit
> Probabilities",
>      "\n\nlogistic =",logistic)
> j<-grep(".one\\b",rownames(out))
> out<-out[-j,]
> return(out)
> }
>
> In this particular case, the error message was as follows:
>
> Error in cat("\nMarginal and Discrete Effects of Gen Ordered Logit /
> Probit Probabilities",  :
>    unused argument (logistic)
>
> I have printed this way in numerous routines without problem and do not
> see why this is happending.
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From pro|jcn@@h @end|ng |rom gm@||@com  Thu Oct 13 16:42:58 2022
From: pro|jcn@@h @end|ng |rom gm@||@com (John C Nash)
Date: Thu, 13 Oct 2022 10:42:58 -0400
Subject: [R] prcomp - arbitrary direction of the returned principal
 components
In-Reply-To: <CAC8=1erX-HD1vM86EBVK-tS1ZdooTAfGbub0+TTBwYaSwhEE3g@mail.gmail.com>
References: <CAC8=1eqUJoYUqq_bDeUCpWL79ootuV44+oSkZ5=oPHnrCsGY5Q@mail.gmail.com>
 <BN6PR2201MB15533913DCFC93FB55E87351CF229@BN6PR2201MB1553.namprd22.prod.outlook.com>
 <CAC8=1epb18uQ9yPvA98dTkCoqnszfB6Ys61Ej3LouMo3jRMzjA@mail.gmail.com>
 <BN6PR2201MB1553FEB192FBB1F8E56D1AF2CF259@BN6PR2201MB1553.namprd22.prod.outlook.com>
 <CAC8=1erX-HD1vM86EBVK-tS1ZdooTAfGbub0+TTBwYaSwhEE3g@mail.gmail.com>
Message-ID: <ce3eee070ad1da7cdd48d61cc48777098c17ebbd.camel@gmail.com>

This reminds me of a situation in 1975 where a large computer service bureau had
contracted to migrate scientific software from a Univac 1108 to a an IBM System 360.
They spent 3 weeks trying to get the IBM to give the same eigenvectors on a problem as the
Univac. There were at least 2 eigenvalues that were equal. They were trying to fix
something that was not broken. Their desperation was enough to offer me a very large fee
to "fix" things. However, I had a nice job, so told them to go away and read a couple of
books on the real-symmetric eigenvalue problem or singular value decomposition, though the
latter was just becoming known outside of numerical linear algebra.

I suspect the OP should go back to basics with principal components and not try to fiddle
with the output. It is likely that the "loadings" (I'm never sure of the nomenclature -- I
use the matrix setup) can be rotated, but you can't just rotate one vector of a set on its
own.

Amazing how these old issues linger for decades. Or maybe linear algebra is not on the
curriculum.

John Nash



On Thu, 2022-10-13 at 19:35 +0530, Ashim Kapoor wrote:
> Dear All,
> 
> Many thanks for your replies.
> 
> My PC1 loading turns out to be :
> 
> 1/sqrt(2) , -1/sqrt(2)
> 
> In simple words : I had 2 variables and I ran prcomp on them. I got my
> PC1 as :? .7071068 var1 - .7071068 var2
> 
> PC2 turned out to be the same as PC1 with a PLUS replacing the minus,
> ie. .7071068 var1 + .7071068 var2
> 
> But forget PC2 for the time being.
> 
> Now my question is : I am not able to use the rule that : choose the
> variable with a bigger magnitude of loading and multiply PC1 by -1 if
> needed (to flip the PC1 since any vector x and it's flipped version -x
> ?are the same vector but with opposite direction) if the variable with
> bigger magnitude is of negative sign.
> 
> I have an alternative measure of stress which is trending UP and has 2
> peaks during 2 recessions and I can see that PC1 is trending DOWN and
> has 2 TROUGHS during the same recessions. That's how I wish to FLIP
> PC1 with a negative sign.
> 
> The data is not mine and I am not at liberty to share it. I can
> construct an artificial example but I would need time to do that.
> 
> That's what's happening.
> 
> Best Regards and
> Many thanks.
> Ashim
> 
> 
> 
> 
> 
> 
> 
> 
> 
> On Thu, Oct 13, 2022 at 5:38 PM Ebert,Timothy Aaron <tebert at ufl.edu> wrote:
> > 
> > I still do not understand. However, the general approach would be to identify a
> > specific value to test. If the test is TRUE then do "this" otherwise do nothing. Once
> > the test condition is properly identified, the coding easily follows.
> > 
> > ?abs() is the same as
> > if x<0 then x = -x?? (non-R code, just idea)
> > The R code might look something more like
> > for (number in 1:ncol(x)){
> > ?? if (x[3,2] < 0) {
> > ???????? x[number, number] = -x[number, number] #only change the diagonal
> > ?? }
> > }
> > 
> > Depending on what values need to be changed you may need a nested for loop to go
> > through all values of x[number1, number2].
> > 
> > Your words: " I can forcefully use a NEGATIVE sign to FLIP the index when it is LOW."
> > Where it appeared that "low" was defined as values that are negative. You still will
> > have low values (close to zero) and high values (far from zero).
> > 
> > You could make the condition some other value:
> > 
> > if x< -4 then x = -x
> > 
> > If you just want to rotate about zero then
> > x = -x
> > In this case the positive values will become negative and the negative values
> > positive.
> > Add an if test to selectively rotate based on the value of a single test element in x
> > (as in x[3,2]).
> > 
> > In debugging or trouble shooting setting seed is useful. For actual data analysis you
> > should not set seed, or possibly better yet use set.seed(NULL).
> > 
> > Tim
> > 
> > 
> > 
> > -----Original Message-----
> > From: Ashim Kapoor <ashimkapoor at gmail.com>
> > Sent: Thursday, October 13, 2022 12:28 AM
> > To: Ebert,Timothy Aaron <tebert at ufl.edu>
> > Cc: R Help <r-help at r-project.org>
> > Subject: Re: [R] prcomp - arbitrary direction of the returned principal components
> > 
> > [External Email]
> > 
> > Dear Aaron,
> > 
> > Many thanks for your reply.
> > 
> > Please allow me to illustrate my query a bit.
> > 
> > I take some data, throw it to prcomp and extract the x data frame from prcomp.
> > 
> > From ?prcomp:
> > 
> > ?????? x: if 'retx' is true the value of the rotated data (the centred
> > ????????? (and scaled if requested) data multiplied by the 'rotation'
> > ????????? matrix) is returned.? Hence, 'cov(x)' is the diagonal matrix
> > ????????? 'diag(sdev^2)'.? For the formula method, 'napredict()' is
> > ????????? applied to handle the treatment of values omitted by the
> > ????????? 'na.action'.
> > 
> > I consider x[,1] as my index. This makes sense as x[,1] is the projection of the data
> > on the FIRST principal component.
> > Now this x[,1] can be a high +ve number or a low -ve number. I can't ignore the sign.
> > 
> > If I ignore the sign by taking the absolute value, the HIGH / LOW stress values will
> > be indistinguishable.
> > 
> > Hence I do not think using absolute values of x[,1] is the solution.
> > Yes it will make the results REPRODUCIBLE but that will be at the cost of losing
> > information.
> > 
> > Any other idea ?
> > 
> > Many thanks,
> > Ashim
> > 
> > On Wed, Oct 12, 2022 at 5:23 PM Ebert,Timothy Aaron <tebert at ufl.edu> wrote:
> > > 
> > > Use absolute value
> > > 
> > > Tim
> > > 
> > > -----Original Message-----
> > > From: R-help <r-help-bounces at r-project.org> On Behalf Of Ashim Kapoor
> > > Sent: Wednesday, October 12, 2022 7:48 AM
> > > To: R Help <r-help at r-project.org>
> > > Subject: [R] prcomp - arbitrary direction of the returned principal
> > > components
> > > 
> > > [External Email]
> > > 
> > > Dear R experts,
> > > 
> > > From ?prcomp,
> > > 
> > > ---- snip -----
> > > Note:
> > > 
> > > ???? The signs of the columns of the rotation matrix are arbitrary, and
> > > ???? so may differ between different programs for PCA, and even between
> > > ???? different builds of R.
> > > ---- snip ------
> > > 
> > > My problem is that I am building an index based on Principal Components Analysis.
> > > When the index is high it should indicate stress in the market. Due to the arbitrary
> > > sign sometimes I get an index which is HIGH when there is stress and sometimes I
> > > get? the OPPOSITE - an index which is LOW when there is stress.
> > > This program is shared with other people who may have a different build of R.
> > > 
> > > I can forcefully use a NEGATIVE sign to FLIP the index when it is LOW.
> > > That works.
> > > 
> > > Now my query is : Just like we do set.seed(1234) and force the pattern of generation
> > > of random number and make it REPRODUCIBLE, can I do something like :
> > > 
> > > set.direction.for.vector.in.pca(1234)
> > > 
> > > Now each time I do prcomp it should choose the SAME ( high or low ) direction of the
> > > principle component on ANY computer having ANY version of R installed.
> > > 
> > > That's what I want. I don't want the the returned principal component to be
> > > HIGH(LOW) on my computer and LOW(HIGH) on someone else's computer.
> > > That would confuse the people the code is shared with.
> > > 
> > > Is this possible ? How do people deal with this ?
> > > 
> > > Many thanks,
> > > Ashim
> > > 
> > > ______________________________________________
> > > R-help at r-project.org?mailing list -- To UNSUBSCRIBE and more, see
> > > https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat
> > > .ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl
> > > .edu%7C60e6d6ae8645462db99b08daacd36b76%7C0d4da0f84a314d76ace60a62331e
> > > 1b84%7C0%7C0%7C638012321302591064%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4w
> > > LjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C
> > > &amp;sdata=AHMEDU%2BTyInvW%2FH6EZQteO1qZ%2BtW3JZfybfaveTD8Yk%3D&amp;re
> > > served=0 PLEASE do read the posting guide
> > > https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r
> > > -project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%
> > > 7C60e6d6ae8645462db99b08daacd36b76%7C0d4da0f84a314d76ace60a62331e1b84%
> > > 7C0%7C0%7C638012321302591064%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwM
> > > DAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;
> > > sdata=yavXAiQorhZjPTozG4Ulo8SuNmR6XFhvA%2FLX9Tfwgi0%3D&amp;reserved=0
> > > and provide commented, minimal, self-contained, reproducible code.
> 
> ______________________________________________
> R-help at r-project.org?mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Thu Oct 13 17:41:41 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Thu, 13 Oct 2022 17:41:41 +0200
Subject: [R] UTF-8 to the console
In-Reply-To: <b07c7fad-1890-e40c-d111-d4ce70cf88a1@bebac.at>
References: <b07c7fad-1890-e40c-d111-d4ce70cf88a1@bebac.at>
Message-ID: <3f1dc670-9a62-03f7-9884-ebf49220e437@gmail.com>

Dear Helmut,

thanks for the report, this is actually a bug in Rterm (or Windows, hard 
to tell, but something that can be fixed in Rterm). More below

On 6/23/22 12:26, Helmut Sch?tz wrote:
> Dear all,
>
> I want to send UTF-8 characters to the console. Font in the 
> GUI-Preference 'Lucida Console', supporting the desired symbols:
> greater than or equal: UTF-8 2265, HTML-entity &ge; HTML-Unicode 
> &#8805; TeX \ge
> approximately equal: UTF-8 2248, HTML-entity &asymp; HTML-Unicode 
> &#8776; TeX \approx
>
> txt <- "x ? y, x \u2265 y; a ? b, a \u2248 b"
> Encoding(txt) <- "UTF-8"
> print(txt)
> [1] "x = y, x = y; a \230 b, a \230 b"
> cat(txt, "\n")
> x = y, x = y; a ? b, a ? b
>
> Desired "x ? y, x ? y; a ? b, a ? b"
>
> I'm sending the email in UTF-8. Don?t know how @r-project.org is 
> configured (ASCII?) If you see garbage, I'm sorry but you should get 
> the idea.
>
> R 4.2.0 on Windows 7 (UCRT10.0.10240.16390) and Windows 11.

The underlying problem I can reproduce on my Windows 10 (which is almost 
surely what you are seeing on Windows 11) is that characters ? and ? 
cannot be pasted to RTerm when running in cmd.exe or PowerShell. Pasting 
these characters pastes nothing.

I've fixed this now in R-devel 83094 (and R-patched 83095). I would be 
grateful if you (or anyone else) could test e.g. in R-patched, most 
likely this example will work as it did for me, but also other examples 
you can think of. Processing the input keys in Rterm/getline is very 
tricky and brittle. What the code sees depends on what the console 
implementation decides to do, and it differs for different console 
implementations, and sadly this is not documented as far as I could find.

Now, the problem you reported does not happen in Msys2/mintty (so 
Rtools42) terminal, because the terminal uses a different console 
implementation. Also, the problem doesn't happen with the Windows 
Terminal application, which has a yet different implementation. If you 
ever needed a work-around to such problems, I would recommend trying the 
Windows Terminal application.

The problem doesn't happen in Rgui, either, but that uses a different 
code path completely on R end, indeed it does not run Rterm.

There is a key combination "Alt+I" you can press in RTerm, which will 
switch to debug mode and will display the keyboard codes R receives (it 
matches the sources in getline.c). When one sees different behavior of 
things like your reported problem in with different console 
implementations, it usually comes with different keyboard codes sent to R.

Your report has been very useful, thanks, and sorry for the long delay. 
I would have spotted it earlier on R bugzilla (or R-devel) list.

Best
Tomas

>
> Helmut


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Thu Oct 13 18:03:30 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Thu, 13 Oct 2022 18:03:30 +0200
Subject: [R] UTF-8 to the console
In-Reply-To: <20220623143616.072fc859@arachnoid>
References: <b07c7fad-1890-e40c-d111-d4ce70cf88a1@bebac.at>
 <20220623143616.072fc859@arachnoid>
Message-ID: <4d709fd0-ce0b-719d-dad8-4d1ba1bc090f@gmail.com>


On 6/23/22 13:36, Ivan Krylov wrote:
> On Thu, 23 Jun 2022 12:26:23 +0200
> Helmut Sch?tz <helmut.schuetz at bebac.at> wrote:
>
>> txt <- "x ? y, x \u2265 y; a ? b, a \u2248 b"
>> Encoding(txt) <- "UTF-8"
> There shouldn't be a need to change the encoding. If you're creating a
> Unicode literal, R should already choose UTF-8 for the resulting
> string. Either way, R automatically converts the strings from their
> source encoding on output.
>
> Moreover, `Encoding<-` doesn't perform any conversion, it only changes
> the declared encoding on the string, affecting the way it may be
> encoded or decoded in the future. If Encoding(txt) wasn't already UTF-8,
> you would likely be damaging the data:
>
> string <- '?' # is already UTF-8
> # No conversion happens, the same bytes re-interpreted differently
> Encoding(string) <- 'latin1'
> string
> # [1] "??"
>
>> R 4.2.0 on Windows 7
> On Windows 7, Rterm will stay limited to the OEM encoding, since UCRT
> only supports UTF-8 locales on Windows ? 10, version 1903. If your OEM
> encoding doesn't have the ?, ? characters, printing them to the console
> is going to be hard. Not impossible -- e.g. an R extension written in C
> could obtain a handle to the current console and use Unicode-aware
> Windows API to print these characters -- but just getting it to work
> would be hard, and it will be likely unportable.
>
>> and Windows 11.
> I think it should be possible. What does system('chcp') say in your
> Rterm session?
>
> For console UTF-8 output to work, two things should happen:
>
> 1. The console must be using UTF-8, i.e. chcp must say it's using code
> page 65001.
>
> 2. Rterm must understand that and also use UTF-8 on output.
>
> What does sessionInfo() and l10n_info() say in your Rterm session on
> Windows 11? In Rterm source code, I see a check for GetACP() == 65001,
> which should have switched the console encoding to UTF-8 automatically.
>
> Perhaps you need to run chcp 65001 before starting Rterm? Maybe you
> need to set a checkbox [*] to make the ANSI codepage UTF-8 by default?
> I'm not sure any of this is going to work, but it's something to try
> before someone more knowledgeable with R on Windows can help you.

You are right, R already tries to set the console code page itself to 
65001, so chcp is no longer needed to change it.

On Windows 7 UTF-8 would not be used by R because it can't be the 
"system encoding" (ACP), and I suppose Helmut's output was from that 
version of Windows:

x = y, x = y; a ? b, a ? b

This suggests transliteration ("best-fit") of the characters not 
representable in the session encoding, done by Windows. On Windows 7, 
characters not representable in the user locale encoding will not be 
usable in Rterm, there is no way around that, but one can e.g. use Rgui.

On new Windows, such as Windows 11, there was a bug in Rterm as I 
reported in the other email, fixed now. The output on my Windows 10 was:

x? y, x ? y; a? b, a ? b

So the characters pasted were missing, but the characters expressed via 
\u escapes were printed correctly. This was a problem between the 
windows console implementation used in cmd.exe/powershell and 
Rterm/getline. What is characteristic for these problems is that the 
behavior differs from when Rterm runs from the Windows Terminal 
application (or possibly Msys2 mintty/winpty/bash).

Best
Tomas

>


From me @end|ng |rom n@nx@me  Wed Oct 12 20:05:35 2022
From: me @end|ng |rom n@nx@me (Nan Xiao)
Date: Wed, 12 Oct 2022 14:05:35 -0400
Subject: [R] [R-pkgs] gsDesign 3.4.0 is released
Message-ID: <b16750c6-f7ad-4399-9077-574ba3d06236@app.fastmail.com>

Dear all,

A new version of gsDesign (3.4.0) is now on CRAN (https://cran.r-project.org/package=gsDesign). gsDesign supports group sequential clinical trial design, largely as presented in Jennison and Turnbull (2000).

This version removes restrictions on conditional power calculations for interim test statistic and brings improvements on dependencies and lifecycle management. Please see the changelog (https://keaven.github.io/gsDesign/news/) for details.

Thanks,
-Nan

_______________________________________________
R-packages mailing list
R-packages at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-packages


From gm@|om@ok|1980 @end|ng |rom gm@||@com  Thu Oct 13 20:08:35 2022
From: gm@|om@ok|1980 @end|ng |rom gm@||@com (=?UTF-8?Q?G=C3=A1bor_Malomsoki?=)
Date: Thu, 13 Oct 2022 20:08:35 +0200
Subject: [R] intersection in data frame
Message-ID: <CAEJRAFaCUdRjCd6hXjs=0Z0pjw92j1yiZxPj5hLJeX5TmVOvgQ@mail.gmail.com>

Dears,

i need to create from a column of observations variables in a datafram like
this way:
example:
original:
ID    station  value
12      xy        15
12      xz        20
13       xy       16
13       xz       19

new df:

 ID      xy     xz
12      15     20
13      16     19

i have been looking around for examples, but i could not find any how to
change my df.
I would like to make regression analysis on the values from different
production stations, so my df is very huge.

Please help on finding the package, description or anything else could help.

Thank you in advance!

Best regards
Malo

	[[alternative HTML version deleted]]


From btupper @end|ng |rom b|ge|ow@org  Thu Oct 13 23:17:33 2022
From: btupper @end|ng |rom b|ge|ow@org (Ben Tupper)
Date: Thu, 13 Oct 2022 17:17:33 -0400
Subject: [R] intersection in data frame
In-Reply-To: <CAEJRAFaCUdRjCd6hXjs=0Z0pjw92j1yiZxPj5hLJeX5TmVOvgQ@mail.gmail.com>
References: <CAEJRAFaCUdRjCd6hXjs=0Z0pjw92j1yiZxPj5hLJeX5TmVOvgQ@mail.gmail.com>
Message-ID: <CALrbzg2-ZagoS=rw2ER+ZPZR_ocYL1jgjNyoruePsQx4nYiL1Q@mail.gmail.com>

Hi,

If you are game to use a tidy approach then you can use tidyr::pivot_wider()

library(dplyr)
library(tidyr)

x <- dplyr::tribble(
  ~ID, ~station,  ~value,
  12, "xy", 15,
  12, "xz", 20,
  13, "xy", 16,
  13, "xz", 19)

tidyr::pivot_wider(x,
                   names_from = station,
                   values_from = value)
#> # A tibble: 2 ? 3
#>      ID    xy    xz
#>   <dbl> <dbl> <dbl>
#> 1    12    15    20
#> 2    13    16    19

Cheers,
Ben


On Thu, Oct 13, 2022 at 5:07 PM G?bor Malomsoki
<gmalomsoki1980 at gmail.com> wrote:
>
> Dears,
>
> i need to create from a column of observations variables in a datafram like
> this way:
> example:
> original:
> ID    station  value
> 12      xy        15
> 12      xz        20
> 13       xy       16
> 13       xz       19
>
> new df:
>
>  ID      xy     xz
> 12      15     20
> 13      16     19
>
> i have been looking around for examples, but i could not find any how to
> change my df.
> I would like to make regression analysis on the values from different
> production stations, so my df is very huge.
>
> Please help on finding the package, description or anything else could help.
>
> Thank you in advance!
>
> Best regards
> Malo
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Thu Oct 13 23:22:18 2022
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Thu, 13 Oct 2022 22:22:18 +0100
Subject: [R] intersection in data frame
In-Reply-To: <CAEJRAFaCUdRjCd6hXjs=0Z0pjw92j1yiZxPj5hLJeX5TmVOvgQ@mail.gmail.com>
References: <CAEJRAFaCUdRjCd6hXjs=0Z0pjw92j1yiZxPj5hLJeX5TmVOvgQ@mail.gmail.com>
Message-ID: <e2190d9c-335e-99ac-c8b8-cf05db01369a@sapo.pt>

Hello,

To reshape from long to wide format, here are two options:


df1 <- 'ID    station  value
12      xy        15
12      xz        20
13       xy       16
13       xz       19'
df1 <- read.table(textConnection(df1), header = TRUE)


# base R
reshape(df1, direction = "wide", idvar = "ID", timevar = "station")
#>   ID value.xy value.xz
#> 1 12       15       20
#> 3 13       16       19

# tidyverse
tidyr::pivot_wider(df1, ID, names_from = station)
#> # A tibble: 2 ? 3
#>      ID    xy    xz
#>   <int> <int> <int>
#> 1    12    15    20
#> 2    13    16    19


This question is StackOverflow question [1].

[1] 
https://stackoverflow.com/questions/5890584/how-to-reshape-data-from-long-to-wide-format


Hope this helps,

Rui Barradas


?s 19:08 de 13/10/2022, G?bor Malomsoki escreveu:
> Dears,
> 
> i need to create from a column of observations variables in a datafram like
> this way:
> example:
> original:
> ID    station  value
> 12      xy        15
> 12      xz        20
> 13       xy       16
> 13       xz       19
> 
> new df:
> 
>   ID      xy     xz
> 12      15     20
> 13      16     19
> 
> i have been looking around for examples, but i could not find any how to
> change my df.
> I would like to make regression analysis on the values from different
> production stations, so my df is very huge.
> 
> Please help on finding the package, description or anything else could help.
> 
> Thank you in advance!
> 
> Best regards
> Malo
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From toth@dene@ @end|ng |rom kogentum@hu  Fri Oct 14 01:31:26 2022
From: toth@dene@ @end|ng |rom kogentum@hu (=?UTF-8?B?RMOpbmVzIFTDs3Ro?=)
Date: Fri, 14 Oct 2022 01:31:26 +0200
Subject: [R] intersection in data frame
In-Reply-To: <e2190d9c-335e-99ac-c8b8-cf05db01369a@sapo.pt>
References: <CAEJRAFaCUdRjCd6hXjs=0Z0pjw92j1yiZxPj5hLJeX5TmVOvgQ@mail.gmail.com>
 <e2190d9c-335e-99ac-c8b8-cf05db01369a@sapo.pt>
Message-ID: <21d82746-b11b-3b73-dde7-e22d62717bb2@kogentum.hu>

Or if your data is really large, you can try data.table::dcast().

 > library(data.table)
 > dcast(ID ~ station, data = as.data.table(df1))
    ID xy xz
1: 12 15 20
2: 13 16 19

(Note: instead of `as.data.table()`, you can use `setDT` or create your 
object as a data.table in the first place.)


On 10/13/22 11:22 PM, Rui Barradas wrote:
> Hello,
> 
> To reshape from long to wide format, here are two options:
> 
> 
> df1 <- 'ID??? station? value
> 12????? xy??????? 15
> 12????? xz??????? 20
> 13?????? xy?????? 16
> 13?????? xz?????? 19'
> df1 <- read.table(textConnection(df1), header = TRUE)
> 
> 
> # base R
> reshape(df1, direction = "wide", idvar = "ID", timevar = "station")
> #>?? ID value.xy value.xz
> #> 1 12?????? 15?????? 20
> #> 3 13?????? 16?????? 19
> 
> # tidyverse
> tidyr::pivot_wider(df1, ID, names_from = station)
> #> # A tibble: 2 ? 3
> #>????? ID??? xy??? xz
> #>?? <int> <int> <int>
> #> 1??? 12??? 15??? 20
> #> 2??? 13??? 16??? 19
> 
> 
> This question is StackOverflow question [1].
> 
> [1] 
> https://stackoverflow.com/questions/5890584/how-to-reshape-data-from-long-to-wide-format 
> 
> 
> 
> Hope this helps,
> 
> Rui Barradas
> 
> 
> ?s 19:08 de 13/10/2022, G?bor Malomsoki escreveu:
>> Dears,
>>
>> i need to create from a column of observations variables in a datafram 
>> like
>> this way:
>> example:
>> original:
>> ID??? station? value
>> 12????? xy??????? 15
>> 12????? xz??????? 20
>> 13?????? xy?????? 16
>> 13?????? xz?????? 19
>>
>> new df:
>>
>> ? ID????? xy???? xz
>> 12????? 15???? 20
>> 13????? 16???? 19
>>
>> i have been looking around for examples, but i could not find any how to
>> change my df.
>> I would like to make regression analysis on the values from different
>> production stations, so my df is very huge.
>>
>> Please help on finding the package, description or anything else could 
>> help.
>>
>> Thank you in advance!
>>
>> Best regards
>> Malo
>>
>> ????[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide 
>> http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide 
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>


From @tyen @end|ng |rom ntu@edu@tw  Fri Oct 14 03:09:35 2022
From: @tyen @end|ng |rom ntu@edu@tw (Steven T. Yen)
Date: Fri, 14 Oct 2022 09:09:35 +0800
Subject: [R] cat in a subroutine
In-Reply-To: <CAHqSRuRRrxFzcka5gyue_tYkO=4eo9yZuic9HG9Hr2L0hqksFA@mail.gmail.com>
References: <3b66dae8-73dc-dbbb-3cb9-20b265f2f0e3@ntu.edu.tw>
 <CAHqSRuRRrxFzcka5gyue_tYkO=4eo9yZuic9HG9Hr2L0hqksFA@mail.gmail.com>
Message-ID: <1b045b90-b144-39e6-b492-33bf8be48d67@ntu.edu.tw>

Hello, Oh Lord, yes, I had a function called "cat", with argument "j". 
That was very dumb.

Renaming function cat resolved the problem. I had lived with this 
problem too long---avoiding printing with cat altogether in this 
program. Thanks to all-----Bill, Iva, Jim, Erin, Andrew for help!

On 10/13/2022 10:30 PM, Bill Dunlap wrote:
> Do you have another function called "cat" in scope? (with an argument 
> called "j")?? Before calling cat("...") call print(cat) and 
> print(find("cat")).
>
> -Bill
>
>
> On Thu, Oct 13, 2022 at 12:35 AM Steven T. Yen <styen at ntu.edu.tw> wrote:
>
>     I have had an issue with printing (with cat) in a subroutine for
>     which I
>     do not have a applicable example, but I am still hoping to get some
>     help. In the following, the first block of code works fine.
>
>     ...
>
>     t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
>     sig<-my.sig.levels(p)
>     out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
>     rownames(out)<-names(me)
>     colnames(out)<-c("est","se","t","p","sig")
>     j<-grep(".one\\b",rownames(out))
>     out<-out[-j,]
>     return(out)
>     }
>
>     But as soon as I insert lines to print (cat) soething simple, it
>     spits
>     out message that appears to be nonsence (unrelated). Any idea. Please
>     help. Thanks.
>
>     t<-abs(me)/se; p<-2*(1-pt(t,nrow(x)))
>     sig<-my.sig.levels(p)
>     out<-data.frame(round(cbind(me,se,t,p),digits)); out<-cbind(out,sig)
>     rownames(out)<-names(me)
>     colnames(out)<-c("est","se","t","p","sig")
>     cat("\nMarginal and Discrete Effects of Gen Ordered Logit / Probit
>     Probabilities",
>     ???? "\n\nlogistic =",logistic)
>     j<-grep(".one\\b",rownames(out))
>     out<-out[-j,]
>     return(out)
>     }
>
>     In this particular case, the error message was as follows:
>
>     Error in cat("\nMarginal and Discrete Effects of Gen Ordered Logit /
>     Probit Probabilities",? :
>     ?? unused argument (logistic)
>
>     I have printed this way in numerous routines without problem and
>     do not
>     see why this is happending.
>
>     ______________________________________________
>     R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>     https://stat.ethz.ch/mailman/listinfo/r-help
>     PLEASE do read the posting guide
>     http://www.R-project.org/posting-guide.html
>     <http://www.R-project.org/posting-guide.html>
>     and provide commented, minimal, self-contained, reproducible code.
>
	[[alternative HTML version deleted]]


From drj|m|emon @end|ng |rom gm@||@com  Fri Oct 14 05:34:03 2022
From: drj|m|emon @end|ng |rom gm@||@com (Jim Lemon)
Date: Fri, 14 Oct 2022 14:34:03 +1100
Subject: [R] Forestplot, grid graphics Viewplot grid.arange
In-Reply-To: <MN2PR04MB6702AE692142D79F71F213BC97209@MN2PR04MB6702.namprd04.prod.outlook.com>
References: <MN2PR04MB6702AE692142D79F71F213BC97209@MN2PR04MB6702.namprd04.prod.outlook.com>
Message-ID: <CA+8X3fVh3bJqZ8VNTujuB-VsWp7VOtniZtzqm9m+G9K7fuFvhg@mail.gmail.com>

Hi Mary,
I didn't see any answers to your post, but doing something like this
is quite easy in base graphics. If you are still stuck, I may be able
to suggest something.

Jim

On Mon, Oct 10, 2022 at 6:05 PM Putt, Mary <mputt at pennmedicine.upenn.edu> wrote:
>
>
> I have created several plots using the forestplot package and the link shown here. <https://cran.r-project.org/web/packages/forestplot/vignettes/forestplot.html > Great package !
> Next step is to combine two plots into a single graphic. The code provided on the link results in 'bleeding' of the graphics/text into each other. I don't want to clip it as I need the text elements. I am guessing the problem involves the combination of text and graphics in the 'plot'. I fooled around with the original post and also did some hunting online but no luck Thanks in advance.
> library(foresplot)
> data("dfHRQoL")
>
> #create individual forest plots for Sweden and Denmark
> fp_sweden <- dfHRQoL |>
>   filter(group == "Sweden") |>
>   mutate(est = sprintf("%.2f", mean), .after = labeltext) |>
>   forestplot(labeltext = c(labeltext, est),
>              title = "Sweden",
>              clip = c(-.1, Inf),
>              xlab = "EQ-5D index",
>              new_page = FALSE)
>
> fp_denmark <- dfHRQoL |>
>   filter(group == "Denmark") |>
>   mutate(est = sprintf("%.2f", mean), .after = labeltext) |>
>   forestplot(labeltext = c(labeltext, est),
>              title = "Denmark",
>              clip = c(-.1, Inf),
>              xlab = "EQ-5D index",
>              new_page = FALSE)
>
>
>
> #now combine into a single plot using the web code; but this one bleeds into each other
> library(grid)
>
> #####
> #Put plots together using grid graphics
> #Attempt 1 from website
>
> #####
> grid.newpage()
> borderWidth <- unit(4, "pt")
> width <- unit(convertX(unit(1, "npc") - borderWidth, unitTo = "npc", valueOnly = TRUE)/2, "npc")
> pushViewport(viewport(layout = grid.layout(nrow = 1,
>                                            ncol = 3,
>                                            widths = unit.c(width,
>                                                            borderWidth,
>                                                            width))
> )
> )
> pushViewport(viewport(layout.pos.row = 1,
>                       layout.pos.col = 1))
> fp_sweden
> upViewport()
> pushViewport(viewport(layout.pos.row = 1,
>                       layout.pos.col = 2))
> grid.rect(gp = gpar(fill = "grey", col = "red"))
> upViewport()
> pushViewport(viewport(layout.pos.row = 1,
>                       layout.pos.col = 3))
> fp_denmark
> upViewport(2)
>
>
> ####
> #Attempt 2 from website, still a problem.
> ####
> grid.newpage()
> borderWidth <- unit(4, "pt")
> width <- unit(convertX(unit(1, "npc") - borderWidth, unitTo = "npc", valueOnly = TRUE)/2, "npc")
> pushViewport(viewport(layout = grid.layout(nrow = 1,
>                                            ncol = 3,
>                                            widths = c(0.45, 0.1, 0.45))
> )
> )
> pushViewport(viewport(layout.pos.row = 1,
>                       layout.pos.col = 1))
> fp_sweden
> upViewport()
>
> pushViewport(viewport(layout.pos.row = 1,
>                       layout.pos.col = 3))
> fp_denmark
> upViewport(2)
>
> ###
> #Attempt 3 converting to grobs and use patchwork
> ###
> library(ggplotify)
> library(patchwork)
>
> fpd_grob <- grid2grob(print(fp_denmark))
>
> p1 <- grid2grob(print(fp_denmark))
> p2 <- grid2grob(print(fp_sweden))
> p_both <- wrap_elements(p1) + wrap_elements(p2)
> p_both
>
> #same problem with grid.arrange()**strong text**
>
>
>
> Mary Putt, PhD, ScD
> Professor of Biostatistics
> Department of Biostatistics, Epidemiology & Informatics
> Pereleman School of Medicine
> University of Pennsylvania
>
> 215-573-7020
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From ||@t@ @end|ng |rom dewey@myzen@co@uk  Fri Oct 14 14:24:35 2022
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Fri, 14 Oct 2022 13:24:35 +0100
Subject: [R] Forestplot, grid graphics Viewplot grid.arange
In-Reply-To: <CA+8X3fVh3bJqZ8VNTujuB-VsWp7VOtniZtzqm9m+G9K7fuFvhg@mail.gmail.com>
References: <MN2PR04MB6702AE692142D79F71F213BC97209@MN2PR04MB6702.namprd04.prod.outlook.com>
 <CA+8X3fVh3bJqZ8VNTujuB-VsWp7VOtniZtzqm9m+G9K7fuFvhg@mail.gmail.com>
Message-ID: <951d7f81-aac6-d0fe-f450-ff6f8ae6d30c@dewey.myzen.co.uk>

There are several other CRAN packages which provide forest plots (see 
CRAN Task View for details) and they do not all use grip graphics which 
I think the forestplot package does. It might be worth swapping to one 
of them.

Michael

On 14/10/2022 04:34, Jim Lemon wrote:
> Hi Mary,
> I didn't see any answers to your post, but doing something like this
> is quite easy in base graphics. If you are still stuck, I may be able
> to suggest something.
> 
> Jim
> 
> On Mon, Oct 10, 2022 at 6:05 PM Putt, Mary <mputt at pennmedicine.upenn.edu> wrote:
>>
>>
>> I have created several plots using the forestplot package and the link shown here. <https://cran.r-project.org/web/packages/forestplot/vignettes/forestplot.html > Great package !
>> Next step is to combine two plots into a single graphic. The code provided on the link results in 'bleeding' of the graphics/text into each other. I don't want to clip it as I need the text elements. I am guessing the problem involves the combination of text and graphics in the 'plot'. I fooled around with the original post and also did some hunting online but no luck Thanks in advance.
>> library(foresplot)
>> data("dfHRQoL")
>>
>> #create individual forest plots for Sweden and Denmark
>> fp_sweden <- dfHRQoL |>
>>    filter(group == "Sweden") |>
>>    mutate(est = sprintf("%.2f", mean), .after = labeltext) |>
>>    forestplot(labeltext = c(labeltext, est),
>>               title = "Sweden",
>>               clip = c(-.1, Inf),
>>               xlab = "EQ-5D index",
>>               new_page = FALSE)
>>
>> fp_denmark <- dfHRQoL |>
>>    filter(group == "Denmark") |>
>>    mutate(est = sprintf("%.2f", mean), .after = labeltext) |>
>>    forestplot(labeltext = c(labeltext, est),
>>               title = "Denmark",
>>               clip = c(-.1, Inf),
>>               xlab = "EQ-5D index",
>>               new_page = FALSE)
>>
>>
>>
>> #now combine into a single plot using the web code; but this one bleeds into each other
>> library(grid)
>>
>> #####
>> #Put plots together using grid graphics
>> #Attempt 1 from website
>>
>> #####
>> grid.newpage()
>> borderWidth <- unit(4, "pt")
>> width <- unit(convertX(unit(1, "npc") - borderWidth, unitTo = "npc", valueOnly = TRUE)/2, "npc")
>> pushViewport(viewport(layout = grid.layout(nrow = 1,
>>                                             ncol = 3,
>>                                             widths = unit.c(width,
>>                                                             borderWidth,
>>                                                             width))
>> )
>> )
>> pushViewport(viewport(layout.pos.row = 1,
>>                        layout.pos.col = 1))
>> fp_sweden
>> upViewport()
>> pushViewport(viewport(layout.pos.row = 1,
>>                        layout.pos.col = 2))
>> grid.rect(gp = gpar(fill = "grey", col = "red"))
>> upViewport()
>> pushViewport(viewport(layout.pos.row = 1,
>>                        layout.pos.col = 3))
>> fp_denmark
>> upViewport(2)
>>
>>
>> ####
>> #Attempt 2 from website, still a problem.
>> ####
>> grid.newpage()
>> borderWidth <- unit(4, "pt")
>> width <- unit(convertX(unit(1, "npc") - borderWidth, unitTo = "npc", valueOnly = TRUE)/2, "npc")
>> pushViewport(viewport(layout = grid.layout(nrow = 1,
>>                                             ncol = 3,
>>                                             widths = c(0.45, 0.1, 0.45))
>> )
>> )
>> pushViewport(viewport(layout.pos.row = 1,
>>                        layout.pos.col = 1))
>> fp_sweden
>> upViewport()
>>
>> pushViewport(viewport(layout.pos.row = 1,
>>                        layout.pos.col = 3))
>> fp_denmark
>> upViewport(2)
>>
>> ###
>> #Attempt 3 converting to grobs and use patchwork
>> ###
>> library(ggplotify)
>> library(patchwork)
>>
>> fpd_grob <- grid2grob(print(fp_denmark))
>>
>> p1 <- grid2grob(print(fp_denmark))
>> p2 <- grid2grob(print(fp_sweden))
>> p_both <- wrap_elements(p1) + wrap_elements(p2)
>> p_both
>>
>> #same problem with grid.arrange()**strong text**
>>
>>
>>
>> Mary Putt, PhD, ScD
>> Professor of Biostatistics
>> Department of Biostatistics, Epidemiology & Informatics
>> Pereleman School of Medicine
>> University of Pennsylvania
>>
>> 215-573-7020
>>
>>          [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
> 

-- 
Michael
http://www.dewey.myzen.co.uk/home.html


From @ndre|@ko@tyrk@ @end|ng |rom gm@||@com  Fri Oct 14 13:07:16 2022
From: @ndre|@ko@tyrk@ @end|ng |rom gm@||@com (=?UTF-8?Q?Andre=C3=AF_V=2E_Kostyrka?=)
Date: Fri, 14 Oct 2022 15:07:16 +0400
Subject: [R] Unintended behaviour of stats::time not returning integers for
 the first cycle
Message-ID: <CAFnf=nq0qZDVS6cUJseJr8Dm9cqs_vn8uVd7OrAyH6-yLX4uxA@mail.gmail.com>

Dear all,



I was using stats::time to obtain the year as a floor of it, and
encountered a problem: due to a rounding error (most likely due to its
reliance on the base::seq.int internally, but correct me if I am wrong),
the actual number corresponding to the beginning of a year X can still be
(X-1).9999999..., resulting in the following undesirable behaviour.



One of the simplest ways of getting the year from a ts object is
floor(time(...)). However, if the starting time cannot be represented
nicely as a power of 2, then, supposedly integer time does not have a
.000000... mantissa:



x <- ts(2:252, start = c(2002, 2), freq = 12)

d <- seq.Date(as.Date("2002-02-01"), to = as.Date("2022-12-01"), by =
"month")

true.year <- rep(2002:2022, each = 12)[-1]

wrong.year <- floor(as.numeric(time(x)))

tail(cbind(as.character(d), true.year, wrong.year), 15) # Look at 2022-01-01

print(as.numeric(time(x))[240], 20) # 2021.9999999999997726, the floor of
which is 2021



Yes, I have read the 'R inferno' book and know the famous '0.3 != 0.7 -
0.4' example, but I believe that the expected / intended behaviour would be
actually returning round years for the first observation in a year. This
could be achieved by rounding the near-integer time to integers.



Since users working with dates are expecting to get exact integer years for
the first cycle of a ts, this should be changed. Thank you in advance for
considering a fix.



Yours sincerely,

Andre? V. Kostyrka

	[[alternative HTML version deleted]]


From er|cjberger @end|ng |rom gm@||@com  Sat Oct 15 09:55:38 2022
From: er|cjberger @end|ng |rom gm@||@com (Eric Berger)
Date: Sat, 15 Oct 2022 10:55:38 +0300
Subject: [R] 
 Unintended behaviour of stats::time not returning integers for
 the first cycle
In-Reply-To: <CAFnf=nq0qZDVS6cUJseJr8Dm9cqs_vn8uVd7OrAyH6-yLX4uxA@mail.gmail.com>
References: <CAFnf=nq0qZDVS6cUJseJr8Dm9cqs_vn8uVd7OrAyH6-yLX4uxA@mail.gmail.com>
Message-ID: <CAGgJW74NbseVm1aYDsN2ga1CKsG9iA3Dk_UJFn6Yb81yA6Oi2w@mail.gmail.com>

Alternatively

correct.year <- floor(time(x)+1e-6)

On Sat, Oct 15, 2022 at 10:26 AM Andre? V. Kostyrka <
andrei.kostyrka at gmail.com> wrote:

> Dear all,
>
>
>
> I was using stats::time to obtain the year as a floor of it, and
> encountered a problem: due to a rounding error (most likely due to its
> reliance on the base::seq.int internally, but correct me if I am wrong),
> the actual number corresponding to the beginning of a year X can still be
> (X-1).9999999..., resulting in the following undesirable behaviour.
>
>
>
> One of the simplest ways of getting the year from a ts object is
> floor(time(...)). However, if the starting time cannot be represented
> nicely as a power of 2, then, supposedly integer time does not have a
> .000000... mantissa:
>
>
>
> x <- ts(2:252, start = c(2002, 2), freq = 12)
>
> d <- seq.Date(as.Date("2002-02-01"), to = as.Date("2022-12-01"), by =
> "month")
>
> true.year <- rep(2002:2022, each = 12)[-1]
>
> wrong.year <- floor(as.numeric(time(x)))
>
> tail(cbind(as.character(d), true.year, wrong.year), 15) # Look at
> 2022-01-01
>
> print(as.numeric(time(x))[240], 20) # 2021.9999999999997726, the floor of
> which is 2021
>
>
>
> Yes, I have read the 'R inferno' book and know the famous '0.3 != 0.7 -
> 0.4' example, but I believe that the expected / intended behaviour would be
> actually returning round years for the first observation in a year. This
> could be achieved by rounding the near-integer time to integers.
>
>
>
> Since users working with dates are expecting to get exact integer years for
> the first cycle of a ts, this should be changed. Thank you in advance for
> considering a fix.
>
>
>
> Yours sincerely,
>
> Andre? V. Kostyrka
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From mputt @end|ng |rom pennmed|c|ne@upenn@edu  Fri Oct 14 15:23:17 2022
From: mputt @end|ng |rom pennmed|c|ne@upenn@edu (Putt, Mary)
Date: Fri, 14 Oct 2022 13:23:17 +0000
Subject: [R] 
 [External] Re:  Forestplot, grid graphics Viewplot grid.arange
In-Reply-To: <CA+8X3fVh3bJqZ8VNTujuB-VsWp7VOtniZtzqm9m+G9K7fuFvhg@mail.gmail.com>
References: <MN2PR04MB6702AE692142D79F71F213BC97209@MN2PR04MB6702.namprd04.prod.outlook.com>
 <CA+8X3fVh3bJqZ8VNTujuB-VsWp7VOtniZtzqm9m+G9K7fuFvhg@mail.gmail.com>
Message-ID: <MN2PR04MB670211782C8EF7C98BE0EB3297249@MN2PR04MB6702.namprd04.prod.outlook.com>

Thank you very much for the offer Jim,

I have the plots for my ?real data? all done?I had used the web-based example to simplify the post. I think at this point I?m going to put them together outside of R?and then do something else next time if I need to put multiple plots together. They did turn out really well using the forestplot package.

Mary

Mary Putt, PhD, ScD
Professor of Biostatistics
Department of Biostatistics, Epidemiology & Informatics
Pereleman School of Medicine
University of Pennsylvania

215-573-7020

From: Jim Lemon <drjimlemon at gmail.com>
Date: Thursday, October 13, 2022 at 11:34 PM
To: Putt, Mary <mputt at pennmedicine.upenn.edu>
Cc: r-help at r-project.org <r-help at r-project.org>
Subject: [External] Re: [R] Forestplot, grid graphics Viewplot grid.arange
Hi Mary,
I didn't see any answers to your post, but doing something like this
is quite easy in base graphics. If you are still stuck, I may be able
to suggest something.

Jim

On Mon, Oct 10, 2022 at 6:05 PM Putt, Mary <mputt at pennmedicine.upenn.edu> wrote:
>
>
> I have created several plots using the forestplot package and the link shown here. <https://cran.r-project.org/web/packages/forestplot/vignettes/forestplot.html > Great package !
> Next step is to combine two plots into a single graphic. The code provided on the link results in 'bleeding' of the graphics/text into each other. I don't want to clip it as I need the text elements. I am guessing the problem involves the combination of text and graphics in the 'plot'. I fooled around with the original post and also did some hunting online but no luck Thanks in advance.
> library(foresplot)
> data("dfHRQoL")
>
> #create individual forest plots for Sweden and Denmark
> fp_sweden <- dfHRQoL |>
>   filter(group == "Sweden") |>
>   mutate(est = sprintf("%.2f", mean), .after = labeltext) |>
>   forestplot(labeltext = c(labeltext, est),
>              title = "Sweden",
>              clip = c(-.1, Inf),
>              xlab = "EQ-5D index",
>              new_page = FALSE)
>
> fp_denmark <- dfHRQoL |>
>   filter(group == "Denmark") |>
>   mutate(est = sprintf("%.2f", mean), .after = labeltext) |>
>   forestplot(labeltext = c(labeltext, est),
>              title = "Denmark",
>              clip = c(-.1, Inf),
>              xlab = "EQ-5D index",
>              new_page = FALSE)
>
>
>
> #now combine into a single plot using the web code; but this one bleeds into each other
> library(grid)
>
> #####
> #Put plots together using grid graphics
> #Attempt 1 from website
>
> #####
> grid.newpage()
> borderWidth <- unit(4, "pt")
> width <- unit(convertX(unit(1, "npc") - borderWidth, unitTo = "npc", valueOnly = TRUE)/2, "npc")
> pushViewport(viewport(layout = grid.layout(nrow = 1,
>                                            ncol = 3,
>                                            widths = unit.c(width,
>                                                            borderWidth,
>                                                            width))
> )
> )
> pushViewport(viewport(layout.pos.row = 1,
>                       layout.pos.col = 1))
> fp_sweden
> upViewport()
> pushViewport(viewport(layout.pos.row = 1,
>                       layout.pos.col = 2))
> grid.rect(gp = gpar(fill = "grey", col = "red"))
> upViewport()
> pushViewport(viewport(layout.pos.row = 1,
>                       layout.pos.col = 3))
> fp_denmark
> upViewport(2)
>
>
> ####
> #Attempt 2 from website, still a problem.
> ####
> grid.newpage()
> borderWidth <- unit(4, "pt")
> width <- unit(convertX(unit(1, "npc") - borderWidth, unitTo = "npc", valueOnly = TRUE)/2, "npc")
> pushViewport(viewport(layout = grid.layout(nrow = 1,
>                                            ncol = 3,
>                                            widths = c(0.45, 0.1, 0.45))
> )
> )
> pushViewport(viewport(layout.pos.row = 1,
>                       layout.pos.col = 1))
> fp_sweden
> upViewport()
>
> pushViewport(viewport(layout.pos.row = 1,
>                       layout.pos.col = 3))
> fp_denmark
> upViewport(2)
>
> ###
> #Attempt 3 converting to grobs and use patchwork
> ###
> library(ggplotify)
> library(patchwork)
>
> fpd_grob <- grid2grob(print(fp_denmark))
>
> p1 <- grid2grob(print(fp_denmark))
> p2 <- grid2grob(print(fp_sweden))
> p_both <- wrap_elements(p1) + wrap_elements(p2)
> p_both
>
> #same problem with grid.arrange()**strong text**
>
>
>
> Mary Putt, PhD, ScD
> Professor of Biostatistics
> Department of Biostatistics, Epidemiology & Informatics
> Pereleman School of Medicine
> University of Pennsylvania
>
> 215-573-7020
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.

	[[alternative HTML version deleted]]


From mputt @end|ng |rom pennmed|c|ne@upenn@edu  Fri Oct 14 15:23:55 2022
From: mputt @end|ng |rom pennmed|c|ne@upenn@edu (Putt, Mary)
Date: Fri, 14 Oct 2022 13:23:55 +0000
Subject: [R] 
 [External] Re:  Forestplot, grid graphics Viewplot grid.arange
In-Reply-To: <951d7f81-aac6-d0fe-f450-ff6f8ae6d30c@dewey.myzen.co.uk>
References: <MN2PR04MB6702AE692142D79F71F213BC97209@MN2PR04MB6702.namprd04.prod.outlook.com>
 <CA+8X3fVh3bJqZ8VNTujuB-VsWp7VOtniZtzqm9m+G9K7fuFvhg@mail.gmail.com>
 <951d7f81-aac6-d0fe-f450-ff6f8ae6d30c@dewey.myzen.co.uk>
Message-ID: <MN2PR04MB67022D230E9B0F273F045ACA97249@MN2PR04MB6702.namprd04.prod.outlook.com>

Thank you for the suggestion  Jim. Will try this the next time I do forest plots.

Mary Putt, PhD, ScD
Professor of Biostatistics
Department of Biostatistics, Epidemiology & Informatics
Pereleman School of Medicine
University of Pennsylvania

215-573-7020

From: Michael Dewey <lists at dewey.myzen.co.uk>
Date: Friday, October 14, 2022 at 8:24 AM
To: Jim Lemon <drjimlemon at gmail.com>, Putt, Mary <mputt at pennmedicine.upenn.edu>
Cc: r-help at r-project.org <r-help at r-project.org>
Subject: [External] Re: [R] Forestplot, grid graphics Viewplot grid.arange
There are several other CRAN packages which provide forest plots (see
CRAN Task View for details) and they do not all use grip graphics which
I think the forestplot package does. It might be worth swapping to one
of them.

Michael

On 14/10/2022 04:34, Jim Lemon wrote:
> Hi Mary,
> I didn't see any answers to your post, but doing something like this
> is quite easy in base graphics. If you are still stuck, I may be able
> to suggest something.
>
> Jim
>
> On Mon, Oct 10, 2022 at 6:05 PM Putt, Mary <mputt at pennmedicine.upenn.edu> wrote:
>>
>>
>> I have created several plots using the forestplot package and the link shown here. <https://cran.r-project.org/web/packages/forestplot/vignettes/forestplot.html > Great package !
>> Next step is to combine two plots into a single graphic. The code provided on the link results in 'bleeding' of the graphics/text into each other. I don't want to clip it as I need the text elements. I am guessing the problem involves the combination of text and graphics in the 'plot'. I fooled around with the original post and also did some hunting online but no luck Thanks in advance.
>> library(foresplot)
>> data("dfHRQoL")
>>
>> #create individual forest plots for Sweden and Denmark
>> fp_sweden <- dfHRQoL |>
>>    filter(group == "Sweden") |>
>>    mutate(est = sprintf("%.2f", mean), .after = labeltext) |>
>>    forestplot(labeltext = c(labeltext, est),
>>               title = "Sweden",
>>               clip = c(-.1, Inf),
>>               xlab = "EQ-5D index",
>>               new_page = FALSE)
>>
>> fp_denmark <- dfHRQoL |>
>>    filter(group == "Denmark") |>
>>    mutate(est = sprintf("%.2f", mean), .after = labeltext) |>
>>    forestplot(labeltext = c(labeltext, est),
>>               title = "Denmark",
>>               clip = c(-.1, Inf),
>>               xlab = "EQ-5D index",
>>               new_page = FALSE)
>>
>>
>>
>> #now combine into a single plot using the web code; but this one bleeds into each other
>> library(grid)
>>
>> #####
>> #Put plots together using grid graphics
>> #Attempt 1 from website
>>
>> #####
>> grid.newpage()
>> borderWidth <- unit(4, "pt")
>> width <- unit(convertX(unit(1, "npc") - borderWidth, unitTo = "npc", valueOnly = TRUE)/2, "npc")
>> pushViewport(viewport(layout = grid.layout(nrow = 1,
>>                                             ncol = 3,
>>                                             widths = unit.c(width,
>>                                                             borderWidth,
>>                                                             width))
>> )
>> )
>> pushViewport(viewport(layout.pos.row = 1,
>>                        layout.pos.col = 1))
>> fp_sweden
>> upViewport()
>> pushViewport(viewport(layout.pos.row = 1,
>>                        layout.pos.col = 2))
>> grid.rect(gp = gpar(fill = "grey", col = "red"))
>> upViewport()
>> pushViewport(viewport(layout.pos.row = 1,
>>                        layout.pos.col = 3))
>> fp_denmark
>> upViewport(2)
>>
>>
>> ####
>> #Attempt 2 from website, still a problem.
>> ####
>> grid.newpage()
>> borderWidth <- unit(4, "pt")
>> width <- unit(convertX(unit(1, "npc") - borderWidth, unitTo = "npc", valueOnly = TRUE)/2, "npc")
>> pushViewport(viewport(layout = grid.layout(nrow = 1,
>>                                             ncol = 3,
>>                                             widths = c(0.45, 0.1, 0.45))
>> )
>> )
>> pushViewport(viewport(layout.pos.row = 1,
>>                        layout.pos.col = 1))
>> fp_sweden
>> upViewport()
>>
>> pushViewport(viewport(layout.pos.row = 1,
>>                        layout.pos.col = 3))
>> fp_denmark
>> upViewport(2)
>>
>> ###
>> #Attempt 3 converting to grobs and use patchwork
>> ###
>> library(ggplotify)
>> library(patchwork)
>>
>> fpd_grob <- grid2grob(print(fp_denmark))
>>
>> p1 <- grid2grob(print(fp_denmark))
>> p2 <- grid2grob(print(fp_sweden))
>> p_both <- wrap_elements(p1) + wrap_elements(p2)
>> p_both
>>
>> #same problem with grid.arrange()**strong text**
>>
>>
>>
>> Mary Putt, PhD, ScD
>> Professor of Biostatistics
>> Department of Biostatistics, Epidemiology & Informatics
>> Pereleman School of Medicine
>> University of Pennsylvania
>>
>> 215-573-7020
>>
>>          [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

--
Michael
http://www.dewey.myzen.co.uk/home.html

	[[alternative HTML version deleted]]


From p@i@di@i m@iii@g oii trusti@d@t@@de  Mon Oct 17 10:29:40 2022
From: p@i@di@i m@iii@g oii trusti@d@t@@de (p@i@di@i m@iii@g oii trusti@d@t@@de)
Date: Mon, 17 Oct 2022 10:29:40 +0200
Subject: [R] statistical error in ggerrorplot argument desc_statby
Message-ID: <20221017102940.Horde.Bw49kraofe3uYjrtD0Vok7H@webmail.df.eu>

Hello!
I think there is a major statistical error or at least an inaccuracy  
in ggerrorplot and I don't know where to report this problem.

When using ggerrorplot, you can choose the argument desc_statby=sd or  
desc_statby= se. Where sd is described as "standard deviation of the  
mean".
and se as "standard error of the mean".
This makes no sense at all, because the standard error of the mean is  
exactly the standard deviation of the mean.

Whereas sd is usually used to denote the standard deviation of the sample.

The standard error of the mean or the standard deviation of the mean  
(sem) equals the standard deviation of the sample divided by the root  
of the sample size: sem= sd/root(n).


In error charts, it is common to represent the mean in combination  
with the sample standard deviation (sd) or the standard error of the  
mean (sem).

I think it is important to clarify the difference between sem and sd  
in relation to desc_statby as they because they are often confused by  
students and researchers alike.

Kind regards

Claudia


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Tue Oct 18 08:49:34 2022
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Mon, 17 Oct 2022 23:49:34 -0700
Subject: [R] statistical error in ggerrorplot argument desc_statby
In-Reply-To: <20221017102940.Horde.Bw49kraofe3uYjrtD0Vok7H@webmail.df.eu>
References: <20221017102940.Horde.Bw49kraofe3uYjrtD0Vok7H@webmail.df.eu>
Message-ID: <C0CA6C95-D7B7-4146-A89C-E3FD573AE321@dcn.davis.ca.us>

I suppose the key concept you seem to be missing is that contributed packages are not part of R, nor are the R developers going to do anything to fix it, even if they might happen to lurk around here occasionally, and many package maintainers do not lurk at all on this list.

If you type ?ggerrorplot at the R prompt you should learn that it is part of the ggpubr package. If you type maintainer("ggpubr") you should learn who _is_ responsible for that package. And if you Google for "cran ggpubr" you should find the canonical web https://CRAN.R-project.org/package=ggpubr on which there is an entry for Bug Reports leading in this case to a GitHub issues tracker. So, an email directed at the maintainer or a quick Google search would be far more likely to lead to an effective change than posting here will.

Do (re-)read the Posting Guide... there are all sorts of tidbits in there.

On October 17, 2022 1:29:40 AM PDT, paladini at trustindata.de wrote:
>Hello!
>I think there is a major statistical error or at least an inaccuracy in ggerrorplot and I don't know where to report this problem.
>
>When using ggerrorplot, you can choose the argument desc_statby=sd or desc_statby= se. Where sd is described as "standard deviation of the mean".
>and se as "standard error of the mean".
>This makes no sense at all, because the standard error of the mean is exactly the standard deviation of the mean.
>
>Whereas sd is usually used to denote the standard deviation of the sample.
>
>The standard error of the mean or the standard deviation of the mean (sem) equals the standard deviation of the sample divided by the root of the sample size: sem= sd/root(n).
>
>
>In error charts, it is common to represent the mean in combination with the sample standard deviation (sd) or the standard error of the mean (sem).
>
>I think it is important to clarify the difference between sem and sd in relation to desc_statby as they because they are often confused by students and researchers alike.
>
>Kind regards
>
>Claudia
>
>______________________________________________
>R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>https://stat.ethz.ch/mailman/listinfo/r-help
>PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>and provide commented, minimal, self-contained, reproducible code.

-- 
Sent from my phone. Please excuse my brevity.


From tebert @end|ng |rom u||@edu  Tue Oct 18 14:16:37 2022
From: tebert @end|ng |rom u||@edu (Ebert,Timothy Aaron)
Date: Tue, 18 Oct 2022 12:16:37 +0000
Subject: [R] statistical error in ggerrorplot argument desc_statby
In-Reply-To: <C0CA6C95-D7B7-4146-A89C-E3FD573AE321@dcn.davis.ca.us>
References: <20221017102940.Horde.Bw49kraofe3uYjrtD0Vok7H@webmail.df.eu>
 <C0CA6C95-D7B7-4146-A89C-E3FD573AE321@dcn.davis.ca.us>
Message-ID: <BN6PR2201MB15532C78D20BC7FF02C199D9CF289@BN6PR2201MB1553.namprd22.prod.outlook.com>

While I agree that S.E. and S.D. are sometimes confused I disagree that the definition and use must be rehashed in every package that uses either one. The programmer (and documentation writer) makes tools available. If they do a good job with documentation then it is more likely that the tool will be used. However, it is up to the user to determine if the tool is right for their purpose. It seems to me that this issue is more about statistics education rather than an error in a package.
Tim


-----Original Message-----
From: R-help <r-help-bounces at r-project.org> On Behalf Of Jeff Newmiller
Sent: Tuesday, October 18, 2022 2:50 AM
To: r-help at r-project.org; paladini at trustindata.de
Subject: Re: [R] statistical error in ggerrorplot argument desc_statby

[External Email]

I suppose the key concept you seem to be missing is that contributed packages are not part of R, nor are the R developers going to do anything to fix it, even if they might happen to lurk around here occasionally, and many package maintainers do not lurk at all on this list.

If you type ?ggerrorplot at the R prompt you should learn that it is part of the ggpubr package. If you type maintainer("ggpubr") you should learn who _is_ responsible for that package. And if you Google for "cran ggpubr" you should find the canonical web https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fcran.r-project.org%2Fpackage%3Dggpubr&amp;data=05%7C01%7Ctebert%40ufl.edu%7C04a350b5a4d8471aa63208dab0d50231%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638016726187416524%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=QIdj47mDOwjrqU3zYdvAlxvPj8NYoAYXR%2FKSiRlDF28%3D&amp;reserved=0 on which there is an entry for Bug Reports leading in this case to a GitHub issues tracker. So, an email directed at the maintainer or a quick Google search would be far more likely to lead to an effective change than posting here will.

Do (re-)read the Posting Guide... there are all sorts of tidbits in there.

On October 17, 2022 1:29:40 AM PDT, paladini at trustindata.de wrote:
>Hello!
>I think there is a major statistical error or at least an inaccuracy in ggerrorplot and I don't know where to report this problem.
>
>When using ggerrorplot, you can choose the argument desc_statby=sd or desc_statby= se. Where sd is described as "standard deviation of the mean".
>and se as "standard error of the mean".
>This makes no sense at all, because the standard error of the mean is exactly the standard deviation of the mean.
>
>Whereas sd is usually used to denote the standard deviation of the sample.
>
>The standard error of the mean or the standard deviation of the mean (sem) equals the standard deviation of the sample divided by the root of the sample size: sem= sd/root(n).
>
>
>In error charts, it is common to represent the mean in combination with the sample standard deviation (sd) or the standard error of the mean (sem).
>
>I think it is important to clarify the difference between sem and sd in relation to desc_statby as they because they are often confused by students and researchers alike.
>
>Kind regards
>
>Claudia
>
>______________________________________________
>R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl.edu%7C04a350b5a4d8471aa63208dab0d50231%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638016726187416524%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=xRUv8l76ez4GSko1MxzYh4E54ZYvmwXvMsVLC6Syx4w%3D&amp;reserved=0
>PLEASE do read the posting guide https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%7C04a350b5a4d8471aa63208dab0d50231%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638016726187416524%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=2aJgIStK6GxmjAv%2BjzaK716ZleKYYREQmyaGMnEd8j4%3D&amp;reserved=0
>and provide commented, minimal, self-contained, reproducible code.

--
Sent from my phone. Please excuse my brevity.

______________________________________________
R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl.edu%7C04a350b5a4d8471aa63208dab0d50231%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638016726187416524%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=xRUv8l76ez4GSko1MxzYh4E54ZYvmwXvMsVLC6Syx4w%3D&amp;reserved=0
PLEASE do read the posting guide https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%7C04a350b5a4d8471aa63208dab0d50231%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638016726187416524%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=2aJgIStK6GxmjAv%2BjzaK716ZleKYYREQmyaGMnEd8j4%3D&amp;reserved=0
and provide commented, minimal, self-contained, reproducible code.


From @ndre|@ko@tyrk@ @end|ng |rom gm@||@com  Tue Oct 18 14:26:28 2022
From: @ndre|@ko@tyrk@ @end|ng |rom gm@||@com (=?UTF-8?Q?Andre=C3=AF_V=2E_Kostyrka?=)
Date: Tue, 18 Oct 2022 16:26:28 +0400
Subject: [R] 
 Unintended behaviour of stats::time not returning integers for
 the first cycle
In-Reply-To: <CAGgJW74NbseVm1aYDsN2ga1CKsG9iA3Dk_UJFn6Yb81yA6Oi2w@mail.gmail.com>
References: <CAFnf=nq0qZDVS6cUJseJr8Dm9cqs_vn8uVd7OrAyH6-yLX4uxA@mail.gmail.com>
 <CAGgJW74NbseVm1aYDsN2ga1CKsG9iA3Dk_UJFn6Yb81yA6Oi2w@mail.gmail.com>
Message-ID: <CAFnf=nqQ9cXKFX4Xz++d3yDjeW_R6c+DuOzfdsx3MuAnp6O-Nw@mail.gmail.com>

Sure, this works, and I was thinking about this solution, but it seems like
a dirty one-time trick. I was wondering whether the following 3 lines could
be considered for inclusion by the core developers, but did not know which
mailing list to write to. Here is my proposal:

correctTime <- function (x, offset = 0, ...) { # Changes
stats:::time.default
  n <- if (is.matrix(x)) nrow(x) else length(x)
  xtsp <- attr(hasTsp(x), "tsp")
  y <- seq.int(xtsp[1L], xtsp[2L], length.out = n) + offset/xtsp[3L]
  round.y <- round(y)
  near.integer <- abs(round.y - y) < sqrt(.Machine$double.eps)
  y[near.integer] <- round.y[near.integer]
  tsp(y) <- xtsp
  y
}

x <- ts(2:252, start = c(2002, 2), freq = 12)
d <- seq.Date(as.Date("2002-02-01"), to = as.Date("2022-12-01"), by =
"month")
true.year <- rep(2002:2022, each = 12)[-1]
wrong.year <- floor(as.numeric(time(x)))
print(as.numeric(time(x))[240], 20) # 2021.9999999999997726, the floor of
which is 2021
print(correctTime(x)[240], 20) # 2022

On Sat, Oct 15, 2022 at 11:56 AM Eric Berger <ericjberger at gmail.com> wrote:

> Alternatively
>
> correct.year <- floor(time(x)+1e-6)
>
> On Sat, Oct 15, 2022 at 10:26 AM Andre? V. Kostyrka <
> andrei.kostyrka at gmail.com> wrote:
>
>> Dear all,
>>
>>
>>
>> I was using stats::time to obtain the year as a floor of it, and
>> encountered a problem: due to a rounding error (most likely due to its
>> reliance on the base::seq.int internally, but correct me if I am wrong),
>> the actual number corresponding to the beginning of a year X can still be
>> (X-1).9999999..., resulting in the following undesirable behaviour.
>>
>>
>>
>> One of the simplest ways of getting the year from a ts object is
>> floor(time(...)). However, if the starting time cannot be represented
>> nicely as a power of 2, then, supposedly integer time does not have a
>> .000000... mantissa:
>>
>>
>>
>> x <- ts(2:252, start = c(2002, 2), freq = 12)
>>
>> d <- seq.Date(as.Date("2002-02-01"), to = as.Date("2022-12-01"), by =
>> "month")
>>
>> true.year <- rep(2002:2022, each = 12)[-1]
>>
>> wrong.year <- floor(as.numeric(time(x)))
>>
>> tail(cbind(as.character(d), true.year, wrong.year), 15) # Look at
>> 2022-01-01
>>
>> print(as.numeric(time(x))[240], 20) # 2021.9999999999997726, the floor of
>> which is 2021
>>
>>
>>
>> Yes, I have read the 'R inferno' book and know the famous '0.3 != 0.7 -
>> 0.4' example, but I believe that the expected / intended behaviour would
>> be
>> actually returning round years for the first observation in a year. This
>> could be achieved by rounding the near-integer time to integers.
>>
>>
>>
>> Since users working with dates are expecting to get exact integer years
>> for
>> the first cycle of a ts, this should be changed. Thank you in advance for
>> considering a fix.
>>
>>
>>
>> Yours sincerely,
>>
>> Andre? V. Kostyrka
>>
>>         [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide
>> http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
>>
>

	[[alternative HTML version deleted]]


From @cpubr @end|ng |rom gm@||@com  Mon Oct 17 16:28:51 2022
From: @cpubr @end|ng |rom gm@||@com (Enrique Blanco Carmona)
Date: Mon, 17 Oct 2022 16:28:51 +0200
Subject: [R] [R-pkgs] SCpubr: Generate high quality,
 publication-ready plots of single-cell transcriptomics data.
Message-ID: <CAJHOHbtK4+PnmMt3Mf=iX0pvFmpVoUjS50=NXQ0to_jiGLT8mw@mail.gmail.com>

Dear R community,

It is my pleasure to announce that my new R package (*SCpubr
<https://github.com/enblacar/SCpubr>*) to generate *high-quality,
publication-ready plots* for *single-cell transcriptomics* data has been
released *on CRAN
<https://cran.r-project.org/web/packages/SCpubr/index.html>*. It uses *Seurat
objects* <https://cran.r-project.org/web/packages/Seurat/index.html> as
backbone to generate any type of data visualisation you might need for your
research!

If this is of interest to you, please give it a try! You can have an
in-depth look of *SCpubr's *functionalities in the *documentation book*
<https://enblacar.github.io/SCpubr-book/>.

Any kind of feedback is appreciated!

Best,
Enrique
-- 
*Enrique Blanco Carmona*
Developer and maintainer

*SCpubr*
*[CRAN package <https://cran.r-project.org/web/packages/SCpubr/index.html>]
| [GitHub <https://github.com/enblacar/SCpubr>] | [Documentation Book
<https://enblacar.github.io/SCpubr-book/>]*

	[[alternative HTML version deleted]]

_______________________________________________
R-packages mailing list
R-packages at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-packages


From ggrothend|eck @end|ng |rom gm@||@com  Tue Oct 18 19:45:45 2022
From: ggrothend|eck @end|ng |rom gm@||@com (Gabor Grothendieck)
Date: Tue, 18 Oct 2022 13:45:45 -0400
Subject: [R] 
 Unintended behaviour of stats::time not returning integers for
 the first cycle
In-Reply-To: <CAFnf=nq0qZDVS6cUJseJr8Dm9cqs_vn8uVd7OrAyH6-yLX4uxA@mail.gmail.com>
References: <CAFnf=nq0qZDVS6cUJseJr8Dm9cqs_vn8uVd7OrAyH6-yLX4uxA@mail.gmail.com>
Message-ID: <CAP01uRmm9p-iFzxUjdO-mgpbECNQQR1+7u1y7S9jRwQVcfM6mg@mail.gmail.com>

The zoo package implements tolerances internally. Converting the ts
object to zoo:

  library(zoo)
  identical(as.integer(time(as.zoo(x))), true.year)
  ## [1] TRUE

On Sat, Oct 15, 2022 at 3:26 AM Andre? V. Kostyrka
<andrei.kostyrka at gmail.com> wrote:
>
> Dear all,
>
>
>
> I was using stats::time to obtain the year as a floor of it, and
> encountered a problem: due to a rounding error (most likely due to its
> reliance on the base::seq.int internally, but correct me if I am wrong),
> the actual number corresponding to the beginning of a year X can still be
> (X-1).9999999..., resulting in the following undesirable behaviour.
>
>
>
> One of the simplest ways of getting the year from a ts object is
> floor(time(...)). However, if the starting time cannot be represented
> nicely as a power of 2, then, supposedly integer time does not have a
> .000000... mantissa:
>
>
>
> x <- ts(2:252, start = c(2002, 2), freq = 12)
>
> d <- seq.Date(as.Date("2002-02-01"), to = as.Date("2022-12-01"), by =
> "month")
>
> true.year <- rep(2002:2022, each = 12)[-1]
>
> wrong.year <- floor(as.numeric(time(x)))
>
> tail(cbind(as.character(d), true.year, wrong.year), 15) # Look at 2022-01-01
>
> print(as.numeric(time(x))[240], 20) # 2021.9999999999997726, the floor of
> which is 2021
>
>
>
> Yes, I have read the 'R inferno' book and know the famous '0.3 != 0.7 -
> 0.4' example, but I believe that the expected / intended behaviour would be
> actually returning round years for the first observation in a year. This
> could be achieved by rounding the near-integer time to integers.
>
>
>
> Since users working with dates are expecting to get exact integer years for
> the first cycle of a ts, this should be changed. Thank you in advance for
> considering a fix.
>
>
>
> Yours sincerely,
>
> Andre? V. Kostyrka
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.



-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Tue Oct 18 21:16:24 2022
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Tue, 18 Oct 2022 12:16:24 -0700
Subject: [R] 
 Unintended behaviour of stats::time not returning integers for
 the first cycle
In-Reply-To: <CAFnf=nqQ9cXKFX4Xz++d3yDjeW_R6c+DuOzfdsx3MuAnp6O-Nw@mail.gmail.com>
References: <CAFnf=nq0qZDVS6cUJseJr8Dm9cqs_vn8uVd7OrAyH6-yLX4uxA@mail.gmail.com>
 <CAGgJW74NbseVm1aYDsN2ga1CKsG9iA3Dk_UJFn6Yb81yA6Oi2w@mail.gmail.com>
 <CAFnf=nqQ9cXKFX4Xz++d3yDjeW_R6c+DuOzfdsx3MuAnp6O-Nw@mail.gmail.com>
Message-ID: <AD9D00A7-FD1B-441F-9099-6C8E249DAFDC@dcn.davis.ca.us>

> did not know which mailing list to write to.

... then you did not read the Posting Guide, or forgot to refer to it?

On October 18, 2022 5:26:28 AM PDT, "Andre? V. Kostyrka" <andrei.kostyrka at gmail.com> wrote:
>Sure, this works, and I was thinking about this solution, but it seems like
>a dirty one-time trick. I was wondering whether the following 3 lines could
>be considered for inclusion by the core developers, but did not know which
>mailing list to write to. Here is my proposal:
>
>correctTime <- function (x, offset = 0, ...) { # Changes
>stats:::time.default
>  n <- if (is.matrix(x)) nrow(x) else length(x)
>  xtsp <- attr(hasTsp(x), "tsp")
>  y <- seq.int(xtsp[1L], xtsp[2L], length.out = n) + offset/xtsp[3L]
>  round.y <- round(y)
>  near.integer <- abs(round.y - y) < sqrt(.Machine$double.eps)
>  y[near.integer] <- round.y[near.integer]
>  tsp(y) <- xtsp
>  y
>}
>
>x <- ts(2:252, start = c(2002, 2), freq = 12)
>d <- seq.Date(as.Date("2002-02-01"), to = as.Date("2022-12-01"), by =
>"month")
>true.year <- rep(2002:2022, each = 12)[-1]
>wrong.year <- floor(as.numeric(time(x)))
>print(as.numeric(time(x))[240], 20) # 2021.9999999999997726, the floor of
>which is 2021
>print(correctTime(x)[240], 20) # 2022
>
>On Sat, Oct 15, 2022 at 11:56 AM Eric Berger <ericjberger at gmail.com> wrote:
>
>> Alternatively
>>
>> correct.year <- floor(time(x)+1e-6)
>>
>> On Sat, Oct 15, 2022 at 10:26 AM Andre? V. Kostyrka <
>> andrei.kostyrka at gmail.com> wrote:
>>
>>> Dear all,
>>>
>>>
>>>
>>> I was using stats::time to obtain the year as a floor of it, and
>>> encountered a problem: due to a rounding error (most likely due to its
>>> reliance on the base::seq.int internally, but correct me if I am wrong),
>>> the actual number corresponding to the beginning of a year X can still be
>>> (X-1).9999999..., resulting in the following undesirable behaviour.
>>>
>>>
>>>
>>> One of the simplest ways of getting the year from a ts object is
>>> floor(time(...)). However, if the starting time cannot be represented
>>> nicely as a power of 2, then, supposedly integer time does not have a
>>> .000000... mantissa:
>>>
>>>
>>>
>>> x <- ts(2:252, start = c(2002, 2), freq = 12)
>>>
>>> d <- seq.Date(as.Date("2002-02-01"), to = as.Date("2022-12-01"), by =
>>> "month")
>>>
>>> true.year <- rep(2002:2022, each = 12)[-1]
>>>
>>> wrong.year <- floor(as.numeric(time(x)))
>>>
>>> tail(cbind(as.character(d), true.year, wrong.year), 15) # Look at
>>> 2022-01-01
>>>
>>> print(as.numeric(time(x))[240], 20) # 2021.9999999999997726, the floor of
>>> which is 2021
>>>
>>>
>>>
>>> Yes, I have read the 'R inferno' book and know the famous '0.3 != 0.7 -
>>> 0.4' example, but I believe that the expected / intended behaviour would
>>> be
>>> actually returning round years for the first observation in a year. This
>>> could be achieved by rounding the near-integer time to integers.
>>>
>>>
>>>
>>> Since users working with dates are expecting to get exact integer years
>>> for
>>> the first cycle of a ts, this should be changed. Thank you in advance for
>>> considering a fix.
>>>
>>>
>>>
>>> Yours sincerely,
>>>
>>> Andre? V. Kostyrka
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>> PLEASE do read the posting guide
>>> http://www.R-project.org/posting-guide.html
>>> and provide commented, minimal, self-contained, reproducible code.
>>>
>>
>
>	[[alternative HTML version deleted]]
>
>______________________________________________
>R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>https://stat.ethz.ch/mailman/listinfo/r-help
>PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>and provide commented, minimal, self-contained, reproducible code.

-- 
Sent from my phone. Please excuse my brevity.


From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Wed Oct 19 10:05:31 2022
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Wed, 19 Oct 2022 10:05:31 +0200
Subject: [R] 
 Unintended behaviour of stats::time not returning integers for
 the first cycle
In-Reply-To: <CAFnf=nqQ9cXKFX4Xz++d3yDjeW_R6c+DuOzfdsx3MuAnp6O-Nw@mail.gmail.com>
References: <CAFnf=nq0qZDVS6cUJseJr8Dm9cqs_vn8uVd7OrAyH6-yLX4uxA@mail.gmail.com>
 <CAGgJW74NbseVm1aYDsN2ga1CKsG9iA3Dk_UJFn6Yb81yA6Oi2w@mail.gmail.com>
 <CAFnf=nqQ9cXKFX4Xz++d3yDjeW_R6c+DuOzfdsx3MuAnp6O-Nw@mail.gmail.com>
Message-ID: <25423.45003.376171.329679@stat.math.ethz.ch>

>>>>> Andre? V Kostyrka 
>>>>>     on Tue, 18 Oct 2022 16:26:28 +0400 writes:

    > Sure, this works, and I was thinking about this solution, but it seems like
    > a dirty one-time trick. I was wondering whether the following 3 lines could
    > be considered for inclusion by the core developers, but did not know which
    > mailing list to write to. 

As Jeff alluded to, *every* message to this list has a footer
with a link to *the POSTING GUIDE"  ...

and from there you quickly learn it is 'R-devel' (instead of 'R-help').

Now that we have already half a dozen messages here, let's keep
the whole thread here, even if only for ease of reading the list archives(!)

    > Here is my proposal:

    > correctTime <- function (x, offset = 0, ...) { # Changes
    > stats:::time.default
    >  n <- if (is.matrix(x)) nrow(x) else length(x)
    >  xtsp <- attr(hasTsp(x), "tsp")
    >  y <- seq.int(xtsp[1L], xtsp[2L], length.out = n) + offset/xtsp[3L]
    >  round.y <- round(y)
    >  near.integer <- abs(round.y - y) < sqrt(.Machine$double.eps)
    >  y[near.integer] <- round.y[near.integer]
    >  tsp(y) <- xtsp
    > y
    > }

Yes, some such change does make sense to me, too.
As the computations above are relatively costly (compared to the
current  time.default()  implementation),
and also for strict back compatibility reasons, I think the
correction should only happen when the user asks for it,  say by
using a new argument 'roundYear = TRUE'  (where the default
remains roundYear=FALSE).

Martin Maechler
ETH Zurich  and  R Core tam

    > x <- ts(2:252, start = c(2002, 2), freq = 12)
    > d <- seq.Date(as.Date("2002-02-01"), to = as.Date("2022-12-01"), by =
    > "month")
    > true.year <- rep(2002:2022, each = 12)[-1]
    > wrong.year <- floor(as.numeric(time(x)))
    > print(as.numeric(time(x))[240], 20) # 2021.9999999999997726, the floor of
    > which is 2021
    > print(correctTime(x)[240], 20) # 2022

    > On Sat, Oct 15, 2022 at 11:56 AM Eric Berger <ericjberger at gmail.com> wrote:

    >> Alternatively
    >> 
    >> correct.year <- floor(time(x)+1e-6)
    >> 
    >> On Sat, Oct 15, 2022 at 10:26 AM Andre? V. Kostyrka <
    >> andrei.kostyrka at gmail.com> wrote:
    >> 
    >>> Dear all,
    >>> 
    >>> 
    >>> 
    >>> I was using stats::time to obtain the year as a floor of it, and
    >>> encountered a problem: due to a rounding error (most likely due to its
    >>> reliance on the base::seq.int internally, but correct me if I am wrong),
    >>> the actual number corresponding to the beginning of a year X can still be
    >>> (X-1).9999999..., resulting in the following undesirable behaviour.
    >>> 
    >>> 
    >>> 
    >>> One of the simplest ways of getting the year from a ts object is
    >>> floor(time(...)). However, if the starting time cannot be represented
    >>> nicely as a power of 2, then, supposedly integer time does not have a
    >>> .000000... mantissa:
    >>> 
    >>> 
    >>> 
    >>> x <- ts(2:252, start = c(2002, 2), freq = 12)
    >>> 
    >>> d <- seq.Date(as.Date("2002-02-01"), to = as.Date("2022-12-01"), by =
    >>> "month")
    >>> 
    >>> true.year <- rep(2002:2022, each = 12)[-1]
    >>> 
    >>> wrong.year <- floor(as.numeric(time(x)))
    >>> 
    >>> tail(cbind(as.character(d), true.year, wrong.year), 15) # Look at
    >>> 2022-01-01
    >>> 
    >>> print(as.numeric(time(x))[240], 20) # 2021.9999999999997726, the floor of
    >>> which is 2021
    >>> 
    >>> 
    >>> 
    >>> Yes, I have read the 'R inferno' book and know the famous '0.3 != 0.7 -
    >>> 0.4' example, but I believe that the expected / intended behaviour would
    >>> be
    >>> actually returning round years for the first observation in a year. This
    >>> could be achieved by rounding the near-integer time to integers.
    >>> 
    >>> 
    >>> 
    >>> Since users working with dates are expecting to get exact integer years
    >>> for
    >>> the first cycle of a ts, this should be changed. Thank you in advance for
    >>> considering a fix.
    >>> 
    >>> 
    >>> 
    >>> Yours sincerely,
    >>> 
    >>> Andre? V. Kostyrka
    >>> 
    >>> [[alternative HTML version deleted]]
    >>> 
    >>> ______________________________________________
    >>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
    >>> https://stat.ethz.ch/mailman/listinfo/r-help
    >>> PLEASE do read the posting guide
    >>> http://www.R-project.org/posting-guide.html
    >>> and provide commented, minimal, self-contained, reproducible code.
    >>> 
    >> 

    > [[alternative HTML version deleted]]

    > ______________________________________________
    > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
    > https://stat.ethz.ch/mailman/listinfo/r-help
    > PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
    > and provide commented, minimal, self-contained, reproducible code.


From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Wed Oct 19 11:44:56 2022
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Wed, 19 Oct 2022 11:44:56 +0200
Subject: [R] 
 Unintended behaviour of stats::time not returning integers for
 the first cycle
In-Reply-To: <25423.45003.376171.329679@stat.math.ethz.ch>
References: <CAFnf=nq0qZDVS6cUJseJr8Dm9cqs_vn8uVd7OrAyH6-yLX4uxA@mail.gmail.com>
 <CAGgJW74NbseVm1aYDsN2ga1CKsG9iA3Dk_UJFn6Yb81yA6Oi2w@mail.gmail.com>
 <CAFnf=nqQ9cXKFX4Xz++d3yDjeW_R6c+DuOzfdsx3MuAnp6O-Nw@mail.gmail.com>
 <25423.45003.376171.329679@stat.math.ethz.ch>
Message-ID: <25423.50968.986873.492087@stat.math.ethz.ch>

>>>>> Martin Maechler 
>>>>>     on Wed, 19 Oct 2022 10:05:31 +0200 writes:

>>>>> Andre? V Kostyrka 
>>>>>     on Tue, 18 Oct 2022 16:26:28 +0400 writes:

    >> Sure, this works, and I was thinking about this solution, but it seems like
    >> a dirty one-time trick. I was wondering whether the following 3 lines could
    >> be considered for inclusion by the core developers, but did not know which
    >> mailing list to write to. 

    > As Jeff alluded to, *every* message to this list has a footer
    > with a link to *the POSTING GUIDE"  ...

    > and from there you quickly learn it is 'R-devel' (instead of 'R-help').

    > Now that we have already half a dozen messages here, let's keep
    > the whole thread here, even if only for ease of reading the list archives(!)

    >> Here is my proposal:

    >> correctTime <- function (x, offset = 0, ...) { # Changes
    >> stats:::time.default
    >> n <- if (is.matrix(x)) nrow(x) else length(x)
    >> xtsp <- attr(hasTsp(x), "tsp")
    >> y <- seq.int(xtsp[1L], xtsp[2L], length.out = n) + offset/xtsp[3L]
    >> round.y <- round(y)
    >> near.integer <- abs(round.y - y) < sqrt(.Machine$double.eps)
    >> y[near.integer] <- round.y[near.integer]
    >> tsp(y) <- xtsp
    >> y
    >> }

    > Yes, some such change does make sense to me, too.
    > As the computations above are relatively costly (compared to the
    > current  time.default()  implementation),
    > and also for strict back compatibility reasons, I think the
    > correction should only happen when the user asks for it,  say by
    > using a new argument 'roundYear = TRUE'  (where the default
    > remains roundYear=FALSE).

    > Martin Maechler
    > ETH Zurich  and  R Core tam

After some more thinking and pondering:

No, there's no need for a 'roundYear = *' argument, but rather
we'd use the 'ts.eps' argument as in many similar situations
with ts() objects needing rounding adjustments.

Consequently, my current (only little tested) proposal  is

time.default <- function (x, offset = 0, ts.eps = getOption("ts.eps"), ...)
{
    xtsp <- attr(hasTsp(x), "tsp")
    y <- seq.int(xtsp[1L], xtsp[2L], length.out = NROW(x)) + offset/xtsp[3L]
    if(ts.eps > 0) {
        iy <- round(y)
        nearI <- abs(iy - y) < ts.eps
        y[nearI] <- iy[nearI]
    }
    tsp(y) <- xtsp
    y
}

It *does* fix your example(s) below.

Martin


    >> x <- ts(2:252, start = c(2002, 2), freq = 12)
    >> d <- seq.Date(as.Date("2002-02-01"), to = as.Date("2022-12-01"), by =
    >> "month")
    >> true.year <- rep(2002:2022, each = 12)[-1]
    >> wrong.year <- floor(as.numeric(time(x)))
    >> print(as.numeric(time(x))[240], 20) # 2021.9999999999997726, the floor of
    >> which is 2021
    >> print(correctTime(x)[240], 20) # 2022

    >> On Sat, Oct 15, 2022 at 11:56 AM Eric Berger <ericjberger at gmail.com> wrote:

    >>> Alternatively
    >>> 
    >>> correct.year <- floor(time(x)+1e-6)
    >>> 
    >>> On Sat, Oct 15, 2022 at 10:26 AM Andre? V. Kostyrka <
    >>> andrei.kostyrka at gmail.com> wrote:
    >>> 
    >>>> Dear all,
    >>>> 
    >>>> 
    >>>> 
    >>>> I was using stats::time to obtain the year as a floor of it, and
    >>>> encountered a problem: due to a rounding error (most likely due to its
    >>>> reliance on the base::seq.int internally, but correct me if I am wrong),
    >>>> the actual number corresponding to the beginning of a year X can still be
    >>>> (X-1).9999999..., resulting in the following undesirable behaviour.
    >>>> 
    >>>> 
    >>>> 
    >>>> One of the simplest ways of getting the year from a ts object is
    >>>> floor(time(...)). However, if the starting time cannot be represented
    >>>> nicely as a power of 2, then, supposedly integer time does not have a
    >>>> .000000... mantissa:
    >>>> 
    >>>> 
    >>>> 
    >>>> x <- ts(2:252, start = c(2002, 2), freq = 12)
    >>>> 
    >>>> d <- seq.Date(as.Date("2002-02-01"), to = as.Date("2022-12-01"), by =
    >>>> "month")
    >>>> 
    >>>> true.year <- rep(2002:2022, each = 12)[-1]
    >>>> 
    >>>> wrong.year <- floor(as.numeric(time(x)))
    >>>> 
    >>>> tail(cbind(as.character(d), true.year, wrong.year), 15) # Look at
    >>>> 2022-01-01
    >>>> 
    >>>> print(as.numeric(time(x))[240], 20) # 2021.9999999999997726, the floor of
    >>>> which is 2021
    >>>> 
    >>>> 
    >>>> 
    >>>> Yes, I have read the 'R inferno' book and know the famous '0.3 != 0.7 -
    >>>> 0.4' example, but I believe that the expected / intended behaviour would
    >>>> be
    >>>> actually returning round years for the first observation in a year. This
    >>>> could be achieved by rounding the near-integer time to integers.
    >>>> 
    >>>> 
    >>>> 
    >>>> Since users working with dates are expecting to get exact integer years
    >>>> for
    >>>> the first cycle of a ts, this should be changed. Thank you in advance for
    >>>> considering a fix.
    >>>> 
    >>>> 
    >>>> 
    >>>> Yours sincerely,
    >>>> 
    >>>> Andre? V. Kostyrka
    >>>> 
    >>>> [[alternative HTML version deleted]]
    >>>> 
    >>>> ______________________________________________
    >>>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
    >>>> https://stat.ethz.ch/mailman/listinfo/r-help
    >>>> PLEASE do read the posting guide
    >>>> http://www.R-project.org/posting-guide.html
    >>>> and provide commented, minimal, self-contained, reproducible code.
    >>>> 
    >>> 

    >> [[alternative HTML version deleted]]

    >> ______________________________________________
    >> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
    >> https://stat.ethz.ch/mailman/listinfo/r-help
    >> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
    >> and provide commented, minimal, self-contained, reproducible code.

    > ______________________________________________
    > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
    > https://stat.ethz.ch/mailman/listinfo/r-help
    > PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
    > and provide commented, minimal, self-contained, reproducible code.


From debb|e @end|ng |rom uc|@edu  Thu Oct 20 03:51:57 2022
From: debb|e @end|ng |rom uc|@edu (Debbie Hahs-Vaughn)
Date: Thu, 20 Oct 2022 01:51:57 +0000
Subject: [R] inconsistencies between HLM and clmm results for the signs for
 the coefficients
Message-ID: <BN9PR11MB5227E798A86A4902870CB36ADD2A9@BN9PR11MB5227.namprd11.prod.outlook.com>

I've generated a very simple multilevel ordinal model using HLM software and using the clmm function from the ordinal package in R. The threshold values and coefficients are comparable, however the signs for the coefficients (and only the coefficients; not the thresholds) are opposite (e.g., positive in HLM, negative in clmm).  This then impacts the odds ratios for the predictors.  HLM reports odds greater than one and clmm reports odds less than one.  I anticipate there is a very easy reason for what's happening, and it's just escaping me.  Can someone please advise on what I've overlooked?

	[[alternative HTML version deleted]]


From th|erry@onke||nx @end|ng |rom |nbo@be  Fri Oct 21 10:02:20 2022
From: th|erry@onke||nx @end|ng |rom |nbo@be (Thierry Onkelinx)
Date: Fri, 21 Oct 2022 10:02:20 +0200
Subject: [R] 
 inconsistencies between HLM and clmm results for the signs for
 the coefficients
In-Reply-To: <BN9PR11MB5227E798A86A4902870CB36ADD2A9@BN9PR11MB5227.namprd11.prod.outlook.com>
References: <BN9PR11MB5227E798A86A4902870CB36ADD2A9@BN9PR11MB5227.namprd11.prod.outlook.com>
Message-ID: <CAJuCY5zVCYdsyjKFueWfoNM4aEVwF_MJyZyeEc+Zp94J4ATArw@mail.gmail.com>

Dear Debbie,

Have a look at the vignette of the ordinal package. Look for the equation
that defines \eta. And note the minus sign associated with \beta. You'll
need to find the equation used in HLM and compare it with the equation from
ordinal.

Best regards,

ir. Thierry Onkelinx
Statisticus / Statistician

Vlaamse Overheid / Government of Flanders
INSTITUUT VOOR NATUUR- EN BOSONDERZOEK / RESEARCH INSTITUTE FOR NATURE AND
FOREST
Team Biometrie & Kwaliteitszorg / Team Biometrics & Quality Assurance
thierry.onkelinx at inbo.be
Havenlaan 88 bus 73, 1000 Brussel
www.inbo.be

///////////////////////////////////////////////////////////////////////////////////////////
To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey
///////////////////////////////////////////////////////////////////////////////////////////

<https://www.inbo.be>


Op do 20 okt. 2022 om 09:22 schreef Debbie Hahs-Vaughn <debbie at ucf.edu>:

> I've generated a very simple multilevel ordinal model using HLM software
> and using the clmm function from the ordinal package in R. The threshold
> values and coefficients are comparable, however the signs for the
> coefficients (and only the coefficients; not the thresholds) are opposite
> (e.g., positive in HLM, negative in clmm).  This then impacts the odds
> ratios for the predictors.  HLM reports odds greater than one and clmm
> reports odds less than one.  I anticipate there is a very easy reason for
> what's happening, and it's just escaping me.  Can someone please advise on
> what I've overlooked?
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From j@zh@o @end|ng |rom ye@h@net  Fri Oct 21 11:29:15 2022
From: j@zh@o @end|ng |rom ye@h@net (Jinsong Zhao)
Date: Fri, 21 Oct 2022 17:29:15 +0800
Subject: [R] unexpected 'else' in " else"
Message-ID: <eee4b08c-0544-7f52-2934-4aaba9cd9ced@yeah.net>

Hi there,

The following code would cause R error:

 > w <- 1:5
 > r <- 1:5
 >         if (is.matrix(r))
+             r[w != 0, , drop = FALSE]
 >         else r[w != 0]
Error: unexpected 'else' in "        else"

However, the code:
         if (is.matrix(r))
             r[w != 0, , drop = FALSE]
         else r[w != 0]
is extracted from stats::weighted.residuals.

My question is why the code in the function does not cause error?

Best,
Jinsong


From @kw@|mmo @end|ng |rom gm@||@com  Fri Oct 21 11:36:45 2022
From: @kw@|mmo @end|ng |rom gm@||@com (Andrew Simmons)
Date: Fri, 21 Oct 2022 05:36:45 -0400
Subject: [R] unexpected 'else' in " else"
In-Reply-To: <eee4b08c-0544-7f52-2934-4aaba9cd9ced@yeah.net>
References: <eee4b08c-0544-7f52-2934-4aaba9cd9ced@yeah.net>
Message-ID: <CAPcHnpRZisZ1kZM5gjpSOybqtCwdoY8JPHCiVhF9q-Vs5iCLOg@mail.gmail.com>

The error comes from the expression not being wrapped with braces. You
could change it to

if (is.matrix(r)) {
    r[w != 0, , drop = FALSE]
} else r[w != 0]

or

{
    if (is.matrix(r))
        r[w != 0, , drop = FALSE]
    else r[w != 0]
}

or

if (is.matrix(r)) r[w != 0, , drop = FALSE] else r[w != 0]


On Fri., Oct. 21, 2022, 05:29 Jinsong Zhao, <jszhao at yeah.net> wrote:

> Hi there,
>
> The following code would cause R error:
>
>  > w <- 1:5
>  > r <- 1:5
>  >         if (is.matrix(r))
> +             r[w != 0, , drop = FALSE]
>  >         else r[w != 0]
> Error: unexpected 'else' in "        else"
>
> However, the code:
>          if (is.matrix(r))
>              r[w != 0, , drop = FALSE]
>          else r[w != 0]
> is extracted from stats::weighted.residuals.
>
> My question is why the code in the function does not cause error?
>
> Best,
> Jinsong
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From n|ckmwr@y @end|ng |rom gm@||@com  Fri Oct 21 13:25:18 2022
From: n|ckmwr@y @end|ng |rom gm@||@com (Nick Wray)
Date: Fri, 21 Oct 2022 12:25:18 +0100
Subject: [R] Opening shapefiles in R
Message-ID: <CABxY9BPCaQT3V4BUHruL5Sj+Y351gmPTYTDOFUmoGWyXF5Ysvg@mail.gmail.com>

Hello

I have managed to download and plot the outline for the River Tweed In the
Sottish borders)  catchment using this code.  21009 is a zipfile downloaded
from the FEH website https://fehweb.ceh.ac.uk/Map:

require(rgdal)

shape <- readOGR(dsn ="C:/Users/nick/Desktop/PhD Oct 22", layer = "21009")

shape

plot(shape)

and I get an outline of the Tweed catchment which I can use

the zipfile has eight documents all with the name ?21009.? and the suffixes
cpg/dbf/prj/sbn/sbx/shp/shp/shx   There are two .shp docs, one labelled as
SHP file and one as XML file.

However

I then have downloaded a file of a plot of all the rivers in the uk from
https://osdatahub.os.uk/downloads/open

I?ve put this data into a zipfile with the name ?rivers?   Within this are
eight docs ? four with the names HydroNode. and suffixes dbf/prj/shp/shx
and four with the name WatercourseLink. and the four suffixes.

Just subbing in ?rivers? for ?21009? in my code above doesn?t work and I
can?t find a way of getting into the shapefiles and opening them


I'd be grateful if anyone can help me get further with this

Thanks Nick Wray

	[[alternative HTML version deleted]]


From tebert @end|ng |rom u||@edu  Fri Oct 21 14:05:58 2022
From: tebert @end|ng |rom u||@edu (Ebert,Timothy Aaron)
Date: Fri, 21 Oct 2022 12:05:58 +0000
Subject: [R] unexpected 'else' in " else"
In-Reply-To: <CAPcHnpRZisZ1kZM5gjpSOybqtCwdoY8JPHCiVhF9q-Vs5iCLOg@mail.gmail.com>
References: <eee4b08c-0544-7f52-2934-4aaba9cd9ced@yeah.net>
 <CAPcHnpRZisZ1kZM5gjpSOybqtCwdoY8JPHCiVhF9q-Vs5iCLOg@mail.gmail.com>
Message-ID: <BN6PR2201MB155336D119AE870E5757153BCF2D9@BN6PR2201MB1553.namprd22.prod.outlook.com>

I can get it to work with
ifelse(is.matrix(r), r[w!=0, , drop=FALSE], r[w!=0])

With w and r as defined r is not a  matrix, so the first part will never execute. The test is for w not equal to zero so it is always true for these vectors. It is usually good to have test code such that all possible cases are activated.

r<--1:8
w<- -1:5
if(is.matrix(r)){
  r[w!=0, , drop=FALSE]
} else r[w != 0]

I think this also works. The "else" must follow the } and you put in a carriage return after the }

I think that is the answer, but not 100% sure.

Tim

-----Original Message-----
From: R-help <r-help-bounces at r-project.org> On Behalf Of Andrew Simmons
Sent: Friday, October 21, 2022 5:37 AM
To: Jinsong Zhao <jszhao at yeah.net>
Cc: R-help Mailing List <r-help at r-project.org>
Subject: Re: [R] unexpected 'else' in " else"

[External Email]

The error comes from the expression not being wrapped with braces. You could change it to

if (is.matrix(r)) {
    r[w != 0, , drop = FALSE]
} else r[w != 0]

or

{
    if (is.matrix(r))
        r[w != 0, , drop = FALSE]
    else r[w != 0]
}

or

if (is.matrix(r)) r[w != 0, , drop = FALSE] else r[w != 0]


On Fri., Oct. 21, 2022, 05:29 Jinsong Zhao, <jszhao at yeah.net> wrote:

> Hi there,
>
> The following code would cause R error:
>
>  > w <- 1:5
>  > r <- 1:5
>  >         if (is.matrix(r))
> +             r[w != 0, , drop = FALSE]
>  >         else r[w != 0]
> Error: unexpected 'else' in "        else"
>
> However, the code:
>          if (is.matrix(r))
>              r[w != 0, , drop = FALSE]
>          else r[w != 0]
> is extracted from stats::weighted.residuals.
>
> My question is why the code in the function does not cause error?
>
> Best,
> Jinsong
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat
> .ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl
> .edu%7C98bd495a0754455cbead08dab348311f%7C0d4da0f84a314d76ace60a62331e
> 1b84%7C0%7C0%7C638019419897938843%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4w
> LjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C
> &amp;sdata=9ImIUx0YyKjFMTDRrwa5fnkqiJL9aDjpGCRxxfI6Hlk%3D&amp;reserved
> =0
> PLEASE do read the posting guide
> https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r
> -project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%
> 7C98bd495a0754455cbead08dab348311f%7C0d4da0f84a314d76ace60a62331e1b84%
> 7C0%7C0%7C638019419897938843%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwM
> DAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;
> sdata=WsqoNk2NQ6NOjKoOKwf%2FPU57XkAwKtRhw6xb68COT1o%3D&amp;reserved=0
> and provide commented, minimal, self-contained, reproducible code.
>

        [[alternative HTML version deleted]]

______________________________________________
R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl.edu%7C98bd495a0754455cbead08dab348311f%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638019419898095081%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=2mYpa25vpXNvPNINi9XxCtc7Vbj4Sp4IQUsA9fL%2BA60%3D&amp;reserved=0
PLEASE do read the posting guide https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%7C98bd495a0754455cbead08dab348311f%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638019419898095081%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=21LO4e%2BNnGmlDjm3XfExMX63Z2viUePxMaHbcgm7JuA%3D&amp;reserved=0
and provide commented, minimal, self-contained, reproducible code.


From j@zh@o @end|ng |rom ye@h@net  Fri Oct 21 14:06:22 2022
From: j@zh@o @end|ng |rom ye@h@net (Jinsong Zhao)
Date: Fri, 21 Oct 2022 20:06:22 +0800
Subject: [R] unexpected 'else' in " else"
In-Reply-To: <CAPcHnpRZisZ1kZM5gjpSOybqtCwdoY8JPHCiVhF9q-Vs5iCLOg@mail.gmail.com>
References: <eee4b08c-0544-7f52-2934-4aaba9cd9ced@yeah.net>
 <CAPcHnpRZisZ1kZM5gjpSOybqtCwdoY8JPHCiVhF9q-Vs5iCLOg@mail.gmail.com>
Message-ID: <dbe9cba9-bdf3-7577-a42d-8101c425bfad@yeah.net>

Thanks a lot!

I know the first and third way to correct the error. The second way 
seems make me know why the code is correct in the function 
stats::weighted.residuals.

On 2022/10/21 17:36, Andrew Simmons wrote:
> The error comes from the expression not being wrapped with braces. You 
> could change it to
>
> if (is.matrix(r)) {
> ? ? r[w != 0, , drop = FALSE]
> } else r[w != 0]
>
> or
>
> {
> ? ? if (is.matrix(r))
> ? ? ? ? r[w != 0, , drop = FALSE]
> ? ? else r[w != 0]
> }
>
> or
>
> if (is.matrix(r)) r[w != 0, , drop = FALSE] else r[w != 0]
>
>
> On Fri., Oct. 21, 2022, 05:29 Jinsong Zhao, <jszhao at yeah.net> wrote:
>
>     Hi there,
>
>     The following code would cause R error:
>
>     ?> w <- 1:5
>     ?> r <- 1:5
>     ?>? ? ? ? ?if (is.matrix(r))
>     +? ? ? ? ? ? ?r[w != 0, , drop = FALSE]
>     ?>? ? ? ? ?else r[w != 0]
>     Error: unexpected 'else' in "? ? ? ? else"
>
>     However, the code:
>     ? ? ? ? ?if (is.matrix(r))
>     ? ? ? ? ? ? ?r[w != 0, , drop = FALSE]
>     ? ? ? ? ?else r[w != 0]
>     is extracted from stats::weighted.residuals.
>
>     My question is why the code in the function does not cause error?
>
>     Best,
>     Jinsong
>
>     ______________________________________________
>     R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>     https://stat.ethz.ch/mailman/listinfo/r-help
>     PLEASE do read the posting guide
>     http://www.R-project.org/posting-guide.html
>     <http://www.R-project.org/posting-guide.html>
>     and provide commented, minimal, self-contained, reproducible code.
>


From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Fri Oct 21 14:42:55 2022
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Fri, 21 Oct 2022 14:42:55 +0200
Subject: [R] unexpected 'else' in " else"
In-Reply-To: <BN6PR2201MB155336D119AE870E5757153BCF2D9@BN6PR2201MB1553.namprd22.prod.outlook.com>
References: <eee4b08c-0544-7f52-2934-4aaba9cd9ced@yeah.net>
 <CAPcHnpRZisZ1kZM5gjpSOybqtCwdoY8JPHCiVhF9q-Vs5iCLOg@mail.gmail.com>
 <BN6PR2201MB155336D119AE870E5757153BCF2D9@BN6PR2201MB1553.namprd22.prod.outlook.com>
Message-ID: <25426.37839.586651.879964@stat.math.ethz.ch>

>>>>> Ebert,Timothy Aaron 
>>>>>     on Fri, 21 Oct 2022 12:05:58 +0000 writes:

    > I can get it to work with
    > ifelse(is.matrix(r), r[w!=0, , drop=FALSE], r[w!=0])

Note that this is *not* good advice:

  if(Cnd) A else B    is very much more efficient  than
  ifelse(Cnd, A, B)

whenever it is appropriate, i.e.,
the condition Cnd is a simple TRUE or FALSE.

ifelse() is very much over-used!

{For the more sophisticated reader:
 In R, these both are function calls:
 `if` is a function of 3 argument with a "peculiar" syntax and
 the third argument with default NULL.
}

Martin Maechler
ETH Zurich  and  R Core team



    > With w and r as defined r is not a  matrix, so the first part will never execute. The test is for w not equal to zero so it is always true for these vectors. It is usually good to have test code such that all possible cases are activated.

    > r<--1:8
    > w<- -1:5
    > if(is.matrix(r)){
    > r[w!=0, , drop=FALSE]
    > } else r[w != 0]

    > I think this also works. The "else" must follow the } and you put in a carriage return after the }

    > I think that is the answer, but not 100% sure.

    > Tim

    > -----Original Message-----
    > From: R-help <r-help-bounces at r-project.org> On Behalf Of Andrew Simmons
    > Sent: Friday, October 21, 2022 5:37 AM
    > To: Jinsong Zhao <jszhao at yeah.net>
    > Cc: R-help Mailing List <r-help at r-project.org>
    > Subject: Re: [R] unexpected 'else' in " else"

    > [External Email]

    > The error comes from the expression not being wrapped with braces. You could change it to

    > if (is.matrix(r)) {
    > r[w != 0, , drop = FALSE]
    > } else r[w != 0]

    > or

    > {
    > if (is.matrix(r))
    > r[w != 0, , drop = FALSE]
    > else r[w != 0]
    > }

    > or

    > if (is.matrix(r)) r[w != 0, , drop = FALSE] else r[w != 0]


    > On Fri., Oct. 21, 2022, 05:29 Jinsong Zhao, <jszhao at yeah.net> wrote:

    >> Hi there,
    >> 
    >> The following code would cause R error:
    >> 
    >> > w <- 1:5
    >> > r <- 1:5
    >> >         if (is.matrix(r))
    >> +             r[w != 0, , drop = FALSE]
    >> >         else r[w != 0]
    >> Error: unexpected 'else' in "        else"
    >> 
    >> However, the code:
    >> if (is.matrix(r))
    >> r[w != 0, , drop = FALSE]
    >> else r[w != 0]
    >> is extracted from stats::weighted.residuals.
    >> 
    >> My question is why the code in the function does not cause error?
    >> 
    >> Best,
    >> Jinsong
    >> 
    >> ______________________________________________
    >> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
    >> https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat
    >> .ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl
    >> .edu%7C98bd495a0754455cbead08dab348311f%7C0d4da0f84a314d76ace60a62331e
    >> 1b84%7C0%7C0%7C638019419897938843%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4w
    >> LjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C
    >> &amp;sdata=9ImIUx0YyKjFMTDRrwa5fnkqiJL9aDjpGCRxxfI6Hlk%3D&amp;reserved
    >> =0
    >> PLEASE do read the posting guide
    >> https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r
    >> -project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%
    >> 7C98bd495a0754455cbead08dab348311f%7C0d4da0f84a314d76ace60a62331e1b84%
    >> 7C0%7C0%7C638019419897938843%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwM
    >> DAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;
    >> sdata=WsqoNk2NQ6NOjKoOKwf%2FPU57XkAwKtRhw6xb68COT1o%3D&amp;reserved=0
    >> and provide commented, minimal, self-contained, reproducible code.
    >> 

    > [[alternative HTML version deleted]]

    > ______________________________________________
    > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
    > https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl.edu%7C98bd495a0754455cbead08dab348311f%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638019419898095081%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=2mYpa25vpXNvPNINi9XxCtc7Vbj4Sp4IQUsA9fL%2BA60%3D&amp;reserved=0
    > PLEASE do read the posting guide https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%7C98bd495a0754455cbead08dab348311f%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638019419898095081%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=21LO4e%2BNnGmlDjm3XfExMX63Z2viUePxMaHbcgm7JuA%3D&amp;reserved=0
    > and provide commented, minimal, self-contained, reproducible code.

    > ______________________________________________
    > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
    > https://stat.ethz.ch/mailman/listinfo/r-help
    > PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
    > and provide commented, minimal, self-contained, reproducible code.


From j|ox @end|ng |rom mcm@@ter@c@  Fri Oct 21 15:49:30 2022
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Fri, 21 Oct 2022 09:49:30 -0400
Subject: [R] unexpected 'else' in " else"
In-Reply-To: <19044_1666354596_29LCGZXC014459_dbe9cba9-bdf3-7577-a42d-8101c425bfad@yeah.net>
References: <eee4b08c-0544-7f52-2934-4aaba9cd9ced@yeah.net>
 <CAPcHnpRZisZ1kZM5gjpSOybqtCwdoY8JPHCiVhF9q-Vs5iCLOg@mail.gmail.com>
 <19044_1666354596_29LCGZXC014459_dbe9cba9-bdf3-7577-a42d-8101c425bfad@yeah.net>
Message-ID: <8bcce2fc-6737-e25e-53b3-b21a6a8c3252@mcmaster.ca>

Dear Jinsong,

When you enter these code lines at the R command prompt, the interpreter 
evaluates an expression when it's syntactically complete, which occurs 
before it sees the else clause. The interpreter can't read your mind and 
know that an else clause will be entered on the next line. When the code 
lines are in a function, the function body is enclosed in braces and so 
the interpreter sees the else clause.

As I believe was already pointed out, you can similarly use braces at 
the command prompt to signal incompleteness of an expression, as in

 > {if (FALSE) print(1)
+ else print(2)}
[1] 2

I hope this helps,
  John

-- 
John Fox, Professor Emeritus
McMaster University
Hamilton, Ontario, Canada
web: https://socialsciences.mcmaster.ca/jfox/
On 2022-10-21 8:06 a.m., Jinsong Zhao wrote:
> Thanks a lot!
> 
> I know the first and third way to correct the error. The second way 
> seems make me know why the code is correct in the function 
> stats::weighted.residuals.
> 
> On 2022/10/21 17:36, Andrew Simmons wrote:
>> The error comes from the expression not being wrapped with braces. You 
>> could change it to
>>
>> if (is.matrix(r)) {
>> ? ? r[w != 0, , drop = FALSE]
>> } else r[w != 0]
>>
>> or
>>
>> {
>> ? ? if (is.matrix(r))
>> ? ? ? ? r[w != 0, , drop = FALSE]
>> ? ? else r[w != 0]
>> }
>>
>> or
>>
>> if (is.matrix(r)) r[w != 0, , drop = FALSE] else r[w != 0]
>>
>>
>> On Fri., Oct. 21, 2022, 05:29 Jinsong Zhao, <jszhao at yeah.net> wrote:
>>
>> ??? Hi there,
>>
>> ??? The following code would cause R error:
>>
>> ??? ?> w <- 1:5
>> ??? ?> r <- 1:5
>> ??? ?>? ? ? ? ?if (is.matrix(r))
>> ??? +? ? ? ? ? ? ?r[w != 0, , drop = FALSE]
>> ??? ?>? ? ? ? ?else r[w != 0]
>> ??? Error: unexpected 'else' in "? ? ? ? else"
>>
>> ??? However, the code:
>> ??? ? ? ? ? ?if (is.matrix(r))
>> ??? ? ? ? ? ? ? ?r[w != 0, , drop = FALSE]
>> ??? ? ? ? ? ?else r[w != 0]
>> ??? is extracted from stats::weighted.residuals.
>>
>> ??? My question is why the code in the function does not cause error?
>>
>> ??? Best,
>> ??? Jinsong
>>
>> ??? ______________________________________________
>> ??? R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> ??? https://stat.ethz.ch/mailman/listinfo/r-help
>> ??? PLEASE do read the posting guide
>> ??? http://www.R-project.org/posting-guide.html
>> ??? <http://www.R-project.org/posting-guide.html>
>> ??? and provide commented, minimal, self-contained, reproducible code.
>>
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide 
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From j@zh@o @end|ng |rom ye@h@net  Fri Oct 21 16:27:35 2022
From: j@zh@o @end|ng |rom ye@h@net (Jinsong Zhao)
Date: Fri, 21 Oct 2022 22:27:35 +0800
Subject: [R] unexpected 'else' in " else"
In-Reply-To: <8bcce2fc-6737-e25e-53b3-b21a6a8c3252@mcmaster.ca>
References: <eee4b08c-0544-7f52-2934-4aaba9cd9ced@yeah.net>
 <CAPcHnpRZisZ1kZM5gjpSOybqtCwdoY8JPHCiVhF9q-Vs5iCLOg@mail.gmail.com>
 <19044_1666354596_29LCGZXC014459_dbe9cba9-bdf3-7577-a42d-8101c425bfad@yeah.net>
 <8bcce2fc-6737-e25e-53b3-b21a6a8c3252@mcmaster.ca>
Message-ID: <5770c674-23da-3aa2-8b5c-8ed09ecd3e0d@yeah.net>

Dear John,

Thank you very much for the explanation. It cleared up my confusion 
about the syntax of "if ... else...", which in the help page of "if" said:
```
In particular, you should not have a newline between ?}? and
 ???? ?else? to avoid a syntax error in entering a ?if ... else?
 ???? construct at the keyboard or via ?source?.
```

Best,
Jinsong


On 2022/10/21 21:49, John Fox wrote:
> Dear Jinsong,
>
> When you enter these code lines at the R command prompt, the 
> interpreter evaluates an expression when it's syntactically complete, 
> which occurs before it sees the else clause. The interpreter can't 
> read your mind and know that an else clause will be entered on the 
> next line. When the code lines are in a function, the function body is 
> enclosed in braces and so the interpreter sees the else clause.
>
> As I believe was already pointed out, you can similarly use braces at 
> the command prompt to signal incompleteness of an expression, as in
>
> > {if (FALSE) print(1)
> + else print(2)}
> [1] 2
>
> I hope this helps,
> ?John
>


From JH@rm@e @end|ng |rom roku@com  Fri Oct 21 16:36:36 2022
From: JH@rm@e @end|ng |rom roku@com (Jorgen Harmse)
Date: Fri, 21 Oct 2022 14:36:36 +0000
Subject: [R] unexpected 'else' in " else"
In-Reply-To: <mailman.368053.1.1666346401.6004.r-help@r-project.org>
References: <mailman.368053.1.1666346401.6004.r-help@r-project.org>
Message-ID: <MW4PR01MB6465010FA9F88CEC19659C41DC2D9@MW4PR01MB6465.prod.exchangelabs.com>

Andrew Simmons is correct but doesn't explain why the code works in the package. This is one of only two differences I have found between running code at the command line and running it from a file. (The other difference is that code in a file is often executed in an environment other than .GlobalEnv. There is some related sugar around packages that usually makes things work the way a user would want.) At the command line, R executes code whenever RETURN could be interpreted as the end of a statement. "If(?.) ?. RETURN" is ambiguous: will it be followed by "else", or is it a complete statement? If it's in a file or wrapped in a block or other structure that obviously hasn't ended yet then R will wait to see the next line of input, but if it could be a complete statement then not executing it would cause a lot of frustration for users. Once the statement is executed, R expects another statement, and no statement begins with "else". (Maybe the interpreter could be enhanced to keep the "if" open under some conditions, but I haven't thought it through. In particular, "if" without "else" is NULL if the condition is FALSE, so it might be necessary to undo an assignment, and that seems very difficult.)

Regards,
Jorgen Harmse.


On Fri., Oct. 21, 2022, 05:29 Jinsong Zhao, <jszhao at yeah.net> wrote:

> Hi there,
>
> The following code would cause R error:
>
>  > w <- 1:5
>  > r <- 1:5
>  >         if (is.matrix(r))
> +             r[w != 0, , drop = FALSE]
>  >         else r[w != 0]
> Error: unexpected 'else' in "        else"
>
> However, the code:
>          if (is.matrix(r))
>              r[w != 0, , drop = FALSE]
>          else r[w != 0]
> is extracted from stats::weighted.residuals.
>
> My question is why the code in the function does not cause error?
>
> Best,
> Jinsong
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

        [[alternative HTML version deleted]]




------------------------------

Subject: Digest Footer

_______________________________________________
R-help at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-help
PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
and provide commented, minimal, self-contained, reproducible code.


------------------------------

End of R-help Digest, Vol 236, Issue 19
***************************************

	[[alternative HTML version deleted]]


From @kw@|mmo @end|ng |rom gm@||@com  Fri Oct 21 18:20:37 2022
From: @kw@|mmo @end|ng |rom gm@||@com (Andrew Simmons)
Date: Fri, 21 Oct 2022 12:20:37 -0400
Subject: [R] unexpected 'else' in " else"
In-Reply-To: <MW4PR01MB6465010FA9F88CEC19659C41DC2D9@MW4PR01MB6465.prod.exchangelabs.com>
References: <mailman.368053.1.1666346401.6004.r-help@r-project.org>
 <MW4PR01MB6465010FA9F88CEC19659C41DC2D9@MW4PR01MB6465.prod.exchangelabs.com>
Message-ID: <CAPcHnpTJ=69hSAH8KH17AQUFJkiP7nf5SStmQJWsuxZv6FhXtQ@mail.gmail.com>

The code working inside stats::weighted.residuals has nothing to do
with being evaluated in a different environment than globalenv() and
has nothing to do with being inside a package.
The reason the code works inside stats::weighted.residuals is because
the function body is wrapped with braces. You can try it yourself:

local({
    FILE <- tempfile(fileext = ".R")
    on.exit(unlink(FILE, force = TRUE, expand = FALSE), add = TRUE,
after = FALSE)
    writeLines("if (TRUE) \n    'evaluating cons.expr'\nelse
'evaluating alt.expr'", FILE)
    writeLines(readLines(FILE))
    try(source(FILE, local = TRUE, echo = TRUE, verbose = FALSE))
})

If you try entering it as a function, it still fails:

local({
    FILE <- tempfile(fileext = ".R")
    on.exit(unlink(FILE, force = TRUE, expand = FALSE), add = TRUE,
after = FALSE)
    writeLines("function () \nif (TRUE) \n    'evaluating
cons.expr'\nelse 'evaluating alt.expr'", FILE)
    writeLines(readLines(FILE))
    try(source(FILE, local = TRUE, echo = TRUE, verbose = FALSE))
})

But R packages use sys.source() instead of source() to run R code, but
it still fails if you run it:

local({
    FILE <- tempfile(fileext = ".R")
    on.exit(unlink(FILE, force = TRUE, expand = FALSE), add = TRUE,
after = FALSE)
    writeLines("if (TRUE) \n    'evaluating cons.expr'\nelse
'evaluating alt.expr'", FILE)
    writeLines(readLines(FILE))
    try(sys.source(FILE, envir = environment()))
})

The part that matters is that the function body is wrapped with
braces. `if` statements inside braces or parenthesis (or possibly
brackets) will continue looking for `else` even after `cons.expr` and
a newline has been fully parsed, but will not otherwise.

On Fri, Oct 21, 2022 at 10:39 AM Jorgen Harmse via R-help
<r-help at r-project.org> wrote:
>
> Andrew Simmons is correct but doesn't explain why the code works in the package. This is one of only two differences I have found between running code at the command line and running it from a file. (The other difference is that code in a file is often executed in an environment other than .GlobalEnv. There is some related sugar around packages that usually makes things work the way a user would want.) At the command line, R executes code whenever RETURN could be interpreted as the end of a statement. "If(?.) ?. RETURN" is ambiguous: will it be followed by "else", or is it a complete statement? If it's in a file or wrapped in a block or other structure that obviously hasn't ended yet then R will wait to see the next line of input, but if it could be a complete statement then not executing it would cause a lot of frustration for users. Once the statement is executed, R expects another statement, and no statement begins with "else". (Maybe the interpreter could be enhanced to keep the "if" open under some conditions, but I haven't thought it through. In particular, "if" without "else" is NULL if the condition is FALSE, so it might be necessary to undo an assignment, and that seems very difficult.)
>
> Regards,
> Jorgen Harmse.
>
>
> On Fri., Oct. 21, 2022, 05:29 Jinsong Zhao, <jszhao at yeah.net> wrote:
>
> > Hi there,
> >
> > The following code would cause R error:
> >
> >  > w <- 1:5
> >  > r <- 1:5
> >  >         if (is.matrix(r))
> > +             r[w != 0, , drop = FALSE]
> >  >         else r[w != 0]
> > Error: unexpected 'else' in "        else"
> >
> > However, the code:
> >          if (is.matrix(r))
> >              r[w != 0, , drop = FALSE]
> >          else r[w != 0]
> > is extracted from stats::weighted.residuals.
> >
> > My question is why the code in the function does not cause error?
> >
> > Best,
> > Jinsong
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide
> > http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.
> >
>
>         [[alternative HTML version deleted]]
>
>
>
>
> ------------------------------
>
> Subject: Digest Footer
>
> _______________________________________________
> R-help at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>
>
> ------------------------------
>
> End of R-help Digest, Vol 236, Issue 19
> ***************************************
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From tebert @end|ng |rom u||@edu  Fri Oct 21 19:38:48 2022
From: tebert @end|ng |rom u||@edu (Ebert,Timothy Aaron)
Date: Fri, 21 Oct 2022 17:38:48 +0000
Subject: [R] unexpected 'else' in " else"
In-Reply-To: <25426.37839.586651.879964@stat.math.ethz.ch>
References: <eee4b08c-0544-7f52-2934-4aaba9cd9ced@yeah.net>
 <CAPcHnpRZisZ1kZM5gjpSOybqtCwdoY8JPHCiVhF9q-Vs5iCLOg@mail.gmail.com>
 <BN6PR2201MB155336D119AE870E5757153BCF2D9@BN6PR2201MB1553.namprd22.prod.outlook.com>
 <25426.37839.586651.879964@stat.math.ethz.ch>
Message-ID: <BN6PR2201MB15536D4B7064661AD27CC099CF2D9@BN6PR2201MB1553.namprd22.prod.outlook.com>

Is there a place where you would use ifelse()? I used it here because it was short and there was no indication of lots of data. In the example I cannot tell the difference of a few hundred milliseconds execution time. Benchmarking code is important for larger problems.

Tim

-----Original Message-----
From: Martin Maechler <maechler at stat.math.ethz.ch> 
Sent: Friday, October 21, 2022 8:43 AM
To: Ebert,Timothy Aaron <tebert at ufl.edu>
Cc: Andrew Simmons <akwsimmo at gmail.com>; Jinsong Zhao <jszhao at yeah.net>; R-help Mailing List <r-help at r-project.org>
Subject: Re: [R] unexpected 'else' in " else"

[External Email]

>>>>> Ebert,Timothy Aaron
>>>>>     on Fri, 21 Oct 2022 12:05:58 +0000 writes:

    > I can get it to work with
    > ifelse(is.matrix(r), r[w!=0, , drop=FALSE], r[w!=0])

Note that this is *not* good advice:

  if(Cnd) A else B    is very much more efficient  than
  ifelse(Cnd, A, B)

whenever it is appropriate, i.e.,
the condition Cnd is a simple TRUE or FALSE.

ifelse() is very much over-used!

{For the more sophisticated reader:
 In R, these both are function calls:
 `if` is a function of 3 argument with a "peculiar" syntax and  the third argument with default NULL.
}

Martin Maechler
ETH Zurich  and  R Core team



    > With w and r as defined r is not a  matrix, so the first part will never execute. The test is for w not equal to zero so it is always true for these vectors. It is usually good to have test code such that all possible cases are activated.

    > r<--1:8
    > w<- -1:5
    > if(is.matrix(r)){
    > r[w!=0, , drop=FALSE]
    > } else r[w != 0]

    > I think this also works. The "else" must follow the } and you put in a carriage return after the }

    > I think that is the answer, but not 100% sure.

    > Tim

    > -----Original Message-----
    > From: R-help <r-help-bounces at r-project.org> On Behalf Of Andrew Simmons
    > Sent: Friday, October 21, 2022 5:37 AM
    > To: Jinsong Zhao <jszhao at yeah.net>
    > Cc: R-help Mailing List <r-help at r-project.org>
    > Subject: Re: [R] unexpected 'else' in " else"

    > [External Email]

    > The error comes from the expression not being wrapped with braces. You could change it to

    > if (is.matrix(r)) {
    > r[w != 0, , drop = FALSE]
    > } else r[w != 0]

    > or

    > {
    > if (is.matrix(r))
    > r[w != 0, , drop = FALSE]
    > else r[w != 0]
    > }

    > or

    > if (is.matrix(r)) r[w != 0, , drop = FALSE] else r[w != 0]


    > On Fri., Oct. 21, 2022, 05:29 Jinsong Zhao, <jszhao at yeah.net> wrote:

    >> Hi there,
    >>
    >> The following code would cause R error:
    >>
    >> > w <- 1:5
    >> > r <- 1:5
    >> >         if (is.matrix(r))
    >> +             r[w != 0, , drop = FALSE]
    >> >         else r[w != 0]
    >> Error: unexpected 'else' in "        else"
    >>
    >> However, the code:
    >> if (is.matrix(r))
    >> r[w != 0, , drop = FALSE]
    >> else r[w != 0]
    >> is extracted from stats::weighted.residuals.
    >>
    >> My question is why the code in the function does not cause error?
    >>
    >> Best,
    >> Jinsong
    >>
    >> ______________________________________________
    >> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
    >> https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat
    >> .ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl
    >> .edu%7C98bd495a0754455cbead08dab348311f%7C0d4da0f84a314d76ace60a62331e
    >> 1b84%7C0%7C0%7C638019419897938843%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4w
    >> LjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C
    >> &amp;sdata=9ImIUx0YyKjFMTDRrwa5fnkqiJL9aDjpGCRxxfI6Hlk%3D&amp;reserved
    >> =0
    >> PLEASE do read the posting guide
    >> https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r%2F&amp;data=05%7C01%7Ctebert%40ufl.edu%7Cd3824be0a76a4e488dda08dab361d1e6%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638019529977132811%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=MTmSNg1tfjToCYtWtMf01Hhy93K0TpT3DPwuvYqVv0s%3D&amp;reserved=0
    >> -project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%
    >> 7C98bd495a0754455cbead08dab348311f%7C0d4da0f84a314d76ace60a62331e1b84%
    >> 7C0%7C0%7C638019419897938843%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwM
    >> DAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;
    >> sdata=WsqoNk2NQ6NOjKoOKwf%2FPU57XkAwKtRhw6xb68COT1o%3D&amp;reserved=0
    >> and provide commented, minimal, self-contained, reproducible code.
    >>

    > [[alternative HTML version deleted]]

    > ______________________________________________
    > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
    > https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl.edu%7Cd3824be0a76a4e488dda08dab361d1e6%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638019529977132811%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=5omzPR7XzgdKZG6pr0Ro%2F6hplvltKLHdDvNkOUVv5qM%3D&amp;reserved=0
    > PLEASE do read the posting guide https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%7Cd3824be0a76a4e488dda08dab361d1e6%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638019529977289047%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=T%2F7it0%2BBAopri6bKPLiS8TySi%2FrFejAuvZLOJkVKA2A%3D&amp;reserved=0
    > and provide commented, minimal, self-contained, reproducible code.

    > ______________________________________________
    > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
    > https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl.edu%7Cd3824be0a76a4e488dda08dab361d1e6%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638019529977289047%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=OGKDKErNG%2FCYRbDMbsLYqaoILdw84WIxD2D0HUY6XE4%3D&amp;reserved=0
    > PLEASE do read the posting guide https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%7Cd3824be0a76a4e488dda08dab361d1e6%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638019529977289047%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=T%2F7it0%2BBAopri6bKPLiS8TySi%2FrFejAuvZLOJkVKA2A%3D&amp;reserved=0
    > and provide commented, minimal, self-contained, reproducible code.


From ||@her @end|ng |rom p|e@@th@n@com  Fri Oct 21 19:45:45 2022
From: ||@her @end|ng |rom p|e@@th@n@com (Dennis Fisher)
Date: Fri, 21 Oct 2022 10:45:45 -0700
Subject: [R] Adding page numbers to existing PDFs
Message-ID: <ECE6CC42-16C5-46D0-BBDC-C287AAD88A4D@plessthan.com>

R 4.2.1
OS X

Colleagues

I have multipage PDF files that were created in R ? the files do NOT have page numbers.  I would like to add page numbers after the fact, i.e., read a file into R, add margin text, then output as a PDF.
Can this be done in R (base R or a package)?  
It can be done in Python using reportlab.pdfgen ? however, the file size increases prohibitively.

Dennis

Dennis Fisher MD
P < (The "P Less Than" Company)
Phone / Fax: 1-866-PLessThan (1-866-753-7784)
www.PLessThan.com


From n|ckmwr@y @end|ng |rom gm@||@com  Fri Oct 21 19:45:30 2022
From: n|ckmwr@y @end|ng |rom gm@||@com (Nick Wray)
Date: Fri, 21 Oct 2022 18:45:30 +0100
Subject: [R] Linestring values to vector
Message-ID: <CABxY9BPNMFmw2HX02gzk+_MNGPaJ6Yc3jsEUO7PbYczOdx8DCA@mail.gmail.com>

Hello I have downloaded a large shapefile dataset of UK rivers and I want
to isolate (as an ordinary R string) the LINESTRING values for particular
lines, corresponding to rivers
Looking at the first line I can isolate the geometry by

Hello I have downloaded a large shapefile dataset of UK rivers and I want
to isolate (as an ordinary R string) the LINESTRING values for particular
lines, corresponding to rivers

Looking at the first line I can isolate the geometry by



st_geometry(rivers[1,8])



Geometry set for 1 feature
Geometry type: LINESTRING
Dimension:     XYZ
Bounding box:  xmin: 462010.6 ymin: 1213039 xmax: 462306.5 ymax: 1213199
z_range:       zmin: 0 zmax: 0
Projected CRS: OSGB 1936 / British National Grid

LINESTRING Z (462306.5 1213048 0, 462275.4 1213...


What I need is all the values in the LINESTRING as a common or garden R
vector, but I cannot find a way to do this.

 Does anyone know how?  Thanks, Nick Wray

	[[alternative HTML version deleted]]


From bgunter@4567 @end|ng |rom gm@||@com  Fri Oct 21 19:57:26 2022
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Fri, 21 Oct 2022 10:57:26 -0700
Subject: [R] Adding page numbers to existing PDFs
In-Reply-To: <ECE6CC42-16C5-46D0-BBDC-C287AAD88A4D@plessthan.com>
References: <ECE6CC42-16C5-46D0-BBDC-C287AAD88A4D@plessthan.com>
Message-ID: <CAGxFJbQVYWK6R2NMiAgnzpW756LhMX+fDFwxHEK0x3UE8qbdjA@mail.gmail.com>

Have you done a web search on "R packages to edit pdf files" or similar? I
got what looked like relevant hits with it.

Bert

On Fri, Oct 21, 2022 at 10:49 AM Dennis Fisher <fisher at plessthan.com> wrote:

> R 4.2.1
> OS X
>
> Colleagues
>
> I have multipage PDF files that were created in R ? the files do NOT have
> page numbers.  I would like to add page numbers after the fact, i.e., read
> a file into R, add margin text, then output as a PDF.
> Can this be done in R (base R or a package)?
> It can be done in Python using reportlab.pdfgen ? however, the file size
> increases prohibitively.
>
> Dennis
>
> Dennis Fisher MD
> P < (The "P Less Than" Company)
> Phone / Fax: 1-866-PLessThan (1-866-753-7784)
> www.PLessThan.com
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Fri Oct 21 20:01:29 2022
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Fri, 21 Oct 2022 11:01:29 -0700
Subject: [R] Linestring values to vector
In-Reply-To: <CABxY9BPNMFmw2HX02gzk+_MNGPaJ6Yc3jsEUO7PbYczOdx8DCA@mail.gmail.com>
References: <CABxY9BPNMFmw2HX02gzk+_MNGPaJ6Yc3jsEUO7PbYczOdx8DCA@mail.gmail.com>
Message-ID: <0A787C56-1BC5-43FE-88A9-731B6F6E5AF6@dcn.davis.ca.us>

As the Posting Guide would have warned you, you will probably have better luck asking this kind of question on the R-sig-geo mailing list.

On October 21, 2022 10:45:30 AM PDT, Nick Wray <nickmwray at gmail.com> wrote:
>Hello I have downloaded a large shapefile dataset of UK rivers and I want
>to isolate (as an ordinary R string) the LINESTRING values for particular
>lines, corresponding to rivers
>Looking at the first line I can isolate the geometry by
>
>Hello I have downloaded a large shapefile dataset of UK rivers and I want
>to isolate (as an ordinary R string) the LINESTRING values for particular
>lines, corresponding to rivers
>
>Looking at the first line I can isolate the geometry by
>
>
>
>st_geometry(rivers[1,8])
>
>
>
>Geometry set for 1 feature
>Geometry type: LINESTRING
>Dimension:     XYZ
>Bounding box:  xmin: 462010.6 ymin: 1213039 xmax: 462306.5 ymax: 1213199
>z_range:       zmin: 0 zmax: 0
>Projected CRS: OSGB 1936 / British National Grid
>
>LINESTRING Z (462306.5 1213048 0, 462275.4 1213...
>
>
>What I need is all the values in the LINESTRING as a common or garden R
>vector, but I cannot find a way to do this.
>
> Does anyone know how?  Thanks, Nick Wray
>
>	[[alternative HTML version deleted]]
>
>______________________________________________
>R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>https://stat.ethz.ch/mailman/listinfo/r-help
>PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>and provide commented, minimal, self-contained, reproducible code.

-- 
Sent from my phone. Please excuse my brevity.


From JH@rm@e @end|ng |rom roku@com  Fri Oct 21 20:01:50 2022
From: JH@rm@e @end|ng |rom roku@com (Jorgen Harmse)
Date: Fri, 21 Oct 2022 18:01:50 +0000
Subject: [R] [EXTERNAL] Re:  unexpected 'else' in " else"
In-Reply-To: <CAPcHnpTJ=69hSAH8KH17AQUFJkiP7nf5SStmQJWsuxZv6FhXtQ@mail.gmail.com>
References: <mailman.368053.1.1666346401.6004.r-help@r-project.org>
 <MW4PR01MB6465010FA9F88CEC19659C41DC2D9@MW4PR01MB6465.prod.exchangelabs.com>
 <CAPcHnpTJ=69hSAH8KH17AQUFJkiP7nf5SStmQJWsuxZv6FhXtQ@mail.gmail.com>
Message-ID: <MW4PR01MB6465BC6C382A03D4EF194487DC2D9@MW4PR01MB6465.prod.exchangelabs.com>

Thank you. I knew it had nothing to do with the choice of environment, but I thought I had seen such unwrapped code working in files in a previous version. Maybe I misremembered. Incidentally, there is nothing special about braces: anything that makes the statement incomplete will do.

Regards,
Jorgen.


> evalq( if (FALSE)

  cat("This shouldn't happen.\n")

else

  cat("Everything is fine.\n"),

+ .GlobalEnv

+ )

Everything is fine.

> x <- 1:5

> x[ if(FALSE) 1L

+    else 2L

+  ]

[1] 2


From: Andrew Simmons <akwsimmo at gmail.com>
Date: Friday, 21October, 2022 at 11:20
To: Jorgen Harmse <JHarmse at roku.com>
Cc: r-help at r-project.org <r-help at r-project.org>
Subject: [EXTERNAL] Re: [R] unexpected 'else' in " else"
The code working inside stats::weighted.residuals has nothing to do
with being evaluated in a different environment than globalenv() and
has nothing to do with being inside a package.
The reason the code works inside stats::weighted.residuals is because
the function body is wrapped with braces. You can try it yourself:

local({
    FILE <- tempfile(fileext = ".R")
    on.exit(unlink(FILE, force = TRUE, expand = FALSE), add = TRUE,
after = FALSE)
    writeLines("if (TRUE) \n    'evaluating cons.expr'\nelse
'evaluating alt.expr'", FILE)
    writeLines(readLines(FILE))
    try(source(FILE, local = TRUE, echo = TRUE, verbose = FALSE))
})

If you try entering it as a function, it still fails:

local({
    FILE <- tempfile(fileext = ".R")
    on.exit(unlink(FILE, force = TRUE, expand = FALSE), add = TRUE,
after = FALSE)
    writeLines("function () \nif (TRUE) \n    'evaluating
cons.expr'\nelse 'evaluating alt.expr'", FILE)
    writeLines(readLines(FILE))
    try(source(FILE, local = TRUE, echo = TRUE, verbose = FALSE))
})

But R packages use sys.source() instead of source() to run R code, but
it still fails if you run it:

local({
    FILE <- tempfile(fileext = ".R")
    on.exit(unlink(FILE, force = TRUE, expand = FALSE), add = TRUE,
after = FALSE)
    writeLines("if (TRUE) \n    'evaluating cons.expr'\nelse
'evaluating alt.expr'", FILE)
    writeLines(readLines(FILE))
    try(sys.source(FILE, envir = environment()))
})

The part that matters is that the function body is wrapped with
braces. `if` statements inside braces or parenthesis (or possibly
brackets) will continue looking for `else` even after `cons.expr` and
a newline has been fully parsed, but will not otherwise.

On Fri, Oct 21, 2022 at 10:39 AM Jorgen Harmse via R-help
<r-help at r-project.org> wrote:
>
> Andrew Simmons is correct but doesn't explain why the code works in the package. This is one of only two differences I have found between running code at the command line and running it from a file. (The other difference is that code in a file is often executed in an environment other than .GlobalEnv. There is some related sugar around packages that usually makes things work the way a user would want.) At the command line, R executes code whenever RETURN could be interpreted as the end of a statement. "If(?.) ?. RETURN" is ambiguous: will it be followed by "else", or is it a complete statement? If it's in a file or wrapped in a block or other structure that obviously hasn't ended yet then R will wait to see the next line of input, but if it could be a complete statement then not executing it would cause a lot of frustration for users. Once the statement is executed, R expects another statement, and no statement begins with "else". (Maybe the interpreter could be enhanced to keep the "if" open under some conditions, but I haven't thought it through. In particular, "if" without "else" is NULL if the condition is FALSE, so it might be necessary to undo an assignment, and that seems very difficult.)
>
> Regards,
> Jorgen Harmse.
>
>
> On Fri., Oct. 21, 2022, 05:29 Jinsong Zhao, <jszhao at yeah.net> wrote:
>
> > Hi there,
> >
> > The following code would cause R error:
> >
> >  > w <- 1:5
> >  > r <- 1:5
> >  >         if (is.matrix(r))
> > +             r[w != 0, , drop = FALSE]
> >  >         else r[w != 0]
> > Error: unexpected 'else' in "        else"
> >
> > However, the code:
> >          if (is.matrix(r))
> >              r[w != 0, , drop = FALSE]
> >          else r[w != 0]
> > is extracted from stats::weighted.residuals.
> >
> > My question is why the code in the function does not cause error?
> >
> > Best,
> > Jinsong
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide
> > http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.
> >
>
>         [[alternative HTML version deleted]]
>
>
>
>
> ------------------------------
>
> Subject: Digest Footer
>
> _______________________________________________
> R-help at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>
>
> ------------------------------
>
> End of R-help Digest, Vol 236, Issue 19
> ***************************************
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.

	[[alternative HTML version deleted]]


From ||@her @end|ng |rom p|e@@th@n@com  Fri Oct 21 20:04:05 2022
From: ||@her @end|ng |rom p|e@@th@n@com (Dennis Fisher)
Date: Fri, 21 Oct 2022 11:04:05 -0700
Subject: [R] Adding page numbers to existing PDFs
In-Reply-To: <CAGxFJbQVYWK6R2NMiAgnzpW756LhMX+fDFwxHEK0x3UE8qbdjA@mail.gmail.com>
References: <ECE6CC42-16C5-46D0-BBDC-C287AAD88A4D@plessthan.com>
 <CAGxFJbQVYWK6R2NMiAgnzpW756LhMX+fDFwxHEK0x3UE8qbdjA@mail.gmail.com>
Message-ID: <A51EB683-063F-4A70-9AE7-E6F246878A4E@plessthan.com>

Bert et al.

I searched with slightly different text and found various packages that might be relevant:
	pdftools
	staplr
	QPDF

However, as far as I can tell, none of these offers the specific functionality that I need.

Dennis

Dennis Fisher MD
P < (The "P Less Than" Company)
Phone / Fax: 1-866-PLessThan (1-866-753-7784)
www.PLessThan.com <http://www.plessthan.com/>




> On Oct 21, 2022, at 10:57 AM, Bert Gunter <bgunter.4567 at gmail.com> wrote:
> 
> "R packages to edit pdf files


	[[alternative HTML version deleted]]


From d@v|d@@teven@ @end|ng |rom u@u@edu  Fri Oct 21 20:26:43 2022
From: d@v|d@@teven@ @end|ng |rom u@u@edu (David Stevens)
Date: Fri, 21 Oct 2022 18:26:43 +0000
Subject: [R] [EXT] Re:  Linestring values to vector
In-Reply-To: <0A787C56-1BC5-43FE-88A9-731B6F6E5AF6@dcn.davis.ca.us>
References: <CABxY9BPNMFmw2HX02gzk+_MNGPaJ6Yc3jsEUO7PbYczOdx8DCA@mail.gmail.com>
 <0A787C56-1BC5-43FE-88A9-731B6F6E5AF6@dcn.davis.ca.us>
Message-ID: <98c0b4d9-873d-c1ba-9381-89c4fb48144d@usu.edu>

The way I did this recently is to look into the .dbf file that comes 
with the shapefile group from ESRI or your feature site, and search the 
feature names for the one I want. This gives you an index to use to 
search for the feature in the actual shapefile. Then, once the shapefile 
is loaded into R using the shapefiles package, you can get the vectors 
of polygon vertices by

lr <- shapefiles::read.shapefile(myFile) # lr is the shapefile object

sfs <- lr$shp[myIndex] #sfs will be a list and the first element is the 
geometry
sfp <- sfs[[1]]$points #sfp is the set of X and Y vertices

lines(sfp$X],sfp$Y,col='red',lwd=2)

David

David K Stevens, PhD, PE, Professor
Civil and Environmental Engineering
Utah Water Research Laboratory
Utah State University
8200 Old Main Hill
Logan, UT 84322-8200
david.stevens at usu.edu
(435) 797-3229 (office)

On 10/21/2022 12:01 PM, Jeff Newmiller wrote:
> As the Posting Guide would have warned you, you will probably have better luck asking this kind of question on the R-sig-geo mailing list.
>
> On October 21, 2022 10:45:30 AM PDT, Nick Wray <nickmwray at gmail.com> wrote:
>> Hello I have downloaded a large shapefile dataset of UK rivers and I want
>> to isolate (as an ordinary R string) the LINESTRING values for particular
>> lines, corresponding to rivers
>> Looking at the first line I can isolate the geometry by
>>
>> Hello I have downloaded a large shapefile dataset of UK rivers and I want
>> to isolate (as an ordinary R string) the LINESTRING values for particular
>> lines, corresponding to rivers
>>
>> Looking at the first line I can isolate the geometry by
>>
>>
>>
>> st_geometry(rivers[1,8])
>>
>>
>>
>> Geometry set for 1 feature
>> Geometry type: LINESTRING
>> Dimension:     XYZ
>> Bounding box:  xmin: 462010.6 ymin: 1213039 xmax: 462306.5 ymax: 1213199
>> z_range:       zmin: 0 zmax: 0
>> Projected CRS: OSGB 1936 / British National Grid
>>
>> LINESTRING Z (462306.5 1213048 0, 462275.4 1213...
>>
>>
>> What I need is all the values in the LINESTRING as a common or garden R
>> vector, but I cannot find a way to do this.
>>
>> Does anyone know how?  Thanks, Nick Wray
>>
>>        [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
> --
> Sent from my phone. Please excuse my brevity.
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
> CAUTION: This email originated from outside of USU. If this appears to be a USU employee, beware of impersonators. Do not click links, reply, download images, or open attachments unless you verify the sender?s identity and know the content is safe.
>

From pro|jcn@@h @end|ng |rom gm@||@com  Fri Oct 21 20:48:22 2022
From: pro|jcn@@h @end|ng |rom gm@||@com (J C Nash)
Date: Fri, 21 Oct 2022 14:48:22 -0400
Subject: [R] Adding page numbers to existing PDFs
In-Reply-To: <A51EB683-063F-4A70-9AE7-E6F246878A4E@plessthan.com>
References: <ECE6CC42-16C5-46D0-BBDC-C287AAD88A4D@plessthan.com>
 <CAGxFJbQVYWK6R2NMiAgnzpW756LhMX+fDFwxHEK0x3UE8qbdjA@mail.gmail.com>
 <A51EB683-063F-4A70-9AE7-E6F246878A4E@plessthan.com>
Message-ID: <6a196ff3-eb63-76c5-f307-dbef891d4997@gmail.com>

It is not automatic, but I've used Xournal for different tasks of editing a pdf.
It would certainly allow page numbers to be added, essentially by overlaying a
text box on each page. Clumsy, but possibly useful.

I tend to use Xournal to blank parts of documents that recipients should not see,
e.g., when sending a credit card statement to justify a payment but only wanting to
reveal selected lines. Or when adding an image of a signature to a form. Or filling in
text on a form.

Truthfully, a tool "addpg2pdf" that did things tidily and automatically could be useful.

JN

On 2022-10-21 14:04, Dennis Fisher wrote:
> Bert et al.
> 
> I searched with slightly different text and found various packages that might be relevant:
> 	pdftools
> 	staplr
> 	QPDF
> 
> However, as far as I can tell, none of these offers the specific functionality that I need.
> 
> Dennis
> 
> Dennis Fisher MD
> P < (The "P Less Than" Company)
> Phone / Fax: 1-866-PLessThan (1-866-753-7784)
> www.PLessThan.com <http://www.plessthan.com/>
> 
> 
> 
> 
>> On Oct 21, 2022, at 10:57 AM, Bert Gunter <bgunter.4567 at gmail.com> wrote:
>>
>> "R packages to edit pdf files
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From ggrothend|eck @end|ng |rom gm@||@com  Fri Oct 21 21:11:46 2022
From: ggrothend|eck @end|ng |rom gm@||@com (Gabor Grothendieck)
Date: Fri, 21 Oct 2022 15:11:46 -0400
Subject: [R] Adding page numbers to existing PDFs
In-Reply-To: <ECE6CC42-16C5-46D0-BBDC-C287AAD88A4D@plessthan.com>
References: <ECE6CC42-16C5-46D0-BBDC-C287AAD88A4D@plessthan.com>
Message-ID: <CAP01uRm2C-VASUGJRjhP_wXK-XXQhd_4yqGpOQbCMX2j3mmRwA@mail.gmail.com>

Create a pdf using latex that has only page numbers and then
superimpose that with your pdf using the free utility pdftk.  The
animation R package has an interface to pdftk. Google to locate
pdftk and again to locate instructions.

There are also freeware GUI Windows programs  that are easy
to use.  This has nothing to do with R.  The one I have used is
A-PDF Number.

On Fri, Oct 21, 2022 at 1:49 PM Dennis Fisher <fisher at plessthan.com> wrote:
>
> R 4.2.1
> OS X
>
> Colleagues
>
> I have multipage PDF files that were created in R ? the files do NOT have page numbers.  I would like to add page numbers after the fact, i.e., read a file into R, add margin text, then output as a PDF.
> Can this be done in R (base R or a package)?
> It can be done in Python using reportlab.pdfgen ? however, the file size increases prohibitively.
>
> Dennis
>
> Dennis Fisher MD
> P < (The "P Less Than" Company)
> Phone / Fax: 1-866-PLessThan (1-866-753-7784)
> www.PLessThan.com
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.



-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From kt1572757 @end|ng |rom gm@||@com  Fri Oct 21 23:03:19 2022
From: kt1572757 @end|ng |rom gm@||@com (Kelly Thompson)
Date: Fri, 21 Oct 2022 17:03:19 -0400
Subject: [R] getting data from a "vertical" table into a "2-dimensional" grid
Message-ID: <CAHfBD2fx1k6XhdoCmQRheCd=Q1a=TmHRvWoaBWbdbhX=148HzA@mail.gmail.com>

###
#I have data presented in a "vertical" data frame as shown below in
data_original.
#I want this data in a matrix or "grid", as shown below.
#What I show below seems like one way this can be done.

#My question: Are there easier or better ways to do this, especially
in Base R, and also in R packages?

#reproducible example

data_original <- data.frame(year = c('1990', '1999', '1990', '1989'),
size = c('s', 'l', 'xl', 'xs'),  n = c(99, 33, 3, 4) )

data_expanded <- expand.grid(unique(data_original$year),
unique(data_original$size), stringsAsFactors = FALSE )
colnames(data_expanded) <- c('year', 'size')
data_expanded <- merge(data_expanded, data_original, all = TRUE)

mat <- matrix(data = data_expanded $n, nrow =
length(unique(data_expanded $year)), ncol =
length(unique(data_expanded $size)) , byrow = TRUE, dimnames = list(
unique(data_expanded$year), unique(data_expanded$size) ) )

data_original
data_expanded
mat


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Sat Oct 22 00:03:07 2022
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Fri, 21 Oct 2022 15:03:07 -0700
Subject: [R] getting data from a "vertical" table into a "2-dimensional"
 grid
In-Reply-To: <CAHfBD2fx1k6XhdoCmQRheCd=Q1a=TmHRvWoaBWbdbhX=148HzA@mail.gmail.com>
References: <CAHfBD2fx1k6XhdoCmQRheCd=Q1a=TmHRvWoaBWbdbhX=148HzA@mail.gmail.com>
Message-ID: <E3C2C9DB-7E28-443B-955B-879C85863177@dcn.davis.ca.us>

This operation goes by a variety of names... reshape (stats), cast (reshape2), spread (tidyr), and pivot_wider (tidyr).

The stats package reshape function is built-in, but uses terminology that can be confusing, and may not come out sorted the way you want so pre-converting to factor or post-sorting may be needed. Other packages may be easier to work with.

ans <- reshape(
  data_original
, direction = "wide"
, idvar = "year"
, timevar = "size"
)
ans <- ans[ order( ans$year ), ]
ans

On October 21, 2022 2:03:19 PM PDT, Kelly Thompson <kt1572757 at gmail.com> wrote:
>###
>#I have data presented in a "vertical" data frame as shown below in
>data_original.
>#I want this data in a matrix or "grid", as shown below.
>#What I show below seems like one way this can be done.
>
>#My question: Are there easier or better ways to do this, especially
>in Base R, and also in R packages?
>
>#reproducible example
>
>data_original <- data.frame(year = c('1990', '1999', '1990', '1989'),
>size = c('s', 'l', 'xl', 'xs'),  n = c(99, 33, 3, 4) )
>
>data_expanded <- expand.grid(unique(data_original$year),
>unique(data_original$size), stringsAsFactors = FALSE )
>colnames(data_expanded) <- c('year', 'size')
>data_expanded <- merge(data_expanded, data_original, all = TRUE)
>
>mat <- matrix(data = data_expanded $n, nrow =
>length(unique(data_expanded $year)), ncol =
>length(unique(data_expanded $size)) , byrow = TRUE, dimnames = list(
>unique(data_expanded$year), unique(data_expanded$size) ) )
>
>data_original
>data_expanded
>mat
>
>______________________________________________
>R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>https://stat.ethz.ch/mailman/listinfo/r-help
>PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>and provide commented, minimal, self-contained, reproducible code.

-- 
Sent from my phone. Please excuse my brevity.


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Sat Oct 22 00:13:10 2022
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Fri, 21 Oct 2022 15:13:10 -0700
Subject: [R] unexpected 'else' in " else"
In-Reply-To: <BN6PR2201MB15536D4B7064661AD27CC099CF2D9@BN6PR2201MB1553.namprd22.prod.outlook.com>
References: <eee4b08c-0544-7f52-2934-4aaba9cd9ced@yeah.net>
 <CAPcHnpRZisZ1kZM5gjpSOybqtCwdoY8JPHCiVhF9q-Vs5iCLOg@mail.gmail.com>
 <BN6PR2201MB155336D119AE870E5757153BCF2D9@BN6PR2201MB1553.namprd22.prod.outlook.com>
 <25426.37839.586651.879964@stat.math.ethz.ch>
 <BN6PR2201MB15536D4B7064661AD27CC099CF2D9@BN6PR2201MB1553.namprd22.prod.outlook.com>
Message-ID: <FE8F4594-4F17-47F8-BB6C-7A4497644457@dcn.davis.ca.us>

Your selection priorities are inverted: ifelse is vectorised... use it to make many individual choices at once with a single atomic vector result. If-else is a control-flow construct... you can return one object of any type from it based on a single comparison or alter variables and ignore the return value (or both, though that is probably not going to make for clear readability). Their use cases might appear to overlap if you choose to work with a length-one vector, but that is a somewhat obscure mis-use of ifelse.

On October 21, 2022 10:38:48 AM PDT, "Ebert,Timothy Aaron" <tebert at ufl.edu> wrote:
>Is there a place where you would use ifelse()? I used it here because it was short and there was no indication of lots of data. In the example I cannot tell the difference of a few hundred milliseconds execution time. Benchmarking code is important for larger problems.
>
>Tim
>
>-----Original Message-----
>From: Martin Maechler <maechler at stat.math.ethz.ch> 
>Sent: Friday, October 21, 2022 8:43 AM
>To: Ebert,Timothy Aaron <tebert at ufl.edu>
>Cc: Andrew Simmons <akwsimmo at gmail.com>; Jinsong Zhao <jszhao at yeah.net>; R-help Mailing List <r-help at r-project.org>
>Subject: Re: [R] unexpected 'else' in " else"
>
>[External Email]
>
>>>>>> Ebert,Timothy Aaron
>>>>>>     on Fri, 21 Oct 2022 12:05:58 +0000 writes:
>
>    > I can get it to work with
>    > ifelse(is.matrix(r), r[w!=0, , drop=FALSE], r[w!=0])
>
>Note that this is *not* good advice:
>
>  if(Cnd) A else B    is very much more efficient  than
>  ifelse(Cnd, A, B)
>
>whenever it is appropriate, i.e.,
>the condition Cnd is a simple TRUE or FALSE.
>
>ifelse() is very much over-used!
>
>{For the more sophisticated reader:
> In R, these both are function calls:
> `if` is a function of 3 argument with a "peculiar" syntax and  the third argument with default NULL.
>}
>
>Martin Maechler
>ETH Zurich  and  R Core team
>
>
>
>    > With w and r as defined r is not a  matrix, so the first part will never execute. The test is for w not equal to zero so it is always true for these vectors. It is usually good to have test code such that all possible cases are activated.
>
>    > r<--1:8
>    > w<- -1:5
>    > if(is.matrix(r)){
>    > r[w!=0, , drop=FALSE]
>    > } else r[w != 0]
>
>    > I think this also works. The "else" must follow the } and you put in a carriage return after the }
>
>    > I think that is the answer, but not 100% sure.
>
>    > Tim
>
>    > -----Original Message-----
>    > From: R-help <r-help-bounces at r-project.org> On Behalf Of Andrew Simmons
>    > Sent: Friday, October 21, 2022 5:37 AM
>    > To: Jinsong Zhao <jszhao at yeah.net>
>    > Cc: R-help Mailing List <r-help at r-project.org>
>    > Subject: Re: [R] unexpected 'else' in " else"
>
>    > [External Email]
>
>    > The error comes from the expression not being wrapped with braces. You could change it to
>
>    > if (is.matrix(r)) {
>    > r[w != 0, , drop = FALSE]
>    > } else r[w != 0]
>
>    > or
>
>    > {
>    > if (is.matrix(r))
>    > r[w != 0, , drop = FALSE]
>    > else r[w != 0]
>    > }
>
>    > or
>
>    > if (is.matrix(r)) r[w != 0, , drop = FALSE] else r[w != 0]
>
>
>    > On Fri., Oct. 21, 2022, 05:29 Jinsong Zhao, <jszhao at yeah.net> wrote:
>
>    >> Hi there,
>    >>
>    >> The following code would cause R error:
>    >>
>    >> > w <- 1:5
>    >> > r <- 1:5
>    >> >         if (is.matrix(r))
>    >> +             r[w != 0, , drop = FALSE]
>    >> >         else r[w != 0]
>    >> Error: unexpected 'else' in "        else"
>    >>
>    >> However, the code:
>    >> if (is.matrix(r))
>    >> r[w != 0, , drop = FALSE]
>    >> else r[w != 0]
>    >> is extracted from stats::weighted.residuals.
>    >>
>    >> My question is why the code in the function does not cause error?
>    >>
>    >> Best,
>    >> Jinsong
>    >>
>    >> ______________________________________________
>    >> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>    >> https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat
>    >> .ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl
>    >> .edu%7C98bd495a0754455cbead08dab348311f%7C0d4da0f84a314d76ace60a62331e
>    >> 1b84%7C0%7C0%7C638019419897938843%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4w
>    >> LjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C
>    >> &amp;sdata=9ImIUx0YyKjFMTDRrwa5fnkqiJL9aDjpGCRxxfI6Hlk%3D&amp;reserved
>    >> =0
>    >> PLEASE do read the posting guide
>    >> https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r%2F&amp;data=05%7C01%7Ctebert%40ufl.edu%7Cd3824be0a76a4e488dda08dab361d1e6%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638019529977132811%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=MTmSNg1tfjToCYtWtMf01Hhy93K0TpT3DPwuvYqVv0s%3D&amp;reserved=0
>    >> -project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%
>    >> 7C98bd495a0754455cbead08dab348311f%7C0d4da0f84a314d76ace60a62331e1b84%
>    >> 7C0%7C0%7C638019419897938843%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwM
>    >> DAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;
>    >> sdata=WsqoNk2NQ6NOjKoOKwf%2FPU57XkAwKtRhw6xb68COT1o%3D&amp;reserved=0
>    >> and provide commented, minimal, self-contained, reproducible code.
>    >>
>
>    > [[alternative HTML version deleted]]
>
>    > ______________________________________________
>    > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>    > https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl.edu%7Cd3824be0a76a4e488dda08dab361d1e6%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638019529977132811%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=5omzPR7XzgdKZG6pr0Ro%2F6hplvltKLHdDvNkOUVv5qM%3D&amp;reserved=0
>    > PLEASE do read the posting guide https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%7Cd3824be0a76a4e488dda08dab361d1e6%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638019529977289047%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=T%2F7it0%2BBAopri6bKPLiS8TySi%2FrFejAuvZLOJkVKA2A%3D&amp;reserved=0
>    > and provide commented, minimal, self-contained, reproducible code.
>
>    > ______________________________________________
>    > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>    > https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl.edu%7Cd3824be0a76a4e488dda08dab361d1e6%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638019529977289047%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=OGKDKErNG%2FCYRbDMbsLYqaoILdw84WIxD2D0HUY6XE4%3D&amp;reserved=0
>    > PLEASE do read the posting guide https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%7Cd3824be0a76a4e488dda08dab361d1e6%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638019529977289047%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=T%2F7it0%2BBAopri6bKPLiS8TySi%2FrFejAuvZLOJkVKA2A%3D&amp;reserved=0
>    > and provide commented, minimal, self-contained, reproducible code.
>
>______________________________________________
>R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>https://stat.ethz.ch/mailman/listinfo/r-help
>PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>and provide commented, minimal, self-contained, reproducible code.

-- 
Sent from my phone. Please excuse my brevity.


From kt1572757 @end|ng |rom gm@||@com  Sat Oct 22 00:23:53 2022
From: kt1572757 @end|ng |rom gm@||@com (Kelly Thompson)
Date: Fri, 21 Oct 2022 18:23:53 -0400
Subject: [R] getting data from a "vertical" table into a "2-dimensional"
 grid
In-Reply-To: <CAHfBD2fx1k6XhdoCmQRheCd=Q1a=TmHRvWoaBWbdbhX=148HzA@mail.gmail.com>
References: <CAHfBD2fx1k6XhdoCmQRheCd=Q1a=TmHRvWoaBWbdbhX=148HzA@mail.gmail.com>
Message-ID: <CAHfBD2cSb9scG=Sw4=PVZBoTRyYN=aPfbZ6hYXxp0VUOBnzreA@mail.gmail.com>

# I think this might be a better example.

# I have data presented in a "vertical" dataframe as shown below in
data_original.
# I want this data in a matrix or "grid", as shown below.
# What I show below seems like one way this can be done.

# My question: Are there easier or better ways to do this, especially
in Base R, and also in R packages?

#create data
set.seed(1)
data_original <- data.frame(year = rep(1990:1999, length  = 50),
category = sample(1:5, size = 50, replace = TRUE),  sales =
sample(0:99999, size = 50 , replace = TRUE) )
dim(data_original)

#remove rows where data_original$year == 1990 & data_original$category
== 5, to ensure there is at least one NA in the "grid"
data_original <- data_original[ (data_original$year == 1990 &
data_original$category == 5) == FALSE, ]
dim(data_original)

#aggregate data
data_aggregate_sum_by_year_and_category <- aggregate(x =
data_original$sales, by = list(year = data_original$year, category =
data_original$category), FUN = sum)
colnames(data_aggregate_sum_by_year_and_category) <- c('year',
'category', 'sum_of_sales')
dim(data_aggregate_sum_by_year_and_category)

data_expanded <- expand.grid(year =
unique(data_aggregate_sum_by_year_and_category$year), category =
unique(data_aggregate_sum_by_year_and_category$category))
dim(data_expanded)
data_expanded <- merge(data_expanded,
data_aggregate_sum_by_year_and_category, all = TRUE)
dim(data_expanded)

mat <- matrix(data = data_expanded$sum_of_sales, nrow =
length(unique(data_expanded$year)), ncol =
length(unique(data_expanded$category)) , byrow = TRUE, dimnames =
list( unique(data_expanded$year), unique(data_expanded$category) ) )


data_original
data_expanded
mat

On Fri, Oct 21, 2022 at 5:03 PM Kelly Thompson <kt1572757 at gmail.com> wrote:
>
> ###
> #I have data presented in a "vertical" data frame as shown below in
> data_original.
> #I want this data in a matrix or "grid", as shown below.
> #What I show below seems like one way this can be done.
>
> #My question: Are there easier or better ways to do this, especially
> in Base R, and also in R packages?
>
> #reproducible example
>
> data_original <- data.frame(year = c('1990', '1999', '1990', '1989'),
> size = c('s', 'l', 'xl', 'xs'),  n = c(99, 33, 3, 4) )
>
> data_expanded <- expand.grid(unique(data_original$year),
> unique(data_original$size), stringsAsFactors = FALSE )
> colnames(data_expanded) <- c('year', 'size')
> data_expanded <- merge(data_expanded, data_original, all = TRUE)
>
> mat <- matrix(data = data_expanded $n, nrow =
> length(unique(data_expanded $year)), ncol =
> length(unique(data_expanded $size)) , byrow = TRUE, dimnames = list(
> unique(data_expanded$year), unique(data_expanded$size) ) )
>
> data_original
> data_expanded
> mat


From kt1572757 @end|ng |rom gm@||@com  Sat Oct 22 00:32:44 2022
From: kt1572757 @end|ng |rom gm@||@com (Kelly Thompson)
Date: Fri, 21 Oct 2022 18:32:44 -0400
Subject: [R] getting data from a "vertical" table into a "2-dimensional"
 grid
In-Reply-To: <CAHfBD2cSb9scG=Sw4=PVZBoTRyYN=aPfbZ6hYXxp0VUOBnzreA@mail.gmail.com>
References: <CAHfBD2fx1k6XhdoCmQRheCd=Q1a=TmHRvWoaBWbdbhX=148HzA@mail.gmail.com>
 <CAHfBD2cSb9scG=Sw4=PVZBoTRyYN=aPfbZ6hYXxp0VUOBnzreA@mail.gmail.com>
Message-ID: <CAHfBD2fPrxQTTeWVY2DUWpVnBaqQt7UtiX0Jo5TOz0GEj30mJA@mail.gmail.com>

As my end result, I want a matrix or data frame, with one row for each
year, and one column for each category.

On Fri, Oct 21, 2022 at 6:23 PM Kelly Thompson <kt1572757 at gmail.com> wrote:
>
> # I think this might be a better example.
>
> # I have data presented in a "vertical" dataframe as shown below in
> data_original.
> # I want this data in a matrix or "grid", as shown below.
> # What I show below seems like one way this can be done.
>
> # My question: Are there easier or better ways to do this, especially
> in Base R, and also in R packages?
>
> #create data
> set.seed(1)
> data_original <- data.frame(year = rep(1990:1999, length  = 50),
> category = sample(1:5, size = 50, replace = TRUE),  sales =
> sample(0:99999, size = 50 , replace = TRUE) )
> dim(data_original)
>
> #remove rows where data_original$year == 1990 & data_original$category
> == 5, to ensure there is at least one NA in the "grid"
> data_original <- data_original[ (data_original$year == 1990 &
> data_original$category == 5) == FALSE, ]
> dim(data_original)
>
> #aggregate data
> data_aggregate_sum_by_year_and_category <- aggregate(x =
> data_original$sales, by = list(year = data_original$year, category =
> data_original$category), FUN = sum)
> colnames(data_aggregate_sum_by_year_and_category) <- c('year',
> 'category', 'sum_of_sales')
> dim(data_aggregate_sum_by_year_and_category)
>
> data_expanded <- expand.grid(year =
> unique(data_aggregate_sum_by_year_and_category$year), category =
> unique(data_aggregate_sum_by_year_and_category$category))
> dim(data_expanded)
> data_expanded <- merge(data_expanded,
> data_aggregate_sum_by_year_and_category, all = TRUE)
> dim(data_expanded)
>
> mat <- matrix(data = data_expanded$sum_of_sales, nrow =
> length(unique(data_expanded$year)), ncol =
> length(unique(data_expanded$category)) , byrow = TRUE, dimnames =
> list( unique(data_expanded$year), unique(data_expanded$category) ) )
>
>
> data_original
> data_expanded
> mat
>
> On Fri, Oct 21, 2022 at 5:03 PM Kelly Thompson <kt1572757 at gmail.com> wrote:
> >
> > ###
> > #I have data presented in a "vertical" data frame as shown below in
> > data_original.
> > #I want this data in a matrix or "grid", as shown below.
> > #What I show below seems like one way this can be done.
> >
> > #My question: Are there easier or better ways to do this, especially
> > in Base R, and also in R packages?
> >
> > #reproducible example
> >
> > data_original <- data.frame(year = c('1990', '1999', '1990', '1989'),
> > size = c('s', 'l', 'xl', 'xs'),  n = c(99, 33, 3, 4) )
> >
> > data_expanded <- expand.grid(unique(data_original$year),
> > unique(data_original$size), stringsAsFactors = FALSE )
> > colnames(data_expanded) <- c('year', 'size')
> > data_expanded <- merge(data_expanded, data_original, all = TRUE)
> >
> > mat <- matrix(data = data_expanded $n, nrow =
> > length(unique(data_expanded $year)), ncol =
> > length(unique(data_expanded $size)) , byrow = TRUE, dimnames = list(
> > unique(data_expanded$year), unique(data_expanded$size) ) )
> >
> > data_original
> > data_expanded
> > mat


From bgunter@4567 @end|ng |rom gm@||@com  Sat Oct 22 01:20:06 2022
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Fri, 21 Oct 2022 16:20:06 -0700
Subject: [R] getting data from a "vertical" table into a "2-dimensional"
 grid
In-Reply-To: <CAHfBD2fPrxQTTeWVY2DUWpVnBaqQt7UtiX0Jo5TOz0GEj30mJA@mail.gmail.com>
References: <CAHfBD2fx1k6XhdoCmQRheCd=Q1a=TmHRvWoaBWbdbhX=148HzA@mail.gmail.com>
 <CAHfBD2cSb9scG=Sw4=PVZBoTRyYN=aPfbZ6hYXxp0VUOBnzreA@mail.gmail.com>
 <CAHfBD2fPrxQTTeWVY2DUWpVnBaqQt7UtiX0Jo5TOz0GEj30mJA@mail.gmail.com>
Message-ID: <CAGxFJbQYcj1Jk9NX6VT3jSjQhokm9wzVouQiuX2ZT7jjKdViTw@mail.gmail.com>

"As my end result, I want a matrix or data frame, with one row for each
year, and one column for each category."

If I understand you correctly, no reshaping gymnastics are needed --
just use ?tapply:

set.seed(1)
do <- data.frame(year = rep(1990:1999, length  = 50),
category = sample(1:5, size = 50, replace = TRUE),
sales = sample(0:99999, size = 50 , replace = TRUE) )


with(do, tapply(sales, list(year, category),sum))
 ## which gives the matrix:

         1      2      3     4     5
1990  13283     NA  55083 87522 64877
1991     NA  80963     NA 30100 28277
1992   9391 202916     NA 55090    NA
1993  29696 167344     NA    NA 17625
1994  98015  99521     NA 70536 52252
1995 157003     NA  26875    NA 11366
1996  32986  88683   6562 79475 95282
1997  13601     NA 134757 12398    NA
1998  30537  51117  31333 20204    NA
1999  39240  87845  62479    NA 98804

If this is not what you wanted, you may need to explain further or
await a response from someone more insightful than I.

Cheers,
Bert


On Fri, Oct 21, 2022 at 3:34 PM Kelly Thompson <kt1572757 at gmail.com> wrote:
>
> As my end result, I want a matrix or data frame, with one row for each
> year, and one column for each category.
>
> On Fri, Oct 21, 2022 at 6:23 PM Kelly Thompson <kt1572757 at gmail.com> wrote:
> >
> > # I think this might be a better example.
> >
> > # I have data presented in a "vertical" dataframe as shown below in
> > data_original.
> > # I want this data in a matrix or "grid", as shown below.
> > # What I show below seems like one way this can be done.
> >
> > # My question: Are there easier or better ways to do this, especially
> > in Base R, and also in R packages?
> >
> > #create data
> > set.seed(1)
> > data_original <- data.frame(year = rep(1990:1999, length  = 50),
> > category = sample(1:5, size = 50, replace = TRUE),  sales =
> > sample(0:99999, size = 50 , replace = TRUE) )
> > dim(data_original)
> >
> > #remove rows where data_original$year == 1990 & data_original$category
> > == 5, to ensure there is at least one NA in the "grid"
> > data_original <- data_original[ (data_original$year == 1990 &
> > data_original$category == 5) == FALSE, ]
> > dim(data_original)
> >
> > #aggregate data
> > data_aggregate_sum_by_year_and_category <- aggregate(x =
> > data_original$sales, by = list(year = data_original$year, category =
> > data_original$category), FUN = sum)
> > colnames(data_aggregate_sum_by_year_and_category) <- c('year',
> > 'category', 'sum_of_sales')
> > dim(data_aggregate_sum_by_year_and_category)
> >
> > data_expanded <- expand.grid(year =
> > unique(data_aggregate_sum_by_year_and_category$year), category =
> > unique(data_aggregate_sum_by_year_and_category$category))
> > dim(data_expanded)
> > data_expanded <- merge(data_expanded,
> > data_aggregate_sum_by_year_and_category, all = TRUE)
> > dim(data_expanded)
> >
> > mat <- matrix(data = data_expanded$sum_of_sales, nrow =
> > length(unique(data_expanded$year)), ncol =
> > length(unique(data_expanded$category)) , byrow = TRUE, dimnames =
> > list( unique(data_expanded$year), unique(data_expanded$category) ) )
> >
> >
> > data_original
> > data_expanded
> > mat
> >
> > On Fri, Oct 21, 2022 at 5:03 PM Kelly Thompson <kt1572757 at gmail.com> wrote:
> > >
> > > ###
> > > #I have data presented in a "vertical" data frame as shown below in
> > > data_original.
> > > #I want this data in a matrix or "grid", as shown below.
> > > #What I show below seems like one way this can be done.
> > >
> > > #My question: Are there easier or better ways to do this, especially
> > > in Base R, and also in R packages?
> > >
> > > #reproducible example
> > >
> > > data_original <- data.frame(year = c('1990', '1999', '1990', '1989'),
> > > size = c('s', 'l', 'xl', 'xs'),  n = c(99, 33, 3, 4) )
> > >
> > > data_expanded <- expand.grid(unique(data_original$year),
> > > unique(data_original$size), stringsAsFactors = FALSE )
> > > colnames(data_expanded) <- c('year', 'size')
> > > data_expanded <- merge(data_expanded, data_original, all = TRUE)
> > >
> > > mat <- matrix(data = data_expanded $n, nrow =
> > > length(unique(data_expanded $year)), ncol =
> > > length(unique(data_expanded $size)) , byrow = TRUE, dimnames = list(
> > > unique(data_expanded$year), unique(data_expanded$size) ) )
> > >
> > > data_original
> > > data_expanded
> > > mat
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From kt1572757 @end|ng |rom gm@||@com  Sat Oct 22 02:13:59 2022
From: kt1572757 @end|ng |rom gm@||@com (Kelly Thompson)
Date: Fri, 21 Oct 2022 20:13:59 -0400
Subject: [R] getting data from a "vertical" table into a "2-dimensional"
 grid
In-Reply-To: <CAGxFJbQYcj1Jk9NX6VT3jSjQhokm9wzVouQiuX2ZT7jjKdViTw@mail.gmail.com>
References: <CAHfBD2fx1k6XhdoCmQRheCd=Q1a=TmHRvWoaBWbdbhX=148HzA@mail.gmail.com>
 <CAHfBD2cSb9scG=Sw4=PVZBoTRyYN=aPfbZ6hYXxp0VUOBnzreA@mail.gmail.com>
 <CAHfBD2fPrxQTTeWVY2DUWpVnBaqQt7UtiX0Jo5TOz0GEj30mJA@mail.gmail.com>
 <CAGxFJbQYcj1Jk9NX6VT3jSjQhokm9wzVouQiuX2ZT7jjKdViTw@mail.gmail.com>
Message-ID: <CAHfBD2esHdxuT4XATSQoGgAgT=gkjvjb9rvtaVaeT8=3TJrFgw@mail.gmail.com>

Bert,
Thanks! I'm pretty sure what you provided gets me to what I was
looking for, and is much simpler. I really appreciate your help.

A follow-up question:
I adjusted the code to not use "hard-coded" column names.

mat2 <- with(data_original, tapply( get(names(data_original)[3]),
list( get(names(data_original)[1]), get(names(data_original)[2])), sum
))

Is there any better way to write that?

Thanks again!
-----

For clarity and to improve upon what I previously wrote, and so I can
practice writing questions like this and asking for help, here's a
recap of my question and "reproducible code", and the "better way" you
provided:

I have data presented in a 3-column data frame as shown below in
"data_original".

I want to aggregate the data in column 3, with the "by" argument using
the first and second columns of "data_original".

I want the results of the aggregation in a matrix, as shown below in "mat1".

As my end "result", I want a matrix with one row for each unique value
of column1 of data_original and one column for each unique value of
column2 of data_original.

What I show below seems like one way this can be done.

My question: Are there easier or better ways to do this, especially in
Base R, and also in R packages?


#create data
set.seed(1)
data_original <- data.frame(year = rep(1990:1999, length  = 50),
category = sample(1:5, size = 50, replace = TRUE),  sales =
sample(0:99999, size = 50 , replace = TRUE) )
dim(data_original)

#remove rows where data_original[,1] == 1990 & data_original[,2] == 5,
to ensure there is at least one NA in the desired matrix (this is an
"edge" case I want the code to "deal with" correctly.)
data_original <- data_original[ (data_original[,1] == 1990 &
data_original[,2] == 5) == FALSE, ]
dim(data_original)

#aggregate data
data_aggregate_col3_by_col1_and_col2 <- aggregate(x =
data_original[3], by = list(data_original[,1], data_original[,2]), FUN
= sum)
colnames(data_aggregate_col3_by_col1_and_col2) <- colnames(data_original)
dim(data_aggregate_col3_by_col1_and_col2)

data_expanded <-
expand.grid(unique(data_aggregate_col3_by_col1_and_col2[,1]),
unique(data_aggregate_col3_by_col1_and_col2[,2]))
colnames(data_expanded) <- colnames(data_aggregate_col3_by_col1_and_col2)[1:2]
dim(data_expanded)

data_expanded <- merge(data_expanded,
data_aggregate_col3_by_col1_and_col2, all = TRUE)
dim(data_expanded)

mat1 <- matrix(data = data_expanded[,3], nrow =
length(unique(data_expanded[,1])), ncol =
length(unique(data_expanded[,2])) , byrow = TRUE, dimnames = list(
unique(data_expanded[,1]), unique(data_expanded[,2]) ) )

#this is an easier way, using with and tapply
mat2 <- with(data_original, tapply( get(names(data_original)[3]),
list( get(names(data_original)[1]), get(names(data_original)[2])), sum
))
#check that mat1 and mat 2 are "nearly equal"
all.equal(mat1, mat2)



Gunter <bgunter.4567 at gmail.com> wrote:
>
> "As my end result, I want a matrix or data frame, with one row for each
> year, and one column for each category."
>
> If I understand you correctly, no reshaping gymnastics are needed --
> just use ?tapply:
>
> set.seed(1)
> do <- data.frame(year = rep(1990:1999, length  = 50),
> category = sample(1:5, size = 50, replace = TRUE),
> sales = sample(0:99999, size = 50 , replace = TRUE) )
>
>
> with(do, tapply(sales, list(year, category),sum))
>  ## which gives the matrix:
>
>          1      2      3     4     5
> 1990  13283     NA  55083 87522 64877
> 1991     NA  80963     NA 30100 28277
> 1992   9391 202916     NA 55090    NA
> 1993  29696 167344     NA    NA 17625
> 1994  98015  99521     NA 70536 52252
> 1995 157003     NA  26875    NA 11366
> 1996  32986  88683   6562 79475 95282
> 1997  13601     NA 134757 12398    NA
> 1998  30537  51117  31333 20204    NA
> 1999  39240  87845  62479    NA 98804
>
> If this is not what you wanted, you may need to explain further or
> await a response from someone more insightful than I.
>
> Cheers,
> Bert
>
>
> On Fri, Oct 21, 2022 at 3:34 PM Kelly Thompson <kt1572757 at gmail.com> wrote:
> >
> > As my end result, I want a matrix or data frame, with one row for each
> > year, and one column for each category.
> >
> > On Fri, Oct 21, 2022 at 6:23 PM Kelly Thompson <kt1572757 at gmail.com> wrote:
> > >
> > > # I think this might be a better example.
> > >
> > > # I have data presented in a "vertical" dataframe as shown below in
> > > data_original.
> > > # I want this data in a matrix or "grid", as shown below.
> > > # What I show below seems like one way this can be done.
> > >
> > > # My question: Are there easier or better ways to do this, especially
> > > in Base R, and also in R packages?
> > >
> > > #create data
> > > set.seed(1)
> > > data_original <- data.frame(year = rep(1990:1999, length  = 50),
> > > category = sample(1:5, size = 50, replace = TRUE),  sales =
> > > sample(0:99999, size = 50 , replace = TRUE) )
> > > dim(data_original)
> > >
> > > #remove rows where data_original$year == 1990 & data_original$category
> > > == 5, to ensure there is at least one NA in the "grid"
> > > data_original <- data_original[ (data_original$year == 1990 &
> > > data_original$category == 5) == FALSE, ]
> > > dim(data_original)
> > >
> > > #aggregate data
> > > data_aggregate_sum_by_year_and_category <- aggregate(x =
> > > data_original$sales, by = list(year = data_original$year, category =
> > > data_original$category), FUN = sum)
> > > colnames(data_aggregate_sum_by_year_and_category) <- c('year',
> > > 'category', 'sum_of_sales')
> > > dim(data_aggregate_sum_by_year_and_category)
> > >
> > > data_expanded <- expand.grid(year =
> > > unique(data_aggregate_sum_by_year_and_category$year), category =
> > > unique(data_aggregate_sum_by_year_and_category$category))
> > > dim(data_expanded)
> > > data_expanded <- merge(data_expanded,
> > > data_aggregate_sum_by_year_and_category, all = TRUE)
> > > dim(data_expanded)
> > >
> > > mat <- matrix(data = data_expanded$sum_of_sales, nrow =
> > > length(unique(data_expanded$year)), ncol =
> > > length(unique(data_expanded$category)) , byrow = TRUE, dimnames =
> > > list( unique(data_expanded$year), unique(data_expanded$category) ) )
> > >
> > >
> > > data_original
> > > data_expanded
> > > mat
> > >
> > > On Fri, Oct 21, 2022 at 5:03 PM Kelly Thompson <kt1572757 at gmail.com> wrote:
> > > >
> > > > ###
> > > > #I have data presented in a "vertical" data frame as shown below in
> > > > data_original.
> > > > #I want this data in a matrix or "grid", as shown below.
> > > > #What I show below seems like one way this can be done.
> > > >
> > > > #My question: Are there easier or better ways to do this, especially
> > > > in Base R, and also in R packages?
> > > >
> > > > #reproducible example
> > > >
> > > > data_original <- data.frame(year = c('1990', '1999', '1990', '1989'),
> > > > size = c('s', 'l', 'xl', 'xs'),  n = c(99, 33, 3, 4) )
> > > >
> > > > data_expanded <- expand.grid(unique(data_original$year),
> > > > unique(data_original$size), stringsAsFactors = FALSE )
> > > > colnames(data_expanded) <- c('year', 'size')
> > > > data_expanded <- merge(data_expanded, data_original, all = TRUE)
> > > >
> > > > mat <- matrix(data = data_expanded $n, nrow =
> > > > length(unique(data_expanded $year)), ncol =
> > > > length(unique(data_expanded $size)) , byrow = TRUE, dimnames = list(
> > > > unique(data_expanded$year), unique(data_expanded$size) ) )
> > > >
> > > > data_original
> > > > data_expanded
> > > > mat
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.


From bgunter@4567 @end|ng |rom gm@||@com  Sat Oct 22 03:49:16 2022
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Fri, 21 Oct 2022 18:49:16 -0700
Subject: [R] getting data from a "vertical" table into a "2-dimensional"
 grid
In-Reply-To: <CAHfBD2esHdxuT4XATSQoGgAgT=gkjvjb9rvtaVaeT8=3TJrFgw@mail.gmail.com>
References: <CAHfBD2fx1k6XhdoCmQRheCd=Q1a=TmHRvWoaBWbdbhX=148HzA@mail.gmail.com>
 <CAHfBD2cSb9scG=Sw4=PVZBoTRyYN=aPfbZ6hYXxp0VUOBnzreA@mail.gmail.com>
 <CAHfBD2fPrxQTTeWVY2DUWpVnBaqQt7UtiX0Jo5TOz0GEj30mJA@mail.gmail.com>
 <CAGxFJbQYcj1Jk9NX6VT3jSjQhokm9wzVouQiuX2ZT7jjKdViTw@mail.gmail.com>
 <CAHfBD2esHdxuT4XATSQoGgAgT=gkjvjb9rvtaVaeT8=3TJrFgw@mail.gmail.com>
Message-ID: <CAGxFJbSFfLtBdbphuL_jAkC6_5UcNM8ca-jyep95AYFH6C-pCg@mail.gmail.com>

Well, if you know the column subscripts you need, just forget about the names!

I would just write a (one-liner) function to do it for any data frame:

myfun <- function(dat)tapply(dat[,3], dat[,1:2], sum)
## dat[,1:2] is a list because it's a data frame and all data frames are lists

myfun(data_original) ## then gives the result

## you could even make the indices arguments of the myfun if they
change in different
## data sets

-- Bert

On Fri, Oct 21, 2022 at 5:14 PM Kelly Thompson <kt1572757 at gmail.com> wrote:
>
> Bert,
> Thanks! I'm pretty sure what you provided gets me to what I was
> looking for, and is much simpler. I really appreciate your help.
>
> A follow-up question:
> I adjusted the code to not use "hard-coded" column names.
>
> mat2 <- with(data_original, tapply( get(names(data_original)[3]),
> list( get(names(data_original)[1]), get(names(data_original)[2])), sum
> ))
>
> Is there any better way to write that?
>
> Thanks again!
> -----
>
> For clarity and to improve upon what I previously wrote, and so I can
> practice writing questions like this and asking for help, here's a
> recap of my question and "reproducible code", and the "better way" you
> provided:
>
> I have data presented in a 3-column data frame as shown below in
> "data_original".
>
> I want to aggregate the data in column 3, with the "by" argument using
> the first and second columns of "data_original".
>
> I want the results of the aggregation in a matrix, as shown below in "mat1".
>
> As my end "result", I want a matrix with one row for each unique value
> of column1 of data_original and one column for each unique value of
> column2 of data_original.
>
> What I show below seems like one way this can be done.
>
> My question: Are there easier or better ways to do this, especially in
> Base R, and also in R packages?
>
>
> #create data
> set.seed(1)
> data_original <- data.frame(year = rep(1990:1999, length  = 50),
> category = sample(1:5, size = 50, replace = TRUE),  sales =
> sample(0:99999, size = 50 , replace = TRUE) )
> dim(data_original)
>
> #remove rows where data_original[,1] == 1990 & data_original[,2] == 5,
> to ensure there is at least one NA in the desired matrix (this is an
> "edge" case I want the code to "deal with" correctly.)
> data_original <- data_original[ (data_original[,1] == 1990 &
> data_original[,2] == 5) == FALSE, ]
> dim(data_original)
>
> #aggregate data
> data_aggregate_col3_by_col1_and_col2 <- aggregate(x =
> data_original[3], by = list(data_original[,1], data_original[,2]), FUN
> = sum)
> colnames(data_aggregate_col3_by_col1_and_col2) <- colnames(data_original)
> dim(data_aggregate_col3_by_col1_and_col2)
>
> data_expanded <-
> expand.grid(unique(data_aggregate_col3_by_col1_and_col2[,1]),
> unique(data_aggregate_col3_by_col1_and_col2[,2]))
> colnames(data_expanded) <- colnames(data_aggregate_col3_by_col1_and_col2)[1:2]
> dim(data_expanded)
>
> data_expanded <- merge(data_expanded,
> data_aggregate_col3_by_col1_and_col2, all = TRUE)
> dim(data_expanded)
>
> mat1 <- matrix(data = data_expanded[,3], nrow =
> length(unique(data_expanded[,1])), ncol =
> length(unique(data_expanded[,2])) , byrow = TRUE, dimnames = list(
> unique(data_expanded[,1]), unique(data_expanded[,2]) ) )
>
> #this is an easier way, using with and tapply
> mat2 <- with(data_original, tapply( get(names(data_original)[3]),
> list( get(names(data_original)[1]), get(names(data_original)[2])), sum
> ))
> #check that mat1 and mat 2 are "nearly equal"
> all.equal(mat1, mat2)
>
>
>
> Gunter <bgunter.4567 at gmail.com> wrote:
> >
> > "As my end result, I want a matrix or data frame, with one row for each
> > year, and one column for each category."
> >
> > If I understand you correctly, no reshaping gymnastics are needed --
> > just use ?tapply:
> >
> > set.seed(1)
> > do <- data.frame(year = rep(1990:1999, length  = 50),
> > category = sample(1:5, size = 50, replace = TRUE),
> > sales = sample(0:99999, size = 50 , replace = TRUE) )
> >
> >
> > with(do, tapply(sales, list(year, category),sum))
> >  ## which gives the matrix:
> >
> >          1      2      3     4     5
> > 1990  13283     NA  55083 87522 64877
> > 1991     NA  80963     NA 30100 28277
> > 1992   9391 202916     NA 55090    NA
> > 1993  29696 167344     NA    NA 17625
> > 1994  98015  99521     NA 70536 52252
> > 1995 157003     NA  26875    NA 11366
> > 1996  32986  88683   6562 79475 95282
> > 1997  13601     NA 134757 12398    NA
> > 1998  30537  51117  31333 20204    NA
> > 1999  39240  87845  62479    NA 98804
> >
> > If this is not what you wanted, you may need to explain further or
> > await a response from someone more insightful than I.
> >
> > Cheers,
> > Bert
> >
> >
> > On Fri, Oct 21, 2022 at 3:34 PM Kelly Thompson <kt1572757 at gmail.com> wrote:
> > >
> > > As my end result, I want a matrix or data frame, with one row for each
> > > year, and one column for each category.
> > >
> > > On Fri, Oct 21, 2022 at 6:23 PM Kelly Thompson <kt1572757 at gmail.com> wrote:
> > > >
> > > > # I think this might be a better example.
> > > >
> > > > # I have data presented in a "vertical" dataframe as shown below in
> > > > data_original.
> > > > # I want this data in a matrix or "grid", as shown below.
> > > > # What I show below seems like one way this can be done.
> > > >
> > > > # My question: Are there easier or better ways to do this, especially
> > > > in Base R, and also in R packages?
> > > >
> > > > #create data
> > > > set.seed(1)
> > > > data_original <- data.frame(year = rep(1990:1999, length  = 50),
> > > > category = sample(1:5, size = 50, replace = TRUE),  sales =
> > > > sample(0:99999, size = 50 , replace = TRUE) )
> > > > dim(data_original)
> > > >
> > > > #remove rows where data_original$year == 1990 & data_original$category
> > > > == 5, to ensure there is at least one NA in the "grid"
> > > > data_original <- data_original[ (data_original$year == 1990 &
> > > > data_original$category == 5) == FALSE, ]
> > > > dim(data_original)
> > > >
> > > > #aggregate data
> > > > data_aggregate_sum_by_year_and_category <- aggregate(x =
> > > > data_original$sales, by = list(year = data_original$year, category =
> > > > data_original$category), FUN = sum)
> > > > colnames(data_aggregate_sum_by_year_and_category) <- c('year',
> > > > 'category', 'sum_of_sales')
> > > > dim(data_aggregate_sum_by_year_and_category)
> > > >
> > > > data_expanded <- expand.grid(year =
> > > > unique(data_aggregate_sum_by_year_and_category$year), category =
> > > > unique(data_aggregate_sum_by_year_and_category$category))
> > > > dim(data_expanded)
> > > > data_expanded <- merge(data_expanded,
> > > > data_aggregate_sum_by_year_and_category, all = TRUE)
> > > > dim(data_expanded)
> > > >
> > > > mat <- matrix(data = data_expanded$sum_of_sales, nrow =
> > > > length(unique(data_expanded$year)), ncol =
> > > > length(unique(data_expanded$category)) , byrow = TRUE, dimnames =
> > > > list( unique(data_expanded$year), unique(data_expanded$category) ) )
> > > >
> > > >
> > > > data_original
> > > > data_expanded
> > > > mat
> > > >
> > > > On Fri, Oct 21, 2022 at 5:03 PM Kelly Thompson <kt1572757 at gmail.com> wrote:
> > > > >
> > > > > ###
> > > > > #I have data presented in a "vertical" data frame as shown below in
> > > > > data_original.
> > > > > #I want this data in a matrix or "grid", as shown below.
> > > > > #What I show below seems like one way this can be done.
> > > > >
> > > > > #My question: Are there easier or better ways to do this, especially
> > > > > in Base R, and also in R packages?
> > > > >
> > > > > #reproducible example
> > > > >
> > > > > data_original <- data.frame(year = c('1990', '1999', '1990', '1989'),
> > > > > size = c('s', 'l', 'xl', 'xs'),  n = c(99, 33, 3, 4) )
> > > > >
> > > > > data_expanded <- expand.grid(unique(data_original$year),
> > > > > unique(data_original$size), stringsAsFactors = FALSE )
> > > > > colnames(data_expanded) <- c('year', 'size')
> > > > > data_expanded <- merge(data_expanded, data_original, all = TRUE)
> > > > >
> > > > > mat <- matrix(data = data_expanded $n, nrow =
> > > > > length(unique(data_expanded $year)), ncol =
> > > > > length(unique(data_expanded $size)) , byrow = TRUE, dimnames = list(
> > > > > unique(data_expanded$year), unique(data_expanded$size) ) )
> > > > >
> > > > > data_original
> > > > > data_expanded
> > > > > mat
> > >
> > > ______________________________________________
> > > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > > https://stat.ethz.ch/mailman/listinfo/r-help
> > > PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> > > and provide commented, minimal, self-contained, reproducible code.
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From po|c1410 @end|ng |rom gm@||@com  Sat Oct 22 08:27:44 2022
From: po|c1410 @end|ng |rom gm@||@com (CALUM POLWART)
Date: Sat, 22 Oct 2022 07:27:44 +0100
Subject: [R] getting data from a "vertical" table into a "2-dimensional"
 grid
In-Reply-To: <CAHfBD2fPrxQTTeWVY2DUWpVnBaqQt7UtiX0Jo5TOz0GEj30mJA@mail.gmail.com>
References: <CAHfBD2fx1k6XhdoCmQRheCd=Q1a=TmHRvWoaBWbdbhX=148HzA@mail.gmail.com>
 <CAHfBD2cSb9scG=Sw4=PVZBoTRyYN=aPfbZ6hYXxp0VUOBnzreA@mail.gmail.com>
 <CAHfBD2fPrxQTTeWVY2DUWpVnBaqQt7UtiX0Jo5TOz0GEj30mJA@mail.gmail.com>
Message-ID: <CA+etgPm3XKoJ8jO_wHnixnOi4TJeWG_SOntVnO99VSMX0nvhag@mail.gmail.com>

You asked for base R but also said or using other methods. So for
completeness here is a solution using Tidyverse

library(tidyverse)
data_original <- data.frame(
  year = c('1990', '1999', '1990', '1989'),
  size = c('s', 'l', 'xl', 'xs'),  n = c(99, 33, 3, 4) )

data_original |>
  pivot_wider(
    id_cols = year,
    names_from = size,
    values_from = n
  )

# A tibble: 3 x 5
  year      s     l    xl    xs
  <chr> <dbl> <dbl> <dbl> <dbl>
1 1990     99    NA     3    NA
2 1999     NA    33    NA    NA
3 1989     NA    NA    NA     4


If you really  want a matrix add

 |>
as.matrix()

To the end.

I saw you asked if you can use column position and the answer is the same
here you can replace size with 2. BUT beware this is prone to errors if
data gets changes in order etc.

This obviously needs to use tidyverse which some people hate. But it does
make the code much more readable to understand what you are doing...

On Fri, 21 Oct 2022, 23:34 Kelly Thompson, <kt1572757 at gmail.com> wrote:

> As my end result, I want a matrix or data frame, with one row for each
> year, and one column for each category.
>
> On Fri, Oct 21, 2022 at 6:23 PM Kelly Thompson <kt1572757 at gmail.com>
> wrote:
> >
> > # I think this might be a better example.
> >
> > # I have data presented in a "vertical" dataframe as shown below in
> > data_original.
> > # I want this data in a matrix or "grid", as shown below.
> > # What I show below seems like one way this can be done.
> >
> > # My question: Are there easier or better ways to do this, especially
> > in Base R, and also in R packages?
> >
> > #create data
> > set.seed(1)
> > data_original <- data.frame(year = rep(1990:1999, length  = 50),
> > category = sample(1:5, size = 50, replace = TRUE),  sales =
> > sample(0:99999, size = 50 , replace = TRUE) )
> > dim(data_original)
> >
> > #remove rows where data_original$year == 1990 & data_original$category
> > == 5, to ensure there is at least one NA in the "grid"
> > data_original <- data_original[ (data_original$year == 1990 &
> > data_original$category == 5) == FALSE, ]
> > dim(data_original)
> >
> > #aggregate data
> > data_aggregate_sum_by_year_and_category <- aggregate(x =
> > data_original$sales, by = list(year = data_original$year, category =
> > data_original$category), FUN = sum)
> > colnames(data_aggregate_sum_by_year_and_category) <- c('year',
> > 'category', 'sum_of_sales')
> > dim(data_aggregate_sum_by_year_and_category)
> >
> > data_expanded <- expand.grid(year =
> > unique(data_aggregate_sum_by_year_and_category$year), category =
> > unique(data_aggregate_sum_by_year_and_category$category))
> > dim(data_expanded)
> > data_expanded <- merge(data_expanded,
> > data_aggregate_sum_by_year_and_category, all = TRUE)
> > dim(data_expanded)
> >
> > mat <- matrix(data = data_expanded$sum_of_sales, nrow =
> > length(unique(data_expanded$year)), ncol =
> > length(unique(data_expanded$category)) , byrow = TRUE, dimnames =
> > list( unique(data_expanded$year), unique(data_expanded$category) ) )
> >
> >
> > data_original
> > data_expanded
> > mat
> >
> > On Fri, Oct 21, 2022 at 5:03 PM Kelly Thompson <kt1572757 at gmail.com>
> wrote:
> > >
> > > ###
> > > #I have data presented in a "vertical" data frame as shown below in
> > > data_original.
> > > #I want this data in a matrix or "grid", as shown below.
> > > #What I show below seems like one way this can be done.
> > >
> > > #My question: Are there easier or better ways to do this, especially
> > > in Base R, and also in R packages?
> > >
> > > #reproducible example
> > >
> > > data_original <- data.frame(year = c('1990', '1999', '1990', '1989'),
> > > size = c('s', 'l', 'xl', 'xs'),  n = c(99, 33, 3, 4) )
> > >
> > > data_expanded <- expand.grid(unique(data_original$year),
> > > unique(data_original$size), stringsAsFactors = FALSE )
> > > colnames(data_expanded) <- c('year', 'size')
> > > data_expanded <- merge(data_expanded, data_original, all = TRUE)
> > >
> > > mat <- matrix(data = data_expanded $n, nrow =
> > > length(unique(data_expanded $year)), ncol =
> > > length(unique(data_expanded $size)) , byrow = TRUE, dimnames = list(
> > > unique(data_expanded$year), unique(data_expanded$size) ) )
> > >
> > > data_original
> > > data_expanded
> > > mat
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From cw||cox @end|ng |rom m|nderoo@org  Sat Oct 22 02:41:12 2022
From: cw||cox @end|ng |rom m|nderoo@org (Chris Wilcox)
Date: Sat, 22 Oct 2022 00:41:12 +0000
Subject: [R] fitting gam with constraints on parameters in mgcv
References: <1aac115f-1308-4eda-b2ca-e37139e7cc5f.885d0088-4e5f-4468-a392-c2714b03c5b3.c3bbdd5d-6d58-4deb-bf5a-ff64c6ec7b10@emailsignatures365.codetwo.com>
Message-ID: <SEZPR02MB6048C702CB7A3A0FD91D91F2D22C9@SEZPR02MB6048.apcprd02.prod.outlook.com>

Hi all,

I am trying to fit a gam using mgcv which has a mix of smooth and parametric terms.  The model is for some count data on fish catches.  I am modelling variation in location and time, but also differences among individual operators.  I am interested in the differences in operators specifically, and so am treating them as a fixed effect in my model.  While there are solutions for my problem outlined below in a glm context, I need to work with a gam as I have a 2 dimensional surface that is a key feature of the model.

My challenge is that some levels of the fixed effect for vessels always have responses of 0, leading them to have coefficient estimates that move to negative infinity, due to the log link. This leads to convergence failures.

I am looking for ways to solve this issue.  One obvious solution is to move to a Bayesian approach, and use weakly informative priors on the fixed effects terms.  I have implemented this in brms, using the same structure.  This works, but the complexity of the models means that the fitting time is much longer and I have a number of data sets to analyze.

I have found a few related questions:
https://stats.stackexchange.com/questions/504542/dealing-with-quasi-complete-separation-in-general-additive-model?r=SearchResults&s=1%7C34.9004<https://stats.stackexchange.com/questions/504542/dealing-with-quasi-complete-separation-in-general-additive-model?r=SearchResults&s=1%7C34.9004>
https://stats.stackexchange.com/questions/11109/how-to-deal-with-perfect-separation-in-logistic-regression<https://stats.stackexchange.com/questions/11109/how-to-deal-with-perfect-separation-in-logistic-regression>
but the first which dealt with gams wasn't resolved, and the second didn't appear to have any viable solutions that I haven't tried.

I would like to find a way to address this using gams in mgcv.  It seems like there should be two possibilities, using penalties of some sort on the fixed effect term or imposing a constraint on the fixed effect term.  After a lot of reading, I have not been able to find a good example of a penalty approach, and I am struggling to operationalize the pcls example from the mgcv help.

The help for pcls in mgcv is https://rdrr.io/cran/mgcv/man/pcls.html<https://rdrr.io/cran/mgcv/man/pcls.html> and the first example is the closest to what we are trying to do.

I have included an example dataset to illustrate the problem, any suggestions are greatly appreciated.

#set up data
Lat <- runif(100,1,20)
Lon <- runif(100,1,20)
Year <- runif(100,1,10)
Vessel <- rep((1:5)/10,each = 20)
Lambda <- exp(0.1*Lat - 0.01*Lat^2 + 0.1*Lon + 0.01*Lon^2 + 0.05*Year + Vessel)
Vessel <- as.factor(Vessel)
Catch <- apply(matrix(Lambda),1,rpois,n=1)
dt <- data.frame(Lat,Lon,Year,Vessel,Catch)

#now fit gam
M <- gam(Catch ~ s(Lat,Lon) + s(Year) + Vessel, family = tw, data = dt)

#create separation, all observations zero for one vessel
dt$Catch[dt$Vessel == levels(dt$Vessel)[2]] <- 0

#now fit gam again with separation
M <- gam(Catch ~ s(Lat,Lon) + s(Year) + Vessel, family = tw, data = dt)


Thanks,

Chris



Chris Wilcox
Minderoo Foundation * Flourishing Oceans
[cid:Minderoo-80w_fc252a32-0168-44a0-8b65-5f9c7e67697f.png]
M       +61 439 071 210
P       +61 8 6460 4949
L       Hobart (GMT+10)
E       cwilcox at minderoo.org
W       minderoo.org<https://www.minderoo.org/>

Please consider the environment before printing this email.
This email and any attachments may contain confidential information and may be subject to legal professional privilege. This email and attachments are intended only for the named addressee. If you are not the named addressee your access to this material is not authorised and you should not disseminate, distribute or copy this e-mail or use the information contained in it. Please notify the sender immediately by e-mail if you have received this e-mail by mistake and delete this e-mail from your system. The sender does not guarantee that this e-mail or any attachments are secure, error-free or free from viruses. The sender therefore does not accept liability for any loss or damage resulting (either directly or indirectly) from any such error or virus. The content and opinions set out in this email and any attachments are not necessarily those of Minderoo Foundation Limited, Tattarang Pty Ltd, their respective related entities, nor any person or entity who is or becomes a director, company secretary, officer, member, manager, employee or contractor (whether directly or indirectly) or related entity of the previously specified entities. This email and any attachments are also subject to copyright and may not be reproduced without permission.

From t@v|b@r @end|ng |rom gm@||@com  Sat Oct 22 11:28:41 2022
From: t@v|b@r @end|ng |rom gm@||@com (Micha Silver)
Date: Sat, 22 Oct 2022 12:28:41 +0300
Subject: [R] Opening shapefiles in R
In-Reply-To: <CABxY9BPCaQT3V4BUHruL5Sj+Y351gmPTYTDOFUmoGWyXF5Ysvg@mail.gmail.com>
References: <CABxY9BPCaQT3V4BUHruL5Sj+Y351gmPTYTDOFUmoGWyXF5Ysvg@mail.gmail.com>
Message-ID: <d0534f85-2115-1bb4-1973-bcab678b1964@gmail.com>

Hello Nick:


First: as Jeff pointed out, you'll probably have better luck posting to 
the r-sig-geo list.


On 21/10/2022 14:25, Nick Wray wrote:
> Hello
>
> I have managed to download and plot the outline for the River Tweed In the
> Sottish borders)  catchment using this code.  21009 is a zipfile downloaded
> from the FEH website https://fehweb.ceh.ac.uk/Map:
>
> require(rgdal)
>
> shape <- readOGR(dsn ="C:/Users/nick/Desktop/PhD Oct 22", layer = "21009")


Second: The R-spatial "ecosystem" has undergone some major changes 
recent years. You'd be well advised, I think, to switch to using the 
`sf` package for vector data. So reading in a shapefile would be 
`sf::st_read(dsn="...")`



Third: Regarding your other post about string representations of 
geometries. Can you be more specific as to what your final goal is? The 
"canonical" string representation of geometries is Well Known Text (WKT) 
and can be returned with the `sf::st_as_text()` function. Does that help?


Kind regards,

Micha


> shape
>
> plot(shape)
>
> and I get an outline of the Tweed catchment which I can use
>
> the zipfile has eight documents all with the name ?21009.? and the suffixes
> cpg/dbf/prj/sbn/sbx/shp/shp/shx   There are two .shp docs, one labelled as
> SHP file and one as XML file.
>
> However
>
> I then have downloaded a file of a plot of all the rivers in the uk from
> https://osdatahub.os.uk/downloads/open
>
> I?ve put this data into a zipfile with the name ?rivers?   Within this are
> eight docs ? four with the names HydroNode. and suffixes dbf/prj/shp/shx
> and four with the name WatercourseLink. and the four suffixes.
>
> Just subbing in ?rivers? for ?21009? in my code above doesn?t work and I
> can?t find a way of getting into the shapefiles and opening them
>
>
> I'd be grateful if anyone can help me get further with this
>
> Thanks Nick Wray
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.

-- 
Micha Silver
Ben Gurion Univ.
Sde Boker, Remote Sensing Lab
cell: +972-523-665918


From n|ckmwr@y @end|ng |rom gm@||@com  Sat Oct 22 12:52:32 2022
From: n|ckmwr@y @end|ng |rom gm@||@com (Nick Wray)
Date: Sat, 22 Oct 2022 11:52:32 +0100
Subject: [R] Opening shapefiles in R
In-Reply-To: <d0534f85-2115-1bb4-1973-bcab678b1964@gmail.com>
References: <CABxY9BPCaQT3V4BUHruL5Sj+Y351gmPTYTDOFUmoGWyXF5Ysvg@mail.gmail.com>
 <d0534f85-2115-1bb4-1973-bcab678b1964@gmail.com>
Message-ID: <CABxY9BPCOiQjJskYY86qqehOCy8OLQRRkKg_yqeNKE6oEHy25Q@mail.gmail.com>

Hi Micha  Thanks for your ideas which I will look into   I hadn't heard of
r-sig-geo before but I've signed up to it.  I'm a bit of beginner as far as
geospatial in R goes.  What I am ultimately trying to do is this - my PhD
research is into the relative proportions of the effects of climate change
and land use on streamflow in Scottish rivers (I'm based at Edinburgh) and
to this end I need to create a map of catchments eg the Tweed onto which I
can placing flow gauging stations/ weather stations etc .  I have catchment
outline shapefiles and the stations but finding the bit of the whole of the
UK river system shapefile which is the Tweed catchment is tricky, as the
shapefile matrix doesn't have names in it and I am trying to identify the
Tweed and its tributaries from the coordinates of its mouth sources and so
on...  that's why i need to pull out the coordinates.  Any suggestions 'd
be v welcome  Nick

On Sat, 22 Oct 2022 at 10:28, Micha Silver <tsvibar at gmail.com> wrote:

> Hello Nick:
>
>
> First: as Jeff pointed out, you'll probably have better luck posting to
> the r-sig-geo list.
>
>
> On 21/10/2022 14:25, Nick Wray wrote:
> > Hello
> >
> > I have managed to download and plot the outline for the River Tweed In
> the
> > Sottish borders)  catchment using this code.  21009 is a zipfile
> downloaded
> > from the FEH website https://fehweb.ceh.ac.uk/Map:
> >
> > require(rgdal)
> >
> > shape <- readOGR(dsn ="C:/Users/nick/Desktop/PhD Oct 22", layer =
> "21009")
>
>
> Second: The R-spatial "ecosystem" has undergone some major changes
> recent years. You'd be well advised, I think, to switch to using the
> `sf` package for vector data. So reading in a shapefile would be
> `sf::st_read(dsn="...")`
>
>
>
> Third: Regarding your other post about string representations of
> geometries. Can you be more specific as to what your final goal is? The
> "canonical" string representation of geometries is Well Known Text (WKT)
> and can be returned with the `sf::st_as_text()` function. Does that help?
>
>
> Kind regards,
>
> Micha
>
>
> > shape
> >
> > plot(shape)
> >
> > and I get an outline of the Tweed catchment which I can use
> >
> > the zipfile has eight documents all with the name ?21009.? and the
> suffixes
> > cpg/dbf/prj/sbn/sbx/shp/shp/shx   There are two .shp docs, one labelled
> as
> > SHP file and one as XML file.
> >
> > However
> >
> > I then have downloaded a file of a plot of all the rivers in the uk from
> > https://osdatahub.os.uk/downloads/open
> >
> > I?ve put this data into a zipfile with the name ?rivers?   Within this
> are
> > eight docs ? four with the names HydroNode. and suffixes dbf/prj/shp/shx
> > and four with the name WatercourseLink. and the four suffixes.
> >
> > Just subbing in ?rivers? for ?21009? in my code above doesn?t work and I
> > can?t find a way of getting into the shapefiles and opening them
> >
> >
> > I'd be grateful if anyone can help me get further with this
> >
> > Thanks Nick Wray
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.
>
> --
> Micha Silver
> Ben Gurion Univ.
> Sde Boker, Remote Sensing Lab
> cell: +972-523-665918
>
>

	[[alternative HTML version deleted]]


From m@r@|@m@ck @end|ng |rom hotm@||@com  Sat Oct 22 21:05:45 2022
From: m@r@|@m@ck @end|ng |rom hotm@||@com (L... L...)
Date: Sat, 22 Oct 2022 19:05:45 +0000
Subject: [R] shaded area between a curve and a circle
In-Reply-To: <BY2PR20MB0453D2D4E8AED84B9EFC584B96780@BY2PR20MB0453.namprd20.prod.outlook.com>
References: <BY2PR20MB0453D2D4E8AED84B9EFC584B96780@BY2PR20MB0453.namprd20.prod.outlook.com>
Message-ID: <BYAPR06MB5254269EE5E61F1E23F2C233962C9@BYAPR06MB5254.namprd06.prod.outlook.com>

Dear, I have a picture in which I draw a circle over the standard normal curve. See below the lines used to draw the figure. The figure is ok, but my problem is: How to shade the areas A, B, C, D, E and F? I know I have to find the points of intersection but I don't know how to find them. Suggestions will be welcome.

library(plotrix)

x   <-  seq(-3.0, 3.0, 0.01)
fy  <-  dnorm(x)
fy  <-  fy / max(fy)

x11()
plot(x, fy, ylim = c(-1, 1), col = "white", lwd = 1.5, xlim = c(-3, 3), lty = 1)
draw.circle(0.0, 0.0, 2.00,  border = 'blue', lty = 1, lwd = 0.8)

lines(x, fy, type = 'l', ylim = c(-1,1), col = 'red', )
lines(x,-fy, type = 'l', ylim = c(-1,1), col = 'red')

text( 0.0, 0.90, "A"); text( 0.0,-0.90, "B")
text(-1.8, 0.25, "C"); text( 1.8, 0.25, "D")
text(-1.8,-0.25, "E"); text( 1.8,-0.25, "F")

Best regards

ML



________________________________



	[[alternative HTML version deleted]]


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Sun Oct 23 14:47:10 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Sun, 23 Oct 2022 14:47:10 +0200
Subject: [R] shaded area between a curve and a circle
In-Reply-To: <BYAPR06MB5254269EE5E61F1E23F2C233962C9@BYAPR06MB5254.namprd06.prod.outlook.com>
References: <BY2PR20MB0453D2D4E8AED84B9EFC584B96780@BY2PR20MB0453.namprd20.prod.outlook.com>
 <BYAPR06MB5254269EE5E61F1E23F2C233962C9@BYAPR06MB5254.namprd06.prod.outlook.com>
Message-ID: <b58bddcc-33a4-15ef-1edc-db2d7b479411@statistik.tu-dortmund.de>

The points on your density curve can be written as  (x, f(x)) - well, if 
you had not divided by its max value which I do not understand why.

Now you simply need to find out which of these points have a distance of 
the circle's radius to the point (0,0).
Hmmm, your "circle" has a radius of 2 in x direction but less in y 
direction? So this is not a circle but an ellipse given the coordinate 
system used?

Assuming you actually want to draw a circle of radius r, then I would 
simply solve Pythagoras' equation, i.e. sqrt(x^2 + f(x)^2) == r
e.g. via uniroot().
But first you need to find out what you actually want to do.

Best,
Uwe Ligges




On 22.10.2022 21:05, L... L... wrote:
> Dear, I have a picture in which I draw a circle over the standard normal curve. See below the lines used to draw the figure. The figure is ok, but my problem is: How to shade the areas A, B, C, D, E and F? I know I have to find the points of intersection but I don't know how to find them. Suggestions will be welcome.
> 
> library(plotrix)
> 
> x   <-  seq(-3.0, 3.0, 0.01)
> fy  <-  dnorm(x)
> fy  <-  fy / max(fy)
> 
> x11()
> plot(x, fy, ylim = c(-1, 1), col = "white", lwd = 1.5, xlim = c(-3, 3), lty = 1)
> draw.circle(0.0, 0.0, 2.00,  border = 'blue', lty = 1, lwd = 0.8)
> 
> lines(x, fy, type = 'l', ylim = c(-1,1), col = 'red', )
> lines(x,-fy, type = 'l', ylim = c(-1,1), col = 'red')
> 
> text( 0.0, 0.90, "A"); text( 0.0,-0.90, "B")
> text(-1.8, 0.25, "C"); text( 1.8, 0.25, "D")
> text(-1.8,-0.25, "E"); text( 1.8,-0.25, "F")
> 
> Best regards
> 
> ML
> 
> 
> 
> ________________________________
> 
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From j@zh@o @end|ng |rom ye@h@net  Sun Oct 23 17:05:29 2022
From: j@zh@o @end|ng |rom ye@h@net (Jinsong Zhao)
Date: Sun, 23 Oct 2022 23:05:29 +0800
Subject: [R] shaded area between a curve and a circle
In-Reply-To: <BYAPR06MB5254269EE5E61F1E23F2C233962C9@BYAPR06MB5254.namprd06.prod.outlook.com>
References: <BY2PR20MB0453D2D4E8AED84B9EFC584B96780@BY2PR20MB0453.namprd20.prod.outlook.com>
 <BYAPR06MB5254269EE5E61F1E23F2C233962C9@BYAPR06MB5254.namprd06.prod.outlook.com>
Message-ID: <49ae982a-630f-f66f-7a08-46b46e7530c1@yeah.net>

The figure is not ok. The coordinate of the normal curve is not the same 
as that of the circle. In fact, there are only four intersections other 
than eight that your figure show.

Best,

Jinsong

On 2022/10/23 3:05, L... L... wrote:
> Dear, I have a picture in which I draw a circle over the standard normal curve. See below the lines used to draw the figure. The figure is ok, but my problem is: How to shade the areas A, B, C, D, E and F? I know I have to find the points of intersection but I don't know how to find them. Suggestions will be welcome.
>
> library(plotrix)
>
> x   <-  seq(-3.0, 3.0, 0.01)
> fy  <-  dnorm(x)
> fy  <-  fy / max(fy)
>
> x11()
> plot(x, fy, ylim = c(-1, 1), col = "white", lwd = 1.5, xlim = c(-3, 3), lty = 1)
> draw.circle(0.0, 0.0, 2.00,  border = 'blue', lty = 1, lwd = 0.8)
>
> lines(x, fy, type = 'l', ylim = c(-1,1), col = 'red', )
> lines(x,-fy, type = 'l', ylim = c(-1,1), col = 'red')
>
> text( 0.0, 0.90, "A"); text( 0.0,-0.90, "B")
> text(-1.8, 0.25, "C"); text( 1.8, 0.25, "D")
> text(-1.8,-0.25, "E"); text( 1.8,-0.25, "F")
>
> Best regards
>
> ML
>
>
>
> ________________________________
>
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From @tyen @end|ng |rom ntu@edu@tw  Mon Oct 24 14:39:33 2022
From: @tyen @end|ng |rom ntu@edu@tw (Steven T. Yen)
Date: Mon, 24 Oct 2022 20:39:33 +0800
Subject: [R] cannot print a list with cat
Message-ID: <051fa517-2df1-9a6c-004e-831f7c9f4c3b@ntu.edu.tw>

I have a "list" containing four elements, as shown below:

 > t(mycontrol)

 ???? tol reltol steptol gradtol
[1,] 0?? 0????? 1e-08?? 1e-12

Printing this in a main program causes no problem (as shown above).
But, using the command t(mycontrol) the line gets ignored. Any idea? Thanks.
Steven Yen


From kry|ov@r00t @end|ng |rom gm@||@com  Mon Oct 24 14:47:52 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Mon, 24 Oct 2022 15:47:52 +0300
Subject: [R] cannot print a list with cat
In-Reply-To: <051fa517-2df1-9a6c-004e-831f7c9f4c3b@ntu.edu.tw>
References: <051fa517-2df1-9a6c-004e-831f7c9f4c3b@ntu.edu.tw>
Message-ID: <20221024154752.05440ffc@arachnoid>

? Mon, 24 Oct 2022 20:39:33 +0800
"Steven T. Yen" <styen at ntu.edu.tw> ?????:

> Printing this in a main program causes no problem (as shown above).
> But, using the command t(mycontrol) the line gets ignored.

t() doesn't print, it returns a value. In R, there's auto-printing in
the toplevel context (see ?withAutoprint), but not when you move away
from the interactive prompt. I think that it should be possible to use
an explicit print(t(mycontrol)) to get the behaviour you desire.

-- 
Best regards,
Ivan


From bor|@@@te|pe @end|ng |rom utoronto@c@  Mon Oct 24 15:05:01 2022
From: bor|@@@te|pe @end|ng |rom utoronto@c@ (Boris Steipe)
Date: Mon, 24 Oct 2022 13:05:01 +0000
Subject: [R] cannot print a list with cat
In-Reply-To: <20221024154752.05440ffc@arachnoid>
References: <051fa517-2df1-9a6c-004e-831f7c9f4c3b@ntu.edu.tw>
 <20221024154752.05440ffc@arachnoid>
Message-ID: <15AC3F65-6D12-44D1-AE3F-F6C6DA9D36E1@utoronto.ca>

???  t() is the transpose function. It just happens to return your list unchanged. The return value is then printed to console if it is not assigned, or returned invisibly. Transposing your list is probably not what you wanted to do.

Returned values do not get printed from within a loop or from a source()'d script. That's why it "works" interactively, but not from a script file.

If you want to print the contents of your list, just use:
  print(mycontrol)

Or use some incantation with sprintf() if you want more control about the format of what gets printed. Eg:

 cat(sprintf("Tolerance: %f (%f %%)", mycontrol$tol, mycontrol$reltol))

etc.


B.



> On 2022-10-24, at 08:47, Ivan Krylov <krylov.r00t at gmail.com> wrote:
> 
> ? Mon, 24 Oct 2022 20:39:33 +0800
> "Steven T. Yen" <styen at ntu.edu.tw> ?????:
> 
>> Printing this in a main program causes no problem (as shown above).
>> But, using the command t(mycontrol) the line gets ignored.
> 
> t() doesn't print, it returns a value. In R, there's auto-printing in
> the toplevel context (see ?withAutoprint), but not when you move away
> from the interactive prompt. I think that it should be possible to use
> an explicit print(t(mycontrol)) to get the behaviour you desire.
> 
> -- 
> Best regards,
> Ivan
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From @tyen @end|ng |rom ntu@edu@tw  Mon Oct 24 15:25:26 2022
From: @tyen @end|ng |rom ntu@edu@tw (Steven T. Yen)
Date: Mon, 24 Oct 2022 21:25:26 +0800
Subject: [R] cannot print a list with cat
In-Reply-To: <15AC3F65-6D12-44D1-AE3F-F6C6DA9D36E1@utoronto.ca>
References: <051fa517-2df1-9a6c-004e-831f7c9f4c3b@ntu.edu.tw>
 <20221024154752.05440ffc@arachnoid>
 <15AC3F65-6D12-44D1-AE3F-F6C6DA9D36E1@utoronto.ca>
Message-ID: <cc79988d-74fe-ec9e-d3c2-884608deaf9a@ntu.edu.tw>

Thank, Boris and Ivan.

The simple command suggested by Ivan ( print(t(mycontrol)) ) worked. I 
went along with Boris' suggestion and do/get the following:

cat(sprintf("(tol,reltol,steptol,gradtol): %E %E %E %E",mycontrol$tol,
mycontrol$reltol,mycontrol$steptol,mycontrol$gradtol))

(tol,reltol,steptol,gradtol): 0.000000E+00 0.000000E+00 1.000000E-08 
1.000000E-12

This works great. Thanks.

Steven

On 10/24/2022 9:05 PM, Boris Steipe wrote:

> ???  t() is the transpose function. It just happens to return your list unchanged. The return value is then printed to console if it is not assigned, or returned invisibly. Transposing your list is probably not what you wanted to do.
>
> Returned values do not get printed from within a loop or from a source()'d script. That's why it "works" interactively, but not from a script file.
>
> If you want to print the contents of your list, just use:
>    print(mycontrol)
>
> Or use some incantation with sprintf() if you want more control about the format of what gets printed. Eg:
>
>   cat(sprintf("Tolerance: %f (%f %%)", mycontrol$tol, mycontrol$reltol))
>
> etc.
>
>
> B.
>
>
>
>> On 2022-10-24, at 08:47, Ivan Krylov <krylov.r00t at gmail.com> wrote:
>>
>> ? Mon, 24 Oct 2022 20:39:33 +0800
>> "Steven T. Yen" <styen at ntu.edu.tw> ?????:
>>
>>> Printing this in a main program causes no problem (as shown above).
>>> But, using the command t(mycontrol) the line gets ignored.
>> t() doesn't print, it returns a value. In R, there's auto-printing in
>> the toplevel context (see ?withAutoprint), but not when you move away
>> from the interactive prompt. I think that it should be possible to use
>> an explicit print(t(mycontrol)) to get the behaviour you desire.
>>
>> -- 
>> Best regards,
>> Ivan
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.


From @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org  Mon Oct 24 15:30:58 2022
From: @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org (Spencer Graves)
Date: Mon, 24 Oct 2022 08:30:58 -0500
Subject: [R] cannot print a list with cat
In-Reply-To: <051fa517-2df1-9a6c-004e-831f7c9f4c3b@ntu.edu.tw>
References: <051fa517-2df1-9a6c-004e-831f7c9f4c3b@ntu.edu.tw>
Message-ID: <d32b2030-ed8a-2a50-0b96-10831436ddc7@effectivedefense.org>



On 10/24/22 7:39 AM, Steven T. Yen wrote:
> I have a "list" containing four elements, as shown below:
> 
>  > t(mycontrol)
> 
>  ???? tol reltol steptol gradtol
> [1,] 0?? 0????? 1e-08?? 1e-12
> 
> Printing this in a main program causes no problem (as shown above).
> But, using the command t(mycontrol) the line gets ignored. Any idea? 


I'm confused.  I get:


 > (mycontrol <- list(tol=0, reltol=0,
+         steptol=1e-8, gradtol=1e-12))
$tol
[1] 0

$reltol
[1] 0

$steptol
[1] 1e-08

$gradtol
[1] 1e-12

 >
 > t(mycontrol)
      tol reltol steptol gradtol
[1,] 0   0      1e-08   1e-12


	  I don't know what you mean by "main program" vs. "the command 
t(mycontrol)".


	  ???
	  Spencer Graves


 > sessionInfo()
R version 4.2.1 (2022-06-23)
Platform: x86_64-apple-darwin17.0 (64-bit)
Running under: macOS Big Sur 11.7

Matrix products: default
LAPACK: 
/Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets
[6] methods   base

loaded via a namespace (and not attached):
[1] compiler_4.2.1 tools_4.2.1


> Thanks.
> Steven Yen
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide 
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Mon Oct 24 16:02:28 2022
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Mon, 24 Oct 2022 15:02:28 +0100
Subject: [R] cannot print a list with cat
In-Reply-To: <cc79988d-74fe-ec9e-d3c2-884608deaf9a@ntu.edu.tw>
References: <051fa517-2df1-9a6c-004e-831f7c9f4c3b@ntu.edu.tw>
 <20221024154752.05440ffc@arachnoid>
 <15AC3F65-6D12-44D1-AE3F-F6C6DA9D36E1@utoronto.ca>
 <cc79988d-74fe-ec9e-d3c2-884608deaf9a@ntu.edu.tw>
Message-ID: <726dbddf-3a15-0293-5e9a-6bfaf6605979@sapo.pt>

Hello,

There's also ?message.


msg <- sprintf("(tol,reltol,steptol,gradtol): %E %E %E %E",
 
mycontrol$tol,mycontrol$reltol,mycontrol$steptol,mycontrol$gradtol)
message(msg)


Hope this helps,

Rui Barradas

?s 14:25 de 24/10/2022, Steven T. Yen escreveu:
> Thank, Boris and Ivan.
> 
> The simple command suggested by Ivan ( print(t(mycontrol)) ) worked. I 
> went along with Boris' suggestion and do/get the following:
> 
> cat(sprintf("(tol,reltol,steptol,gradtol): %E %E %E %E",mycontrol$tol,
> mycontrol$reltol,mycontrol$steptol,mycontrol$gradtol))
> 
> (tol,reltol,steptol,gradtol): 0.000000E+00 0.000000E+00 1.000000E-08 
> 1.000000E-12
> 
> This works great. Thanks.
> 
> Steven
> 
> On 10/24/2022 9:05 PM, Boris Steipe wrote:
> 
>> ???? t() is the transpose function. It just happens to return your 
>> list unchanged. The return value is then printed to console if it is 
>> not assigned, or returned invisibly. Transposing your list is probably 
>> not what you wanted to do.
>>
>> Returned values do not get printed from within a loop or from a 
>> source()'d script. That's why it "works" interactively, but not from a 
>> script file.
>>
>> If you want to print the contents of your list, just use:
>> ?? print(mycontrol)
>>
>> Or use some incantation with sprintf() if you want more control about 
>> the format of what gets printed. Eg:
>>
>> ? cat(sprintf("Tolerance: %f (%f %%)", mycontrol$tol, mycontrol$reltol))
>>
>> etc.
>>
>>
>> B.
>>
>>
>>
>>> On 2022-10-24, at 08:47, Ivan Krylov <krylov.r00t at gmail.com> wrote:
>>>
>>> ? Mon, 24 Oct 2022 20:39:33 +0800
>>> "Steven T. Yen" <styen at ntu.edu.tw> ?????:
>>>
>>>> Printing this in a main program causes no problem (as shown above).
>>>> But, using the command t(mycontrol) the line gets ignored.
>>> t() doesn't print, it returns a value. In R, there's auto-printing in
>>> the toplevel context (see ?withAutoprint), but not when you move away
>>> from the interactive prompt. I think that it should be possible to use
>>> an explicit print(t(mycontrol)) to get the behaviour you desire.
>>>
>>> -- 
>>> Best regards,
>>> Ivan
>>>
>>> ______________________________________________
>>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>> PLEASE do read the posting guide 
>>> http://www.R-project.org/posting-guide.html
>>> and provide commented, minimal, self-contained, reproducible code.
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide 
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From m@k@hho||y @end|ng |rom gm@||@com  Mon Oct 24 17:17:47 2022
From: m@k@hho||y @end|ng |rom gm@||@com (greg holly)
Date: Mon, 24 Oct 2022 10:17:47 -0500
Subject: [R] Sensitivity and Specificity
Message-ID: <CAM9Qe4im3XyAvSaDSAq94z+uwwKTwi2Tthr9ExoxLs+NvLPVOA@mail.gmail.com>

Hi all R-Help ,

After partitioning my data to testing and training (please see below), I
need to estimate the Sensitivity and Specificity. I failed. It would be
appropriate to get your help.

Best regards,
Greg


inTrain <- createDataPartition(y=data$case,
                               p=0.7,
                               list=FALSE)
training <- data[ inTrain,]
testing  <- data[-inTrain,]

attach(training)
#model training and prediction
data_training <- glm(case ~ age+BMI+Calcium+Albumin+meno_1, data =
training, family = binomial(link="logit"))

predict <- predict(data_training, data_predict = testing, type = "response")

predict_testing <- ifelse(predict > 0.5,1,0)

# Sensitivity and Specificity

 sensitivity<-(predict_testing[2,2]/(predict_testing[2,2]+predict_testing[2,1]))*100
 sensitivity

 specificity<-(predict_testing[1,1]/(predict_testing[1,1]+predict_testing[1,2]))*100
 specificity

	[[alternative HTML version deleted]]


From @tyen @end|ng |rom ntu@edu@tw  Mon Oct 24 17:21:00 2022
From: @tyen @end|ng |rom ntu@edu@tw (Steven T. Yen)
Date: Mon, 24 Oct 2022 23:21:00 +0800
Subject: [R] cannot print a list with cat
In-Reply-To: <726dbddf-3a15-0293-5e9a-6bfaf6605979@sapo.pt>
References: <051fa517-2df1-9a6c-004e-831f7c9f4c3b@ntu.edu.tw>
 <20221024154752.05440ffc@arachnoid>
 <15AC3F65-6D12-44D1-AE3F-F6C6DA9D36E1@utoronto.ca>
 <cc79988d-74fe-ec9e-d3c2-884608deaf9a@ntu.edu.tw>
 <726dbddf-3a15-0293-5e9a-6bfaf6605979@sapo.pt>
Message-ID: <1ad3cf97-932a-c2aa-bb74-0c2bb98908d3@ntu.edu.tw>

Thanks to everyone. I read ? sprint and the following is best I came up 
with. If there are ways to collapse the lines I'd be glad to know. 
Otherwise, I will live with this. Thanks again.

cat(sprintf("\ntol???? = %e",mycontrol$tol),
 ??? sprintf("\nreltol? = %e",mycontrol$reltol),
 ??? sprintf("\nsteptol = %e",mycontrol$steptol),
 ??? sprintf("\ngradtol = %e",mycontrol$gradtol))

tol???? = 0.000000e+00
reltol? = 0.000000e+00
steptol = 1.000000e-08
gradtol = 1.000000e-10

On 10/24/2022 10:02 PM, Rui Barradas wrote:
> Hello,
>
> There's also ?message.
>
>
> msg <- sprintf("(tol,reltol,steptol,gradtol): %E %E %E %E",
>
> mycontrol$tol,mycontrol$reltol,mycontrol$steptol,mycontrol$gradtol)
> message(msg)
>
>
> Hope this helps,
>
> Rui Barradas
>
> ?s 14:25 de 24/10/2022, Steven T. Yen escreveu:
>> Thank, Boris and Ivan.
>>
>> The simple command suggested by Ivan ( print(t(mycontrol)) ) worked. 
>> I went along with Boris' suggestion and do/get the following:
>>
>> cat(sprintf("(tol,reltol,steptol,gradtol): %E %E %E %E",mycontrol$tol,
>> mycontrol$reltol,mycontrol$steptol,mycontrol$gradtol))
>>
>> (tol,reltol,steptol,gradtol): 0.000000E+00 0.000000E+00 1.000000E-08 
>> 1.000000E-12
>>
>> This works great. Thanks.
>>
>> Steven
>>
>> On 10/24/2022 9:05 PM, Boris Steipe wrote:
>>
>>> ???? t() is the transpose function. It just happens to return your 
>>> list unchanged. The return value is then printed to console if it is 
>>> not assigned, or returned invisibly. Transposing your list is 
>>> probably not what you wanted to do.
>>>
>>> Returned values do not get printed from within a loop or from a 
>>> source()'d script. That's why it "works" interactively, but not from 
>>> a script file.
>>>
>>> If you want to print the contents of your list, just use:
>>> ?? print(mycontrol)
>>>
>>> Or use some incantation with sprintf() if you want more control 
>>> about the format of what gets printed. Eg:
>>>
>>> ? cat(sprintf("Tolerance: %f (%f %%)", mycontrol$tol, 
>>> mycontrol$reltol))
>>>
>>> etc.
>>>
>>>
>>> B.
>>>
>>>
>>>
>>>> On 2022-10-24, at 08:47, Ivan Krylov <krylov.r00t at gmail.com> wrote:
>>>>
>>>> ? Mon, 24 Oct 2022 20:39:33 +0800
>>>> "Steven T. Yen" <styen at ntu.edu.tw> ?????:
>>>>
>>>>> Printing this in a main program causes no problem (as shown above).
>>>>> But, using the command t(mycontrol) the line gets ignored.
>>>> t() doesn't print, it returns a value. In R, there's auto-printing in
>>>> the toplevel context (see ?withAutoprint), but not when you move away
>>>> from the interactive prompt. I think that it should be possible to use
>>>> an explicit print(t(mycontrol)) to get the behaviour you desire.
>>>>
>>>> -- 
>>>> Best regards,
>>>> Ivan
>>>>
>>>> ______________________________________________
>>>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>>> PLEASE do read the posting guide 
>>>> http://www.R-project.org/posting-guide.html
>>>> and provide commented, minimal, self-contained, reproducible code.
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide 
>> http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.


From JH@rm@e @end|ng |rom roku@com  Mon Oct 24 17:45:21 2022
From: JH@rm@e @end|ng |rom roku@com (Jorgen Harmse)
Date: Mon, 24 Oct 2022 15:45:21 +0000
Subject: [R] unexpected 'else' in " else" (Ebert,Timothy Aaron)
In-Reply-To: <mailman.368082.1.1666432801.57482.r-help@r-project.org>
References: <mailman.368082.1.1666432801.57482.r-help@r-project.org>
Message-ID: <MW4PR01MB64651EF91E8B7D2ADDA87644DC2E9@MW4PR01MB6465.prod.exchangelabs.com>

There were several interesting points about `ifelse`. The usual behaviour seems to be that all three inputs are evaluated, and the entries of `yes` corresponding to `TRUE` in `test` are combined with the entries of `no` corresponding to `FALSE` in `test`. Moreover, `yes` & `no` seem to be recycled as necessary in case `test` is longer. On top of that, there seems to be some sugar that suppresses evaluations in case `all(test)` and/or `all(!test)`, and the return type can be `logical` even if `yes` & `no` are not. I agreed with the other responses already, but my experiments further confirmed that `ifelse` is not interchangeable with `if(....) .... else ....`.



The documentation confirms most of this, but 'same length and attributes (including dimensions and ?"class"?) as ?test?' looks wrong. The output seems to be `logical` or something related to the classes of `yes` & `no`.



Regards,

Jorgen Harmse.



> ifelse(FALSE, {cat("Evaluating the vector for 'if'.\n"); 1:3}, {cat("Evaluating the vector for 'else'.\n"); 0:4})

Evaluating the vector for 'else'.

[1] 0

> ifelse(rep(FALSE,5L), {cat("Evaluating the vector for 'if'.\n"); 1:3}, {cat("Evaluating the vector for 'else'.\n"); 0:4})

Evaluating the vector for 'else'.

[1] 0 1 2 3 4

> ifelse(rep(TRUE,3L), {cat("Evaluating the vector for 'if'.\n"); 1:3}, {cat("Evaluating the vector for 'else'.\n"); 0:4})

Evaluating the vector for 'if'.

[1] 1 2 3

> ifelse(c(TRUE,TRUE,FALSE), {cat("Evaluating the vector for 'if'.\n"); 1:3}, {cat("Evaluating the vector for 'else'.\n"); 0:4})

Evaluating the vector for 'if'.

Evaluating the vector for 'else'.

[1] 1 2 2

> ifelse(c(TRUE,TRUE,FALSE,TRUE), {cat("Evaluating the vector for 'if'.\n"); 1:3}, {cat("Evaluating the vector for 'else'.\n"); 0:4})

Evaluating the vector for 'if'.

Evaluating the vector for 'else'.

[1] 1 2 2 1

> args(ifelse)

function (test, yes, no)

NULL

> ifelse(c(TRUE,TRUE,FALSE,TRUE,TRUE,FALSE,TRUE), {cat("Evaluating the vector for 'if'.\n"); 1:3}, {cat("Evaluating the vector for 'else'.\n"); 0:4})

Evaluating the vector for 'if'.

Evaluating the vector for 'else'.

[1] 1 2 2 1 2 0 1

> ifelse(logical(0L), {cat("Evaluating the vector for 'if'.\n"); 1:3}, {cat("Evaluating the vector for 'else'.\n"); 0:4})

logical(0)

> ifelse(TRUE, integer(0L), numeric(0L))

[1] NA

> class(ifelse(TRUE, integer(0L), numeric(0L)))

[1] "integer"

> ifelse(integer(0L)) # test is an empty vector of integers and yes & no are missing.

logical(0)








	[[alternative HTML version deleted]]


From ||@t@ @end|ng |rom dewey@myzen@co@uk  Mon Oct 24 17:45:47 2022
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Mon, 24 Oct 2022 16:45:47 +0100
Subject: [R] Sensitivity and Specificity
In-Reply-To: <CAM9Qe4im3XyAvSaDSAq94z+uwwKTwi2Tthr9ExoxLs+NvLPVOA@mail.gmail.com>
References: <CAM9Qe4im3XyAvSaDSAq94z+uwwKTwi2Tthr9ExoxLs+NvLPVOA@mail.gmail.com>
Message-ID: <c2a8b39f-7daa-6844-4d77-b4b4932061bb@dewey.myzen.co.uk>

Rather hard to know without seeing what output you expected and what 
error message you got if any but did you mean to summarise your variable 
predict before doing anything with it?

Michael

On 24/10/2022 16:17, greg holly wrote:
> Hi all R-Help ,
> 
> After partitioning my data to testing and training (please see below), I
> need to estimate the Sensitivity and Specificity. I failed. It would be
> appropriate to get your help.
> 
> Best regards,
> Greg
> 
> 
> inTrain <- createDataPartition(y=data$case,
>                                 p=0.7,
>                                 list=FALSE)
> training <- data[ inTrain,]
> testing  <- data[-inTrain,]
> 
> attach(training)
> #model training and prediction
> data_training <- glm(case ~ age+BMI+Calcium+Albumin+meno_1, data =
> training, family = binomial(link="logit"))
> 
> predict <- predict(data_training, data_predict = testing, type = "response")
> 
> predict_testing <- ifelse(predict > 0.5,1,0)
> 
> # Sensitivity and Specificity
> 
>   sensitivity<-(predict_testing[2,2]/(predict_testing[2,2]+predict_testing[2,1]))*100
>   sensitivity
> 
>   specificity<-(predict_testing[1,1]/(predict_testing[1,1]+predict_testing[1,2]))*100
>   specificity
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
> 

-- 
Michael
http://www.dewey.myzen.co.uk/home.html


From bgunter@4567 @end|ng |rom gm@||@com  Mon Oct 24 17:48:44 2022
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Mon, 24 Oct 2022 08:48:44 -0700
Subject: [R] cannot print a list with cat
In-Reply-To: <1ad3cf97-932a-c2aa-bb74-0c2bb98908d3@ntu.edu.tw>
References: <051fa517-2df1-9a6c-004e-831f7c9f4c3b@ntu.edu.tw>
 <20221024154752.05440ffc@arachnoid>
 <15AC3F65-6D12-44D1-AE3F-F6C6DA9D36E1@utoronto.ca>
 <cc79988d-74fe-ec9e-d3c2-884608deaf9a@ntu.edu.tw>
 <726dbddf-3a15-0293-5e9a-6bfaf6605979@sapo.pt>
 <1ad3cf97-932a-c2aa-bb74-0c2bb98908d3@ntu.edu.tw>
Message-ID: <CAGxFJbTBOJ9g=PgmA6=3G13bNRActcaVC8hpNScTbuH0JF=UFA@mail.gmail.com>

"collapse the lines" means ??

If you mean that you want to control the precision (# of decimals
places to show) then that is exactly what sprintf does. ?sprintf tells
you how. If you mean something else, please specify more clearly -- or
await a reply from someone with greater insight than I.

-- Bert

On Mon, Oct 24, 2022 at 8:28 AM Steven T. Yen <styen at ntu.edu.tw> wrote:
>
> Thanks to everyone. I read ? sprint and the following is best I came up
> with. If there are ways to collapse the lines I'd be glad to know.
> Otherwise, I will live with this. Thanks again.
>
> cat(sprintf("\ntol     = %e",mycontrol$tol),
>      sprintf("\nreltol  = %e",mycontrol$reltol),
>      sprintf("\nsteptol = %e",mycontrol$steptol),
>      sprintf("\ngradtol = %e",mycontrol$gradtol))
>
> tol     = 0.000000e+00
> reltol  = 0.000000e+00
> steptol = 1.000000e-08
> gradtol = 1.000000e-10
>
> On 10/24/2022 10:02 PM, Rui Barradas wrote:
> > Hello,
> >
> > There's also ?message.
> >
> >
> > msg <- sprintf("(tol,reltol,steptol,gradtol): %E %E %E %E",
> >
> > mycontrol$tol,mycontrol$reltol,mycontrol$steptol,mycontrol$gradtol)
> > message(msg)
> >
> >
> > Hope this helps,
> >
> > Rui Barradas
> >
> > ?s 14:25 de 24/10/2022, Steven T. Yen escreveu:
> >> Thank, Boris and Ivan.
> >>
> >> The simple command suggested by Ivan ( print(t(mycontrol)) ) worked.
> >> I went along with Boris' suggestion and do/get the following:
> >>
> >> cat(sprintf("(tol,reltol,steptol,gradtol): %E %E %E %E",mycontrol$tol,
> >> mycontrol$reltol,mycontrol$steptol,mycontrol$gradtol))
> >>
> >> (tol,reltol,steptol,gradtol): 0.000000E+00 0.000000E+00 1.000000E-08
> >> 1.000000E-12
> >>
> >> This works great. Thanks.
> >>
> >> Steven
> >>
> >> On 10/24/2022 9:05 PM, Boris Steipe wrote:
> >>
> >>> ???  t() is the transpose function. It just happens to return your
> >>> list unchanged. The return value is then printed to console if it is
> >>> not assigned, or returned invisibly. Transposing your list is
> >>> probably not what you wanted to do.
> >>>
> >>> Returned values do not get printed from within a loop or from a
> >>> source()'d script. That's why it "works" interactively, but not from
> >>> a script file.
> >>>
> >>> If you want to print the contents of your list, just use:
> >>>    print(mycontrol)
> >>>
> >>> Or use some incantation with sprintf() if you want more control
> >>> about the format of what gets printed. Eg:
> >>>
> >>>   cat(sprintf("Tolerance: %f (%f %%)", mycontrol$tol,
> >>> mycontrol$reltol))
> >>>
> >>> etc.
> >>>
> >>>
> >>> B.
> >>>
> >>>
> >>>
> >>>> On 2022-10-24, at 08:47, Ivan Krylov <krylov.r00t at gmail.com> wrote:
> >>>>
> >>>> ? Mon, 24 Oct 2022 20:39:33 +0800
> >>>> "Steven T. Yen" <styen at ntu.edu.tw> ?????:
> >>>>
> >>>>> Printing this in a main program causes no problem (as shown above).
> >>>>> But, using the command t(mycontrol) the line gets ignored.
> >>>> t() doesn't print, it returns a value. In R, there's auto-printing in
> >>>> the toplevel context (see ?withAutoprint), but not when you move away
> >>>> from the interactive prompt. I think that it should be possible to use
> >>>> an explicit print(t(mycontrol)) to get the behaviour you desire.
> >>>>
> >>>> --
> >>>> Best regards,
> >>>> Ivan
> >>>>
> >>>> ______________________________________________
> >>>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> >>>> https://stat.ethz.ch/mailman/listinfo/r-help
> >>>> PLEASE do read the posting guide
> >>>> http://www.R-project.org/posting-guide.html
> >>>> and provide commented, minimal, self-contained, reproducible code.
> >>
> >> ______________________________________________
> >> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> >> https://stat.ethz.ch/mailman/listinfo/r-help
> >> PLEASE do read the posting guide
> >> http://www.R-project.org/posting-guide.html
> >> and provide commented, minimal, self-contained, reproducible code.
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From m@k@hho||y @end|ng |rom gm@||@com  Mon Oct 24 17:50:27 2022
From: m@k@hho||y @end|ng |rom gm@||@com (greg holly)
Date: Mon, 24 Oct 2022 10:50:27 -0500
Subject: [R] Sensitivity and Specificity
In-Reply-To: <c2a8b39f-7daa-6844-4d77-b4b4932061bb@dewey.myzen.co.uk>
References: <CAM9Qe4im3XyAvSaDSAq94z+uwwKTwi2Tthr9ExoxLs+NvLPVOA@mail.gmail.com>
 <c2a8b39f-7daa-6844-4d77-b4b4932061bb@dewey.myzen.co.uk>
Message-ID: <CAM9Qe4jMAexXVpefekGDvoD4__WDEmnjAEbZ9mRdMjqPMfZ_tQ@mail.gmail.com>

Hi Michael,

I appreciate your writing. Here are what I have after;

> predict_testing <- ifelse(predict > 0.5,1,0)
>
> head(predict)
         1          2          3          5          7          8
0.29006984 0.28370507 0.10761993 0.02204224 0.12873872 0.08127920
>
> # Sensitivity and Specificity
>
>
sensitivity<-(predict_testing[2,2]/(predict_testing[2,2]+predict_testing[2,1]))*100
Error in predict_testing[2, 2] : incorrect number of dimensions
> sensitivity
function (data, ...)
{
    UseMethod("sensitivity")
}
<bytecode: 0x000002082a2f01d8>
<environment: namespace:caret>
>
>
specificity<-(predict_testing[1,1]/(predict_testing[1,1]+predict_testing[1,2]))*100
Error in predict_testing[1, 1] : incorrect number of dimensions
> specificity
function (data, ...)
{
    UseMethod("specificity")
}
<bytecode: 0x000002082a2fa600>
<environment: namespace:caret>

On Mon, Oct 24, 2022 at 10:45 AM Michael Dewey <lists at dewey.myzen.co.uk>
wrote:

> Rather hard to know without seeing what output you expected and what
> error message you got if any but did you mean to summarise your variable
> predict before doing anything with it?
>
> Michael
>
> On 24/10/2022 16:17, greg holly wrote:
> > Hi all R-Help ,
> >
> > After partitioning my data to testing and training (please see below), I
> > need to estimate the Sensitivity and Specificity. I failed. It would be
> > appropriate to get your help.
> >
> > Best regards,
> > Greg
> >
> >
> > inTrain <- createDataPartition(y=data$case,
> >                                 p=0.7,
> >                                 list=FALSE)
> > training <- data[ inTrain,]
> > testing  <- data[-inTrain,]
> >
> > attach(training)
> > #model training and prediction
> > data_training <- glm(case ~ age+BMI+Calcium+Albumin+meno_1, data =
> > training, family = binomial(link="logit"))
> >
> > predict <- predict(data_training, data_predict = testing, type =
> "response")
> >
> > predict_testing <- ifelse(predict > 0.5,1,0)
> >
> > # Sensitivity and Specificity
> >
> >
>  sensitivity<-(predict_testing[2,2]/(predict_testing[2,2]+predict_testing[2,1]))*100
> >   sensitivity
> >
> >
>  specificity<-(predict_testing[1,1]/(predict_testing[1,1]+predict_testing[1,2]))*100
> >   specificity
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.
> >
>
> --
> Michael
> http://www.dewey.myzen.co.uk/home.html
>

	[[alternative HTML version deleted]]


From kt1572757 @end|ng |rom gm@||@com  Mon Oct 24 18:07:44 2022
From: kt1572757 @end|ng |rom gm@||@com (Kelly Thompson)
Date: Mon, 24 Oct 2022 12:07:44 -0400
Subject: [R] When using require(),
 why do I get the error message "Error in if (!loaded) { : the
 condition has length > 1" ?
Message-ID: <CAHfBD2frpoHQ04bH5vGz8a_Fn2v1q1=i33doUkaqH5pk=5bevQ@mail.gmail.com>

# Below, when using require(), why do I get the error message "Error
in if (!loaded) { : the condition has length > 1" ?

# This is my reproducible code:

#create a vector with the names of the packages I want to use
packages_i_want_to_use <- c('base', 'this_pac_does_not_exist')

# Here I get error messages:
require( packages_i_want_to_use[1] )
#Error in if (!loaded) { : the condition has length > 1

require( packages_i_want_to_use[2] )
#Error in if (!loaded) { : the condition has length > 1

# Here I get what I expect:
require('base')

require('this_pac_does_not_exist')
#Loading required package: this_pac_does_not_exist
#Warning message:
#In library(package, lib.loc = lib.loc, character.only = TRUE,
logical.return = TRUE,  :
#  there is no package called ?this_pac_does_not_exist?


From @kw@|mmo @end|ng |rom gm@||@com  Mon Oct 24 18:28:59 2022
From: @kw@|mmo @end|ng |rom gm@||@com (Andrew Simmons)
Date: Mon, 24 Oct 2022 12:28:59 -0400
Subject: [R] When using require(),
 why do I get the error message "Error in if (!loaded) { : the
 condition has length > 1" ?
In-Reply-To: <CAHfBD2frpoHQ04bH5vGz8a_Fn2v1q1=i33doUkaqH5pk=5bevQ@mail.gmail.com>
References: <CAHfBD2frpoHQ04bH5vGz8a_Fn2v1q1=i33doUkaqH5pk=5bevQ@mail.gmail.com>
Message-ID: <CAPcHnpSM=jYg+16mguamJv+foZuv_D_9mCrtB_uYk6n3wqf7Qg@mail.gmail.com>

require(), similarly to library(), does not evaluate its first argument
UNLESS you add character.only = TRUE

require( packages_i_want_to_use[1], character.only = TRUE)


On Mon, Oct 24, 2022, 12:26 Kelly Thompson <kt1572757 at gmail.com> wrote:

> # Below, when using require(), why do I get the error message "Error
> in if (!loaded) { : the condition has length > 1" ?
>
> # This is my reproducible code:
>
> #create a vector with the names of the packages I want to use
> packages_i_want_to_use <- c('base', 'this_pac_does_not_exist')
>
> # Here I get error messages:
> require( packages_i_want_to_use[1] )
> #Error in if (!loaded) { : the condition has length > 1
>
> require( packages_i_want_to_use[2] )
> #Error in if (!loaded) { : the condition has length > 1
>
> # Here I get what I expect:
> require('base')
>
> require('this_pac_does_not_exist')
> #Loading required package: this_pac_does_not_exist
> #Warning message:
> #In library(package, lib.loc = lib.loc, character.only = TRUE,
> logical.return = TRUE,  :
> #  there is no package called ?this_pac_does_not_exist?
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From bgunter@4567 @end|ng |rom gm@||@com  Mon Oct 24 18:30:53 2022
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Mon, 24 Oct 2022 09:30:53 -0700
Subject: [R] unexpected 'else' in " else" (Ebert,Timothy Aaron)
In-Reply-To: <MW4PR01MB64651EF91E8B7D2ADDA87644DC2E9@MW4PR01MB6465.prod.exchangelabs.com>
References: <mailman.368082.1.1666432801.57482.r-help@r-project.org>
 <MW4PR01MB64651EF91E8B7D2ADDA87644DC2E9@MW4PR01MB6465.prod.exchangelabs.com>
Message-ID: <CAGxFJbR-R8AFY-muYs2X_sJX2NVWKyEk6ydNwFtmnK7DzMiQTg@mail.gmail.com>

"...but 'same length and attributes (including dimensions and
?"class"?) as ?test?' looks wrong. The output seems to be `logical` or
something related to the classes of `yes` & `no`."

The documentation in fact says:
"A vector of the same length and attributes (including dimensions and
"class") as test and data values from the values of yes or no. **The
mode of the answer will be coerced from logical to accommodate first
any values taken from yes and then any values taken from no.**

So the values are taken from 'yes' and 'no' (with coercion if they are
of different classes), and the class of the result will presumably be
inferred from the mode of those values. e.g.

> z <- c(TRUE,TRUE,FALSE)
> class(z)
[1] "logical"
> w <- ifelse(z,5,'a')
> class(w)
[1] "character"  ## note coercion

So it would appear that the ifelse() documentation needs to be
clarified. For example, if the above asterisked phrase were "The S3
*class* of the answer will be inferred from the mode, where the mode
of the answer will be coerced ..." that might resolve at least that
bit of confusion However, that might also be incorrect -- what about
S4 vs S3 vs Reference classes, for example (are such cases even
possible?)? I leave resolution of these matters -- or at least their
accurate and complete documentation -- to wiser heads.

Cheers,
Bert




On Mon, Oct 24, 2022 at 8:45 AM Jorgen Harmse via R-help
<r-help at r-project.org> wrote:
>
> There were several interesting points about `ifelse`. The usual behaviour seems to be that all three inputs are evaluated, and the entries of `yes` corresponding to `TRUE` in `test` are combined with the entries of `no` corresponding to `FALSE` in `test`. Moreover, `yes` & `no` seem to be recycled as necessary in case `test` is longer. On top of that, there seems to be some sugar that suppresses evaluations in case `all(test)` and/or `all(!test)`, and the return type can be `logical` even if `yes` & `no` are not. I agreed with the other responses already, but my experiments further confirmed that `ifelse` is not interchangeable with `if(....) .... else ....`.
>
>
>
> The documentation confirms most of this, but 'same length and attributes (including dimensions and ?"class"?) as ?test?' looks wrong. The output seems to be `logical` or something related to the classes of `yes` & `no`.
>
>
>
> Regards,
>
> Jorgen Harmse.
>
>
>
> > ifelse(FALSE, {cat("Evaluating the vector for 'if'.\n"); 1:3}, {cat("Evaluating the vector for 'else'.\n"); 0:4})
>
> Evaluating the vector for 'else'.
>
> [1] 0
>
> > ifelse(rep(FALSE,5L), {cat("Evaluating the vector for 'if'.\n"); 1:3}, {cat("Evaluating the vector for 'else'.\n"); 0:4})
>
> Evaluating the vector for 'else'.
>
> [1] 0 1 2 3 4
>
> > ifelse(rep(TRUE,3L), {cat("Evaluating the vector for 'if'.\n"); 1:3}, {cat("Evaluating the vector for 'else'.\n"); 0:4})
>
> Evaluating the vector for 'if'.
>
> [1] 1 2 3
>
> > ifelse(c(TRUE,TRUE,FALSE), {cat("Evaluating the vector for 'if'.\n"); 1:3}, {cat("Evaluating the vector for 'else'.\n"); 0:4})
>
> Evaluating the vector for 'if'.
>
> Evaluating the vector for 'else'.
>
> [1] 1 2 2
>
> > ifelse(c(TRUE,TRUE,FALSE,TRUE), {cat("Evaluating the vector for 'if'.\n"); 1:3}, {cat("Evaluating the vector for 'else'.\n"); 0:4})
>
> Evaluating the vector for 'if'.
>
> Evaluating the vector for 'else'.
>
> [1] 1 2 2 1
>
> > args(ifelse)
>
> function (test, yes, no)
>
> NULL
>
> > ifelse(c(TRUE,TRUE,FALSE,TRUE,TRUE,FALSE,TRUE), {cat("Evaluating the vector for 'if'.\n"); 1:3}, {cat("Evaluating the vector for 'else'.\n"); 0:4})
>
> Evaluating the vector for 'if'.
>
> Evaluating the vector for 'else'.
>
> [1] 1 2 2 1 2 0 1
>
> > ifelse(logical(0L), {cat("Evaluating the vector for 'if'.\n"); 1:3}, {cat("Evaluating the vector for 'else'.\n"); 0:4})
>
> logical(0)
>
> > ifelse(TRUE, integer(0L), numeric(0L))
>
> [1] NA
>
> > class(ifelse(TRUE, integer(0L), numeric(0L)))
>
> [1] "integer"
>
> > ifelse(integer(0L)) # test is an empty vector of integers and yes & no are missing.
>
> logical(0)
>
>
>
>
>
>
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From kry|ov@r00t @end|ng |rom gm@||@com  Mon Oct 24 18:34:08 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Mon, 24 Oct 2022 19:34:08 +0300
Subject: [R] When using require(),
 why do I get the error message "Error in if (!loaded) { : the
 condition has length > 1" ?
In-Reply-To: <CAHfBD2frpoHQ04bH5vGz8a_Fn2v1q1=i33doUkaqH5pk=5bevQ@mail.gmail.com>
References: <CAHfBD2frpoHQ04bH5vGz8a_Fn2v1q1=i33doUkaqH5pk=5bevQ@mail.gmail.com>
Message-ID: <20221024193408.04b8927e@arachnoid>

? Mon, 24 Oct 2022 12:07:44 -0400
Kelly Thompson <kt1572757 at gmail.com> ?????:

> require( packages_i_want_to_use[1] )
> #Error in if (!loaded) { : the condition has length > 1

This seems to be a bug in require(). In addition to understanding
character strings as arguments, require() can load packages named by
unquoted barewords:

require(base)

This uses non-standard evaluation, and the part that transforms an
unquoted symbol into a package name doesn't expect to see what is
effectively `[`(packages_i_want_to_use, 1) instead of a single symbol.

If you pass the character.only = TRUE argument to require(), this
additional handling is disabled, making your examples work again. It's
a good idea to always pass this argument when calling require() with a
variable as the first argument.

-- 
Best regards,
Ivan


From henr|k@bengt@@on @end|ng |rom gm@||@com  Mon Oct 24 18:34:09 2022
From: henr|k@bengt@@on @end|ng |rom gm@||@com (Henrik Bengtsson)
Date: Mon, 24 Oct 2022 09:34:09 -0700
Subject: [R] When using require(),
 why do I get the error message "Error in if (!loaded) { : the
 condition has length > 1" ?
In-Reply-To: <CAHfBD2frpoHQ04bH5vGz8a_Fn2v1q1=i33doUkaqH5pk=5bevQ@mail.gmail.com>
References: <CAHfBD2frpoHQ04bH5vGz8a_Fn2v1q1=i33doUkaqH5pk=5bevQ@mail.gmail.com>
Message-ID: <CAFDcVCR-jC-59W8nXfuu+TvDHhk4etBnCFF=VKTvu1npMTNkqg@mail.gmail.com>

You need to pass character.only = TRUE to require() whenever you
specify the package using a character variable.

I agree, the error message is confusing.

/Henrik

On Mon, Oct 24, 2022 at 9:26 AM Kelly Thompson <kt1572757 at gmail.com> wrote:
>
> # Below, when using require(), why do I get the error message "Error
> in if (!loaded) { : the condition has length > 1" ?
>
> # This is my reproducible code:
>
> #create a vector with the names of the packages I want to use
> packages_i_want_to_use <- c('base', 'this_pac_does_not_exist')
>
> # Here I get error messages:
> require( packages_i_want_to_use[1] )
> #Error in if (!loaded) { : the condition has length > 1
>
> require( packages_i_want_to_use[2] )
> #Error in if (!loaded) { : the condition has length > 1
>
> # Here I get what I expect:
> require('base')
>
> require('this_pac_does_not_exist')
> #Loading required package: this_pac_does_not_exist
> #Warning message:
> #In library(package, lib.loc = lib.loc, character.only = TRUE,
> logical.return = TRUE,  :
> #  there is no package called ?this_pac_does_not_exist?
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From bgunter@4567 @end|ng |rom gm@||@com  Mon Oct 24 18:35:02 2022
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Mon, 24 Oct 2022 09:35:02 -0700
Subject: [R] When using require(),
 why do I get the error message "Error in if (!loaded) { : the
 condition has length > 1" ?
In-Reply-To: <CAHfBD2frpoHQ04bH5vGz8a_Fn2v1q1=i33doUkaqH5pk=5bevQ@mail.gmail.com>
References: <CAHfBD2frpoHQ04bH5vGz8a_Fn2v1q1=i33doUkaqH5pk=5bevQ@mail.gmail.com>
Message-ID: <CAGxFJbSpty2_Yj1w=p2sD4QhBEBzkQCtXvw2RfHvn4bH2T_k2A@mail.gmail.com>

Reread ?require more carefully. Especially for the  'package' argument.

Incidentally, you don't need to require base. It's always available.

-- Bert

On Mon, Oct 24, 2022 at 9:25 AM Kelly Thompson <kt1572757 at gmail.com> wrote:
>
> # Below, when using require(), why do I get the error message "Error
> in if (!loaded) { : the condition has length > 1" ?
>
> # This is my reproducible code:
>
> #create a vector with the names of the packages I want to use
> packages_i_want_to_use <- c('base', 'this_pac_does_not_exist')
>
> # Here I get error messages:
> require( packages_i_want_to_use[1] )
> #Error in if (!loaded) { : the condition has length > 1
>
> require( packages_i_want_to_use[2] )
> #Error in if (!loaded) { : the condition has length > 1
>
> # Here I get what I expect:
> require('base')
>
> require('this_pac_does_not_exist')
> #Loading required package: this_pac_does_not_exist
> #Warning message:
> #In library(package, lib.loc = lib.loc, character.only = TRUE,
> logical.return = TRUE,  :
> #  there is no package called ?this_pac_does_not_exist?
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Mon Oct 24 18:41:26 2022
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Mon, 24 Oct 2022 09:41:26 -0700
Subject: [R] When using require(),
 why do I get the error message "Error in if (!loaded) { : the
 condition has length > 1" ?
In-Reply-To: <CAHfBD2frpoHQ04bH5vGz8a_Fn2v1q1=i33doUkaqH5pk=5bevQ@mail.gmail.com>
References: <CAHfBD2frpoHQ04bH5vGz8a_Fn2v1q1=i33doUkaqH5pk=5bevQ@mail.gmail.com>
Message-ID: <8A39708C-8A5C-440D-9297-0EA15F4700E4@dcn.davis.ca.us>

Don't load base. It is already loaded.

On October 24, 2022 9:07:44 AM PDT, Kelly Thompson <kt1572757 at gmail.com> wrote:
># Below, when using require(), why do I get the error message "Error
>in if (!loaded) { : the condition has length > 1" ?
>
># This is my reproducible code:
>
>#create a vector with the names of the packages I want to use
>packages_i_want_to_use <- c('base', 'this_pac_does_not_exist')
>
># Here I get error messages:
>require( packages_i_want_to_use[1] )
>#Error in if (!loaded) { : the condition has length > 1
>
>require( packages_i_want_to_use[2] )
>#Error in if (!loaded) { : the condition has length > 1
>
># Here I get what I expect:
>require('base')
>
>require('this_pac_does_not_exist')
>#Loading required package: this_pac_does_not_exist
>#Warning message:
>#In library(package, lib.loc = lib.loc, character.only = TRUE,
>logical.return = TRUE,  :
>#  there is no package called ?this_pac_does_not_exist?
>
>______________________________________________
>R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>https://stat.ethz.ch/mailman/listinfo/r-help
>PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>and provide commented, minimal, self-contained, reproducible code.

-- 
Sent from my phone. Please excuse my brevity.


From kt1572757 @end|ng |rom gm@||@com  Mon Oct 24 18:42:19 2022
From: kt1572757 @end|ng |rom gm@||@com (Kelly Thompson)
Date: Mon, 24 Oct 2022 12:42:19 -0400
Subject: [R] When using require(),
 why do I get the error message "Error in if (!loaded) { : the
 condition has length > 1" ?
In-Reply-To: <CAPcHnpSM=jYg+16mguamJv+foZuv_D_9mCrtB_uYk6n3wqf7Qg@mail.gmail.com>
References: <CAHfBD2frpoHQ04bH5vGz8a_Fn2v1q1=i33doUkaqH5pk=5bevQ@mail.gmail.com>
 <CAPcHnpSM=jYg+16mguamJv+foZuv_D_9mCrtB_uYk6n3wqf7Qg@mail.gmail.com>
Message-ID: <CAHfBD2ckw+RK=9iiw68L0nMmr9E4w3-Od_Ep5PqYmi+oRDtHqg@mail.gmail.com>

Thanks!

# Please, can you help me understand why
require( 'base' ) # works, but
require( packages_i_want_to_use[1] ) # does not work?

# In require( 'base' ), what is the "first argument"?

On Mon, Oct 24, 2022 at 12:29 PM Andrew Simmons <akwsimmo at gmail.com> wrote:
>
> require(), similarly to library(), does not evaluate its first argument UNLESS you add character.only = TRUE
>
> require( packages_i_want_to_use[1], character.only = TRUE)
>
>
> On Mon, Oct 24, 2022, 12:26 Kelly Thompson <kt1572757 at gmail.com> wrote:
>>
>> # Below, when using require(), why do I get the error message "Error
>> in if (!loaded) { : the condition has length > 1" ?
>>
>> # This is my reproducible code:
>>
>> #create a vector with the names of the packages I want to use
>> packages_i_want_to_use <- c('base', 'this_pac_does_not_exist')
>>
>> # Here I get error messages:
>> require( packages_i_want_to_use[1] )
>> #Error in if (!loaded) { : the condition has length > 1
>>
>> require( packages_i_want_to_use[2] )
>> #Error in if (!loaded) { : the condition has length > 1
>>
>> # Here I get what I expect:
>> require('base')
>>
>> require('this_pac_does_not_exist')
>> #Loading required package: this_pac_does_not_exist
>> #Warning message:
>> #In library(package, lib.loc = lib.loc, character.only = TRUE,
>> logical.return = TRUE,  :
>> #  there is no package called ?this_pac_does_not_exist?
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.


From JH@rm@e @end|ng |rom roku@com  Mon Oct 24 18:53:03 2022
From: JH@rm@e @end|ng |rom roku@com (Jorgen Harmse)
Date: Mon, 24 Oct 2022 16:53:03 +0000
Subject: [R] [EXTERNAL] Re:  unexpected 'else' in " else" (Ebert,
 Timothy Aaron)
In-Reply-To: <CAGxFJbR-R8AFY-muYs2X_sJX2NVWKyEk6ydNwFtmnK7DzMiQTg@mail.gmail.com>
References: <mailman.368082.1.1666432801.57482.r-help@r-project.org>
 <MW4PR01MB64651EF91E8B7D2ADDA87644DC2E9@MW4PR01MB6465.prod.exchangelabs.com>
 <CAGxFJbR-R8AFY-muYs2X_sJX2NVWKyEk6ydNwFtmnK7DzMiQTg@mail.gmail.com>
Message-ID: <MW4PR01MB6465A5C62609BF2204F39F03DC2E9@MW4PR01MB6465.prod.exchangelabs.com>

I agree that the documentation should be clarified. Moreover, my last example shows that the class can be different even when no mode coercion is required. I don't know enough about S3 & S4 to comment on your last point.

Regards,
Jorgen Harmse.


From: Bert Gunter <bgunter.4567 at gmail.com>
Date: Monday, 24October, 2022 at 11:31
To: Jorgen Harmse <JHarmse at roku.com>
Cc: r-help at r-project.org <r-help at r-project.org>
Subject: [EXTERNAL] Re: [R] unexpected 'else' in " else" (Ebert,Timothy Aaron)
...

So it would appear that the ifelse() documentation needs to be
clarified. For example, if the above asterisked phrase were "The S3
*class* of the answer will be inferred from the mode, where the mode
of the answer will be coerced ..." that might resolve at least that
bit of confusion However, that might also be incorrect -- what about
S4 vs S3 vs Reference classes, for example (are such cases even
possible?)? I leave resolution of these matters -- or at least their
accurate and complete documentation -- to wiser heads.

Cheers,
Bert

...

> > ifelse(integer(0L)) # test is an empty vector of integers and yes & no are missing.
>
> logical(0)


	[[alternative HTML version deleted]]


From @kw@|mmo @end|ng |rom gm@||@com  Mon Oct 24 18:53:07 2022
From: @kw@|mmo @end|ng |rom gm@||@com (Andrew Simmons)
Date: Mon, 24 Oct 2022 12:53:07 -0400
Subject: [R] When using require(),
 why do I get the error message "Error in if (!loaded) { : the
 condition has length > 1" ?
In-Reply-To: <CAHfBD2ckw+RK=9iiw68L0nMmr9E4w3-Od_Ep5PqYmi+oRDtHqg@mail.gmail.com>
References: <CAHfBD2frpoHQ04bH5vGz8a_Fn2v1q1=i33doUkaqH5pk=5bevQ@mail.gmail.com>
 <CAPcHnpSM=jYg+16mguamJv+foZuv_D_9mCrtB_uYk6n3wqf7Qg@mail.gmail.com>
 <CAHfBD2ckw+RK=9iiw68L0nMmr9E4w3-Od_Ep5PqYmi+oRDtHqg@mail.gmail.com>
Message-ID: <CAPcHnpTZNEb66TgZYGHmenvT_O9uXpCQqn6MQLCXrNNdA41Ukg@mail.gmail.com>

In the first one, the argument is a character vector of length 1, so the
code works perfectly fine.

The second is a call, and when coerced to a character vector should look
like

c("[", "packages_i_want_to_use", "1")

You can try this yourself with quote(packages_i_want_to_use[1]) which
returns its first argument, unevaluated.

On Mon, Oct 24, 2022, 12:46 Kelly Thompson <kt1572757 at gmail.com> wrote:

> Thanks!
>
> # Please, can you help me understand why
> require( 'base' ) # works, but
> require( packages_i_want_to_use[1] ) # does not work?
>
> # In require( 'base' ), what is the "first argument"?
>
> On Mon, Oct 24, 2022 at 12:29 PM Andrew Simmons <akwsimmo at gmail.com>
> wrote:
> >
> > require(), similarly to library(), does not evaluate its first argument
> UNLESS you add character.only = TRUE
> >
> > require( packages_i_want_to_use[1], character.only = TRUE)
> >
> >
> > On Mon, Oct 24, 2022, 12:26 Kelly Thompson <kt1572757 at gmail.com> wrote:
> >>
> >> # Below, when using require(), why do I get the error message "Error
> >> in if (!loaded) { : the condition has length > 1" ?
> >>
> >> # This is my reproducible code:
> >>
> >> #create a vector with the names of the packages I want to use
> >> packages_i_want_to_use <- c('base', 'this_pac_does_not_exist')
> >>
> >> # Here I get error messages:
> >> require( packages_i_want_to_use[1] )
> >> #Error in if (!loaded) { : the condition has length > 1
> >>
> >> require( packages_i_want_to_use[2] )
> >> #Error in if (!loaded) { : the condition has length > 1
> >>
> >> # Here I get what I expect:
> >> require('base')
> >>
> >> require('this_pac_does_not_exist')
> >> #Loading required package: this_pac_does_not_exist
> >> #Warning message:
> >> #In library(package, lib.loc = lib.loc, character.only = TRUE,
> >> logical.return = TRUE,  :
> >> #  there is no package called ?this_pac_does_not_exist?
> >>
> >> ______________________________________________
> >> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> >> https://stat.ethz.ch/mailman/listinfo/r-help
> >> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> >> and provide commented, minimal, self-contained, reproducible code.
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From bgunter@4567 @end|ng |rom gm@||@com  Mon Oct 24 19:07:35 2022
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Mon, 24 Oct 2022 10:07:35 -0700
Subject: [R] unexpected 'else' in " else" (Ebert,Timothy Aaron)
In-Reply-To: <CAGxFJbR-R8AFY-muYs2X_sJX2NVWKyEk6ydNwFtmnK7DzMiQTg@mail.gmail.com>
References: <mailman.368082.1.1666432801.57482.r-help@r-project.org>
 <MW4PR01MB64651EF91E8B7D2ADDA87644DC2E9@MW4PR01MB6465.prod.exchangelabs.com>
 <CAGxFJbR-R8AFY-muYs2X_sJX2NVWKyEk6ydNwFtmnK7DzMiQTg@mail.gmail.com>
Message-ID: <CAGxFJbReuDQVYCzGONJD4CpJhqsGntn3o0+jpKoeewe53yd2Sg@mail.gmail.com>

I wanted to follow up.
A more careful reading of the following:
"A vector of the same length and attributes (including dimensions and
"class") as test..."

So the above **refers only to a "class" attribute that appears among
the attributes of test and result**. Using my previous example, note
that:

 z <- c(TRUE,TRUE,FALSE)
> attributes(z)
NULL ## so no 'class' among attributes(z)
## However
> class(z)  ## S3 class
[1] "logical"
## Similarly
> w <- ifelse(z,5,'a')
> attributes(w)
NULL ## so no 'class' among attributes(w)
> class(w)   ##S3 class
[1] "character"

So my (anyway) confusion stems from conflating the S3 'class' of the
object with a "class" attribute, of which there is none.

Nevertheless, I believe that the phrase I suggested (or something
along those lines) might clarify how the S3 class is determined and
perhaps better distinguish it from a "class" attribute among the
attributes, if there there is such. Or maybe that part of the doc
should just be removed.

My guess is that this documentation has been around for a long time
and no one has gotten around to revising it once S3 classes came into
wider use. ... or saw the need to revise it, anyway.

-- Bert





"

On Mon, Oct 24, 2022 at 9:30 AM Bert Gunter <bgunter.4567 at gmail.com> wrote:
>
> "...but 'same length and attributes (including dimensions and
> ?"class"?) as ?test?' looks wrong. The output seems to be `logical` or
> something related to the classes of `yes` & `no`."
>
> The documentation in fact says:
> "A vector of the same length and attributes (including dimensions and
> "class") as test and data values from the values of yes or no. **The
> mode of the answer will be coerced from logical to accommodate first
> any values taken from yes and then any values taken from no.**
>
> So the values are taken from 'yes' and 'no' (with coercion if they are
> of different classes), and the class of the result will presumably be
> inferred from the mode of those values. e.g.
>
> > z <- c(TRUE,TRUE,FALSE)
> > class(z)
> [1] "logical"
> > w <- ifelse(z,5,'a')
> > class(w)
> [1] "character"  ## note coercion
>
> So it would appear that the ifelse() documentation needs to be
> clarified. For example, if the above asterisked phrase were "The S3
> *class* of the answer will be inferred from the mode, where the mode
> of the answer will be coerced ..." that might resolve at least that
> bit of confusion However, that might also be incorrect -- what about
> S4 vs S3 vs Reference classes, for example (are such cases even
> possible?)? I leave resolution of these matters -- or at least their
> accurate and complete documentation -- to wiser heads.
>
> Cheers,
> Bert
>
>
>
>
> On Mon, Oct 24, 2022 at 8:45 AM Jorgen Harmse via R-help
> <r-help at r-project.org> wrote:
> >
> > There were several interesting points about `ifelse`. The usual behaviour seems to be that all three inputs are evaluated, and the entries of `yes` corresponding to `TRUE` in `test` are combined with the entries of `no` corresponding to `FALSE` in `test`. Moreover, `yes` & `no` seem to be recycled as necessary in case `test` is longer. On top of that, there seems to be some sugar that suppresses evaluations in case `all(test)` and/or `all(!test)`, and the return type can be `logical` even if `yes` & `no` are not. I agreed with the other responses already, but my experiments further confirmed that `ifelse` is not interchangeable with `if(....) .... else ....`.
> >
> >
> >
> > The documentation confirms most of this, but 'same length and attributes (including dimensions and ?"class"?) as ?test?' looks wrong. The output seems to be `logical` or something related to the classes of `yes` & `no`.
> >
> >
> >
> > Regards,
> >
> > Jorgen Harmse.
> >
> >
> >
> > > ifelse(FALSE, {cat("Evaluating the vector for 'if'.\n"); 1:3}, {cat("Evaluating the vector for 'else'.\n"); 0:4})
> >
> > Evaluating the vector for 'else'.
> >
> > [1] 0
> >
> > > ifelse(rep(FALSE,5L), {cat("Evaluating the vector for 'if'.\n"); 1:3}, {cat("Evaluating the vector for 'else'.\n"); 0:4})
> >
> > Evaluating the vector for 'else'.
> >
> > [1] 0 1 2 3 4
> >
> > > ifelse(rep(TRUE,3L), {cat("Evaluating the vector for 'if'.\n"); 1:3}, {cat("Evaluating the vector for 'else'.\n"); 0:4})
> >
> > Evaluating the vector for 'if'.
> >
> > [1] 1 2 3
> >
> > > ifelse(c(TRUE,TRUE,FALSE), {cat("Evaluating the vector for 'if'.\n"); 1:3}, {cat("Evaluating the vector for 'else'.\n"); 0:4})
> >
> > Evaluating the vector for 'if'.
> >
> > Evaluating the vector for 'else'.
> >
> > [1] 1 2 2
> >
> > > ifelse(c(TRUE,TRUE,FALSE,TRUE), {cat("Evaluating the vector for 'if'.\n"); 1:3}, {cat("Evaluating the vector for 'else'.\n"); 0:4})
> >
> > Evaluating the vector for 'if'.
> >
> > Evaluating the vector for 'else'.
> >
> > [1] 1 2 2 1
> >
> > > args(ifelse)
> >
> > function (test, yes, no)
> >
> > NULL
> >
> > > ifelse(c(TRUE,TRUE,FALSE,TRUE,TRUE,FALSE,TRUE), {cat("Evaluating the vector for 'if'.\n"); 1:3}, {cat("Evaluating the vector for 'else'.\n"); 0:4})
> >
> > Evaluating the vector for 'if'.
> >
> > Evaluating the vector for 'else'.
> >
> > [1] 1 2 2 1 2 0 1
> >
> > > ifelse(logical(0L), {cat("Evaluating the vector for 'if'.\n"); 1:3}, {cat("Evaluating the vector for 'else'.\n"); 0:4})
> >
> > logical(0)
> >
> > > ifelse(TRUE, integer(0L), numeric(0L))
> >
> > [1] NA
> >
> > > class(ifelse(TRUE, integer(0L), numeric(0L)))
> >
> > [1] "integer"
> >
> > > ifelse(integer(0L)) # test is an empty vector of integers and yes & no are missing.
> >
> > logical(0)
> >
> >
> >
> >
> >
> >
> >
> >
> >         [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.


From ||@t@ @end|ng |rom dewey@myzen@co@uk  Mon Oct 24 19:10:12 2022
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Mon, 24 Oct 2022 18:10:12 +0100
Subject: [R] Sensitivity and Specificity
In-Reply-To: <CAM9Qe4jMAexXVpefekGDvoD4__WDEmnjAEbZ9mRdMjqPMfZ_tQ@mail.gmail.com>
References: <CAM9Qe4im3XyAvSaDSAq94z+uwwKTwi2Tthr9ExoxLs+NvLPVOA@mail.gmail.com>
 <c2a8b39f-7daa-6844-4d77-b4b4932061bb@dewey.myzen.co.uk>
 <CAM9Qe4jMAexXVpefekGDvoD4__WDEmnjAEbZ9mRdMjqPMfZ_tQ@mail.gmail.com>
Message-ID: <e05b3b03-cf0e-28df-526b-9db792d4f90e@dewey.myzen.co.uk>

So predict is a one-dimensional vector of predictions but you are 
treating it as a two-dimensional matrix (presumably you think those are 
the totals).

Michael

On 24/10/2022 16:50, greg holly wrote:
> Hi Michael,
> 
> I appreciate your writing. Here are what I have after;
> 
>  > predict_testing <- ifelse(predict > 0.5,1,0)
>  >
>  > head(predict)
>  ? ? ? ? ?1 ? ? ? ? ?2 ? ? ? ? ?3 ? ? ? ? ?5 ? ? ? ? ?7 ? ? ? ? ?8
> 0.29006984 0.28370507 0.10761993 0.02204224 0.12873872 0.08127920
>  >
>  > # Sensitivity and Specificity
>  >
>  > 
> sensitivity<-(predict_testing[2,2]/(predict_testing[2,2]+predict_testing[2,1]))*100
> Error in predict_testing[2, 2] : incorrect number of dimensions
>  > sensitivity
> function (data, ...)
> {
>  ? ? UseMethod("sensitivity")
> }
> <bytecode: 0x000002082a2f01d8>
> <environment: namespace:caret>
>  >
>  > 
> specificity<-(predict_testing[1,1]/(predict_testing[1,1]+predict_testing[1,2]))*100
> Error in predict_testing[1, 1] : incorrect number of dimensions
>  > specificity
> function (data, ...)
> {
>  ? ? UseMethod("specificity")
> }
> <bytecode: 0x000002082a2fa600>
> <environment: namespace:caret>
> 
> On Mon, Oct 24, 2022 at 10:45 AM Michael Dewey <lists at dewey.myzen.co.uk 
> <mailto:lists at dewey.myzen.co.uk>> wrote:
> 
>     Rather hard to know without seeing what output you expected and what
>     error message you got if any but did you mean to summarise your
>     variable
>     predict before doing anything with it?
> 
>     Michael
> 
>     On 24/10/2022 16:17, greg holly wrote:
>      > Hi all R-Help ,
>      >
>      > After partitioning my data to testing and training (please see
>     below), I
>      > need to estimate the Sensitivity and Specificity. I failed. It
>     would be
>      > appropriate to get your help.
>      >
>      > Best regards,
>      > Greg
>      >
>      >
>      > inTrain <- createDataPartition(y=data$case,
>      >? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?p=0.7,
>      >? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?list=FALSE)
>      > training <- data[ inTrain,]
>      > testing? <- data[-inTrain,]
>      >
>      > attach(training)
>      > #model training and prediction
>      > data_training <- glm(case ~ age+BMI+Calcium+Albumin+meno_1, data =
>      > training, family = binomial(link="logit"))
>      >
>      > predict <- predict(data_training, data_predict = testing, type =
>     "response")
>      >
>      > predict_testing <- ifelse(predict > 0.5,1,0)
>      >
>      > # Sensitivity and Specificity
>      >
>      > 
>      ?sensitivity<-(predict_testing[2,2]/(predict_testing[2,2]+predict_testing[2,1]))*100
>      >? ?sensitivity
>      >
>      > 
>      ?specificity<-(predict_testing[1,1]/(predict_testing[1,1]+predict_testing[1,2]))*100
>      >? ?specificity
>      >
>      >? ? ? ?[[alternative HTML version deleted]]
>      >
>      > ______________________________________________
>      > R-help at r-project.org <mailto:R-help at r-project.org> mailing list
>     -- To UNSUBSCRIBE and more, see
>      > https://stat.ethz.ch/mailman/listinfo/r-help
>     <https://stat.ethz.ch/mailman/listinfo/r-help>
>      > PLEASE do read the posting guide
>     http://www.R-project.org/posting-guide.html
>     <http://www.R-project.org/posting-guide.html>
>      > and provide commented, minimal, self-contained, reproducible code.
>      >
> 
>     -- 
>     Michael
>     http://www.dewey.myzen.co.uk/home.html
>     <http://www.dewey.myzen.co.uk/home.html>
> 
> 
> <http://www.avg.com/email-signature?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=emailclient>	Virus-free.www.avg.com <http://www.avg.com/email-signature?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=emailclient>
> 
> <#DAB4FAD8-2DD7-40BB-A1B8-4E2AA1F9FDF2>

-- 
Michael
http://www.dewey.myzen.co.uk/home.html


From m@k@hho||y @end|ng |rom gm@||@com  Mon Oct 24 19:24:28 2022
From: m@k@hho||y @end|ng |rom gm@||@com (greg holly)
Date: Mon, 24 Oct 2022 12:24:28 -0500
Subject: [R] Sensitivity and Specificity
In-Reply-To: <e05b3b03-cf0e-28df-526b-9db792d4f90e@dewey.myzen.co.uk>
References: <CAM9Qe4im3XyAvSaDSAq94z+uwwKTwi2Tthr9ExoxLs+NvLPVOA@mail.gmail.com>
 <c2a8b39f-7daa-6844-4d77-b4b4932061bb@dewey.myzen.co.uk>
 <CAM9Qe4jMAexXVpefekGDvoD4__WDEmnjAEbZ9mRdMjqPMfZ_tQ@mail.gmail.com>
 <e05b3b03-cf0e-28df-526b-9db792d4f90e@dewey.myzen.co.uk>
Message-ID: <CAM9Qe4gddAUG6Br2k8b5bq52vf2xwX8sKLiJ3NKxTVqx+TX3_w@mail.gmail.com>

THanks Michael for this.This is much appreciated. So, how can I estimate
the sensitivity and  specificity after having the prediction on testing
data. Any thoughts?

Kind regards,
Greg



On Mon, Oct 24, 2022 at 12:10 PM Michael Dewey <lists at dewey.myzen.co.uk>
wrote:

> So predict is a one-dimensional vector of predictions but you are
> treating it as a two-dimensional matrix (presumably you think those are
> the totals).
>
> Michael
>
> On 24/10/2022 16:50, greg holly wrote:
> > Hi Michael,
> >
> > I appreciate your writing. Here are what I have after;
> >
> >  > predict_testing <- ifelse(predict > 0.5,1,0)
> >  >
> >  > head(predict)
> >           1          2          3          5          7          8
> > 0.29006984 0.28370507 0.10761993 0.02204224 0.12873872 0.08127920
> >  >
> >  > # Sensitivity and Specificity
> >  >
> >  >
> >
> sensitivity<-(predict_testing[2,2]/(predict_testing[2,2]+predict_testing[2,1]))*100
> > Error in predict_testing[2, 2] : incorrect number of dimensions
> >  > sensitivity
> > function (data, ...)
> > {
> >      UseMethod("sensitivity")
> > }
> > <bytecode: 0x000002082a2f01d8>
> > <environment: namespace:caret>
> >  >
> >  >
> >
> specificity<-(predict_testing[1,1]/(predict_testing[1,1]+predict_testing[1,2]))*100
> > Error in predict_testing[1, 1] : incorrect number of dimensions
> >  > specificity
> > function (data, ...)
> > {
> >      UseMethod("specificity")
> > }
> > <bytecode: 0x000002082a2fa600>
> > <environment: namespace:caret>
> >
> > On Mon, Oct 24, 2022 at 10:45 AM Michael Dewey <lists at dewey.myzen.co.uk
> > <mailto:lists at dewey.myzen.co.uk>> wrote:
> >
> >     Rather hard to know without seeing what output you expected and what
> >     error message you got if any but did you mean to summarise your
> >     variable
> >     predict before doing anything with it?
> >
> >     Michael
> >
> >     On 24/10/2022 16:17, greg holly wrote:
> >      > Hi all R-Help ,
> >      >
> >      > After partitioning my data to testing and training (please see
> >     below), I
> >      > need to estimate the Sensitivity and Specificity. I failed. It
> >     would be
> >      > appropriate to get your help.
> >      >
> >      > Best regards,
> >      > Greg
> >      >
> >      >
> >      > inTrain <- createDataPartition(y=data$case,
> >      >                                 p=0.7,
> >      >                                 list=FALSE)
> >      > training <- data[ inTrain,]
> >      > testing  <- data[-inTrain,]
> >      >
> >      > attach(training)
> >      > #model training and prediction
> >      > data_training <- glm(case ~ age+BMI+Calcium+Albumin+meno_1, data =
> >      > training, family = binomial(link="logit"))
> >      >
> >      > predict <- predict(data_training, data_predict = testing, type =
> >     "response")
> >      >
> >      > predict_testing <- ifelse(predict > 0.5,1,0)
> >      >
> >      > # Sensitivity and Specificity
> >      >
> >      >
> >
>  sensitivity<-(predict_testing[2,2]/(predict_testing[2,2]+predict_testing[2,1]))*100
> >      >   sensitivity
> >      >
> >      >
> >
>  specificity<-(predict_testing[1,1]/(predict_testing[1,1]+predict_testing[1,2]))*100
> >      >   specificity
> >      >
> >      >       [[alternative HTML version deleted]]
> >      >
> >      > ______________________________________________
> >      > R-help at r-project.org <mailto:R-help at r-project.org> mailing list
> >     -- To UNSUBSCRIBE and more, see
> >      > https://stat.ethz.ch/mailman/listinfo/r-help
> >     <https://stat.ethz.ch/mailman/listinfo/r-help>
> >      > PLEASE do read the posting guide
> >     http://www.R-project.org/posting-guide.html
> >     <http://www.R-project.org/posting-guide.html>
> >      > and provide commented, minimal, self-contained, reproducible code.
> >      >
> >
> >     --
> >     Michael
> >     http://www.dewey.myzen.co.uk/home.html
> >     <http://www.dewey.myzen.co.uk/home.html>
> >
> >
> > <
> http://www.avg.com/email-signature?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=emailclient>
> Virus-free.www.avg.com <
> http://www.avg.com/email-signature?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=emailclient
> >
> >
> > <#DAB4FAD8-2DD7-40BB-A1B8-4E2AA1F9FDF2>
>
> --
> Michael
> http://www.dewey.myzen.co.uk/home.html
>

	[[alternative HTML version deleted]]


From kt1572757 @end|ng |rom gm@||@com  Mon Oct 24 19:50:15 2022
From: kt1572757 @end|ng |rom gm@||@com (Kelly Thompson)
Date: Mon, 24 Oct 2022 13:50:15 -0400
Subject: [R] When using require(),
 why do I get the error message "Error in if (!loaded) { : the
 condition has length > 1" ?
In-Reply-To: <CAPcHnpTZNEb66TgZYGHmenvT_O9uXpCQqn6MQLCXrNNdA41Ukg@mail.gmail.com>
References: <CAHfBD2frpoHQ04bH5vGz8a_Fn2v1q1=i33doUkaqH5pk=5bevQ@mail.gmail.com>
 <CAPcHnpSM=jYg+16mguamJv+foZuv_D_9mCrtB_uYk6n3wqf7Qg@mail.gmail.com>
 <CAHfBD2ckw+RK=9iiw68L0nMmr9E4w3-Od_Ep5PqYmi+oRDtHqg@mail.gmail.com>
 <CAPcHnpTZNEb66TgZYGHmenvT_O9uXpCQqn6MQLCXrNNdA41Ukg@mail.gmail.com>
Message-ID: <CAHfBD2egZX8gutQ681mcnC40Q64Y3tSjr3xrneNZ4VEV9jnXRg@mail.gmail.com>

Andrew,
Thanks. I reviewed the code for "require" and saw:
"if (!character.only)
        package <- as.character(substitute(package))"

#This helps me better understand what is going on. I am sharing this
here because I think it might help others understand.
as.character( substitute("this_pac_does_not_exist") ) #quoted

as.character( substitute( this_pac_does_not_exist ) ) #not quoted

as.character( substitute("this_pac_does_not_exist") ) == as.character(
substitute( this_pac_does_not_exist ) )

#####

packages_i_want_to_use <- c("this_pac_does_not_exist", "abcz")
as.character( substitute(packages_i_want_to_use[1] ) )
packages_i_want_to_use[1]
as.character( substitute(packages_i_want_to_use[1] ) ) ==
packages_i_want_to_use[1]

#To prevent substitute(packages_i_want_to_use[1] from getting changed
to as.character( substitute(packages_i_want_to_use[1] ) ), we need to
set character.only = TRUE

On Mon, Oct 24, 2022 at 12:53 PM Andrew Simmons <akwsimmo at gmail.com> wrote:
>
> In the first one, the argument is a character vector of length 1, so the code works perfectly fine.
>
> The second is a call, and when coerced to a character vector should look like
>
> c("[", "packages_i_want_to_use", "1")
>
> You can try this yourself with quote(packages_i_want_to_use[1]) which returns its first argument, unevaluated.
>
> On Mon, Oct 24, 2022, 12:46 Kelly Thompson <kt1572757 at gmail.com> wrote:
>>
>> Thanks!
>>
>> # Please, can you help me understand why
>> require( 'base' ) # works, but
>> require( packages_i_want_to_use[1] ) # does not work?
>>
>> # In require( 'base' ), what is the "first argument"?
>>
>> On Mon, Oct 24, 2022 at 12:29 PM Andrew Simmons <akwsimmo at gmail.com> wrote:
>> >
>> > require(), similarly to library(), does not evaluate its first argument UNLESS you add character.only = TRUE
>> >
>> > require( packages_i_want_to_use[1], character.only = TRUE)
>> >
>> >
>> > On Mon, Oct 24, 2022, 12:26 Kelly Thompson <kt1572757 at gmail.com> wrote:
>> >>
>> >> # Below, when using require(), why do I get the error message "Error
>> >> in if (!loaded) { : the condition has length > 1" ?
>> >>
>> >> # This is my reproducible code:
>> >>
>> >> #create a vector with the names of the packages I want to use
>> >> packages_i_want_to_use <- c('base', 'this_pac_does_not_exist')
>> >>
>> >> # Here I get error messages:
>> >> require( packages_i_want_to_use[1] )
>> >> #Error in if (!loaded) { : the condition has length > 1
>> >>
>> >> require( packages_i_want_to_use[2] )
>> >> #Error in if (!loaded) { : the condition has length > 1
>> >>
>> >> # Here I get what I expect:
>> >> require('base')
>> >>
>> >> require('this_pac_does_not_exist')
>> >> #Loading required package: this_pac_does_not_exist
>> >> #Warning message:
>> >> #In library(package, lib.loc = lib.loc, character.only = TRUE,
>> >> logical.return = TRUE,  :
>> >> #  there is no package called ?this_pac_does_not_exist?
>> >>
>> >> ______________________________________________
>> >> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> >> https://stat.ethz.ch/mailman/listinfo/r-help
>> >> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>> >> and provide commented, minimal, self-contained, reproducible code.
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Mon Oct 24 21:01:10 2022
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Mon, 24 Oct 2022 20:01:10 +0100
Subject: [R] Sensitivity and Specificity
In-Reply-To: <CAM9Qe4jMAexXVpefekGDvoD4__WDEmnjAEbZ9mRdMjqPMfZ_tQ@mail.gmail.com>
References: <CAM9Qe4im3XyAvSaDSAq94z+uwwKTwi2Tthr9ExoxLs+NvLPVOA@mail.gmail.com>
 <c2a8b39f-7daa-6844-4d77-b4b4932061bb@dewey.myzen.co.uk>
 <CAM9Qe4jMAexXVpefekGDvoD4__WDEmnjAEbZ9mRdMjqPMfZ_tQ@mail.gmail.com>
Message-ID: <53214662-aa8f-1d29-e9bd-fd19cd281342@sapo.pt>

?s 16:50 de 24/10/2022, greg holly escreveu:
> Hi Michael,
> 
> I appreciate your writing. Here are what I have after;
> 
>> predict_testing <- ifelse(predict > 0.5,1,0)
>>
>> head(predict)
>           1          2          3          5          7          8
> 0.29006984 0.28370507 0.10761993 0.02204224 0.12873872 0.08127920
>>
>> # Sensitivity and Specificity
>>
>>
> sensitivity<-(predict_testing[2,2]/(predict_testing[2,2]+predict_testing[2,1]))*100
> Error in predict_testing[2, 2] : incorrect number of dimensions
>> sensitivity
> function (data, ...)
> {
>      UseMethod("sensitivity")
> }
> <bytecode: 0x000002082a2f01d8>
> <environment: namespace:caret>
>>
>>
> specificity<-(predict_testing[1,1]/(predict_testing[1,1]+predict_testing[1,2]))*100
> Error in predict_testing[1, 1] : incorrect number of dimensions
>> specificity
> function (data, ...)
> {
>      UseMethod("specificity")
> }
> <bytecode: 0x000002082a2fa600>
> <environment: namespace:caret>
> 
> On Mon, Oct 24, 2022 at 10:45 AM Michael Dewey <lists at dewey.myzen.co.uk>
> wrote:
> 
>> Rather hard to know without seeing what output you expected and what
>> error message you got if any but did you mean to summarise your variable
>> predict before doing anything with it?
>>
>> Michael
>>
>> On 24/10/2022 16:17, greg holly wrote:
>>> Hi all R-Help ,
>>>
>>> After partitioning my data to testing and training (please see below), I
>>> need to estimate the Sensitivity and Specificity. I failed. It would be
>>> appropriate to get your help.
>>>
>>> Best regards,
>>> Greg
>>>
>>>
>>> inTrain <- createDataPartition(y=data$case,
>>>                                  p=0.7,
>>>                                  list=FALSE)
>>> training <- data[ inTrain,]
>>> testing  <- data[-inTrain,]
>>>
>>> attach(training)
>>> #model training and prediction
>>> data_training <- glm(case ~ age+BMI+Calcium+Albumin+meno_1, data =
>>> training, family = binomial(link="logit"))
>>>
>>> predict <- predict(data_training, data_predict = testing, type =
>> "response")
>>>
>>> predict_testing <- ifelse(predict > 0.5,1,0)
>>>
>>> # Sensitivity and Specificity
>>>
>>>
>>   sensitivity<-(predict_testing[2,2]/(predict_testing[2,2]+predict_testing[2,1]))*100
>>>    sensitivity
>>>
>>>
>>   specificity<-(predict_testing[1,1]/(predict_testing[1,1]+predict_testing[1,2]))*100
>>>    specificity
>>>
>>>        [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>> PLEASE do read the posting guide
>> http://www.R-project.org/posting-guide.html
>>> and provide commented, minimal, self-contained, reproducible code.
>>>
>>
>> --
>> Michael
>> http://www.dewey.myzen.co.uk/home.html
>>
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.

Hello,

Instead of computing by hand, why not use package caret?


tbl <- table(predict_testing, testing$case)
caret::sensitivity(tbl)
caret::specificity(tbl)


Hope this helps,

Rui Barradas


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Mon Oct 24 21:23:16 2022
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Mon, 24 Oct 2022 20:23:16 +0100
Subject: [R] cannot print a list with cat
In-Reply-To: <1ad3cf97-932a-c2aa-bb74-0c2bb98908d3@ntu.edu.tw>
References: <051fa517-2df1-9a6c-004e-831f7c9f4c3b@ntu.edu.tw>
 <20221024154752.05440ffc@arachnoid>
 <15AC3F65-6D12-44D1-AE3F-F6C6DA9D36E1@utoronto.ca>
 <cc79988d-74fe-ec9e-d3c2-884608deaf9a@ntu.edu.tw>
 <726dbddf-3a15-0293-5e9a-6bfaf6605979@sapo.pt>
 <1ad3cf97-932a-c2aa-bb74-0c2bb98908d3@ntu.edu.tw>
Message-ID: <858f772a-40ce-3462-2922-d6c79d729246@sapo.pt>

?s 16:21 de 24/10/2022, Steven T. Yen escreveu:
> Thanks to everyone. I read ? sprint and the following is best I came up 
> with. If there are ways to collapse the lines I'd be glad to know. 
> Otherwise, I will live with this. Thanks again.
> 
> cat(sprintf("\ntol???? = %e",mycontrol$tol),
>  ??? sprintf("\nreltol? = %e",mycontrol$reltol),
>  ??? sprintf("\nsteptol = %e",mycontrol$steptol),
>  ??? sprintf("\ngradtol = %e",mycontrol$gradtol))
> 
> tol???? = 0.000000e+00
> reltol? = 0.000000e+00
> steptol = 1.000000e-08
> gradtol = 1.000000e-10
> 
> On 10/24/2022 10:02 PM, Rui Barradas wrote:
>> Hello,
>>
>> There's also ?message.
>>
>>
>> msg <- sprintf("(tol,reltol,steptol,gradtol): %E %E %E %E",
>>
>> mycontrol$tol,mycontrol$reltol,mycontrol$steptol,mycontrol$gradtol)
>> message(msg)
>>
>>
>> Hope this helps,
>>
>> Rui Barradas
>>
>> ?s 14:25 de 24/10/2022, Steven T. Yen escreveu:
>>> Thank, Boris and Ivan.
>>>
>>> The simple command suggested by Ivan ( print(t(mycontrol)) ) worked. 
>>> I went along with Boris' suggestion and do/get the following:
>>>
>>> cat(sprintf("(tol,reltol,steptol,gradtol): %E %E %E %E",mycontrol$tol,
>>> mycontrol$reltol,mycontrol$steptol,mycontrol$gradtol))
>>>
>>> (tol,reltol,steptol,gradtol): 0.000000E+00 0.000000E+00 1.000000E-08 
>>> 1.000000E-12
>>>
>>> This works great. Thanks.
>>>
>>> Steven
>>>
>>> On 10/24/2022 9:05 PM, Boris Steipe wrote:
>>>
>>>> ???? t() is the transpose function. It just happens to return your 
>>>> list unchanged. The return value is then printed to console if it is 
>>>> not assigned, or returned invisibly. Transposing your list is 
>>>> probably not what you wanted to do.
>>>>
>>>> Returned values do not get printed from within a loop or from a 
>>>> source()'d script. That's why it "works" interactively, but not from 
>>>> a script file.
>>>>
>>>> If you want to print the contents of your list, just use:
>>>> ?? print(mycontrol)
>>>>
>>>> Or use some incantation with sprintf() if you want more control 
>>>> about the format of what gets printed. Eg:
>>>>
>>>> ? cat(sprintf("Tolerance: %f (%f %%)", mycontrol$tol, 
>>>> mycontrol$reltol))
>>>>
>>>> etc.
>>>>
>>>>
>>>> B.
>>>>
>>>>
>>>>
>>>>> On 2022-10-24, at 08:47, Ivan Krylov <krylov.r00t at gmail.com> wrote:
>>>>>
>>>>> ? Mon, 24 Oct 2022 20:39:33 +0800
>>>>> "Steven T. Yen" <styen at ntu.edu.tw> ?????:
>>>>>
>>>>>> Printing this in a main program causes no problem (as shown above).
>>>>>> But, using the command t(mycontrol) the line gets ignored.
>>>>> t() doesn't print, it returns a value. In R, there's auto-printing in
>>>>> the toplevel context (see ?withAutoprint), but not when you move away
>>>>> from the interactive prompt. I think that it should be possible to use
>>>>> an explicit print(t(mycontrol)) to get the behaviour you desire.
>>>>>
>>>>> -- 
>>>>> Best regards,
>>>>> Ivan
>>>>>
>>>>> ______________________________________________
>>>>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>>>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>>>> PLEASE do read the posting guide 
>>>>> http://www.R-project.org/posting-guide.html
>>>>> and provide commented, minimal, self-contained, reproducible code.
>>>
>>> ______________________________________________
>>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>> PLEASE do read the posting guide 
>>> http://www.R-project.org/posting-guide.html
>>> and provide commented, minimal, self-contained, reproducible code.

Hello,

Here is a way. I leave it in may code lines to make it more 
understandale, I hope.


# From Spencer's post
(mycontrol <- list(tol=0, reltol=0, steptol=1e-8, gradtol=1e-12))
#> $tol
#> [1] 0
#>
#> $reltol
#> [1] 0
#>
#> $steptol
#> [1] 1e-08
#>
#> $gradtol
#> [1] 1e-12

fmt_string <- paste0(
   "\ntol     = %e",
   "\nreltol  = %e",
   "\nsteptol = %e",
   "\ngradtol = %e"
)

msg <- sprintf(fmt_string, mycontrol$tol, mycontrol$reltol, 
mycontrol$steptol, mycontrol$gradtol)

msg
#> [1] "\ntol     = 0.000000e+00\nreltol  = 0.000000e+00\nsteptol = 
1.000000e-08\ngradtol = 1.000000e-12"

cat(msg)
#>
#> tol     = 0.000000e+00
#> reltol  = 0.000000e+00
#> steptol = 1.000000e-08
#> gradtol = 1.000000e-12

message(msg)
#>
#> tol     = 0.000000e+00
#> reltol  = 0.000000e+00
#> steptol = 1.000000e-08
#> gradtol = 1.000000e-12


You also can write the format string all in a row.


msg2 <- with(mycontrol, sprintf("\ntol     = %e\nreltol  = %e\nsteptol = 
%e\ngradtol = %e", tol, reltol, steptol, gradtol))
cat(msg2)
#>
#> tol     = 0.000000e+00
#> reltol  = 0.000000e+00
#> steptol = 1.000000e-08
#> gradtol = 1.000000e-12


Hope this helps,

Rui Barradas


From @tyen @end|ng |rom ntu@edu@tw  Tue Oct 25 04:50:57 2022
From: @tyen @end|ng |rom ntu@edu@tw (Steven T. Yen)
Date: Tue, 25 Oct 2022 10:50:57 +0800
Subject: [R] cannot print a list with cat
In-Reply-To: <858f772a-40ce-3462-2922-d6c79d729246@sapo.pt>
References: <051fa517-2df1-9a6c-004e-831f7c9f4c3b@ntu.edu.tw>
 <20221024154752.05440ffc@arachnoid>
 <15AC3F65-6D12-44D1-AE3F-F6C6DA9D36E1@utoronto.ca>
 <cc79988d-74fe-ec9e-d3c2-884608deaf9a@ntu.edu.tw>
 <726dbddf-3a15-0293-5e9a-6bfaf6605979@sapo.pt>
 <1ad3cf97-932a-c2aa-bb74-0c2bb98908d3@ntu.edu.tw>
 <858f772a-40ce-3462-2922-d6c79d729246@sapo.pt>
Message-ID: <0b544503-d654-684e-012d-6968c2e77c95@ntu.edu.tw>

Thanks to all, who have helped greatly. I essentially followed Rui to do:

 ? fmt_string<-paste0("\ntol???? = %.1e","\nreltol? = %.1e","\nsteptol = 
%.1e","\ngradtol = %.1e")
#msg<-sprintf(fmt_string,mycontrol$tol,mycontrol$reltol,mycontrol$steptol,mycontrol$gradtol) 
#works
msg<-with(mycontrol,sprintf(fmt_string,tol,reltol,steptol,gradtol))
 ? cat(msg)

tol???? = 0.0e+00
reltol? = 0.0e+00
steptol = 1.0e-08
gradtol = 1.0e-10

Thids has worked great! Thanks again to all.

Steven Yen

On 10/25/2022 3:23 AM, Rui Barradas wrote:
> ?s 16:21 de 24/10/2022, Steven T. Yen escreveu:
>> Thanks to everyone. I read ? sprint and the following is best I came 
>> up with. If there are ways to collapse the lines I'd be glad to know. 
>> Otherwise, I will live with this. Thanks again.
>>
>> cat(sprintf("\ntol???? = %e",mycontrol$tol),
>> ???? sprintf("\nreltol? = %e",mycontrol$reltol),
>> ???? sprintf("\nsteptol = %e",mycontrol$steptol),
>> ???? sprintf("\ngradtol = %e",mycontrol$gradtol))
>>
>> tol???? = 0.000000e+00
>> reltol? = 0.000000e+00
>> steptol = 1.000000e-08
>> gradtol = 1.000000e-10
>>
>> On 10/24/2022 10:02 PM, Rui Barradas wrote:
>>> Hello,
>>>
>>> There's also ?message.
>>>
>>>
>>> msg <- sprintf("(tol,reltol,steptol,gradtol): %E %E %E %E",
>>>
>>> mycontrol$tol,mycontrol$reltol,mycontrol$steptol,mycontrol$gradtol)
>>> message(msg)
>>>
>>>
>>> Hope this helps,
>>>
>>> Rui Barradas
>>>
>>> ?s 14:25 de 24/10/2022, Steven T. Yen escreveu:
>>>> Thank, Boris and Ivan.
>>>>
>>>> The simple command suggested by Ivan ( print(t(mycontrol)) ) 
>>>> worked. I went along with Boris' suggestion and do/get the following:
>>>>
>>>> cat(sprintf("(tol,reltol,steptol,gradtol): %E %E %E %E",mycontrol$tol,
>>>> mycontrol$reltol,mycontrol$steptol,mycontrol$gradtol))
>>>>
>>>> (tol,reltol,steptol,gradtol): 0.000000E+00 0.000000E+00 
>>>> 1.000000E-08 1.000000E-12
>>>>
>>>> This works great. Thanks.
>>>>
>>>> Steven
>>>>
>>>> On 10/24/2022 9:05 PM, Boris Steipe wrote:
>>>>
>>>>> ???? t() is the transpose function. It just happens to return your 
>>>>> list unchanged. The return value is then printed to console if it 
>>>>> is not assigned, or returned invisibly. Transposing your list is 
>>>>> probably not what you wanted to do.
>>>>>
>>>>> Returned values do not get printed from within a loop or from a 
>>>>> source()'d script. That's why it "works" interactively, but not 
>>>>> from a script file.
>>>>>
>>>>> If you want to print the contents of your list, just use:
>>>>> ?? print(mycontrol)
>>>>>
>>>>> Or use some incantation with sprintf() if you want more control 
>>>>> about the format of what gets printed. Eg:
>>>>>
>>>>> ? cat(sprintf("Tolerance: %f (%f %%)", mycontrol$tol, 
>>>>> mycontrol$reltol))
>>>>>
>>>>> etc.
>>>>>
>>>>>
>>>>> B.
>>>>>
>>>>>
>>>>>
>>>>>> On 2022-10-24, at 08:47, Ivan Krylov <krylov.r00t at gmail.com> wrote:
>>>>>>
>>>>>> ? Mon, 24 Oct 2022 20:39:33 +0800
>>>>>> "Steven T. Yen" <styen at ntu.edu.tw> ?????:
>>>>>>
>>>>>>> Printing this in a main program causes no problem (as shown above).
>>>>>>> But, using the command t(mycontrol) the line gets ignored.
>>>>>> t() doesn't print, it returns a value. In R, there's 
>>>>>> auto-printing in
>>>>>> the toplevel context (see ?withAutoprint), but not when you move 
>>>>>> away
>>>>>> from the interactive prompt. I think that it should be possible 
>>>>>> to use
>>>>>> an explicit print(t(mycontrol)) to get the behaviour you desire.
>>>>>>
>>>>>> -- 
>>>>>> Best regards,
>>>>>> Ivan
>>>>>>
>>>>>> ______________________________________________
>>>>>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>>>>> PLEASE do read the posting guide 
>>>>>> http://www.R-project.org/posting-guide.html
>>>>>> and provide commented, minimal, self-contained, reproducible code.
>>>>
>>>> ______________________________________________
>>>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>>> PLEASE do read the posting guide 
>>>> http://www.R-project.org/posting-guide.html
>>>> and provide commented, minimal, self-contained, reproducible code.
>
> Hello,
>
> Here is a way. I leave it in may code lines to make it more 
> understandale, I hope.
>
>
> # From Spencer's post
> (mycontrol <- list(tol=0, reltol=0, steptol=1e-8, gradtol=1e-12))
> #> $tol
> #> [1] 0
> #>
> #> $reltol
> #> [1] 0
> #>
> #> $steptol
> #> [1] 1e-08
> #>
> #> $gradtol
> #> [1] 1e-12
>
> fmt_string <- paste0(
> ? "\ntol???? = %e",
> ? "\nreltol? = %e",
> ? "\nsteptol = %e",
> ? "\ngradtol = %e"
> )
>
> msg <- sprintf(fmt_string, mycontrol$tol, mycontrol$reltol, 
> mycontrol$steptol, mycontrol$gradtol)
>
> msg
> #> [1] "\ntol???? = 0.000000e+00\nreltol? = 0.000000e+00\nsteptol = 
> 1.000000e-08\ngradtol = 1.000000e-12"
>
> cat(msg)
> #>
> #> tol???? = 0.000000e+00
> #> reltol? = 0.000000e+00
> #> steptol = 1.000000e-08
> #> gradtol = 1.000000e-12
>
> message(msg)
> #>
> #> tol???? = 0.000000e+00
> #> reltol? = 0.000000e+00
> #> steptol = 1.000000e-08
> #> gradtol = 1.000000e-12
>
>
> You also can write the format string all in a row.
>
>
> msg2 <- with(mycontrol, sprintf("\ntol???? = %e\nreltol? = %e\nsteptol 
> = %e\ngradtol = %e", tol, reltol, steptol, gradtol))
> cat(msg2)
> #>
> #> tol???? = 0.000000e+00
> #> reltol? = 0.000000e+00
> #> steptol = 1.000000e-08
> #> gradtol = 1.000000e-12
>
>
> Hope this helps,
>
> Rui Barradas
>


From j|n||68 @end|ng |rom gm@||@com  Tue Oct 25 06:42:42 2022
From: j|n||68 @end|ng |rom gm@||@com (Jin Li)
Date: Tue, 25 Oct 2022 15:42:42 +1100
Subject: [R] Sensitivity and Specificity
In-Reply-To: <53214662-aa8f-1d29-e9bd-fd19cd281342@sapo.pt>
References: <CAM9Qe4im3XyAvSaDSAq94z+uwwKTwi2Tthr9ExoxLs+NvLPVOA@mail.gmail.com>
 <c2a8b39f-7daa-6844-4d77-b4b4932061bb@dewey.myzen.co.uk>
 <CAM9Qe4jMAexXVpefekGDvoD4__WDEmnjAEbZ9mRdMjqPMfZ_tQ@mail.gmail.com>
 <53214662-aa8f-1d29-e9bd-fd19cd281342@sapo.pt>
Message-ID: <CAGu_3ZJsGCFRGLW3Dk6M+ewtN8a105cu49KnQwMxnePXRxH0Aw@mail.gmail.com>

Hi Greg,

This can be done by:
spm::pred.acc(testing$case,  predict_testing)

It will return both sensitivity and specificity, along with a few other
commonly used measures.

Hope this helps,
Jin

On Tue, Oct 25, 2022 at 6:01 AM Rui Barradas <ruipbarradas at sapo.pt> wrote:

> ?s 16:50 de 24/10/2022, greg holly escreveu:
> > Hi Michael,
> >
> > I appreciate your writing. Here are what I have after;
> >
> >> predict_testing <- ifelse(predict > 0.5,1,0)
> >>
> >> head(predict)
> >           1          2          3          5          7          8
> > 0.29006984 0.28370507 0.10761993 0.02204224 0.12873872 0.08127920
> >>
> >> # Sensitivity and Specificity
> >>
> >>
> >
> sensitivity<-(predict_testing[2,2]/(predict_testing[2,2]+predict_testing[2,1]))*100
> > Error in predict_testing[2, 2] : incorrect number of dimensions
> >> sensitivity
> > function (data, ...)
> > {
> >      UseMethod("sensitivity")
> > }
> > <bytecode: 0x000002082a2f01d8>
> > <environment: namespace:caret>
> >>
> >>
> >
> specificity<-(predict_testing[1,1]/(predict_testing[1,1]+predict_testing[1,2]))*100
> > Error in predict_testing[1, 1] : incorrect number of dimensions
> >> specificity
> > function (data, ...)
> > {
> >      UseMethod("specificity")
> > }
> > <bytecode: 0x000002082a2fa600>
> > <environment: namespace:caret>
> >
> > On Mon, Oct 24, 2022 at 10:45 AM Michael Dewey <lists at dewey.myzen.co.uk>
> > wrote:
> >
> >> Rather hard to know without seeing what output you expected and what
> >> error message you got if any but did you mean to summarise your variable
> >> predict before doing anything with it?
> >>
> >> Michael
> >>
> >> On 24/10/2022 16:17, greg holly wrote:
> >>> Hi all R-Help ,
> >>>
> >>> After partitioning my data to testing and training (please see below),
> I
> >>> need to estimate the Sensitivity and Specificity. I failed. It would be
> >>> appropriate to get your help.
> >>>
> >>> Best regards,
> >>> Greg
> >>>
> >>>
> >>> inTrain <- createDataPartition(y=data$case,
> >>>                                  p=0.7,
> >>>                                  list=FALSE)
> >>> training <- data[ inTrain,]
> >>> testing  <- data[-inTrain,]
> >>>
> >>> attach(training)
> >>> #model training and prediction
> >>> data_training <- glm(case ~ age+BMI+Calcium+Albumin+meno_1, data =
> >>> training, family = binomial(link="logit"))
> >>>
> >>> predict <- predict(data_training, data_predict = testing, type =
> >> "response")
> >>>
> >>> predict_testing <- ifelse(predict > 0.5,1,0)
> >>>
> >>> # Sensitivity and Specificity
> >>>
> >>>
> >>
>  sensitivity<-(predict_testing[2,2]/(predict_testing[2,2]+predict_testing[2,1]))*100
> >>>    sensitivity
> >>>
> >>>
> >>
>  specificity<-(predict_testing[1,1]/(predict_testing[1,1]+predict_testing[1,2]))*100
> >>>    specificity
> >>>
> >>>        [[alternative HTML version deleted]]
> >>>
> >>> ______________________________________________
> >>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> >>> https://stat.ethz.ch/mailman/listinfo/r-help
> >>> PLEASE do read the posting guide
> >> http://www.R-project.org/posting-guide.html
> >>> and provide commented, minimal, self-contained, reproducible code.
> >>>
> >>
> >> --
> >> Michael
> >> http://www.dewey.myzen.co.uk/home.html
> >>
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.
>
> Hello,
>
> Instead of computing by hand, why not use package caret?
>
>
> tbl <- table(predict_testing, testing$case)
> caret::sensitivity(tbl)
> caret::specificity(tbl)
>
>
> Hope this helps,
>
> Rui Barradas
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>


-- 
Jin
------------------------------------------
Jin Li, PhD
Founder, Data2action, Australia
https://www.researchgate.net/profile/Jin_Li32
https://scholar.google.com/citations?user=Jeot53EAAAAJ&hl=en

	[[alternative HTML version deleted]]


From M@tth|@@@Koh| @end|ng |rom @t@m@t@@de  Tue Oct 25 07:10:44 2022
From: M@tth|@@@Koh| @end|ng |rom @t@m@t@@de (Prof. Dr. Matthias Kohl)
Date: Tue, 25 Oct 2022 07:10:44 +0200
Subject: [R] Sensitivity and Specificity
In-Reply-To: <CAGu_3ZJsGCFRGLW3Dk6M+ewtN8a105cu49KnQwMxnePXRxH0Aw@mail.gmail.com>
References: <CAM9Qe4im3XyAvSaDSAq94z+uwwKTwi2Tthr9ExoxLs+NvLPVOA@mail.gmail.com>
 <c2a8b39f-7daa-6844-4d77-b4b4932061bb@dewey.myzen.co.uk>
 <CAM9Qe4jMAexXVpefekGDvoD4__WDEmnjAEbZ9mRdMjqPMfZ_tQ@mail.gmail.com>
 <53214662-aa8f-1d29-e9bd-fd19cd281342@sapo.pt>
 <CAGu_3ZJsGCFRGLW3Dk6M+ewtN8a105cu49KnQwMxnePXRxH0Aw@mail.gmail.com>
Message-ID: <f13d50b6-e705-264c-ae29-071041497592@stamats.de>

MKclass::perfMeasures(predict_testing, truth = testing$case, namePos = 1)

should also work and computes 80 performance measures.

Best Matthias

Am 25.10.22 um 06:42 schrieb Jin Li:
> Hi Greg,
> 
> This can be done by:
> spm::pred.acc(testing$case,  predict_testing)
> 
> It will return both sensitivity and specificity, along with a few other
> commonly used measures.
> 
> Hope this helps,
> Jin
> 
> On Tue, Oct 25, 2022 at 6:01 AM Rui Barradas <ruipbarradas at sapo.pt> wrote:
> 
>> ?s 16:50 de 24/10/2022, greg holly escreveu:
>>> Hi Michael,
>>>
>>> I appreciate your writing. Here are what I have after;
>>>
>>>> predict_testing <- ifelse(predict > 0.5,1,0)
>>>>
>>>> head(predict)
>>>            1          2          3          5          7          8
>>> 0.29006984 0.28370507 0.10761993 0.02204224 0.12873872 0.08127920
>>>>
>>>> # Sensitivity and Specificity
>>>>
>>>>
>>>
>> sensitivity<-(predict_testing[2,2]/(predict_testing[2,2]+predict_testing[2,1]))*100
>>> Error in predict_testing[2, 2] : incorrect number of dimensions
>>>> sensitivity
>>> function (data, ...)
>>> {
>>>       UseMethod("sensitivity")
>>> }
>>> <bytecode: 0x000002082a2f01d8>
>>> <environment: namespace:caret>
>>>>
>>>>
>>>
>> specificity<-(predict_testing[1,1]/(predict_testing[1,1]+predict_testing[1,2]))*100
>>> Error in predict_testing[1, 1] : incorrect number of dimensions
>>>> specificity
>>> function (data, ...)
>>> {
>>>       UseMethod("specificity")
>>> }
>>> <bytecode: 0x000002082a2fa600>
>>> <environment: namespace:caret>
>>>
>>> On Mon, Oct 24, 2022 at 10:45 AM Michael Dewey <lists at dewey.myzen.co.uk>
>>> wrote:
>>>
>>>> Rather hard to know without seeing what output you expected and what
>>>> error message you got if any but did you mean to summarise your variable
>>>> predict before doing anything with it?
>>>>
>>>> Michael
>>>>
>>>> On 24/10/2022 16:17, greg holly wrote:
>>>>> Hi all R-Help ,
>>>>>
>>>>> After partitioning my data to testing and training (please see below),
>> I
>>>>> need to estimate the Sensitivity and Specificity. I failed. It would be
>>>>> appropriate to get your help.
>>>>>
>>>>> Best regards,
>>>>> Greg
>>>>>
>>>>>
>>>>> inTrain <- createDataPartition(y=data$case,
>>>>>                                   p=0.7,
>>>>>                                   list=FALSE)
>>>>> training <- data[ inTrain,]
>>>>> testing  <- data[-inTrain,]
>>>>>
>>>>> attach(training)
>>>>> #model training and prediction
>>>>> data_training <- glm(case ~ age+BMI+Calcium+Albumin+meno_1, data =
>>>>> training, family = binomial(link="logit"))
>>>>>
>>>>> predict <- predict(data_training, data_predict = testing, type =
>>>> "response")
>>>>>
>>>>> predict_testing <- ifelse(predict > 0.5,1,0)
>>>>>
>>>>> # Sensitivity and Specificity
>>>>>
>>>>>
>>>>
>>   sensitivity<-(predict_testing[2,2]/(predict_testing[2,2]+predict_testing[2,1]))*100
>>>>>     sensitivity
>>>>>
>>>>>
>>>>
>>   specificity<-(predict_testing[1,1]/(predict_testing[1,1]+predict_testing[1,2]))*100
>>>>>     specificity
>>>>>
>>>>>         [[alternative HTML version deleted]]
>>>>>
>>>>> ______________________________________________
>>>>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>>>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>>>> PLEASE do read the posting guide
>>>> http://www.R-project.org/posting-guide.html
>>>>> and provide commented, minimal, self-contained, reproducible code.
>>>>>
>>>>
>>>> --
>>>> Michael
>>>> http://www.dewey.myzen.co.uk/home.html
>>>>
>>>
>>>        [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>> PLEASE do read the posting guide
>> http://www.R-project.org/posting-guide.html
>>> and provide commented, minimal, self-contained, reproducible code.
>>
>> Hello,
>>
>> Instead of computing by hand, why not use package caret?
>>
>>
>> tbl <- table(predict_testing, testing$case)
>> caret::sensitivity(tbl)
>> caret::specificity(tbl)
>>
>>
>> Hope this helps,
>>
>> Rui Barradas
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide
>> http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
>>
> 
> 

-- 
Prof. Dr. Matthias Kohl
www.stamats.de


From kt1572757 @end|ng |rom gm@||@com  Tue Oct 25 15:54:03 2022
From: kt1572757 @end|ng |rom gm@||@com (Kelly Thompson)
Date: Tue, 25 Oct 2022 09:54:03 -0400
Subject: [R] getting to a point where packages are installed and "ready to
 use", without unnecessarily reinstalling packages
Message-ID: <CAHfBD2cSEMLkt+nZNDs2iuav7oLsTOW1cbgNM5xQUJc+_M+LXw@mail.gmail.com>

I have R packages I want to use.

Q. What is the "best" way to get to a point where all of the packages
are installed and "ready to use", AND where I only install or
re-install a package if doing so is needed?

#I searched the web for insights and found these:
https://hohenfeld.is/posts/check-if-a-package-is-installed-in-r/
https://stackoverflow.com/questions/9341635/check-for-installed-packages-before-running-install-packages

Based on what I read there, I "think" I should use the require function.

Here is what I came up with.

Is there anything "wrong" with this code, and are there any ways I can
improve the code?

### START OF REPRODUCIBLE CODE

#install and load packages (list the packages I want in a vector,
check if they are available to use, install if needed, load and
attach, review)

#create a vector with the character vector of the name(s) of
package(s) I want to use
packages_i_want_to_use <- c('RODBC', 'data.table', 'matrixStats',
'plyr', 'MASS', 'dplyr', 'lubridate')
#packages_i_want_to_use <- c("this_pac_does_not_exist", "abcz", "lubridate")

#use the require function to check if the package(s) is (are) available
packages_exist_true_false <- sapply(X = packages_i_want_to_use, FUN =
require, character.only = TRUE, quietly = TRUE)

# create a vector with the names of the packages that need to be installed
packages_to_install <-
packages_i_want_to_use[packages_exist_true_false == FALSE]

#specify the repo(s) AKA CRAN mirror I want to use
myrepo <- 'https://ftp.osuosl.org/pub/cran/'

#install the package(s)
install.packages(pkgs = packages_to_install, repos = myrepo)

#load and attach the packages_i_want_to_use using the library function
sapply(X = packages_i_want_to_use, FUN = library, character.only = TRUE)

#review
#review to determine if the packages are available, using require()
packages_exist_true_false_review <- sapply(X = packages_i_want_to_use,
FUN = require, character.only = TRUE, quietly = TRUE)
packages_exist_true_false_review

### END OF REPRODUCIBLE CODE


From th|erry@onke||nx @end|ng |rom |nbo@be  Tue Oct 25 15:59:14 2022
From: th|erry@onke||nx @end|ng |rom |nbo@be (Thierry Onkelinx)
Date: Tue, 25 Oct 2022 15:59:14 +0200
Subject: [R] 
 getting to a point where packages are installed and "ready to
 use", without unnecessarily reinstalling packages
In-Reply-To: <CAHfBD2cSEMLkt+nZNDs2iuav7oLsTOW1cbgNM5xQUJc+_M+LXw@mail.gmail.com>
References: <CAHfBD2cSEMLkt+nZNDs2iuav7oLsTOW1cbgNM5xQUJc+_M+LXw@mail.gmail.com>
Message-ID: <CAJuCY5xoguGwaCyHmLQSQikYy4Uaxj9R8vqPECHTsJnLMrkZPg@mail.gmail.com>

Dear Kelly,

Have a look at the renv package (https://CRAN.R-project.org/package=renv).
Once setup, your code reduces to renv::restore()

Best regards,

ir. Thierry Onkelinx
Statisticus / Statistician

Vlaamse Overheid / Government of Flanders
INSTITUUT VOOR NATUUR- EN BOSONDERZOEK / RESEARCH INSTITUTE FOR NATURE AND
FOREST
Team Biometrie & Kwaliteitszorg / Team Biometrics & Quality Assurance
thierry.onkelinx at inbo.be
Havenlaan 88 bus 73, 1000 Brussel
www.inbo.be

///////////////////////////////////////////////////////////////////////////////////////////
To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey
///////////////////////////////////////////////////////////////////////////////////////////

<https://www.inbo.be>


Op di 25 okt. 2022 om 15:54 schreef Kelly Thompson <kt1572757 at gmail.com>:

> I have R packages I want to use.
>
> Q. What is the "best" way to get to a point where all of the packages
> are installed and "ready to use", AND where I only install or
> re-install a package if doing so is needed?
>
> #I searched the web for insights and found these:
> https://hohenfeld.is/posts/check-if-a-package-is-installed-in-r/
>
> https://stackoverflow.com/questions/9341635/check-for-installed-packages-before-running-install-packages
>
> Based on what I read there, I "think" I should use the require function.
>
> Here is what I came up with.
>
> Is there anything "wrong" with this code, and are there any ways I can
> improve the code?
>
> ### START OF REPRODUCIBLE CODE
>
> #install and load packages (list the packages I want in a vector,
> check if they are available to use, install if needed, load and
> attach, review)
>
> #create a vector with the character vector of the name(s) of
> package(s) I want to use
> packages_i_want_to_use <- c('RODBC', 'data.table', 'matrixStats',
> 'plyr', 'MASS', 'dplyr', 'lubridate')
> #packages_i_want_to_use <- c("this_pac_does_not_exist", "abcz",
> "lubridate")
>
> #use the require function to check if the package(s) is (are) available
> packages_exist_true_false <- sapply(X = packages_i_want_to_use, FUN =
> require, character.only = TRUE, quietly = TRUE)
>
> # create a vector with the names of the packages that need to be installed
> packages_to_install <-
> packages_i_want_to_use[packages_exist_true_false == FALSE]
>
> #specify the repo(s) AKA CRAN mirror I want to use
> myrepo <- 'https://ftp.osuosl.org/pub/cran/'
>
> #install the package(s)
> install.packages(pkgs = packages_to_install, repos = myrepo)
>
> #load and attach the packages_i_want_to_use using the library function
> sapply(X = packages_i_want_to_use, FUN = library, character.only = TRUE)
>
> #review
> #review to determine if the packages are available, using require()
> packages_exist_true_false_review <- sapply(X = packages_i_want_to_use,
> FUN = require, character.only = TRUE, quietly = TRUE)
> packages_exist_true_false_review
>
> ### END OF REPRODUCIBLE CODE
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From JH@rm@e @end|ng |rom roku@com  Tue Oct 25 17:06:27 2022
From: JH@rm@e @end|ng |rom roku@com (Jorgen Harmse)
Date: Tue, 25 Oct 2022 15:06:27 +0000
Subject: [R] [EXTERNAL] Re:  unexpected 'else' in " else" (Ebert,
 Timothy Aaron)
In-Reply-To: <CAGxFJbReuDQVYCzGONJD4CpJhqsGntn3o0+jpKoeewe53yd2Sg@mail.gmail.com>
References: <mailman.368082.1.1666432801.57482.r-help@r-project.org>
 <MW4PR01MB64651EF91E8B7D2ADDA87644DC2E9@MW4PR01MB6465.prod.exchangelabs.com>
 <CAGxFJbR-R8AFY-muYs2X_sJX2NVWKyEk6ydNwFtmnK7DzMiQTg@mail.gmail.com>
 <CAGxFJbReuDQVYCzGONJD4CpJhqsGntn3o0+jpKoeewe53yd2Sg@mail.gmail.com>
Message-ID: <MW4PR01MB64651E44A869908D567144EBDC2E9@MW4PR01MB6465.prod.exchangelabs.com>

Good catch! I also misread it, and I think most people would. If I wanted to write confusing documentation then I could play similar games with 'mode' and 'length'.

Regards,
Jorgen Harmse.



> test <- c(TRUE,FALSE,FALSE)

> attr(test,'class') <- 'foo' # probably a bad idea, but I want to see what will happen

> z <- ifelse(test, 1:3, 7:9)

> attr(z,'class')

[1] "foo"

> attr(z,'mode')

NULL

> attr(z,'length')

NULL




From: Bert Gunter <bgunter.4567 at gmail.com>
Date: Monday, 24October, 2022 at 12:07
To: Jorgen Harmse <JHarmse at roku.com>
Cc: r-help at r-project.org <r-help at r-project.org>
Subject: [EXTERNAL] Re: [R] unexpected 'else' in " else" (Ebert,Timothy Aaron)
I wanted to follow up.
A more careful reading of the following:
"A vector of the same length and attributes (including dimensions and
"class") as test..."

So the above **refers only to a "class" attribute that appears among
the attributes of test and result**. Using my previous example, note
that:

 z <- c(TRUE,TRUE,FALSE)
> attributes(z)
NULL ## so no 'class' among attributes(z)
## However
> class(z)  ## S3 class
[1] "logical"
## Similarly
> w <- ifelse(z,5,'a')
> attributes(w)
NULL ## so no 'class' among attributes(w)
> class(w)   ##S3 class
[1] "character"

So my (anyway) confusion stems from conflating the S3 'class' of the
object with a "class" attribute, of which there is none.

Nevertheless, I believe that the phrase I suggested (or something
along those lines) might clarify how the S3 class is determined and
perhaps better distinguish it from a "class" attribute among the
attributes, if there there is such. Or maybe that part of the doc
should just be removed.

My guess is that this documentation has been around for a long time
and no one has gotten around to revising it once S3 classes came into
wider use. ... or saw the need to revise it, anyway.

-- Bert




	[[alternative HTML version deleted]]


From e@g|ek2011 @end|ng |rom gm@||@com  Tue Oct 25 15:33:10 2022
From: e@g|ek2011 @end|ng |rom gm@||@com (ken eagle)
Date: Tue, 25 Oct 2022 08:33:10 -0500
Subject: [R] startup loading issue
Message-ID: <CAEtNUH=1YT1D_XZdNGF8rb0oLknOkcoajCF0yYKrbZXD_kO=Hw@mail.gmail.com>

I thought I was loading a ~300M binary (bigwig) file into another
application, but the window changed to the R GUI without my realizing it
and R tried to load the file.  I?m on a Mac M1-based laptop with system
12.5.1 and 8G of ram, running R 4.2.1 (Intel version).   According to
ActivityMonitor, R grabs ~45G (!) of memory before the system warns me that
it is out of application memory and I have to force quit R.  I have since
tried locating/moving/editing .Rprofile, .Rapp.history, or .RData files
with no impact.  Starting R from a Terminal session works fine but has no
impact on the problem.  I have tried restarting R, restarting the laptop,
and re-installing R, all with no change; on restarting R, it just starts
reloading the file it can?t handle (CtrlC and ESC don?t do anything). I
have changed the directory name of the offending file, and the filename
itself, without changing what happens upon starting R.  I?ve also created a
new .Rprofile that successfully executes but does not prevent the load
problem unless the .Rprofile includes a quit() command.

Any suggestions?

Ken

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Oct 25 12:28:33 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 25 Oct 2022 06:28:33 -0400
Subject: [R] Replace multiple subexpressions at once?
Message-ID: <347e4a75-f828-72a6-ac05-423f2760ca33@gmail.com>

An R regular expression pattern can contain parenthesized 
subexpressions, and those can be used later in the same pattern, or in 
the replacement in sub() and gsub().  What I'd like to do is match 
several subexpressions and replace all of them.

For example, I might have a string like

     s <- "<div data-pos=\"Untitled.knit.md at 12:1-13:1\">"

and I can use the regular expression

     regexp <- ".*<[^>]+ data-pos=\"([^\"]*)@([[:digit:]]+):.*"

to match the whole thing, with \\1 matching "Untitled.knit.md" and \\2 
matching "12".  I'd like to replace the first with "newname" and the 
second with "newnumber", so the string ends up looking like

     s <- "<div data-pos=\"newname at newnumber:1-13:1\">"

I could write a function to do this using regexec() and two calls to 
`substring<-`(), but I'm hoping someone has already done that.  Any 
suggestions?

Duncan Murdoch

P.S.  I'm going to be travelling for a couple of weeks, and so may not 
respond right away.


From w||||@mwdun|@p @end|ng |rom gm@||@com  Tue Oct 25 19:58:58 2022
From: w||||@mwdun|@p @end|ng |rom gm@||@com (Bill Dunlap)
Date: Tue, 25 Oct 2022 10:58:58 -0700
Subject: [R] Replace multiple subexpressions at once?
In-Reply-To: <347e4a75-f828-72a6-ac05-423f2760ca33@gmail.com>
References: <347e4a75-f828-72a6-ac05-423f2760ca33@gmail.com>
Message-ID: <CAHqSRuRrErqq4kaxgwnTdXouh24XQfaYvvcaUF1p7w6LD-yrCQ@mail.gmail.com>

There probably is a package with such a function, but you can do with one
call to sub() if you parenthesize all the subexpressions in the regular
expression and use \\1, etc., in the replacement for those parts you want
to keep.  E.g.,

> s <- "<div data-pos=\"Untitled.knit.md at 12:1-13:1\">"
> want <-  "<div data-pos=\"newname at newnumber:1-13:1\">"
> new_regexp <- "(.*<[^>]+ data-pos=\")([^\"]*)(@)([[:digit:]]+)(:.*)"
> all.equal( sub(new_regexp, "\\1newname\\3newnumber\\5", s), want)
[1] TRUE

-Bill


On Tue, Oct 25, 2022 at 10:12 AM Duncan Murdoch <murdoch.duncan at gmail.com>
wrote:

> An R regular expression pattern can contain parenthesized
> subexpressions, and those can be used later in the same pattern, or in
> the replacement in sub() and gsub().  What I'd like to do is match
> several subexpressions and replace all of them.
>
> For example, I might have a string like
>
>      s <- "<div data-pos=\"Untitled.knit.md at 12:1-13:1\">"
>
> and I can use the regular expression
>
>      regexp <- ".*<[^>]+ data-pos=\"([^\"]*)@([[:digit:]]+):.*"
>
> to match the whole thing, with \\1 matching "Untitled.knit.md" and \\2
> matching "12".  I'd like to replace the first with "newname" and the
> second with "newnumber", so the string ends up looking like
>
>      s <- "<div data-pos=\"newname at newnumber:1-13:1\">"
>
> I could write a function to do this using regexec() and two calls to
> `substring<-`(), but I'm hoping someone has already done that.  Any
> suggestions?
>
> Duncan Murdoch
>
> P.S.  I'm going to be travelling for a couple of weeks, and so may not
> respond right away.
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Tue Oct 25 20:25:35 2022
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Tue, 25 Oct 2022 11:25:35 -0700
Subject: [R] startup loading issue
In-Reply-To: <CAEtNUH=1YT1D_XZdNGF8rb0oLknOkcoajCF0yYKrbZXD_kO=Hw@mail.gmail.com>
References: <CAEtNUH=1YT1D_XZdNGF8rb0oLknOkcoajCF0yYKrbZXD_kO=Hw@mail.gmail.com>
Message-ID: <FD684CDA-B78D-4C39-BFCE-5A2A3CBCC373@dcn.davis.ca.us>

My bet would be a .RData file. They extract data from shared objects in memory but do not restore that data in shared objects, so there is a risk of memory requirements exploding.

If this is actually a problem specific to the Mac, you might want to ask on R-sig-mac.

On October 25, 2022 6:33:10 AM PDT, ken eagle <eaglek2011 at gmail.com> wrote:
>I thought I was loading a ~300M binary (bigwig) file into another
>application, but the window changed to the R GUI without my realizing it
>and R tried to load the file.  I?m on a Mac M1-based laptop with system
>12.5.1 and 8G of ram, running R 4.2.1 (Intel version).   According to
>ActivityMonitor, R grabs ~45G (!) of memory before the system warns me that
>it is out of application memory and I have to force quit R.  I have since
>tried locating/moving/editing .Rprofile, .Rapp.history, or .RData files
>with no impact.  Starting R from a Terminal session works fine but has no
>impact on the problem.  I have tried restarting R, restarting the laptop,
>and re-installing R, all with no change; on restarting R, it just starts
>reloading the file it can?t handle (CtrlC and ESC don?t do anything). I
>have changed the directory name of the offending file, and the filename
>itself, without changing what happens upon starting R.  I?ve also created a
>new .Rprofile that successfully executes but does not prevent the load
>problem unless the .Rprofile includes a quit() command.
>
>Any suggestions?
>
>Ken
>
>	[[alternative HTML version deleted]]
>
>______________________________________________
>R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>https://stat.ethz.ch/mailman/listinfo/r-help
>PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>and provide commented, minimal, self-contained, reproducible code.

-- 
Sent from my phone. Please excuse my brevity.


From m@k@hho||y @end|ng |rom gm@||@com  Tue Oct 25 20:29:12 2022
From: m@k@hho||y @end|ng |rom gm@||@com (greg holly)
Date: Tue, 25 Oct 2022 13:29:12 -0500
Subject: [R] Sensitivity and Specificity
In-Reply-To: <f13d50b6-e705-264c-ae29-071041497592@stamats.de>
References: <CAM9Qe4im3XyAvSaDSAq94z+uwwKTwi2Tthr9ExoxLs+NvLPVOA@mail.gmail.com>
 <c2a8b39f-7daa-6844-4d77-b4b4932061bb@dewey.myzen.co.uk>
 <CAM9Qe4jMAexXVpefekGDvoD4__WDEmnjAEbZ9mRdMjqPMfZ_tQ@mail.gmail.com>
 <53214662-aa8f-1d29-e9bd-fd19cd281342@sapo.pt>
 <CAGu_3ZJsGCFRGLW3Dk6M+ewtN8a105cu49KnQwMxnePXRxH0Aw@mail.gmail.com>
 <f13d50b6-e705-264c-ae29-071041497592@stamats.de>
Message-ID: <CAM9Qe4ihAC3Xnw0DxiNYQhXwY6E=cYtetj2HG6KyZTamaXOsWQ@mail.gmail.com>

Hi Micheal, Rui, Jin and Matthias,
I appreciate your time and help. The problem has been solved with your
guides.
Kind regards,
Greg.

On Tue, Oct 25, 2022 at 12:11 AM Prof. Dr. Matthias Kohl <
Matthias.Kohl at stamats.de> wrote:

> MKclass::perfMeasures(predict_testing, truth = testing$case, namePos = 1)
>
> should also work and computes 80 performance measures.
>
> Best Matthias
>
> Am 25.10.22 um 06:42 schrieb Jin Li:
> > Hi Greg,
> >
> > This can be done by:
> > spm::pred.acc(testing$case,  predict_testing)
> >
> > It will return both sensitivity and specificity, along with a few other
> > commonly used measures.
> >
> > Hope this helps,
> > Jin
> >
> > On Tue, Oct 25, 2022 at 6:01 AM Rui Barradas <ruipbarradas at sapo.pt>
> wrote:
> >
> >> ?s 16:50 de 24/10/2022, greg holly escreveu:
> >>> Hi Michael,
> >>>
> >>> I appreciate your writing. Here are what I have after;
> >>>
> >>>> predict_testing <- ifelse(predict > 0.5,1,0)
> >>>>
> >>>> head(predict)
> >>>            1          2          3          5          7          8
> >>> 0.29006984 0.28370507 0.10761993 0.02204224 0.12873872 0.08127920
> >>>>
> >>>> # Sensitivity and Specificity
> >>>>
> >>>>
> >>>
> >>
> sensitivity<-(predict_testing[2,2]/(predict_testing[2,2]+predict_testing[2,1]))*100
> >>> Error in predict_testing[2, 2] : incorrect number of dimensions
> >>>> sensitivity
> >>> function (data, ...)
> >>> {
> >>>       UseMethod("sensitivity")
> >>> }
> >>> <bytecode: 0x000002082a2f01d8>
> >>> <environment: namespace:caret>
> >>>>
> >>>>
> >>>
> >>
> specificity<-(predict_testing[1,1]/(predict_testing[1,1]+predict_testing[1,2]))*100
> >>> Error in predict_testing[1, 1] : incorrect number of dimensions
> >>>> specificity
> >>> function (data, ...)
> >>> {
> >>>       UseMethod("specificity")
> >>> }
> >>> <bytecode: 0x000002082a2fa600>
> >>> <environment: namespace:caret>
> >>>
> >>> On Mon, Oct 24, 2022 at 10:45 AM Michael Dewey <
> lists at dewey.myzen.co.uk>
> >>> wrote:
> >>>
> >>>> Rather hard to know without seeing what output you expected and what
> >>>> error message you got if any but did you mean to summarise your
> variable
> >>>> predict before doing anything with it?
> >>>>
> >>>> Michael
> >>>>
> >>>> On 24/10/2022 16:17, greg holly wrote:
> >>>>> Hi all R-Help ,
> >>>>>
> >>>>> After partitioning my data to testing and training (please see
> below),
> >> I
> >>>>> need to estimate the Sensitivity and Specificity. I failed. It would
> be
> >>>>> appropriate to get your help.
> >>>>>
> >>>>> Best regards,
> >>>>> Greg
> >>>>>
> >>>>>
> >>>>> inTrain <- createDataPartition(y=data$case,
> >>>>>                                   p=0.7,
> >>>>>                                   list=FALSE)
> >>>>> training <- data[ inTrain,]
> >>>>> testing  <- data[-inTrain,]
> >>>>>
> >>>>> attach(training)
> >>>>> #model training and prediction
> >>>>> data_training <- glm(case ~ age+BMI+Calcium+Albumin+meno_1, data =
> >>>>> training, family = binomial(link="logit"))
> >>>>>
> >>>>> predict <- predict(data_training, data_predict = testing, type =
> >>>> "response")
> >>>>>
> >>>>> predict_testing <- ifelse(predict > 0.5,1,0)
> >>>>>
> >>>>> # Sensitivity and Specificity
> >>>>>
> >>>>>
> >>>>
> >>
>  sensitivity<-(predict_testing[2,2]/(predict_testing[2,2]+predict_testing[2,1]))*100
> >>>>>     sensitivity
> >>>>>
> >>>>>
> >>>>
> >>
>  specificity<-(predict_testing[1,1]/(predict_testing[1,1]+predict_testing[1,2]))*100
> >>>>>     specificity
> >>>>>
> >>>>>         [[alternative HTML version deleted]]
> >>>>>
> >>>>> ______________________________________________
> >>>>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> >>>>> https://stat.ethz.ch/mailman/listinfo/r-help
> >>>>> PLEASE do read the posting guide
> >>>> http://www.R-project.org/posting-guide.html
> >>>>> and provide commented, minimal, self-contained, reproducible code.
> >>>>>
> >>>>
> >>>> --
> >>>> Michael
> >>>> http://www.dewey.myzen.co.uk/home.html
> >>>>
> >>>
> >>>        [[alternative HTML version deleted]]
> >>>
> >>> ______________________________________________
> >>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> >>> https://stat.ethz.ch/mailman/listinfo/r-help
> >>> PLEASE do read the posting guide
> >> http://www.R-project.org/posting-guide.html
> >>> and provide commented, minimal, self-contained, reproducible code.
> >>
> >> Hello,
> >>
> >> Instead of computing by hand, why not use package caret?
> >>
> >>
> >> tbl <- table(predict_testing, testing$case)
> >> caret::sensitivity(tbl)
> >> caret::specificity(tbl)
> >>
> >>
> >> Hope this helps,
> >>
> >> Rui Barradas
> >>
> >> ______________________________________________
> >> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> >> https://stat.ethz.ch/mailman/listinfo/r-help
> >> PLEASE do read the posting guide
> >> http://www.R-project.org/posting-guide.html
> >> and provide commented, minimal, self-contained, reproducible code.
> >>
> >
> >
>
> --
> Prof. Dr. Matthias Kohl
> www.stamats.de
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From jwd @end|ng |rom @urewe@t@net  Wed Oct 26 05:16:45 2022
From: jwd @end|ng |rom @urewe@t@net (John Dougherty)
Date: Tue, 25 Oct 2022 20:16:45 -0700
Subject: [R] startup loading issue
In-Reply-To: <CAEtNUH=1YT1D_XZdNGF8rb0oLknOkcoajCF0yYKrbZXD_kO=Hw@mail.gmail.com>
References: <CAEtNUH=1YT1D_XZdNGF8rb0oLknOkcoajCF0yYKrbZXD_kO=Hw@mail.gmail.com>
Message-ID: <20221025201645.4e30f9c9.jwd@surewest.net>

On Tue, 25 Oct 2022 08:33:10 -0500
ken eagle <eaglek2011 at gmail.com> wrote:

> I thought I was loading a ~300M binary (bigwig) file into another
> application . . .

Is the other application R dependent, written in R, or call R
capacities? If it doesn't, the issue might be with the "other
application rather than R.

JWDougherty


From r@oknz @end|ng |rom gm@||@com  Wed Oct 26 11:14:34 2022
From: r@oknz @end|ng |rom gm@||@com (Richard O'Keefe)
Date: Wed, 26 Oct 2022 22:14:34 +1300
Subject: [R] cannot print a list with cat
In-Reply-To: <1ad3cf97-932a-c2aa-bb74-0c2bb98908d3@ntu.edu.tw>
References: <051fa517-2df1-9a6c-004e-831f7c9f4c3b@ntu.edu.tw>
 <20221024154752.05440ffc@arachnoid>
 <15AC3F65-6D12-44D1-AE3F-F6C6DA9D36E1@utoronto.ca>
 <cc79988d-74fe-ec9e-d3c2-884608deaf9a@ntu.edu.tw>
 <726dbddf-3a15-0293-5e9a-6bfaf6605979@sapo.pt>
 <1ad3cf97-932a-c2aa-bb74-0c2bb98908d3@ntu.edu.tw>
Message-ID: <CABcYAdKJFR_5Gr9TDjHHMUt7dgVJAAK9DdjWBhjLdJ7QX-QMng@mail.gmail.com>

\n is for TERMINATING lines.  Just like in C, C++, Java,
C#, Python, Ruby, Erlang, pretty much everything that
uses \n in strings at all.

sprintf("gradtol = %e\n", mycontrol$gradtol)
makes sense.

More generally, sprintf() takes as many arguments as
you care to give it, so
cat(sprintf("tol = %e\nreltol = %e\nsteptol = %e\ngradtol = %e\n",
   mycontrol$tol, mycontrol$reltol, mycontrol$steptol,
   mycontrol$gradtol))

R being R, I'd prefer using ?format myself.

On Tue, 25 Oct 2022 at 04:29, Steven T. Yen <styen at ntu.edu.tw> wrote:

> Thanks to everyone. I read ? sprint and the following is best I came up
> with. If there are ways to collapse the lines I'd be glad to know.
> Otherwise, I will live with this. Thanks again.
>
> cat(sprintf("\ntol     = %e",mycontrol$tol),
>      sprintf("\nreltol  = %e",mycontrol$reltol),
>      sprintf("\nsteptol = %e",mycontrol$steptol),
>      sprintf("\ngradtol = %e",mycontrol$gradtol))
>
> tol     = 0.000000e+00
> reltol  = 0.000000e+00
> steptol = 1.000000e-08
> gradtol = 1.000000e-10
>
> On 10/24/2022 10:02 PM, Rui Barradas wrote:
> > Hello,
> >
> > There's also ?message.
> >
> >
> > msg <- sprintf("(tol,reltol,steptol,gradtol): %E %E %E %E",
> >
> > mycontrol$tol,mycontrol$reltol,mycontrol$steptol,mycontrol$gradtol)
> > message(msg)
> >
> >
> > Hope this helps,
> >
> > Rui Barradas
> >
> > ?s 14:25 de 24/10/2022, Steven T. Yen escreveu:
> >> Thank, Boris and Ivan.
> >>
> >> The simple command suggested by Ivan ( print(t(mycontrol)) ) worked.
> >> I went along with Boris' suggestion and do/get the following:
> >>
> >> cat(sprintf("(tol,reltol,steptol,gradtol): %E %E %E %E",mycontrol$tol,
> >> mycontrol$reltol,mycontrol$steptol,mycontrol$gradtol))
> >>
> >> (tol,reltol,steptol,gradtol): 0.000000E+00 0.000000E+00 1.000000E-08
> >> 1.000000E-12
> >>
> >> This works great. Thanks.
> >>
> >> Steven
> >>
> >> On 10/24/2022 9:05 PM, Boris Steipe wrote:
> >>
> >>> ???  t() is the transpose function. It just happens to return your
> >>> list unchanged. The return value is then printed to console if it is
> >>> not assigned, or returned invisibly. Transposing your list is
> >>> probably not what you wanted to do.
> >>>
> >>> Returned values do not get printed from within a loop or from a
> >>> source()'d script. That's why it "works" interactively, but not from
> >>> a script file.
> >>>
> >>> If you want to print the contents of your list, just use:
> >>>    print(mycontrol)
> >>>
> >>> Or use some incantation with sprintf() if you want more control
> >>> about the format of what gets printed. Eg:
> >>>
> >>>   cat(sprintf("Tolerance: %f (%f %%)", mycontrol$tol,
> >>> mycontrol$reltol))
> >>>
> >>> etc.
> >>>
> >>>
> >>> B.
> >>>
> >>>
> >>>
> >>>> On 2022-10-24, at 08:47, Ivan Krylov <krylov.r00t at gmail.com> wrote:
> >>>>
> >>>> ? Mon, 24 Oct 2022 20:39:33 +0800
> >>>> "Steven T. Yen" <styen at ntu.edu.tw> ?????:
> >>>>
> >>>>> Printing this in a main program causes no problem (as shown above).
> >>>>> But, using the command t(mycontrol) the line gets ignored.
> >>>> t() doesn't print, it returns a value. In R, there's auto-printing in
> >>>> the toplevel context (see ?withAutoprint), but not when you move away
> >>>> from the interactive prompt. I think that it should be possible to use
> >>>> an explicit print(t(mycontrol)) to get the behaviour you desire.
> >>>>
> >>>> --
> >>>> Best regards,
> >>>> Ivan
> >>>>
> >>>> ______________________________________________
> >>>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> >>>> https://stat.ethz.ch/mailman/listinfo/r-help
> >>>> PLEASE do read the posting guide
> >>>> http://www.R-project.org/posting-guide.html
> >>>> and provide commented, minimal, self-contained, reproducible code.
> >>
> >> ______________________________________________
> >> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> >> https://stat.ethz.ch/mailman/listinfo/r-help
> >> PLEASE do read the posting guide
> >> http://www.R-project.org/posting-guide.html
> >> and provide commented, minimal, self-contained, reproducible code.
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From r@oknz @end|ng |rom gm@||@com  Wed Oct 26 12:03:30 2022
From: r@oknz @end|ng |rom gm@||@com (Richard O'Keefe)
Date: Wed, 26 Oct 2022 23:03:30 +1300
Subject: [R] unexpected 'else' in " else"
In-Reply-To: <eee4b08c-0544-7f52-2934-4aaba9cd9ced@yeah.net>
References: <eee4b08c-0544-7f52-2934-4aaba9cd9ced@yeah.net>
Message-ID: <CABcYAd+=v6FvOqi7JjK7iR5RScVdDBGZK_BASQ-z0=k6TKEyYA@mail.gmail.com>

This is explained in books about S and R.
The first place to look is of course
> ?"if"
which says
<quote>
     Note that it is a common mistake to forget to put braces ('{ ..
     }') around your statements, e.g., after 'if(..)' or 'for(....)'.
     In particular, you should not have a newline between '}' and
     'else' to avoid a syntax error in entering a 'if ... else'
     construct at the keyboard or via 'source'.  For that reason, one
     (somewhat extreme) attitude of defensive programming is to always
     use braces, e.g., for 'if' clauses.
</quote>

The basic issue is that the top level wants to get started
on your command AS SOON AS IT HAS A COMPLETE COMMAND,
and if (...) stmt
is complete.  It's not going to hang around "Waiting for Godot"
for an 'else' that might never ever ever turn up.  So
   if (x < y) z <-
   x else z <- y
is absolutely fine, no braces needed, while
   if (x < y) z <- x
   else z <- y
will see the eager top level rush off to do your bidding
at the end of the first line and then be completely
baffled by an 'else' where it does not expect one.

It's the same reason that you break AFTER infix operators
instead of BEFORE.
   x <- y +
   z
works fine, while
   x <- y
   + z
doesn't.



On Fri, 21 Oct 2022 at 22:29, Jinsong Zhao <jszhao at yeah.net> wrote:

> Hi there,
>
> The following code would cause R error:
>
>  > w <- 1:5
>  > r <- 1:5
>  >         if (is.matrix(r))
> +             r[w != 0, , drop = FALSE]
>  >         else r[w != 0]
> Error: unexpected 'else' in "        else"
>
> However, the code:
>          if (is.matrix(r))
>              r[w != 0, , drop = FALSE]
>          else r[w != 0]
> is extracted from stats::weighted.residuals.
>
> My question is why the code in the function does not cause error?
>
> Best,
> Jinsong
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From p@u|bern@|07 @end|ng |rom gm@||@com  Wed Oct 26 15:41:34 2022
From: p@u|bern@|07 @end|ng |rom gm@||@com (Paul Bernal)
Date: Wed, 26 Oct 2022 08:41:34 -0500
Subject: [R] Function for Distribution Fitting
Message-ID: <CAMOcQfPYVC2uTg4N6dnYfwCaUHxkTfrOnN7kC5gpD+VbHKfXYQ@mail.gmail.com>

Dear friends from the R community,

Hope you are all doing great. So far, whenever I need to perform
distribution fitting on a particular dataset, I make use of R package
fitdistrplus.

However, distribution fitting using the fitdist() function from
fitdistrplus is rather manual (you need to specify which probability
distribution you are trying to fit), and it would be more convenient if the
function tested all possible probability distributions (or a bunch of them)
and then estimates the parameters and suggests the most suitable
distribution.

Is there any package besides fitdistrplus that does allow automatic
distribution fitting?

Best regards,
Paul

	[[alternative HTML version deleted]]


From jrg @end|ng |rom |oe@|@u@  Wed Oct 26 16:01:04 2022
From: jrg @end|ng |rom |oe@|@u@ (JRG)
Date: Wed, 26 Oct 2022 14:01:04 +0000
Subject: [R] Function for Distribution Fitting
In-Reply-To: <CAMOcQfPYVC2uTg4N6dnYfwCaUHxkTfrOnN7kC5gpD+VbHKfXYQ@mail.gmail.com>
References: <CAMOcQfPYVC2uTg4N6dnYfwCaUHxkTfrOnN7kC5gpD+VbHKfXYQ@mail.gmail.com>
Message-ID: <589f6a4f-9cd6-10aa-2ce9-4e2e1686016b@loesl.us>

"all possible probability distributions"

I doubt that is a finite set.  To select "a bunch of them" would seem to
imply a reduction of that set based on what's
possible/promising/pertinent in your specific problem.  IMHO, what's the
"most suitable distribution" tends to depend partly on knowledge of the
subject matter of your problem.

Doesn't that put you back in your present situation?



---JRG




On 10/26/22 09:41, Paul Bernal wrote:
> Dear friends from the R community,
>
> Hope you are all doing great. So far, whenever I need to perform
> distribution fitting on a particular dataset, I make use of R package
> fitdistrplus.
>
> However, distribution fitting using the fitdist() function from
> fitdistrplus is rather manual (you need to specify which probability
> distribution you are trying to fit), and it would be more convenient if the
> function tested all possible probability distributions (or a bunch of them)
> and then estimates the parameters and suggests the most suitable
> distribution.
>
> Is there any package besides fitdistrplus that does allow automatic
> distribution fitting?
>
> Best regards,
> Paul
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From bgunter@4567 @end|ng |rom gm@||@com  Wed Oct 26 16:32:57 2022
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Wed, 26 Oct 2022 07:32:57 -0700
Subject: [R] Function for Distribution Fitting
In-Reply-To: <589f6a4f-9cd6-10aa-2ce9-4e2e1686016b@loesl.us>
References: <CAMOcQfPYVC2uTg4N6dnYfwCaUHxkTfrOnN7kC5gpD+VbHKfXYQ@mail.gmail.com>
 <589f6a4f-9cd6-10aa-2ce9-4e2e1686016b@loesl.us>
Message-ID: <CAGxFJbTwtopUU6J4atF2FVHJ8D6iPYNZfT89BxN1ovgAg3QJVQ@mail.gmail.com>

Of course it's an infinite set!

The OP should look here:
https://cran.r-project.org/web/views/Distributions.html

-- Bert

On Wed, Oct 26, 2022 at 7:01 AM JRG via R-help <r-help at r-project.org> wrote:
>
> "all possible probability distributions"
>
> I doubt that is a finite set.  To select "a bunch of them" would seem to
> imply a reduction of that set based on what's
> possible/promising/pertinent in your specific problem.  IMHO, what's the
> "most suitable distribution" tends to depend partly on knowledge of the
> subject matter of your problem.
>
> Doesn't that put you back in your present situation?
>
>
>
> ---JRG
>
>
>
>
> On 10/26/22 09:41, Paul Bernal wrote:
> > Dear friends from the R community,
> >
> > Hope you are all doing great. So far, whenever I need to perform
> > distribution fitting on a particular dataset, I make use of R package
> > fitdistrplus.
> >
> > However, distribution fitting using the fitdist() function from
> > fitdistrplus is rather manual (you need to specify which probability
> > distribution you are trying to fit), and it would be more convenient if the
> > function tested all possible probability distributions (or a bunch of them)
> > and then estimates the parameters and suggests the most suitable
> > distribution.
> >
> > Is there any package besides fitdistrplus that does allow automatic
> > distribution fitting?
> >
> > Best regards,
> > Paul
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From ggrothend|eck @end|ng |rom gm@||@com  Wed Oct 26 17:02:24 2022
From: ggrothend|eck @end|ng |rom gm@||@com (Gabor Grothendieck)
Date: Wed, 26 Oct 2022 11:02:24 -0400
Subject: [R] Function for Distribution Fitting
In-Reply-To: <CAMOcQfPYVC2uTg4N6dnYfwCaUHxkTfrOnN7kC5gpD+VbHKfXYQ@mail.gmail.com>
References: <CAMOcQfPYVC2uTg4N6dnYfwCaUHxkTfrOnN7kC5gpD+VbHKfXYQ@mail.gmail.com>
Message-ID: <CAP01uRmWws5=m69xWWx_6NnjXtir5jczXn_FeiCB-nrn7pXhkQ@mail.gmail.com>

A Cullen & Frey graph (fitdistrplus::descdist) can be used to compare certain
common distributions.

On Wed, Oct 26, 2022 at 9:42 AM Paul Bernal <paulbernal07 at gmail.com> wrote:
>
> Dear friends from the R community,
>
> Hope you are all doing great. So far, whenever I need to perform
> distribution fitting on a particular dataset, I make use of R package
> fitdistrplus.
>
> However, distribution fitting using the fitdist() function from
> fitdistrplus is rather manual (you need to specify which probability
> distribution you are trying to fit), and it would be more convenient if the
> function tested all possible probability distributions (or a bunch of them)
> and then estimates the parameters and suggests the most suitable
> distribution.
>
> Is there any package besides fitdistrplus that does allow automatic
> distribution fitting?
>
> Best regards,
> Paul
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.



-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From gm@|om@ok|1980 @end|ng |rom gm@||@com  Wed Oct 26 18:51:40 2022
From: gm@|om@ok|1980 @end|ng |rom gm@||@com (=?UTF-8?Q?G=C3=A1bor_Malomsoki?=)
Date: Wed, 26 Oct 2022 18:51:40 +0200
Subject: [R] compile report error
Message-ID: <CAEJRAFb5kHC4VvfuC0vwiK_VjiGCMwhC4DtzRrkzqA_J5MUkTA@mail.gmail.com>

 Dear all,

Error in parse(text = x, keep.source = TRUE) :
  <text>:13:66: unexpected INCOMPLETE_STRING
12:
13: tomitettseg_GesNa$station_desc[tomitettseg_GesNa$station_desc ==
"Dichtheits.- Durchflusspr

i get this error message when i try to compile the report.
i think this is because of the punktuation mark between the quotation marks
"." .
i do not know how to solve this, because with this column name i got the
csv,  and i am changing the column name in the script, not to have it so
long and avoid characters like .   ?  :
 tomitettseg_GesNa$station_desc[tomitettseg_GesNa$station_desc ==
"Dichtheits.- Durchflusspr?fung M8.1"] <-"D_D_"
thanks

BR
Gabor

	[[alternative HTML version deleted]]


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Wed Oct 26 19:04:58 2022
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Wed, 26 Oct 2022 18:04:58 +0100
Subject: [R] compile report error
In-Reply-To: <CAEJRAFb5kHC4VvfuC0vwiK_VjiGCMwhC4DtzRrkzqA_J5MUkTA@mail.gmail.com>
References: <CAEJRAFb5kHC4VvfuC0vwiK_VjiGCMwhC4DtzRrkzqA_J5MUkTA@mail.gmail.com>
Message-ID: <a67121b7-d838-b2ac-117a-09b4a8ff0288@sapo.pt>

?s 17:51 de 26/10/2022, G?bor Malomsoki escreveu:
>   Dear all,
> 
> Error in parse(text = x, keep.source = TRUE) :
>    <text>:13:66: unexpected INCOMPLETE_STRING
> 12:
> 13: tomitettseg_GesNa$station_desc[tomitettseg_GesNa$station_desc ==
> "Dichtheits.- Durchflusspr
> 
> i get this error message when i try to compile the report.
> i think this is because of the punktuation mark between the quotation marks
> "." .
> i do not know how to solve this, because with this column name i got the
> csv,  and i am changing the column name in the script, not to have it so
> long and avoid characters like .   ?  :
>   tomitettseg_GesNa$station_desc[tomitettseg_GesNa$station_desc ==
> "Dichtheits.- Durchflusspr?fung M8.1"] <-"D_D_"
> thanks
> 
> BR
> Gabor
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.

Hello,

Can you post the output of dput(x)? Or of dput(x[10:15])?

Hope this helps,

Rui Barradas


From tebert @end|ng |rom u||@edu  Wed Oct 26 19:15:29 2022
From: tebert @end|ng |rom u||@edu (Ebert,Timothy Aaron)
Date: Wed, 26 Oct 2022 17:15:29 +0000
Subject: [R] Function for Distribution Fitting
In-Reply-To: <589f6a4f-9cd6-10aa-2ce9-4e2e1686016b@loesl.us>
References: <CAMOcQfPYVC2uTg4N6dnYfwCaUHxkTfrOnN7kC5gpD+VbHKfXYQ@mail.gmail.com>
 <589f6a4f-9cd6-10aa-2ce9-4e2e1686016b@loesl.us>
Message-ID: <BN6PR2201MB15535F383F033FF5E61BA31DCF309@BN6PR2201MB1553.namprd22.prod.outlook.com>

If you have three values, then it should be possible to fit any number of distributions such that they could return those three values. On the other hand, if you have billions of values and insist on a perfect fit then you may have a unique distribution only identified by the data in hand. For most purposes it is better to define the distribution based on your understanding of the numbers and how they were generated rather than trying to identify the distribution that best matches your data. I do not know your application for this. Here is a list of available functions in R:
https://cran.r-project.org/web/views/Distributions.html

I hope that helps, but I am not sure this is a task worth doing. If you start at the top of the list, and stop at the first "match" that sounds a bit like p-hacking.

Tim

-----Original Message-----
From: R-help <r-help-bounces at r-project.org> On Behalf Of JRG via R-help
Sent: Wednesday, October 26, 2022 10:01 AM
To: r-help at r-project.org
Subject: Re: [R] Function for Distribution Fitting

[External Email]

"all possible probability distributions"

I doubt that is a finite set.  To select "a bunch of them" would seem to imply a reduction of that set based on what's possible/promising/pertinent in your specific problem.  IMHO, what's the "most suitable distribution" tends to depend partly on knowledge of the subject matter of your problem.

Doesn't that put you back in your present situation?



---JRG




On 10/26/22 09:41, Paul Bernal wrote:
> Dear friends from the R community,
>
> Hope you are all doing great. So far, whenever I need to perform 
> distribution fitting on a particular dataset, I make use of R package 
> fitdistrplus.
>
> However, distribution fitting using the fitdist() function from 
> fitdistrplus is rather manual (you need to specify which probability 
> distribution you are trying to fit), and it would be more convenient 
> if the function tested all possible probability distributions (or a 
> bunch of them) and then estimates the parameters and suggests the most 
> suitable distribution.
>
> Is there any package besides fitdistrplus that does allow automatic 
> distribution fitting?
>
> Best regards,
> Paul
>
>       [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat
> .ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl
> .edu%7Cf7aa511782ff4d98a04908dab75aa2a0%7C0d4da0f84a314d76ace60a62331e
> 1b84%7C0%7C0%7C638023897166448945%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4w
> LjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C
> &amp;sdata=XS069Wk8JxeT4piBqA5JC3vtE2vu6uS8KTp1tqDIf7c%3D&amp;reserved
> =0 PLEASE do read the posting guide 
> https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r
> -project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%
> 7Cf7aa511782ff4d98a04908dab75aa2a0%7C0d4da0f84a314d76ace60a62331e1b84%
> 7C0%7C0%7C638023897166448945%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwM
> DAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;
> sdata=FZHNApQa2raJnbAgUZ544bH91EMtjSG7Ef47dMCoo3M%3D&amp;reserved=0
> and provide commented, minimal, self-contained, reproducible code.

______________________________________________
R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=05%7C01%7Ctebert%40ufl.edu%7Cf7aa511782ff4d98a04908dab75aa2a0%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638023897166448945%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=XS069Wk8JxeT4piBqA5JC3vtE2vu6uS8KTp1tqDIf7c%3D&amp;reserved=0
PLEASE do read the posting guide https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=05%7C01%7Ctebert%40ufl.edu%7Cf7aa511782ff4d98a04908dab75aa2a0%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638023897166448945%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=FZHNApQa2raJnbAgUZ544bH91EMtjSG7Ef47dMCoo3M%3D&amp;reserved=0
and provide commented, minimal, self-contained, reproducible code.


From gm@|om@ok|1980 @end|ng |rom gm@||@com  Wed Oct 26 19:37:12 2022
From: gm@|om@ok|1980 @end|ng |rom gm@||@com (=?UTF-8?Q?G=C3=A1bor_Malomsoki?=)
Date: Wed, 26 Oct 2022 19:37:12 +0200
Subject: [R] compile report error
In-Reply-To: <a67121b7-d838-b2ac-117a-09b4a8ff0288@sapo.pt>
References: <CAEJRAFb5kHC4VvfuC0vwiK_VjiGCMwhC4DtzRrkzqA_J5MUkTA@mail.gmail.com>
 <a67121b7-d838-b2ac-117a-09b4a8ff0288@sapo.pt>
Message-ID: <CAEJRAFbP8gbftSWWzZzfi9zVy2ROBkbsqp6JEDWfipAD0+Zv7A@mail.gmail.com>

Hello,

sure
dput(tomitettseg[10:15, c(1-8)])

structure(list(serial_number = c("3620000017126683", "3620000017126683",
"3620000017126683", "3620000017362605", "3620000017362605",
"3620000017362605"
), station_number = c(362060010081, 362060010081, 362060010081,
362060010081, 362060010081, 362060010081), station_desc = c("Dichtheits.-
Durchflusspr?fung M8.1",
"Dichtheits.- Durchflusspr?fung M8.1", "Dichtheits.- Durchflusspr?fung
M8.1",
"Dichtheits.- Durchflusspr?fung M8.1", "Dichtheits.- Durchflusspr?fung
M8.1",
"Dichtheits.- Durchflusspr?fung M8.1"), part_number = c(40005935L,
40005935L, 40005935L, 40005935L, 40005935L, 40005935L), book_date =
c("2019-01-15 07:49:58.467000000",
"2019-01-15 07:49:58.467000000", "2019-01-15 07:49:58.467000000",
"2019-01-15 07:58:18.403000000", "2019-01-15 07:58:18.403000000",
"2019-01-15 07:58:18.403000000"), measure_name = c("BlowBy (BlowBy)
Leckrate",
"BlowBy (BlowBy) Druck", "GESnA (GESnA) Leckrate", "BlowBy (BlowBy)
Leckrate",
"BlowBy (BlowBy) Druck", "GESnA (GESnA) Leckrate"), book_state = c(0L,
0L, 0L, 0L, 0L, 0L)), row.names = 10:15, class = "data.frame")



Am Mi., 26. Okt. 2022 um 19:05 Uhr schrieb Rui Barradas <
ruipbarradas at sapo.pt>:

> ?s 17:51 de 26/10/2022, G?bor Malomsoki escreveu:
> >   Dear all,
> >
> > Error in parse(text = x, keep.source = TRUE) :
> >    <text>:13:66: unexpected INCOMPLETE_STRING
> > 12:
> > 13: tomitettseg_GesNa$station_desc[tomitettseg_GesNa$station_desc ==
> > "Dichtheits.- Durchflusspr
> >
> > i get this error message when i try to compile the report.
> > i think this is because of the punktuation mark between the quotation
> marks
> > "." .
> > i do not know how to solve this, because with this column name i got the
> > csv,  and i am changing the column name in the script, not to have it so
> > long and avoid characters like .   ?  :
> >   tomitettseg_GesNa$station_desc[tomitettseg_GesNa$station_desc ==
> > "Dichtheits.- Durchflusspr?fung M8.1"] <-"D_D_"
> > thanks
> >
> > BR
> > Gabor
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.
>
> Hello,
>
> Can you post the output of dput(x)? Or of dput(x[10:15])?
>
> Hope this helps,
>
> Rui Barradas
>

	[[alternative HTML version deleted]]


From kt1572757 @end|ng |rom gm@||@com  Wed Oct 26 20:09:58 2022
From: kt1572757 @end|ng |rom gm@||@com (Kelly Thompson)
Date: Wed, 26 Oct 2022 14:09:58 -0400
Subject: [R] Best place to ask questions about non-R Base topics, ex. dplyr,
 dbplyr, etc. ?
Message-ID: <CAHfBD2e0u86_Wg9-zrmiSWEL9kCPOitkqyeCn2US65YMCO5nJw@mail.gmail.com>


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Wed Oct 26 21:12:18 2022
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Wed, 26 Oct 2022 12:12:18 -0700
Subject: [R] 
 Best place to ask questions about non-R Base topics, ex. dplyr,
 dbplyr, etc. ?
In-Reply-To: <CAHfBD2e0u86_Wg9-zrmiSWEL9kCPOitkqyeCn2US65YMCO5nJw@mail.gmail.com>
References: <CAHfBD2e0u86_Wg9-zrmiSWEL9kCPOitkqyeCn2US65YMCO5nJw@mail.gmail.com>
Message-ID: <0BA1A178-2879-4B2E-AD4F-8DE6101D6C31@dcn.davis.ca.us>

The general recommendation is to consult the contributed package web page on CRAN for a URL entry or other recommendation for support, e.g. [1]. Other forums include StackExchange for theory and StackOverflow for computing, and there are several sub-reddits on Reddit related to R.

[1] https://cran.r-project.org/package=dplyr

On October 26, 2022 11:09:58 AM PDT, Kelly Thompson <kt1572757 at gmail.com> wrote:
>
>______________________________________________
>R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>https://stat.ethz.ch/mailman/listinfo/r-help
>PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>and provide commented, minimal, self-contained, reproducible code.

-- 
Sent from my phone. Please excuse my brevity.


From gm@|om@ok|1980 @end|ng |rom gm@||@com  Wed Oct 26 21:19:12 2022
From: gm@|om@ok|1980 @end|ng |rom gm@||@com (=?UTF-8?Q?G=C3=A1bor_Malomsoki?=)
Date: Wed, 26 Oct 2022 21:19:12 +0200
Subject: [R] compile report error
In-Reply-To: <CAEJRAFbP8gbftSWWzZzfi9zVy2ROBkbsqp6JEDWfipAD0+Zv7A@mail.gmail.com>
References: <CAEJRAFb5kHC4VvfuC0vwiK_VjiGCMwhC4DtzRrkzqA_J5MUkTA@mail.gmail.com>
 <a67121b7-d838-b2ac-117a-09b4a8ff0288@sapo.pt>
 <CAEJRAFbP8gbftSWWzZzfi9zVy2ROBkbsqp6JEDWfipAD0+Zv7A@mail.gmail.com>
Message-ID: <CAEJRAFac0f+sKHMbH-k7uBkk2Na22OfBgTgwULM2WQRwJFMf2w@mail.gmail.com>

If i change the column name:
"Dichtheits.- Durchflusspr?fung M8.1"
In the csv to something else, like "x" then it works, but this is not the
elegant solution.


G?bor Malomsoki <gmalomsoki1980 at gmail.com> schrieb am Mi., 26. Okt. 2022,
19:37:

> Hello,
>
> sure
> dput(tomitettseg[10:15, c(1-8)])
>
> structure(list(serial_number = c("3620000017126683", "3620000017126683",
> "3620000017126683", "3620000017362605", "3620000017362605",
> "3620000017362605"
> ), station_number = c(362060010081, 362060010081, 362060010081,
> 362060010081, 362060010081, 362060010081), station_desc = c("Dichtheits.-
> Durchflusspr?fung M8.1",
> "Dichtheits.- Durchflusspr?fung M8.1", "Dichtheits.- Durchflusspr?fung
> M8.1",
> "Dichtheits.- Durchflusspr?fung M8.1", "Dichtheits.- Durchflusspr?fung
> M8.1",
> "Dichtheits.- Durchflusspr?fung M8.1"), part_number = c(40005935L,
> 40005935L, 40005935L, 40005935L, 40005935L, 40005935L), book_date =
> c("2019-01-15 07:49:58.467000000",
> "2019-01-15 07:49:58.467000000", "2019-01-15 07:49:58.467000000",
> "2019-01-15 07:58:18.403000000", "2019-01-15 07:58:18.403000000",
> "2019-01-15 07:58:18.403000000"), measure_name = c("BlowBy (BlowBy)
> Leckrate",
> "BlowBy (BlowBy) Druck", "GESnA (GESnA) Leckrate", "BlowBy (BlowBy)
> Leckrate",
> "BlowBy (BlowBy) Druck", "GESnA (GESnA) Leckrate"), book_state = c(0L,
> 0L, 0L, 0L, 0L, 0L)), row.names = 10:15, class = "data.frame")
>
>
>
> Am Mi., 26. Okt. 2022 um 19:05 Uhr schrieb Rui Barradas <
> ruipbarradas at sapo.pt>:
>
>> ?s 17:51 de 26/10/2022, G?bor Malomsoki escreveu:
>> >   Dear all,
>> >
>> > Error in parse(text = x, keep.source = TRUE) :
>> >    <text>:13:66: unexpected INCOMPLETE_STRING
>> > 12:
>> > 13: tomitettseg_GesNa$station_desc[tomitettseg_GesNa$station_desc ==
>> > "Dichtheits.- Durchflusspr
>> >
>> > i get this error message when i try to compile the report.
>> > i think this is because of the punktuation mark between the quotation
>> marks
>> > "." .
>> > i do not know how to solve this, because with this column name i got the
>> > csv,  and i am changing the column name in the script, not to have it so
>> > long and avoid characters like .   ?  :
>> >   tomitettseg_GesNa$station_desc[tomitettseg_GesNa$station_desc ==
>> > "Dichtheits.- Durchflusspr?fung M8.1"] <-"D_D_"
>> > thanks
>> >
>> > BR
>> > Gabor
>> >
>> >       [[alternative HTML version deleted]]
>> >
>> > ______________________________________________
>> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> > https://stat.ethz.ch/mailman/listinfo/r-help
>> > PLEASE do read the posting guide
>> http://www.R-project.org/posting-guide.html
>> > and provide commented, minimal, self-contained, reproducible code.
>>
>> Hello,
>>
>> Can you post the output of dput(x)? Or of dput(x[10:15])?
>>
>> Hope this helps,
>>
>> Rui Barradas
>>
>

	[[alternative HTML version deleted]]


From er|cjberger @end|ng |rom gm@||@com  Wed Oct 26 21:39:01 2022
From: er|cjberger @end|ng |rom gm@||@com (Eric Berger)
Date: Wed, 26 Oct 2022 22:39:01 +0300
Subject: [R] 
 Best place to ask questions about non-R Base topics, ex. dplyr,
 dbplyr, etc. ?
In-Reply-To: <0BA1A178-2879-4B2E-AD4F-8DE6101D6C31@dcn.davis.ca.us>
References: <CAHfBD2e0u86_Wg9-zrmiSWEL9kCPOitkqyeCn2US65YMCO5nJw@mail.gmail.com>
 <0BA1A178-2879-4B2E-AD4F-8DE6101D6C31@dcn.davis.ca.us>
Message-ID: <CAGgJW76-TSEiM5m=dz7q_s_CHc3XT5uzGA7MGSVBei=Wk3J0FA@mail.gmail.com>

Also, since your examples were dplyr and dbplyr which are associated
with RStudio.com (aka Posit) you might also try

https://community.rstudio.com

You can apply filters on that site to narrow the results



On Wed, Oct 26, 2022 at 10:12 PM Jeff Newmiller
<jdnewmil at dcn.davis.ca.us> wrote:
>
> The general recommendation is to consult the contributed package web page on CRAN for a URL entry or other recommendation for support, e.g. [1]. Other forums include StackExchange for theory and StackOverflow for computing, and there are several sub-reddits on Reddit related to R.
>
> [1] https://cran.r-project.org/package=dplyr
>
> On October 26, 2022 11:09:58 AM PDT, Kelly Thompson <kt1572757 at gmail.com> wrote:
> >
> >______________________________________________
> >R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> >https://stat.ethz.ch/mailman/listinfo/r-help
> >PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> >and provide commented, minimal, self-contained, reproducible code.
>
> --
> Sent from my phone. Please excuse my brevity.
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Wed Oct 26 22:08:09 2022
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Wed, 26 Oct 2022 21:08:09 +0100
Subject: [R] compile report error
In-Reply-To: <CAEJRAFac0f+sKHMbH-k7uBkk2Na22OfBgTgwULM2WQRwJFMf2w@mail.gmail.com>
References: <CAEJRAFb5kHC4VvfuC0vwiK_VjiGCMwhC4DtzRrkzqA_J5MUkTA@mail.gmail.com>
 <a67121b7-d838-b2ac-117a-09b4a8ff0288@sapo.pt>
 <CAEJRAFbP8gbftSWWzZzfi9zVy2ROBkbsqp6JEDWfipAD0+Zv7A@mail.gmail.com>
 <CAEJRAFac0f+sKHMbH-k7uBkk2Na22OfBgTgwULM2WQRwJFMf2w@mail.gmail.com>
Message-ID: <f868fccd-0444-9929-2e63-9ed2214d27d8@sapo.pt>

?s 20:19 de 26/10/2022, G?bor Malomsoki escreveu:
> If i change the column name:
> "Dichtheits.- Durchflusspr?fung M8.1"
> In the csv to something else, like "x" then it works, but this is not the
> elegant solution.
> 
> 
> G?bor Malomsoki <gmalomsoki1980 at gmail.com> schrieb am Mi., 26. Okt. 2022,
> 19:37:
> 
>> Hello,
>>
>> sure
>> dput(tomitettseg[10:15, c(1-8)])
>>
>> structure(list(serial_number = c("3620000017126683", "3620000017126683",
>> "3620000017126683", "3620000017362605", "3620000017362605",
>> "3620000017362605"
>> ), station_number = c(362060010081, 362060010081, 362060010081,
>> 362060010081, 362060010081, 362060010081), station_desc = c("Dichtheits.-
>> Durchflusspr?fung M8.1",
>> "Dichtheits.- Durchflusspr?fung M8.1", "Dichtheits.- Durchflusspr?fung
>> M8.1",
>> "Dichtheits.- Durchflusspr?fung M8.1", "Dichtheits.- Durchflusspr?fung
>> M8.1",
>> "Dichtheits.- Durchflusspr?fung M8.1"), part_number = c(40005935L,
>> 40005935L, 40005935L, 40005935L, 40005935L, 40005935L), book_date =
>> c("2019-01-15 07:49:58.467000000",
>> "2019-01-15 07:49:58.467000000", "2019-01-15 07:49:58.467000000",
>> "2019-01-15 07:58:18.403000000", "2019-01-15 07:58:18.403000000",
>> "2019-01-15 07:58:18.403000000"), measure_name = c("BlowBy (BlowBy)
>> Leckrate",
>> "BlowBy (BlowBy) Druck", "GESnA (GESnA) Leckrate", "BlowBy (BlowBy)
>> Leckrate",
>> "BlowBy (BlowBy) Druck", "GESnA (GESnA) Leckrate"), book_state = c(0L,
>> 0L, 0L, 0L, 0L, 0L)), row.names = 10:15, class = "data.frame")
>>
>>
>>
>> Am Mi., 26. Okt. 2022 um 19:05 Uhr schrieb Rui Barradas <
>> ruipbarradas at sapo.pt>:
>>
>>> ?s 17:51 de 26/10/2022, G?bor Malomsoki escreveu:
>>>>    Dear all,
>>>>
>>>> Error in parse(text = x, keep.source = TRUE) :
>>>>     <text>:13:66: unexpected INCOMPLETE_STRING
>>>> 12:
>>>> 13: tomitettseg_GesNa$station_desc[tomitettseg_GesNa$station_desc ==
>>>> "Dichtheits.- Durchflusspr
>>>>
>>>> i get this error message when i try to compile the report.
>>>> i think this is because of the punktuation mark between the quotation
>>> marks
>>>> "." .
>>>> i do not know how to solve this, because with this column name i got the
>>>> csv,  and i am changing the column name in the script, not to have it so
>>>> long and avoid characters like .   ?  :
>>>>    tomitettseg_GesNa$station_desc[tomitettseg_GesNa$station_desc ==
>>>> "Dichtheits.- Durchflusspr?fung M8.1"] <-"D_D_"
>>>> thanks
>>>>
>>>> BR
>>>> Gabor
>>>>
>>>>        [[alternative HTML version deleted]]
>>>>
>>>> ______________________________________________
>>>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>>> PLEASE do read the posting guide
>>> http://www.R-project.org/posting-guide.html
>>>> and provide commented, minimal, self-contained, reproducible code.
>>>
>>> Hello,
>>>
>>> Can you post the output of dput(x)? Or of dput(x[10:15])?
>>>
>>> Hope this helps,
>>>
>>> Rui Barradas
>>>
>>
> 

Hello,

Are you looking for this?



df1 <-
   structure(list(
     serial_number = c("3620000017126683", "3620000017126683",
                       "3620000017126683", "3620000017362605",
                       "3620000017362605", "3620000017362605"),
     station_number = c(362060010081, 362060010081, 362060010081,
                        362060010081, 362060010081, 362060010081),
     station_desc = c("Dichtheits.- Durchflusspr?fung M8.1",
                      "Dichtheits.- Durchflusspr?fung M8.1",
                      "Dichtheits.- Durchflusspr?fung M8.1",
                      "Dichtheits.- Durchflusspr?fung M8.1",
                      "Dichtheits.- Durchflusspr?fung M8.1",
                      "Dichtheits.- Durchflusspr?fung M8.1"),
     part_number = c(40005935L, 40005935L, 40005935L, 40005935L, 
40005935L, 40005935L),
     book_date = c("2019-01-15 07:49:58.467000000", "2019-01-15 
07:49:58.467000000",
                   "2019-01-15 07:49:58.467000000", "2019-01-15 
07:58:18.403000000",
                   "2019-01-15 07:58:18.403000000", "2019-01-15 
07:58:18.403000000"),
     measure_name = c("BlowBy (BlowBy) Leckrate", "BlowBy (BlowBy) Druck",
                      "GESnA (GESnA) Leckrate", "BlowBy (BlowBy) Leckrate",
                      "BlowBy (BlowBy) Druck", "GESnA (GESnA) Leckrate"),
     book_state = c(0L,0L, 0L, 0L, 0L, 0L)),
     row.names = 10:15, class = "data.frame")

parse(text = df1, keep.source = TRUE)
#> expression(c("3620000017126683", "3620000017126683", 
"3620000017126683", "3620000017362605", "3620000017362605", 
"3620000017362605"),
#>     c(362060010081, 362060010081, 362060010081, 362060010081, 
362060010081, 362060010081),
#>     c("Dichtheits.- Durchflusspr?fung M8.1", "Dichtheits.- 
Durchflusspr?fung M8.1", "Dichtheits.- Durchflusspr?fung M8.1", 
"Dichtheits.- Durchflusspr?fung M8.1", "Dichtheits.- Durchflusspr?fung 
M8.1", "Dichtheits.- Durchflusspr?fung M8.1"),
#>     c(40005935, 40005935, 40005935, 40005935, 40005935, 40005935),
#>     c("2019-01-15 07:49:58.467000000", "2019-01-15 
07:49:58.467000000", "2019-01-15 07:49:58.467000000", "2019-01-15 
07:58:18.403000000", "2019-01-15 07:58:18.403000000", "2019-01-15 
07:58:18.403000000"),
#>     c("BlowBy (BlowBy) Leckrate", "BlowBy (BlowBy) Druck", "GESnA 
(GESnA) Leckrate", "BlowBy (BlowBy) Leckrate", "BlowBy (BlowBy) Druck", 
"GESnA (GESnA) Leckrate"),
#>     c(0, 0, 0, 0, 0, 0))


No errors, outputs an object of class "expression", as expected.
But I had to edit manually to remove the newline characters that came 
with it.

Hope this helps,

Rui Barradas


From re|chm@nj @end|ng |rom @bcg|ob@|@net  Wed Oct 26 22:37:09 2022
From: re|chm@nj @end|ng |rom @bcg|ob@|@net (Jeff Reichman)
Date: Wed, 26 Oct 2022 15:37:09 -0500
Subject: [R] Color Nodes
References: <008b01d8e97a$b919d730$2b4d8590$.ref@sbcglobal.net>
Message-ID: <008b01d8e97a$b919d730$2b4d8590$@sbcglobal.net>

R-Help

 

For those of you who use igraph is there a way to highlight (color)
particular notes. For example if I want to color the "Peter" node red and
everything else blue  or leave default) how would I do that or can I do
that. Seems as though I might create an attribute column - maybe??

 

Jeff

 

library(igraph)

 

# define links in data

edges <- rbind(c("Dave", "Jenny"), c("Peter", "Jenny"), c("John", "Jenny"),
c("Dave", "Peter"), c("Dave", "John"), c("Peter", "Sam"), c("Sam",
"Albert"), c("Peter", "John"))

 

# generate and plot graph

# set argument directed = FALSE in graph.edgelist() to plot an undirected
graph.

g <- graph.edgelist(edges, directed = FALSE)

plot(g, vertex.size = 1, vertex.label.dist = 0.5)


	[[alternative HTML version deleted]]


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Wed Oct 26 23:39:55 2022
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Wed, 26 Oct 2022 22:39:55 +0100
Subject: [R] Color Nodes
In-Reply-To: <008b01d8e97a$b919d730$2b4d8590$@sbcglobal.net>
References: <008b01d8e97a$b919d730$2b4d8590$.ref@sbcglobal.net>
 <008b01d8e97a$b919d730$2b4d8590$@sbcglobal.net>
Message-ID: <e536cd35-3bcd-01e5-e995-72336e7bab7e@sapo.pt>

?s 21:37 de 26/10/2022, Jeff Reichman escreveu:
> R-Help
> 
>   
> 
> For those of you who use igraph is there a way to highlight (color)
> particular notes. For example if I want to color the "Peter" node red and
> everything else blue  or leave default) how would I do that or can I do
> that. Seems as though I might create an attribute column - maybe??
> 
>   
> 
> Jeff
> 
>   
> 
> library(igraph)
> 
>   
> 
> # define links in data
> 
> edges <- rbind(c("Dave", "Jenny"), c("Peter", "Jenny"), c("John", "Jenny"),
> c("Dave", "Peter"), c("Dave", "John"), c("Peter", "Sam"), c("Sam",
> "Albert"), c("Peter", "John"))
> 
>   
> 
> # generate and plot graph
> 
> # set argument directed = FALSE in graph.edgelist() to plot an undirected
> graph.
> 
> g <- graph.edgelist(edges, directed = FALSE)
> 
> plot(g, vertex.size = 1, vertex.label.dist = 0.5)
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.

Hello,

After creating the graph, set the vertices colors by subsetting V(g).
Here are two exaples, the first color Peter red and leave the others 
with their default color. The second, color the other vertices blue.



V(g)["Peter"]$color <- "red"

plot(g, vertex.size = 20, vertex.label.dist = 0.5,
      vertex.color = V(g)$color)

V(g)$color <- "blue"
V(g)["Peter"]$color <- "red"
plot(g, vertex.size = 20, vertex.label.dist = 0.5,
      vertex.color = V(g)$color)



Hope this helps,

Rui Barradas


From re|chm@nj @end|ng |rom @bcg|ob@|@net  Thu Oct 27 00:51:20 2022
From: re|chm@nj @end|ng |rom @bcg|ob@|@net (Jeff Reichman)
Date: Wed, 26 Oct 2022 17:51:20 -0500
Subject: [R] Color Nodes
In-Reply-To: <e536cd35-3bcd-01e5-e995-72336e7bab7e@sapo.pt>
References: <008b01d8e97a$b919d730$2b4d8590$.ref@sbcglobal.net>
 <008b01d8e97a$b919d730$2b4d8590$@sbcglobal.net>
 <e536cd35-3bcd-01e5-e995-72336e7bab7e@sapo.pt>
Message-ID: <013c01d8e98d$77e422d0$67ac6870$@sbcglobal.net>

Yes Rui that will work for my needs thank you

-----Original Message-----
From: Rui Barradas <ruipbarradas at sapo.pt> 
Sent: Wednesday, October 26, 2022 4:40 PM
To: reichmanj at sbcglobal.net; R-help at r-project.org
Subject: Re: [R] Color Nodes

?s 21:37 de 26/10/2022, Jeff Reichman escreveu:
> R-Help
> 
>   
> 
> For those of you who use igraph is there a way to highlight (color) 
> particular notes. For example if I want to color the "Peter" node red 
> and everything else blue  or leave default) how would I do that or can 
> I do that. Seems as though I might create an attribute column - maybe??
> 
>   
> 
> Jeff
> 
>   
> 
> library(igraph)
> 
>   
> 
> # define links in data
> 
> edges <- rbind(c("Dave", "Jenny"), c("Peter", "Jenny"), c("John", 
> "Jenny"), c("Dave", "Peter"), c("Dave", "John"), c("Peter", "Sam"), 
> c("Sam", "Albert"), c("Peter", "John"))
> 
>   
> 
> # generate and plot graph
> 
> # set argument directed = FALSE in graph.edgelist() to plot an 
> undirected graph.
> 
> g <- graph.edgelist(edges, directed = FALSE)
> 
> plot(g, vertex.size = 1, vertex.label.dist = 0.5)
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see 
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide 
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.

Hello,

After creating the graph, set the vertices colors by subsetting V(g).
Here are two exaples, the first color Peter red and leave the others with their default color. The second, color the other vertices blue.



V(g)["Peter"]$color <- "red"

plot(g, vertex.size = 20, vertex.label.dist = 0.5,
      vertex.color = V(g)$color)

V(g)$color <- "blue"
V(g)["Peter"]$color <- "red"
plot(g, vertex.size = 20, vertex.label.dist = 0.5,
      vertex.color = V(g)$color)



Hope this helps,

Rui Barradas


